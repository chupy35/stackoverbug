31677563
Connection refused error on Elastic Search
<p>When I tried connecting to Elastic Search using the &#xA;<code>curl http://localhost:9200</code> it is working fine.</p>&#xA;&#xA;<p>But when I run the <code>curl http://IpAddress:9200</code> it is throwing an error saying <code>connection refused port 9200</code>.</p>&#xA;&#xA;<p>How to resolve this error?</p>&#xA;
<p>By default it should bind to all local addresses. So, assuming you don't have a network layer issue with firewalls, the only ES setting I can think to check is <code>network.bind_host</code> and make sure it is either not set or is set to <code>0.0.0.0</code> or <code>::0</code> or to the correct IP address for your network.</p>&#xA;&#xA;<p>Update: per comments in ES 2.3 you should set <code>network.host</code> instead. </p>&#xA;
<p>Edit <code>/etc/elasticsearch/elasticsearch.yml</code> and add the following line:</p>&#xA;&#xA;<pre>network.host: 0.0.0.0</pre>&#xA;&#xA;<p>This will "unset" this parameter and will allow connections from other IPs.</p>&#xA;
<pre><code>OpenJDK 64-Bit Server VM warning: INFO: os::commit_memory(0x0000000085330000, 2060255232, 0) failed; error='Cannot allocate memory' (errno=12)&#xA;</code></pre>&#xA;&#xA;<p>be sure that the server is started. I've seen this problem when my virtual machine had too litle RAM and es could not start.</p>&#xA;&#xA;<pre><code>sudo systemctl status elasticsearch&#xA;</code></pre>&#xA;&#xA;<p>the above will show you if es is indeed running.</p>&#xA;
<p>In my case elasticsearch was started.&#xA;But still had </p>&#xA;&#xA;<pre><code>curl: (7) Failed to connect to localhost port 9200: Connection refused&#xA;</code></pre>&#xA;&#xA;<p>The following command was unsuccessful</p>&#xA;&#xA;<pre><code>sudo service elasticsearch restart&#xA;</code></pre>&#xA;&#xA;<p>In order to make it work, I had to run instead</p>&#xA;&#xA;<pre><code>sudo systemctl restart elasticsearch&#xA;</code></pre>&#xA;&#xA;<p>Then it went all fine.</p>&#xA;
<p>In this case, first of all you need to check the java version using below command:</p>&#xA;&#xA;<pre><code>java -version&#xA;</code></pre>&#xA;&#xA;<p>after running this command you get something like this: </p>&#xA;&#xA;<blockquote>&#xA;  <p>java version "1.7.0_51"&#xA;  OpenJDK Runtime Environment (rhel-2.4.5.5.el7-x86_64 u51-b31)&#xA;  OpenJDK 64-Bit Server VM (build 24.51-b03, mixed mode)</p>&#xA;</blockquote>&#xA;&#xA;<p>then use this command:</p>&#xA;&#xA;<pre><code>update-alternatives --config java&#xA;</code></pre>&#xA;&#xA;<p>and select the below version</p>&#xA;&#xA;<blockquote>&#xA;  <p>*+ 1           /usr/lib/jvm/java-1.7.0-openjdk-1.7.0.51-2.4.5.5.el7.x86_64/jre/bin/java&#xA;     2           /usr/java/jdk1.8.0_73/jre/bin/java</p>&#xA;</blockquote>&#xA;&#xA;<p>Enter to keep the current selection[+], or type selection number: 2</p>&#xA;&#xA;<pre><code>curl -XGET http://127.0.0.1:9200&#xA;</code></pre>&#xA;
<p>Open your <strong>Dockerfile</strong> under <strong>elasticsearch</strong> folder and update <strong>"network.host=0.0.0.0"</strong> with <strong>"network.host=127.0.0.1"</strong>. Then restart the container. Check your connection with curl.</p>&#xA;&#xA;<pre><code>$ curl http://docker-machine-ip:9200&#xA;{&#xA;  "name" : "vI6Zq_D",&#xA;  "cluster_name" : "elasticsearch",&#xA;  "cluster_uuid" : "hhyB_Wa4QwSX6zZd1F894Q",&#xA;  "version" : {&#xA;    "number" : "5.2.0",&#xA;    "build_hash" : "24e05b9",&#xA;    "build_date" : "2017-01-24T19:52:35.800Z",&#xA;    "build_snapshot" : false,&#xA;    "lucene_version" : "6.4.0"&#xA;  },&#xA;  "tagline" : "You Know, for Search"&#xA;}&#xA;</code></pre>&#xA;
<p>For this problem, I had to use : &#xA;<code>sudo /usr/share/elasticsearch/bin/elasticsearch start</code></p>&#xA;&#xA;<p>to be able to get something on ports 9200/9300 (sudo netstat -ntlp) and a response to:</p>&#xA;&#xA;<p><code>curl -XGET <a href="http://localhost:9200" rel="noreferrer">http://localhost:9200</a></code></p>&#xA;
<p>I had the same problem refusing connections on 9200 port.&#xA;Check elasticsearch service status with the command <code>sudo service elasticsearch status</code>. If it is presenting an error and you read anything related to Java, probably the problem is your jvm memory. You can edit it in <code>/etc/elasticsearch/jvm.options</code>. For a 1GB RAM memory machine on Amazon environment, I kept my configuration on:</p>&#xA;&#xA;<pre><code>-Xms128m&#xA;-Xmx128m&#xA;</code></pre>&#xA;&#xA;<p>After setting that and restarting elasticsearch service, it worked like a charm. Nmap and UFW (if you use local firewall) checking should also be useful.</p>&#xA;
<p>Tried everything on this page, and only instructions from <a href="https://lxadm.com/Problems_starting_elasticsearch_in_Ubuntu_16.04" rel="noreferrer">here</a> helped.</p>&#xA;&#xA;<p>in <code>/etc/default/elasticsearch</code>, make sure these are un-commented:</p>&#xA;&#xA;<pre><code>START_DAEMON=true&#xA;ES_USER=elasticsearch&#xA;ES_GROUP=elasticsearch&#xA;LOG_DIR=/var/log/elasticsearch&#xA;DATA_DIR=/var/lib/elasticsearch&#xA;WORK_DIR=/tmp/elasticsearch&#xA;CONF_DIR=/etc/elasticsearch&#xA;CONF_FILE=/etc/elasticsearch/elasticsearch.yml&#xA;RESTART_ON_UPGRADE=true&#xA;</code></pre>&#xA;&#xA;<p>make sure <code>/var/lib/elasticsearch</code> is owned by elasticsearch user:</p>&#xA;&#xA;<pre><code>chown -R elasticsearch:elasticsearch /var/lib/elasticsearch/&#xA;</code></pre>&#xA;
<p>Why don't you start with this command-line:</p>&#xA;&#xA;<pre><code>$ sudo service elasticsearch status&#xA;</code></pre>&#xA;&#xA;<p>I did it and get:</p>&#xA;&#xA;<pre><code>"There is insufficient memory for the Java Runtime..."&#xA;</code></pre>&#xA;&#xA;<p>Then I edited <code>/etc/elasticsearch/jvm.options</code> file:</p>&#xA;&#xA;<pre><code>...&#xA;&#xA;################################################################&#xA;&#xA;# Xms represents the initial size of total heap space&#xA;# Xmx represents the maximum size of total heap space&#xA;&#xA;#-Xms2g&#xA;#-Xms2g&#xA;&#xA;-Xms512m&#xA;-Xmx512m&#xA;&#xA;################################################################&#xA;&#xA;...&#xA;</code></pre>&#xA;&#xA;<p>This worked like a charm.</p>&#xA;
<p>My 2 cents,</p>&#xA;&#xA;<p>I just followed the install procedure on Digital Ocean, apparently the package available in the repos is not up to date, I deleted everything and followed the install procedure direct from Elastic Search and everything is working now, basically the out of the box behaviour is on a localhost pointing to 9200. Same thing/issue found with Kibana, the solution for me was too, to remove everything and just follow their procedure, Hope this saves someone two hours (the time I spent figuring out how to setup ELK!)</p>&#xA;&#xA;<p>en</p>&#xA;
<p>None of the proposed solutions here worked for me, but what eventually got it working was adding the following to <code>elasticsearch.yml</code></p>&#xA;&#xA;<pre><code>network:&#xA;  host: 0.0.0.0&#xA;http:&#xA;  port: 9200&#xA;</code></pre>&#xA;&#xA;<p>After that, I restarted the service and now I can <code>curl</code> it from both within the VM and externally. For some odd reason, I had to try a few different variants of a <code>curl</code> call <em>inside</em> the VM before it worked:</p>&#xA;&#xA;<pre><code>curl localhost:9200&#xA;curl http://localhost:9200&#xA;curl 127.0.0.1:9200&#xA;</code></pre>&#xA;&#xA;<p>Note: I'm using Elasticsearch 5.5 on Ubuntu 14.04</p>&#xA;
<p>After utilizing some of the answers above, don't forget that after an apt install, a total reboot might be in order.</p>&#xA;
<p>Just to add on this, I've came across many docs through google that said to set network.host to localhost.</p>&#xA;&#xA;<p>Doing so gave me the infamous connection refused. You must use an IP address (127.0.0.1), not a FQDN.</p>&#xA;&#xA;<p>Jeff</p>&#xA;
<p>Update your jdk to latest minimum version for your elasticsearch.</p>&#xA;