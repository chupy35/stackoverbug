30650825
To find difference between two integer fields and check it falls under a specific range, using scripts in elasticsearch
<p>I have two fields,let us name them "fieldA" and "fieldB" in my documents and i need to find the difference between them and check if that value falls under a specific range say "rangeA" or " rangeB" and then return the documents that matches my criteria.&#xA;The schema for data is as shown below:</p>&#xA;&#xA;<pre><code>{&#xA;"fieldA": 45&#xA;"fieldB":13&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>I need to find all the document which have the difference between "fieldA" and "fieldB" in between 30 and 35. How can i do this using scripting in elasticsearch?</p>&#xA;
<pre><code>{&#xA;  "query": {&#xA;    "filtered": {&#xA;      "filter": {&#xA;        "script": {&#xA;          "script": "difference=doc['fieldA'].value-doc['fieldB'].value;return (difference&gt;param1 &amp;&amp; difference&lt;param2);",&#xA;          "params": {&#xA;            "param1":30,&#xA;            "param2":35&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;
<p>This can also be done using aggregations and scripts like below:</p>&#xA;&#xA;<pre><code>{&#xA;   "aggregations": {&#xA;      "age_diff": {&#xA;         "range": {&#xA;            "script": "doc[\"fieldA\"].value - doc[\"fieldB\"].value",&#xA;            "ranges": [&#xA;               {&#xA;                  "from": 30,&#xA;                  "to": 35&#xA;               }&#xA;            ]&#xA;         }&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>This way you can just check how many documents falls under the specified range.But if you want to get the documents under the aggregations you can use "top_hits" aggregations.</p>&#xA;&#xA;<p>More detailed discussion on aggregations can be found <a href="http://blog.qbox.io/elasticsearch-aggregations" rel="nofollow">here</a> and more about "top_hits" can be found in detail <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics-top-hits-aggregation.html" rel="nofollow">here</a></p>&#xA;