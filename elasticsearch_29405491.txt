29405491
Elastic Search SUM of aggregated values
<p>We are using elastic search to get some statics. </p>&#xA;&#xA;<ol>&#xA;<li>I need to get average values for each group.</li>&#xA;<li>Sum all this values</li>&#xA;</ol>&#xA;&#xA;<p>So far, step no. 1 was pretty straight forward. However I really don't know how to sum all values at the end. Is this possible? If yes, how?.</p>&#xA;&#xA;<p>Thanks for suggestions.&#xA;Here is my aggs query > </p>&#xA;&#xA;<pre><code>{  &#xA;   "query":{  &#xA;      "filtered":{  &#xA;         "query":{  &#xA;            "query_string":{  &#xA;               "analyze_wildcard":true,&#xA;               "query":"*"&#xA;            }&#xA;         }&#xA;      }&#xA;   },&#xA;   "aggs":{  &#xA;      "2":{  &#xA;         "terms":{  &#xA;            "field":"person",&#xA;            "size":5000,&#xA;            "order":{  &#xA;               "1":"desc"&#xA;            }&#xA;         },&#xA;         "aggs":{  &#xA;            "1":{  &#xA;               "avg":{  &#xA;                  "field":"company"&#xA;               }&#xA;            }&#xA;         }&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;
<p>Aggregating over aggregation results are not yet supported in elasticsearch. Apparently there is a concept called <a href="https://github.com/elastic/elasticsearch/issues/8110" rel="nofollow noreferrer">reducers</a> that are being developed for 2.0.  I would suggest having a look at <a href="http://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics-scripted-metric-aggregation.html" rel="nofollow noreferrer">scripted metric aggregations</a>. Basically, you can create your own aggregation by controlling the collection and computation aspects yourself using scripts.</p>&#xA;&#xA;<p>Alternatively, if possible you can precompute and store the average when indexing and then use the sum aggregation when querying. </p>&#xA;&#xA;<p>Have a look at the following question for an example of this aggregation: <a href="https://stackoverflow.com/questions/26992154/elasticsearch-possible-to-process-aggregation-results">Elasticsearch: Possible to process aggregation results?</a></p>&#xA;