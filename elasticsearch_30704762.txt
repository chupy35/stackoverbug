30704762
Elasticsearch Filter by day of week
<p>I have the following document structure:</p>&#xA;&#xA;<pre><code>{&#xA;    "@version" : "1",&#xA;    "@timestamp" : "2015-05-25T13:31:43.848Z",&#xA;    "type" : "myevent",&#xA;    "value": 1&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Is it possible to query all documents that occured on a Sunday?</p>&#xA;
<p>You can try to query it with a <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-script-filter.html" rel="nofollow"><code>script</code> filter</a> like this:</p>&#xA;&#xA;<pre><code>curl -XPOST localhost:9200/your_index/_search -d'&#xA;{&#xA;  "query": {&#xA;    "filtered": {&#xA;      "filter": {&#xA;        "script": {&#xA;          "script": "doc['@timestamp'].date.dayOfWeek == 7"&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}'&#xA;</code></pre>&#xA;&#xA;<p>Note that you need to make sure dynamic scripting is enabled by adding this to your <code>elasticsearch.yml</code> configuration</p>&#xA;&#xA;<pre><code>script.disable_dynamic: false&#xA;</code></pre>&#xA;
<p>Or, if you don't want to <a href="https://www.elastic.co/blog/running-groovy-scripts-without-dynamic-scripting" rel="nofollow">enable dynamic scripting</a> because of <a href="https://github.com/elastic/elasticsearch/issues/9655" rel="nofollow">this</a> use a script file:</p>&#xA;&#xA;<pre><code>{&#xA;  "query": {&#xA;    "filtered": {&#xA;      "filter": {&#xA;        "script": {&#xA;          "script_file": "my_date_script",&#xA;          "params": {&#xA;            "some_day": 7&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>where <code>my_date_script.groovy</code> should be placed under <code>/config/scripts</code> and its content should look like this:</p>&#xA;&#xA;<pre><code>def day = doc['@timestamp'].date.dayOfWeek; day == some_day&#xA;</code></pre>&#xA;&#xA;<p>Or, as I mentioned in my comment, for faster queries (since scripts are not particularly fast) index the day of the week in the index and directly query that.</p>&#xA;