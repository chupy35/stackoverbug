33508044
Elasticsearch: Filtering by date and time as different fields
<p>I am trying to create a filter for my query using a date range and a time range. In my case, date and time are different fields. So I want to run queries like: Show me all the events happening this month (15-10-01/15-10-30) between 10:00:00 am and 12:00:00</p>&#xA;&#xA;<p>This is my query, but it is not working. Note: If I only use the "date part" it works, but with the combination of the time field, the results are wrong.</p>&#xA;&#xA;<p>Any suggestion?</p>&#xA;&#xA;<pre><code>{"query": {&#xA;    "filtered": {&#xA;         "query": {&#xA;             "match": { "message" : "error" }&#xA;         },&#xA;         "filter": {&#xA;             "bool" : {&#xA;                 "must" : {&#xA;                     "range": {&#xA;                         "date": {&#xA;                             "gte": "15-11-01",&#xA;                             "lte": "15-11-30"&#xA;                         }&#xA;                     }&#xA;                 },&#xA;                 "must" : {&#xA;                     "range": {&#xA;                         "time": {&#xA;                             "gte": "10:00:00",&#xA;                             "lte": "12:00:00"&#xA;                         }&#xA;                 }&#xA;             }&#xA;         }&#xA;     }&#xA;  }&#xA;}&#xA;}&#xA;</code></pre>&#xA;&#xA;<p><strong>Update:</strong> Running the command: </p>&#xA;&#xA;<pre><code>curl -XGET localhost:9200/my_index/_mapping&#xA;</code></pre>&#xA;&#xA;<p>As some of you suggested, I could discover that ES is defining the "time" field type as string and not as (date) time.&#xA;Additionally, as it was pointed in the first answer, my query syntax was wrong.</p>&#xA;
<p>One thing that is not correct is that you have two <code>must</code> clause inside your <code>bool</code> filter. That is not valid JSON and so that might be the reason why your query doesn't work, try the following query instead which has the two <code>range</code> filters inside the <code>bool/must</code> filter:</p>&#xA;&#xA;<pre><code>{&#xA;  "query": {&#xA;    "filtered": {&#xA;      "query": {&#xA;        "match": {&#xA;          "message": "error"&#xA;        }&#xA;      },&#xA;      "filter": {&#xA;        "bool": {&#xA;          "must": [&#xA;            {&#xA;              "range": {&#xA;                "date": {&#xA;                  "gte": "15-11-01",&#xA;                  "lte": "15-11-30"&#xA;                }&#xA;              }&#xA;            },&#xA;            {&#xA;              "range": {&#xA;                "time": {&#xA;                  "gte": "10:00:00",&#xA;                  "lte": "12:00:00"&#xA;                }&#xA;              }&#xA;            }&#xA;          ]&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;