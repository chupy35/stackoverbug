30829603
ElasticSearch - Reindex to add doc_value
<h1>What am I trying to do?</h1>&#xA;&#xA;<p>Add doc_type to an existing index.</p>&#xA;&#xA;<h1>What have I tried?</h1>&#xA;&#xA;<h2>Created index and document</h2>&#xA;&#xA;<pre><code>POST /my_index-1/my_type/1&#xA;{&#xA;    "my_prop": "my_value"&#xA;}&#xA;</code></pre>&#xA;&#xA;<h2>Added a template</h2>&#xA;&#xA;<pre><code>PUT /_template/my_template&#xA;{&#xA;    "id": "my_template",&#xA;    "template": "my_index-*",&#xA;    "mappings": {&#xA;        "_default_": {&#xA;            "dynamic_templates": [&#xA;                {&#xA;                    "my_prop_template": {&#xA;                        "mapping": {&#xA;                            "index": "not_analyzed",&#xA;                            "doc_values": true,&#xA;                            "fielddata": {&#xA;                                "format": "doc_values"&#xA;                            },&#xA;                            "type": "string"&#xA;                        },&#xA;                        "match": "my_prop",&#xA;                        "match_mapping_type": "string"&#xA;                    }&#xA;                }&#xA;            ]&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<h2>Reindexed</h2>&#xA;&#xA;<pre><code>./stream2es es --source http://localhost:9200/my_index-1 --target http://localhost:9200/my_index-2&#xA;</code></pre>&#xA;&#xA;<h1>What went wrong?</h1>&#xA;&#xA;<p>In the new index <code>my_index-2</code> the property did not receive <code>"doc_values": true</code>:</p>&#xA;&#xA;<pre><code>...&#xA;"properties": {&#xA;    "my_prop": {&#xA;        "type": "string"&#xA;    }&#xA;}&#xA;...&#xA;</code></pre>&#xA;&#xA;<ul>&#xA;<li>Just for the sanity, I have also tried adding the same document to my_index-3, and it got <code>"doc_values": true</code>.</li>&#xA;</ul>&#xA;&#xA;<h1>My question</h1>&#xA;&#xA;<p>How can I reindex my old index with <code>"doc_values": true</code>?</p>&#xA;
<p>Thanks @Val! Logstash indeed solved the problem.</p>&#xA;&#xA;<p>Both <a href="https://github.com/elastic/stream2es" rel="nofollow">stream2es</a> and <a href="https://github.com/karussell/elasticsearch-reindex" rel="nofollow">elasticsearch-reindex</a> created new mapping <em>without</em> "doc_values": true.</p>&#xA;