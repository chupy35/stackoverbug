30111258
ElasticSearch : IN equivalent operator in ElasticSearch
<p>I am trying to find ElasticSearch query equivalent to <code>IN</code> \ <code>NOT</code> in SQL.</p>&#xA;&#xA;<p>I know we can use QueryString query with multiple OR to get the same answer, but that ends up with lot of OR's.</p>&#xA;&#xA;<p>Can anyone share the example?</p>&#xA;
<p>Similar to what Chris suggested as a comment, the analogous replacement for <code>IN</code> is the <a href="http://www.elastic.co/guide/en/elasticsearch/reference/1.5/query-dsl-terms-filter.html" rel="noreferrer"><code>terms</code> <em>filter</em></a> (queries imply scoring, which may improve the returned order).</p>&#xA;&#xA;<pre><code>SELECT * FROM table WHERE id IN (1, 2, 3);&#xA;</code></pre>&#xA;&#xA;<p>The equivalent Elasticsearch 1.x filter would be:</p>&#xA;&#xA;<pre><code>{&#xA;  "query" : {&#xA;    "filtered" : {&#xA;      "filter" : {&#xA;        "terms" : {&#xA;          "id" : [1, 2, 3]&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>The equivalent Elasticsearch 2.x+ filter would be:</p>&#xA;&#xA;<pre><code>{&#xA;  "query" : {&#xA;    "bool" : {&#xA;      "filter" : {&#xA;        "terms" : {&#xA;          "id" : [1, 2, 3]&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>The important takeaway is that the <code>terms</code> filter (and query for that matter) work on exact matches. It is implicitly an <code>or</code> operation, similar to <code>IN</code>.</p>&#xA;&#xA;<p>If you wanted to invert it, you could use the not filter, but I would suggest using the slightly more verbose <code>bool</code>/<code>must_not</code> filter (to get in the habit of also using <code>bool</code>/<code>must</code> and <code>bool</code>).</p>&#xA;&#xA;<pre><code>{&#xA;  "query" : {&#xA;    "bool" : {&#xA;      "must_not" : {&#xA;        "terms" : {&#xA;          "id" : [1, 2, 3]&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Overall, the <code>bool</code> compound query syntax is <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-bool-query.html" rel="noreferrer">one of the most important filters in Elasticsearch</a>, as are the <code>term</code> (singular) and <code>terms</code> filters (plural, as shown).</p>&#xA;
<p>I saw what you requested.&#xA;And I wrote the source code as below.</p>&#xA;&#xA;<p>I hope this helps you solve your problem.</p>&#xA;&#xA;<p>sql query :</p>&#xA;&#xA;<pre><code>select * from tablename where fieldname in ('AA','BB');&#xA;</code></pre>&#xA;&#xA;<p>elastic search : </p>&#xA;&#xA;<pre><code>{&#xA;    query :{&#xA;        bool:{&#xA;            must:[{&#xA;              "script": {&#xA;                "script":{&#xA;                  "inline": "(doc['fieldname'].value.toString().substring(0,2).toUpperCase() in ['AA','BB']) == true"&#xA;                }&#xA;              }&#xA;            }],&#xA;            should:[],&#xA;            must_not:[]&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;