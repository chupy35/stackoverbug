33646543
Multiple OR filter in Elasticsearch
<p>Hello I'm having trouble deciding the correctness of the following query for multiple OR in Elasticsearch. I want to select all the unique data (not count, but select all rows)</p>&#xA;&#xA;<p>My best try for this in elastic query is </p>&#xA;&#xA;<pre><code>GET mystash/_search&#xA;{&#xA;    "aggs": {&#xA;        "uniques":{&#xA;             "filter":&#xA;            {&#xA;                "or":&#xA;                        [&#xA;                            { "term": { "url.raw" : "/a.json" } },&#xA;                            { "term": { "url.raw" : "/b.json" } },&#xA;                            { "term": { "url.raw" : "/c.json"} },&#xA;                            { "term": { "url.raw" : "/d.json"} }&#xA;                        ]&#xA;            },&#xA;            "aggs": {&#xA;                "unique" :{&#xA;                    "terms" :{&#xA;                        "field" : "id.raw",&#xA;                        "size" : 0&#xA;                    }&#xA;                }&#xA;            }&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>The equivalent SQL would be</p>&#xA;&#xA;<pre><code>SELECT DISTINCT id&#xA;FROM json_record&#xA;WHERE &#xA;    json_record.url = 'a.json' OR&#xA;    json_record.url = 'b.json' OR&#xA;    json_record.url = 'c.json' OR&#xA;    json_record.url = 'd.json'&#xA;</code></pre>&#xA;&#xA;<p>I was wondering whether the query above is correct, since the data will be needed for report generations.</p>&#xA;
<p>Some remarks:</p>&#xA;&#xA;<ul>&#xA;<li>You should use a query filter instead of an aggregation filter. Your query loads <strong>all</strong> documents. </li>&#xA;<li>You can replace your or+term filter by a single terms filter</li>&#xA;<li>You could use a size=0 at the root of the query to get only agg result and not search results</li>&#xA;</ul>&#xA;&#xA;<p>Example code:</p>&#xA;&#xA;<pre><code>{"size":0,&#xA;  "query" :{"filtered":{"filter":{"terms":{"url":["a", "b", "c"]}}}}, &#xA;   "aggs" :{"unique":{"term":{"field":"id", "size" :0}}}&#xA;} &#xA;</code></pre>&#xA;