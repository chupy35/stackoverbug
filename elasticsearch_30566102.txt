30566102
How to query for values associated with a key across all documents?
<p>Let's say there are some documents in my index which look like this:</p>&#xA;&#xA;<pre><code>{    &#xA;  "properties":[&#xA;    {&#xA;     "name":"foo",&#xA;     "value":"2"&#xA;    },&#xA;    {&#xA;     "name":"boo",&#xA;     "value":"sausage"&#xA;    }&#xA;  ]&#xA;},&#xA;{     &#xA;  "properties":[&#xA;    {&#xA;     "name":"foo",&#xA;     "value":"8"&#xA;    },&#xA;    {&#xA;     "name":"boo",&#xA;     "value":"chicken"&#xA;    }&#xA;  ]&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>I'd like to query the index in a way to return all <code>properties.name</code> with all their associated <code>properties.value</code> values. So the result should contain something like this:</p>&#xA;&#xA;<pre><code> {&#xA;  "foo":["2","8"],&#xA;  "boo":["chicken","sausage"]&#xA; }&#xA;</code></pre>&#xA;&#xA;<p>How can I get such a result?</p>&#xA;&#xA;<p>Update: Can I achieve that with a single query?</p>&#xA;
<p>you can use <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-multi-search.html" rel="nofollow">multi search API</a>:</p>&#xA;&#xA;<pre><code>$ cat requests&#xA;{"index" : "test"}&#xA;{"fields" : ["value"], "query" : {"term": {"properties.name": "foo"}}, "from" : 0, "size" : 1000}&#xA;{"index" : "test"}&#xA;{"fields" : ["value"], "query" : {"term" : {"properties.name": "boo"}}, , "from" : 0, "size" : 1000}&#xA;&#xA;$ curl -XGET localhost:9200/_msearch --data-binary @requests;&#xA;</code></pre>&#xA;&#xA;<p>Or you can use <code>bool</code> query:</p>&#xA;&#xA;<pre><code>$ curl -XGET localhost:9200/test/type -d &#xA;'{&#xA;  "from": 0, "size": 1000,&#xA;  "query": {&#xA;    "bool": {&#xA;      "should": [&#xA;                  { "match": { "properties.name": "foo" }},&#xA;                  { "match": { "properties.name": "boo"   }}&#xA;      ]&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>but you need to filter value by yourself.</p>&#xA;