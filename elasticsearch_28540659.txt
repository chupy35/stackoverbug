28540659
Elasticsearch is not working after full disk
<p>I made space, restarted the service (no good) and then rebooted but I still get this in the elasticsearch.log:</p>&#xA;&#xA;<pre><code>[2015-02-16 13:35:19,625][WARN ][cluster.action.shard     ] [Server] [logstash-2015.02.16][1] sending failed shard for [logstash-2015.02.16][1], node[PFamB-ZJS7CwSdyyAcP_8A], [P], s[INITIALIZING], indexUUID [tZ3I9HZ6TDaZSicIuGWRWQ], &#xA;    reason [Failed to start shard, message [IndexShardGatewayRecoveryException[[logstash-2015.02.16][1] &#xA;    failed to recover shard]; nested: TranslogCorruptedException[translog corruption while reading from stream]; nested: ElasticsearchIllegalArgumentException[No version type match [83]]; ]]&#xA;[2015-02-16 13:35:19,625][WARN ][cluster.action.shard     ] [Server] [logstash-2015.02.16][1] received shard failed for [logstash-2015.02.16][1], node[PFamB-ZJS7CwSdyyAcP_8A], [P], s[INITIALIZING], indexUUID [tZ3I9HZ6TDaZSicIuGWRWQ], &#xA;    reason [Failed to start shard, message [IndexShardGatewayRecoveryException[[logstash-2015.02.16][1] &#xA;    failed to recover shard]; nested: TranslogCorruptedException[translog corruption while reading from stream]; nested: ElasticsearchIllegalArgumentException[No version type match [83]]; ]]&#xA;[2015-02-16 13:35:43,570][DEBUG][action.index             ] [Server] observer: timeout notification from cluster service. timeout setting [1m], time since start [1m]&#xA;[2015-02-16 13:36:10,757][DEBUG][action.index             ] [Server] observer: timeout notification from cluster service. timeout setting [1m], time since start [1m]&#xA;</code></pre>&#xA;&#xA;<p>What should I do?</p>&#xA;
<p>I got the same problem too, with "No version type match" error in logs.</p>&#xA;&#xA;<p>(Also, after disk got full)</p>&#xA;&#xA;<p>Tried bigfoot's solution to manually delete recovery files and it worked.</p>&#xA;&#xA;<p>Probably this can have some negative side effects though.</p>&#xA;
<p>Bigfoot's solution is the only one that seems to work.</p>&#xA;&#xA;<p>While the stack trace observed seems to be similar to: <a href="https://github.com/elastic/elasticsearch/issues/12055" rel="noreferrer">https://github.com/elastic/elasticsearch/issues/12055</a></p>&#xA;&#xA;<p>This pull request is supposed to fix the issue: <a href="https://github.com/elastic/elasticsearch/pull/9797" rel="noreferrer">https://github.com/elastic/elasticsearch/pull/9797</a></p>&#xA;&#xA;<p>But upgrading to v1.5.0 also does <em>not</em> do the trick.</p>&#xA;&#xA;<p>Thus the only thing that works:</p>&#xA;&#xA;<pre><code>find  /var/lib/elasticsearch/elasticsearch/nodes/ -name "*.recovering"&#xA;</code></pre>&#xA;&#xA;<p>And delete all recovering files.&#xA;Of course this has side-effects.</p>&#xA;