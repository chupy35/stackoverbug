34293411
Elasticsearch parent - child mapping: Search in both and highlight
<p>I have the following elasticsearch 1.6.2 index mappings: parent <strong>item</strong> and child <strong>document</strong>. One item can have several documents. Documents are <strong>not</strong> nested because they contain base64 data (mapper-attachments-plugin) and cannot be updated with an item.</p>&#xA;&#xA;<pre><code>"mappings" : {&#xA;  "document" : {&#xA;    "_parent" : {&#xA;      "type" : "item"&#xA;    }, &#xA;    "_routing" : {&#xA;      "required" : true&#xA;    },&#xA;    "properties" : {&#xA;      "extension" : {&#xA;        "type" : "string",&#xA;        "term_vector" : "with_positions_offsets",     &#xA;        "include_in_all" : true&#xA;      }, ...&#xA;    },&#xA; }&#xA; "item" : { &#xA;    "properties" : {&#xA;      "prop1" : {&#xA;        "type" : "string",&#xA;        "include_in_all" : true&#xA;      }, ...&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>I like to search in <strong>both</strong> indices but always return <strong>items</strong>. If there is a match in an document, return the corresponding item. If there is a match in an item, return the item. If both is true, return the item. </p>&#xA;&#xA;<p>Is it possible to combine <strong>has_child</strong> and <strong>has_parent</strong> searches?</p>&#xA;&#xA;<p>This search only searches in documents and returns items:</p>&#xA;&#xA;<pre><code>{&#xA; "query": {&#xA;  "has_child": {&#xA;    "type": "document",&#xA;    "query": {&#xA;      "query_string":{"query":"her*}&#xA;  },&#xA;     "inner_hits" : {&#xA;      "highlight" : {&#xA;             "fields" : {&#xA;                 "*" : {}              &#xA;             }&#xA;           }&#xA;       }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p><strong>EXAMPLE</strong></p>&#xA;&#xA;<pre><code>GET index/item/174&#xA;{&#xA;  "_type" : "item",&#xA;  "_id" : "174",&#xA;  "_source":{"prop1":"Perjeta construction"}&#xA;}&#xA;&#xA;GET index/document/116&#xA;{&#xA;  "_type" : "document",&#xA;  "_id" : "116", &#xA;  "_source":{"extension":"pdf","item": {"id":174},"fileName":"construction plan"}&#xA;} &#xA;&#xA;__POSSIBLE SEARCH RESULT searching for "constr*"__&#xA;&#xA;{&#xA;"hits": {&#xA;  "total": 1,&#xA;  "hits": [&#xA;     {&#xA;        "_type": "item",&#xA;        "_id": "174",&#xA;        "_source": {&#xA;           "prop1": "Perjeta construction"&#xA;        },&#xA;        "highlight": {&#xA;           "prop1": [&#xA;              "Perjeta &lt;em&gt;construction&lt;\/em&gt;"&#xA;           ]&#xA;        },&#xA;        "inner_hits": {&#xA;           "document": {&#xA;              "hits": {&#xA;                 "hits": [&#xA;                    {&#xA;                       "_type": "document",&#xA;                       "_id": "116",&#xA;                       "_source": {&#xA;                          "extension": "pdf",&#xA;                          "item": {&#xA;                             "id": 174&#xA;                          },                              &#xA;                          "fileName": "construction plan"&#xA;                       },&#xA;                       "highlight": {&#xA;                          "fileName": [&#xA;                             "&lt;em&gt;construction&lt;\/em&gt; plan"&#xA;                          ]&#xA;                       }&#xA;                    }&#xA;                 ]&#xA;              }&#xA;           }&#xA;        }&#xA;     }&#xA;  ]&#xA;}&#xA;}&#xA;</code></pre>&#xA;
<p>I can answer my question "Is it possible to combine has_child and has_parent" with <em>no</em>.</p>&#xA;&#xA;<p>You should only use one at a time on one index.</p>&#xA;