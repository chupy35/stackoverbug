29981483
Filter query with or without keyword
<p>I have a table with a name column and category_id column. The query below returns a <code>BadRequest</code> error. I think this is the most meaningful returned from the error blob.</p>&#xA;&#xA;<p>*note: <code>"something*"</code> is a keyword I pass in to search for.</p>&#xA;&#xA;<pre><code>Expected field name but got START_OBJECT&#xA;</code></pre>&#xA;&#xA;<p>I am looking for a query that will return results filtered by <code>category_id</code> with or without a keyword search.</p>&#xA;&#xA;<pre><code>{&#xA;  query: {&#xA;    bool: {must: [{&#xA;      wildcard: {name: "something*"}&#xA;    ]},&#xA;    filtered: {&#xA;      filter: {&#xA;        bool: {&#xA;          must: {&#xA;            term: {category_id: 1}&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  }, &#xA;  sort: [{&#xA;    _geo_distance: {&#xA;      store_location: {:lat=&gt;0, :lon=&gt;0},&#xA;      order: "asc",&#xA;      unit: "miles"&#xA;    }&#xA;  }]&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>What is wrong with this query?</p>&#xA;
<p>If I were to guess (ie. this is untested), I'd say it's because you've got your bool outside of your <code>filtered</code> sub-query. Move it inside a <code>query</code> sub-query inside your <code>filtered</code> sub-query like so:</p>&#xA;&#xA;<pre><code>{&#xA;  query: {&#xA;    filtered: {&#xA;      query: {&#xA;        bool: {must: [{&#xA;          wildcard: {name: "something*"}&#xA;        ]},&#xA;      },&#xA;      filter: {&#xA;        bool: {&#xA;          must: {&#xA;            term: {category_id: 1}&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  }, &#xA;  sort: [{&#xA;    _geo_distance: {&#xA;      store_location: {:lat=&gt;0, :lon=&gt;0},&#xA;      order: "asc",&#xA;      unit: "miles"&#xA;    }&#xA;  }]&#xA;}&#xA;</code></pre>&#xA;