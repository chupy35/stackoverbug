28932178
Elasticsearch, Failed to obtain node lock, is the following location writable
<p>Elasticsearch won't start using <code>./bin/elasticsearch</code>.&#xA;It raises the following exception:</p>&#xA;&#xA;<pre><code>- ElasticsearchIllegalStateException[Failed to obtain node lock, is the following location writable?: [/home/user1/elasticsearch-1.4.4/data/elasticsearch]&#xA;</code></pre>&#xA;&#xA;<p>I checked the permissions on the same location and the location has 777 permissions on it and is owned by user1.</p>&#xA;&#xA;<pre><code>ls -al /home/user1/elasticsearch-1.4.4/data/elasticsearch&#xA;</code></pre>&#xA;&#xA;<blockquote>&#xA;<pre><code>drwxrwxrwx  3 user1 wheel 4096 Mar  8 13:24 .&#xA;drwxrwxrwx  3 user1 wheel 4096 Mar  8 13:00 ..&#xA;drwxrwxrwx 52 user1 wheel 4096 Mar  8 13:51 nodes&#xA;</code></pre>&#xA;</blockquote>&#xA;&#xA;<p>What is the problem?</p>&#xA;&#xA;<p>Trying to run elasticsearch 1.4.4 on linux without root access. </p>&#xA;
<p>In my situation I had wrong permissions on the ES dir folder. Setting correct owner solved it.</p>&#xA;&#xA;<pre><code># change owner&#xA;chown -R elasticsearch:elasticsearch /data/elasticsearch/&#xA;&#xA;# to validate&#xA;ls /data/elasticsearch/ -la&#xA;# prints    &#xA;# drwxr-xr-x 2 elasticsearch elasticsearch 4096 Apr 30 14:54 CLUSTER_NAME&#xA;</code></pre>&#xA;
<p>In my case, this error was caused by not mounting the devices used for the configured data directories using "sudo mount".</p>&#xA;
<p>I got this same error message, but things were mounted fine and the permissions were all correctly assigned.</p>&#xA;&#xA;<p>Turns out that I had an 'orphaned' elasticsearch process that was not being killed by the normal stop command.</p>&#xA;&#xA;<p>I had to manually kill the process and then restarting elasticsearch worked again.</p>&#xA;
<p>I had an orphaned java process related to Elasticsearch. Killing it solved the lock issue.</p>&#xA;&#xA;<pre><code>ps aux | grep 'java'&#xA;kill -9 &lt;PID&gt;&#xA;</code></pre>&#xA;
<p>You already have ES running.  To prove that type:</p>&#xA;&#xA;<p>curl 'localhost:9200/_cat/indices?v'</p>&#xA;&#xA;<p>If you want to run another instance on the same box you can set node.max_local_storage_nodes in elasticsearch.yml to a value larger than 1.</p>&#xA;
<p>the reason is another instance is running!<br>&#xA;first find the id of running elastic.</p>&#xA;&#xA;<pre><code>ps aux | grep 'elastic'&#xA;</code></pre>&#xA;&#xA;<p>then kill using <code>kill -9 &lt;PID_OF_RUNNING_ELASTIC&gt;</code>.<br>&#xA;There were some answers to remove node.lock file but that didn't help since the running instance will make it again!</p>&#xA;
<p>Try the following:&#xA;1. find the port 9200, e.g.: <code>lsof -i:9200</code>&#xA;   This will show you which processes use the port 9200.&#xA;2. kill the pid(s), e.g. repeat <code>kill -9 pid</code> for each PID that the output of <code>lsof</code> showed in step 1&#xA;3. restart elasticsearch, e.g. <code>elasticsearch</code></p>&#xA;
<p>I had an another ElasticSearch running on the same machine.</p>&#xA;&#xA;<p>Command to check : <strong><em>netstat -nlp | grep 9200</em></strong> (9200 - Elastic Port)&#xA;Result : tcp        0      0 :::9210                     :::*       LISTEN      27462/java</p>&#xA;&#xA;<p>Kill the process by,&#xA;<strong><em>kill -9 27462</em></strong>&#xA;27462 - PID of ElasticSearch instance</p>&#xA;&#xA;<p>Start the elastic search and it may run now.</p>&#xA;
<p>To add to the above answers there could be some other scenarios in which you can get the error.In fact I had done a update from 5.5 to 6.3 for elasticsearch.I have been using the docker compose setup with named volumes for data directories.I had to do a <code>docker volume prune</code> to remove the stale ones.After doing that I was no longer facing the issue.</p>&#xA;
<p>After I upgraded the elasticsearch docker-image from version 5.6.x to 6.3.y the container would not start anymore because of the aforementioned error</p>&#xA;&#xA;<blockquote>&#xA;  <p>Failed to obtain node lock</p>&#xA;</blockquote>&#xA;&#xA;<p>In my case the root-cause of the error was <strong>missing file-permissions</strong></p>&#xA;&#xA;<p>The data-folder used by elasticsearch was mounted from the host-system into the container (declared in the docker-compose.yml):</p>&#xA;&#xA;<pre><code>    volumes:&#xA;      - /var/docker_folders/common/experimental-upgrade:/usr/share/elasticsearch/data&#xA;</code></pre>&#xA;&#xA;<p>This folder could not be accessed anymore by elasticsearch for reasons I did not understand at all. After I set very permissive file-permissions to this folder and all sub-folders <strong>the container did start again</strong>.</p>&#xA;&#xA;<p>I do not want to reproduce the command to set those very permissive access-rights on the mounted docker-folder, because it is most likely a very bad practice and a security-issue. I just wanted to share the fact that it might not be a second process of elasticsearch running, but actually just missing access-rights to the mounted folder.</p>&#xA;&#xA;<p>Maybe someone could elaborate on the apropriate rights to set for a mounted-folder in a docker-container?</p>&#xA;