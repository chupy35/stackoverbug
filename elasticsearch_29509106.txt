29509106
ElasticSearch script filter compare two field
<p>I want to use script filter to get all match that the score value equals to maxScore value. but it is not work.</p>&#xA;&#xA;<pre><code>{&#xA;    "query": {&#xA;        "filtered": {&#xA;            "filter": {&#xA;                "script": {&#xA;                    "script": "doc['match.score'].value == doc['match.maxScore'].value"&#xA;                }&#xA;            }&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>I have this error :</p>&#xA;&#xA;<pre><code>{&#xA;    "error": "SearchPhaseExecutionException[Failed to execute phase [query], all shards failed; shardFailures {[yk_PnKg9SOaf1d8acCsjvw][cobink_search][0]: SearchParseException[[cobink_search][0]: from[-1],size[-1]: Parse Failure [Failed to parse source [{"query":{"filtered":{"filter":{"script":{"script":"doc['match.score'].value == doc['match.maxScore'].value"}}}}}]]]; nested: ScriptException[dynamic scripting for [groovy] disabled]; }{[0jYKWZlyQiiVPHlzmoMjkA][cobink_search][1]: RemoteTransportException[[Hammer Harrison][inet[/192.168.1.100:9300]][indices:data/read/search[phase/query]]]; nested: SearchParseException[[cobink_search][1]: from[-1],size[-1]: Parse Failure [Failed to parse source [{"query":{"filtered":{"filter":{"script":{"script":"doc['match.score'].value == doc['match.maxScore'].value"}}}}}]]]; nested: ScriptException[dynamic scripting for [groovy] disabled]; }{[yk_PnKg9SOaf1d8acCsjvw][cobink_search][2]: SearchParseException[[cobink_search][2]: from[-1],size[-1]: Parse Failure [Failed to parse source [{"query":{"filtered":{"filter":{"script":{"script":"doc['match.score'].value == doc['match.maxScore'].value"}}}}}]]]; nested: ScriptException[dynamic scripting for [groovy] disabled]; }{[yk_PnKg9SOaf1d8acCsjvw][cobink_search][3]: SearchParseException[[cobink_search][3]: from[-1],size[-1]: Parse Failure [Failed to parse source [{"query":{"filtered":{"filter":{"script":{"script":"doc['match.score'].value == doc['match.maxScore'].value"}}}}}]]]; nested: ScriptException[dynamic scripting for [groovy] disabled]; }{[0jYKWZlyQiiVPHlzmoMjkA][cobink_search][4]: RemoteTransportException[[Hammer Harrison][inet[/192.168.1.100:9300]][indices:data/read/search[phase/query]]]; nested: SearchParseException[[cobink_search][4]: from[-1],size[-1]: Parse Failure [Failed to parse source [{"query":{"filtered":{"filter":{"script":{"script":"doc['match.score'].value == doc['match.maxScore'].value"}}}}}]]]; nested: ScriptException[dynamic scripting for [groovy] disabled]; }]",&#xA;    "status": 400&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Thanks you guys :)</p>&#xA;
<p>Dynamic scripting is disabled in your case. Add the following line in your <code>elasticsearch.yml</code> file to enable dynamic scripting. Then your query should work. But beware this can leave a security hole in your Elasticsearch cluster. Read more about it <a href="https://www.elastic.co/blog/scripting-security" rel="nofollow">here</a> and <a href="http://www.elastic.co/guide/en/elasticsearch/reference/1.x/modules-scripting.html" rel="nofollow">here</a>.</p>&#xA;&#xA;<pre><code>script.disable_dynamic: false&#xA;</code></pre>&#xA;
<p>In version 2.x and above you need to use </p>&#xA;&#xA;<pre><code>script.indexed: on&#xA;script.inline: on&#xA;</code></pre>&#xA;&#xA;<p>in your elasticsearch.yml file, to enable the scripts. </p>&#xA;