28723308
elasticsearch more_like_this with highlights
<p>So, I've got myself a small elasticsearch server and I'm trying to do the following:&#xA;1) The user searches for some keyword(s).&#xA;2) The user is shown a list of relevant results. Results are shown from the highlights, with the search word highlighted.&#xA;3) The user clicks on a result.&#xA;4) A new page shows the whole document, the keyword is highlighted among the whole document and there's a list of relevant (more_like_this) results.</p>&#xA;&#xA;<p>My first query is as following:</p>&#xA;&#xA;<pre><code>{&#xA;"query" : &#xA;{&#xA;    "filtered" : &#xA;    {&#xA;        "query": {"term": {&#xA;           "text": {&#xA;              "value": "term"&#xA;           }&#xA;        }}&#xA;    }&#xA;},&#xA;"highlight":&#xA;{&#xA;    "fields":&#xA;    {&#xA;        "title" : {"number_of_fragments" : "0"},&#xA;        "text" :  {}&#xA;    },&#xA;    "pre_tags" : ["&lt;b&gt;"],&#xA;    "post_tags" : ["&lt;/b&gt;"]&#xA;},&#xA;"_source" : ["title", "date", "_id"],&#xA;"from" : 0,&#xA;"size" : 10&#xA;</code></pre>&#xA;&#xA;<p>}</p>&#xA;&#xA;<p>My second query is as following (id is obviously the document id, here 1000 for example):&#xA;<code>{&#xA;    "query": {&#xA;        "more_like_this": &#xA;        {&#xA;            "fields" :  ["text","title"],&#xA;            "docs": [{&#xA;                "_id" : "1000"&#xA;            }],&#xA;            "min_term_freq" : 1,&#xA;            "include" : true&#xA;        }&#xA;    },&#xA;    "_source" : [ "title", "text", "_id", "url" ],&#xA;    "from" : 0, &#xA;    "size" : 10&#xA;}</code></p>&#xA;&#xA;<p>Is there any way to achieve what I want (have the more_like_this query highlight the search term) or is the only solution for that is to do another query for the full document highlights?</p>&#xA;&#xA;<p>Thanks in advance.</p>&#xA;
<p>It is possible, if you change your mapping.&#xA;You need to enable term positions and offsets.</p>&#xA;&#xA;<p>e.g. </p>&#xA;&#xA;<pre><code>"title" : {&#xA;    "type": "string",&#xA;    "term_vector": "with_positions_offsets"&#xA;}                     &#xA;</code></pre>&#xA;&#xA;<p>And then highlighting should work as usual. I tested it with ES version 1.6.</p>&#xA;&#xA;<p><a href="https://github.com/elastic/elasticsearch/issues/10829#issuecomment-148041529" rel="nofollow">https://github.com/elastic/elasticsearch/issues/10829#issuecomment-148041529</a></p>&#xA;