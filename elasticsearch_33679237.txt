33679237
Elasticsearch include field in result set of aggregation
<p>How can field of type string be included in the result set of an aggregation?&#xA;For example given the following mapping:</p>&#xA;&#xA;<pre><code>{&#xA; "sport": {&#xA;  "mappings": {&#xA;     "runners": {&#xA;        "properties": {&#xA;           "name": {&#xA;              "type": "string"&#xA;           },&#xA;           "city": {&#xA;              "type": "string"&#xA;           },&#xA;           "region": {&#xA;              "type": "string"&#xA;           },&#xA;           "sport": {&#xA;              "type": "string"&#xA;                }&#xA;            }&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;</code></pre>&#xA;&#xA;<p>Sample data:</p>&#xA;&#xA;<pre><code>curl -XPOST "http://localhost:9200/sport/_bulk" -d'&#xA;  {"index":{"_index":"sport","_type":"runner"}}&#xA;  {"name":"Gary", "city":"New York","region":"A","sport":"Soccer"}&#xA;  {"index":{"_index":"sport","_type":"runner"}}&#xA;  {"name":"Bob", "city":"New York","region":"A","sport":"Tennis"}&#xA;  {"index":{"_index":"sport","_type":"runner"}}&#xA;  {"name":"Mike", "city":"Atlanta","region":"B","sport":"Soccer"}&#xA; '&#xA;</code></pre>&#xA;&#xA;<p>How can the field <code>name</code> be included in result set of the aggregation:</p>&#xA;&#xA;<pre><code>{&#xA;"size": 0, &#xA;"aggregations": {&#xA;  "agg": {&#xA;     "terms": {&#xA;        "field": "city"}&#xA;       }&#xA;     }&#xA;   }&#xA;</code></pre>&#xA;
<p>This seems to do what you want, if I'm understanding you correctly:</p>&#xA;&#xA;<pre><code>POST /sport/_search&#xA;{&#xA;   "size": 0,&#xA;   "aggregations": {&#xA;      "city_terms": {&#xA;         "terms": {&#xA;            "field": "city"&#xA;         },&#xA;         "aggs": {&#xA;            "name_terms": {&#xA;               "terms": {&#xA;                  "field": "name"&#xA;               }&#xA;            }&#xA;         }&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>With the data you provided, it returns:</p>&#xA;&#xA;<pre><code>{&#xA;   "took": 43,&#xA;   "timed_out": false,&#xA;   "_shards": {&#xA;      "total": 5,&#xA;      "successful": 5,&#xA;      "failed": 0&#xA;   },&#xA;   "hits": {&#xA;      "total": 3,&#xA;      "max_score": 0,&#xA;      "hits": []&#xA;   },&#xA;   "aggregations": {&#xA;      "city_terms": {&#xA;         "doc_count_error_upper_bound": 0,&#xA;         "sum_other_doc_count": 0,&#xA;         "buckets": [&#xA;            {&#xA;               "key": "new",&#xA;               "doc_count": 2,&#xA;               "name_terms": {&#xA;                  "doc_count_error_upper_bound": 0,&#xA;                  "sum_other_doc_count": 0,&#xA;                  "buckets": [&#xA;                     {&#xA;                        "key": "bob",&#xA;                        "doc_count": 1&#xA;                     },&#xA;                     {&#xA;                        "key": "gary",&#xA;                        "doc_count": 1&#xA;                     }&#xA;                  ]&#xA;               }&#xA;            },&#xA;            {&#xA;               "key": "york",&#xA;               "doc_count": 2,&#xA;               "name_terms": {&#xA;                  "doc_count_error_upper_bound": 0,&#xA;                  "sum_other_doc_count": 0,&#xA;                  "buckets": [&#xA;                     {&#xA;                        "key": "bob",&#xA;                        "doc_count": 1&#xA;                     },&#xA;                     {&#xA;                        "key": "gary",&#xA;                        "doc_count": 1&#xA;                     }&#xA;                  ]&#xA;               }&#xA;            },&#xA;            {&#xA;               "key": "atlanta",&#xA;               "doc_count": 1,&#xA;               "name_terms": {&#xA;                  "doc_count_error_upper_bound": 0,&#xA;                  "sum_other_doc_count": 0,&#xA;                  "buckets": [&#xA;                     {&#xA;                        "key": "mike",&#xA;                        "doc_count": 1&#xA;                     }&#xA;                  ]&#xA;               }&#xA;            }&#xA;         ]&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>(You may want to add <code>"index":"not_analyzed"</code> to one or both fields in your mapping, if these results are not what you were expecting.)</p>&#xA;&#xA;<p>Here's the code I used to test it:</p>&#xA;&#xA;<p><a href="http://sense.qbox.io/gist/07735aadc082c1c60409931c279f3fd85a340dbb" rel="nofollow">http://sense.qbox.io/gist/07735aadc082c1c60409931c279f3fd85a340dbb</a></p>&#xA;