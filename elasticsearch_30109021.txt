30109021
ElasticSearch: how to search for %like% values in a field
<p>I have a search query (in Postman/Chrome) that returns a list of companies, but I need to filter them out for a specific pattern. What filter do I use and how to do it?&#xA;<strong>I need to filter query result for company_id LIKE %50%</strong></p>&#xA;&#xA;<p>Her is what I run:</p>&#xA;&#xA;<pre><code>    {&#xA;  "fields": [&#xA;    "company_id" &#xA;    ],&#xA;  "query": {&#xA;    "bool": {&#xA;      "must": [&#xA;                {"term": {"app.raw": "AAA"}},&#xA;                {"wildcard": {"cat.raw": "RS"}}&#xA;            ],&#xA;      "must_not": [],&#xA;      "should": []&#xA;    }          &#xA;  },&#xA;  "from": 0,&#xA;  "size": 5,&#xA;  "sort": [],&#xA;  "facets": {}&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>I get back something like:</p>&#xA;&#xA;<pre><code>"hits": [&#xA;            {&#xA;...&#xA;                "fields": {&#xA;                    "company_id": [&#xA;                        "745"&#xA;                    ]&#xA;                }&#xA;            },&#xA;            {&#xA;...&#xA;                "fields": {&#xA;                    "company_id": [&#xA;                        "5056"&#xA;                    ]&#xA;                }&#xA;            },&#xA;            {&#xA;...&#xA;                "fields": {&#xA;                    "company_id": [&#xA;                        "7765"&#xA;                    ]&#xA;                }&#xA;            },&#xA;            {&#xA;...&#xA;                "fields": {&#xA;                    "company_id": [&#xA;                        "5044"&#xA;                    ]&#xA;                }&#xA;            },&#xA;            {&#xA;...&#xA;                "fields": {&#xA;                    "company_id": [&#xA;                        "501"&#xA;                    ]&#xA;                }&#xA;</code></pre>&#xA;
<p>First of all I am not fully sure what issue you are facing. You are not getting correct/expected result? You need to include the mapping you have used because the query will depend on it.</p>&#xA;&#xA;<p>Wildcard searches are heavy. If you want to do partial matching search (equivalent of %like%)You can use <a href="http://www.elastic.co/guide/en/elasticsearch/reference/0.90/analysis-ngram-tokenfilter.html" rel="nofollow">ngram token filter</a> in your analyzer and do term search. It will take care of matching partial string. </p>&#xA;&#xA;<p>You can define an analyzer like </p>&#xA;&#xA;<pre><code>{&#xA;  "settings":{&#xA;    "analysis":{&#xA;      "analyzer":{&#xA;        "Like":{&#xA;          "type":"custom",&#xA;          "tokenizer":"keyword",&#xA;          "filter":[ "lowercase", "ngram" ] &#xA;        }&#xA;      },&#xA;      "filter":{&#xA;        "ngram":{&#xA;          "type":"ngram",&#xA;          "min_gram":2,&#xA;          "max_gram":15&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>And define in your mapping for cat.raw the analyzer "Like" defined above.</p>&#xA;&#xA;<p>If you have used the ngram in your analyzer then You can change the query part to something simple term query like</p>&#xA;&#xA;<pre><code> "query": {&#xA;    "bool": {&#xA;      "must": [&#xA;                {"term": {"app.raw": "AAA"}},&#xA;                {"term": {"cat.raw": "RS"}}&#xA;            ],&#xA;      "must_not": [],&#xA;      "should": []&#xA;    }          &#xA;  }&#xA;</code></pre>&#xA;&#xA;<p><strong>EDIT</strong>: updated answer based on comment</p>&#xA;&#xA;<p>Ok now it is clear what you want to do.</p>&#xA;&#xA;<p>One way is to define <code>company_id</code> As string in your mapping and use <a href="http://www.elastic.co/guide/en/elasticsearch/reference/1.3/query-dsl-prefix-query.html" rel="nofollow">prefix query</a> </p>&#xA;&#xA;<pre><code>"query": {&#xA;    "bool": {&#xA;      "must": [&#xA;                {"term": {"app.raw": "AAA"}},&#xA;                {"term": {"cat.raw": "RS"}},&#xA;                {"prefix":{"company_id": "50"}}&#xA;            ],&#xA;      "must_not": [],&#xA;      "should": []&#xA;    }          &#xA;  }&#xA;</code></pre>&#xA;&#xA;<p>Another alternative could be to use edgengram in your analyzer for company_id and use term filter/query.</p>&#xA;&#xA;<p>Note: for search in "cat.raw" it is still better to use the term query with analyzer having ngram instead of the wildcard query.</p>&#xA;