32202793
How to use nested filters in Elasticsearch?
<p>I have a set of articles. I want to filter on <code>tags</code> AND <code>host</code>.</p>&#xA;&#xA;<p>E.g I want all articles that are tagged with 'news' OR 'sport' AND has the 'host' set to 'cnn.com' OR 'bbc.com'.</p>&#xA;&#xA;<p>I tried to create this nested bool filter, but that did not work. It also returns articles from other hosts.&#xA;Any suggestions?</p>&#xA;&#xA;<pre><code>GET _search&#xA;{&#xA;    "query": {&#xA;      "filtered": {&#xA;        "query": {&#xA;          "match_all": {}&#xA;        },&#xA;        "filter": {&#xA;          "bool": {&#xA;            "should": [&#xA;              // Match one or more of these tags.&#xA;              { "term" : { "tags" : "sport"} },&#xA;              { "term" : { "tags" : "news"} },&#xA;              { "bool": { &#xA;                // Only from one of these hosts.&#xA;                "should": [&#xA;                  { "term": { "host": "bbc.com" } },&#xA;                  { "term": { "host": "cnn.com" } }&#xA;                ]&#xA;              }}&#xA;            ]&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;
<p>Nesting the query like this worked. :-)</p>&#xA;&#xA;<pre><code>GET _search&#xA;{&#xA;    "query": {&#xA;      "filtered": {&#xA;        "query": {&#xA;          "match_all": {}&#xA;        },&#xA;        "filter": {&#xA;          "bool": {&#xA;            "must": [&#xA;&#xA;              { "bool": {&#xA;                "should": [&#xA;                  { "term" : { "tags" : "sport"} },&#xA;                  { "term" : { "tags" : "news"} }&#xA;                ]&#xA;              }},&#xA;&#xA;              { "bool": { &#xA;                "should": [&#xA;                  { "term": { "host": "bbc.com" } },&#xA;                  { "term": { "host": "cnn.com" } }&#xA;                ]&#xA;              }}&#xA;            ]&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;