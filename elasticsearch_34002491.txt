34002491
Having ElasticSearch ignore filter when field does not exist
<p>I am running a query against an alias that is currently pointing to a dozen of indexes. Not all documents have the same structure across these indexes, so I am trying to run a filtered query:</p>&#xA;&#xA;<pre><code>     "filter" : {&#xA;        "bool" : {&#xA;          "must" : [ { &#xA;              "term" : { "channel" : "24" }&#xA;            },&#xA;            {&#xA;              "range" : {&#xA;                "startTime" : { "gt" : "now" }&#xA;              }&#xA;           }]&#xA;       }&#xA;     }&#xA;</code></pre>&#xA;&#xA;<p>ElasticSearch is filtering all documents that have channel 24, but I would also want all the other document that do not have the attribute channel. For example, my query should bring all actors (doc doesnt have properties channel and startTime), movies (doc doesnt have properties channel and startTime), genres (doc doesnt have properties channel and startTime) and tv shows/programs (doc has properties channel and startTime) that air on channel 24.</p>&#xA;&#xA;<p>Is there a way to do that without involving filter script? I could achieve this using script but then the performance of the query would be really bad.</p>&#xA;&#xA;<p>Thank you&#xA;Thiago</p>&#xA;
<p>Try this:</p>&#xA;&#xA;<pre><code>POST /test_index/_search&#xA;{&#xA;   "filter": {&#xA;      "bool": {&#xA;         "should": [&#xA;            {&#xA;               "bool": {&#xA;                  "must": [&#xA;                     {&#xA;                        "term": {&#xA;                           "channel": "24"&#xA;                        }&#xA;                     },&#xA;                     {&#xA;                        "range": {&#xA;                           "startTime": {&#xA;                              "gt": "now"&#xA;                           }&#xA;                        }&#xA;                     }&#xA;                  ]&#xA;               }&#xA;            },&#xA;            {&#xA;               "bool": {&#xA;                  "must_not": [&#xA;                     {&#xA;                        "exists": {&#xA;                           "field": "channel"&#xA;                        }&#xA;                     },&#xA;                     {&#xA;                        "exists": {&#xA;                           "field": "startTime"&#xA;                        }&#xA;                     }&#xA;                  ]&#xA;               }&#xA;            }&#xA;         ]&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;