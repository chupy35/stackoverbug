30729228
Weird performance difference when not caching uuid
<p>I read this <a href="https://www.elastic.co/blog/performance-considerations-elasticsearch-indexing" rel="nofollow">documentation article</a> regarding Java UUIDs which says that using Java's random uuid is the worst choice.</p>&#xA;&#xA;<p>I have a large amount of documents in one index where I have a Java random UUID in one of the fields, but not as the document id.</p>&#xA;&#xA;<p>I'm running the following query which takes about 6000ms to return:</p>&#xA;&#xA;<pre><code>{&#xA;    "query": {&#xA;        "filtered": {&#xA;            "filter": {&#xA;                "and": [&#xA;                    {&#xA;                        "term": {&#xA;                            "events.d_id": "1175cbe1-5329-8463-7e7b-547aca5dbe83"&#xA;                        }&#xA;                    },&#xA;                    {&#xA;                        "term": {&#xA;                            "events.a_id": "4495665825523018"&#xA;                        }&#xA;                    }&#xA;                ]&#xA;            }&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>However, when setting <code>_cache</code> to <code>false</code> on that term, I'm getting results back in 4ms:</p>&#xA;&#xA;<pre><code>{&#xA;    "query": {&#xA;        "filtered": {&#xA;            "filter": {&#xA;                "and": [&#xA;                    {&#xA;                        "term": {&#xA;                            "events.d_id": "1175cbe1-5329-8463-7e7b-547aca5dbe83",&#xA;                            "_cache": false&#xA;                        }&#xA;                    },&#xA;                    {&#xA;                        "term": {&#xA;                            "events.a_id": "4495665825523018"&#xA;                        }&#xA;                    }&#xA;                ]&#xA;            }&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>I did another test where I changed the <code>events.d_id</code> to a non-existent value, but in the same format, the query would still take 6000ms and return 0 results. However when I changed the <code>-</code> to <code>_</code> the query took 4ms. It's like ES treats this specific format differently. Please note that the field is defined as <code>string</code> and <code>not_analyzed</code></p>&#xA;