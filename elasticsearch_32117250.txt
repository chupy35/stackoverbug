32117250
How to limit and then sort in Elastic Search
<p>I want to first limit the results returned by elastic search(sorted by _score) to 1000 and then sort those 1000 results by a specific field.</p>&#xA;&#xA;<p>An example in SQL would be -<br/></p>&#xA;&#xA;<pre><code>select name,count,score &#xA;from &#xA;  (select name,count,score from users order by score limit 1000) A &#xA;order by count&#xA;</code></pre>&#xA;&#xA;<p>How can I do this in elastic search?</p>&#xA;
<p>Try below query</p>&#xA;&#xA;<pre><code>{&#xA;"filtered" : {&#xA;    "filter" : {&#xA;         "limit" : {"value" : 100}&#xA;     },&#xA;    "sort" : [&#xA;        {"score " : {"order" : "asc"}}&#xA;    ]&#xA;    "query" : {&#xA;        "term" : { "name" : "shay" }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;
<p>You can use the secondary sort option to achieve this. Sort by the following order</p>&#xA;&#xA;<ol>&#xA;<li>_score (elasticsearch score)</li>&#xA;<li>sort_field (count as per your Q)</li>&#xA;</ol>&#xA;&#xA;<p>Bellow query will search the documents and sort first using the elasticsearch calculated score value then the second level sorting will apply for the field count and the size(limit) will be 1000 so only the 1000 documents return to you.</p>&#xA;&#xA;<p><strong>Sample</strong></p>&#xA;&#xA;<pre><code>{&#xA;  "size": 1000,&#xA;  "query": {&#xA;    "match_all": {}&#xA;  },&#xA;  "sort": [&#xA;    "_score",&#xA;    {&#xA;      "count": {&#xA;        "order": "asc"&#xA;      }&#xA;    }&#xA;  ],&#xA;  "fields": [&#xA;    "name",&#xA;    "count",&#xA;    "score"&#xA;  ]&#xA;}&#xA;</code></pre>&#xA;