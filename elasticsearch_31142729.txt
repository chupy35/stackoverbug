31142729
Append to a Elasticsearch field list/array if it's not an existing element
<p>Say we have:</p>&#xA;&#xA;<pre><code>curl -XPOST "http://localhost:9200/t/t/1" -d'&#xA;{&#xA;     "hobbies" : ["a", "b"]&#xA;}'&#xA;</code></pre>&#xA;&#xA;<p>I know I can do this to append to hobbies:</p>&#xA;&#xA;<pre><code>curl -XPOST "http://localhost:9200/t/t/1/_update" -d'&#xA;{&#xA;     "script" : "ctx._source.hobbies += hobby",&#xA;     "params" : {&#xA;         "hobby" : "c"&#xA;     }&#xA;}'&#xA;</code></pre>&#xA;&#xA;<p>But how can I do it so if hobby isn't 'c' but is 'b', I won't end up with ["a", "b", "b"] for hobby? So it only appends "c" if "c" isn't a hobby already? </p>&#xA;
<p>You can achieve the same by modifying the script in OP a little </p>&#xA;&#xA;<p>Example :</p>&#xA;&#xA;<pre><code>curl -XPOST "http://localhost:9200/t/t/1/_update -d'&#xA;{&#xA;     "script" : " if(! ctx._source.hobbies.contains(hobby)){ ctx._source.hobbies += hobby }",&#xA;     "params" : {&#xA;         "hobby" : "c"&#xA;     }&#xA;}'&#xA;</code></pre>&#xA;&#xA;<p>The above  example assumes that field <em>hobbies</em> exists and is a <em>List</em> else you would need to incorporate a bit more logic to handle these.</p>&#xA;