34603898
can terms lookup mechanism query by other field but id?
<p>here is elasticsearch official website about terms:&#xA;<a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.1/query-dsl-terms-query.html" rel="nofollow">https://www.elastic.co/guide/en/elasticsearch/reference/2.1/query-dsl-terms-query.html</a></p>&#xA;&#xA;<p>As we can see, if we want to do terms lookup mechanism query, we should use command like this:</p>&#xA;&#xA;<pre><code>curl -XGET localhost:9200/tweets/_search -d '{&#xA;  "query" : {&#xA;    "terms" : {&#xA;      "user" : {&#xA;        "index" : "users",&#xA;        "type" : "user",&#xA;        "id" : "2",&#xA;        "path" : "followers"&#xA;      }&#xA;    }&#xA;  }&#xA;}'&#xA;</code></pre>&#xA;&#xA;<p>But what if i want to do query by other field of users.&#xA;Assume that users has some other fields such as name and can i use terms lookup mechanism finding the tweets by giving users name but not id. &#xA;I have tried to use command like this:</p>&#xA;&#xA;<pre><code>curl -XGET localhost:9200/tweets/_search -d '{&#xA;  "query" : {&#xA;    "terms" : {&#xA;      "user" : {&#xA;        "index" : "users",&#xA;        "type" : "user",&#xA;        "name" : "Jane",&#xA;        "path" : "followers"&#xA;      }&#xA;    }&#xA;  }&#xA;}'  &#xA;</code></pre>&#xA;&#xA;<p>but it occurs error. &#xA;Looking forward to your help. Thank you!</p>&#xA;
<p>I think you did not understand exactly how this works. Terms lookup query works by reading values from a field of a document with the given id. In this case, you are trying to match the value of field <code>user</code> in <code>tweets</code> index with values of field <code>followers</code> in document with id <code>"2"</code> present in <code>users</code> index and <code>user</code> type.</p>&#xA;&#xA;<p>If you want to read from any other field then simply mention that in <code>"path"</code>.</p>&#xA;&#xA;<p>What you mainly need to understand is that the lookup values are all fetched from a field of a <strong>single document</strong> and not multiple documents.</p>&#xA;
<p>The terms lookup mechanism is basically a built-in optimization to not have to make two queries to JOIN two indices, i.e. one in index A to get the ids to lookup and a second to fetch the documents with those ids in index B. </p>&#xA;&#xA;<p>In contrary to SQL, such a JOIN can only work on the <code>id</code> field since this is the only way to uniquely retrieve a document from Elasticsearch via a GET call, which is exactly what Elasticsearch will do in the <code>terms</code> lookup.</p>&#xA;&#xA;<p>So to answer your question, the terms lookup mechanism will not work on any other field than the <code>id</code> field since the first document to be retrieved must be unique. In your case, ES would not know how to fetch the document for the user with <code>name</code> <code>Jane</code> since <code>name</code> is just a field present in the user document, but in no way a unique identifier for user <code>Jane</code>.</p>&#xA;