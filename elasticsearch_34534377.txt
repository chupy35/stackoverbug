34534377
Unable to retrieve a geopoint data field when searching
<p>I have an index with a field called <code>loc</code> which is correctly mapped as a geopoint.</p>&#xA;&#xA;<p>When running a search like:</p>&#xA;&#xA;<pre><code>curl -XGET 'http://localhost:9200/DB/_search'&#xA;</code></pre>&#xA;&#xA;<p>I get 10 or so results and all of them appear to have <code>loc</code> inside the <code>_source</code> object.</p>&#xA;&#xA;<p>If I try:</p>&#xA;&#xA;<pre><code>curl -XGET 'http://localhost:9200/DB/_search?fields=name'&#xA;</code></pre>&#xA;&#xA;<p>I get a <code>fields</code> object with the <code>name</code> field correctly set up (<code>name</code> exists, it is another field, it is a string). Thing is, if I try the same thing with the <code>loc</code> field, as in:</p>&#xA;&#xA;<pre><code>curl -XGET 'http://localhost:9200/DB/_search?fields=loc'&#xA;</code></pre>&#xA;&#xA;<p>I don't get anything back, neither the <code>_source</code> nor the <code>fields</code> objects.</p>&#xA;&#xA;<p>How may I return the <code>loc</code> field when running this query?</p>&#xA;&#xA;<p>Bonus question: Is there a way to return the <code>loc</code> field as a geohash?</p>&#xA;&#xA;<p>Update, here's the mapping:</p>&#xA;&#xA;<pre><code>{&#xA;  "geonames": {&#xA;    "mappings": {&#xA;      "place": {&#xA;        "properties": {&#xA;          "ele": {&#xA;            "type": "string"&#xA;          },&#xA;          "geoid": {&#xA;            "type": "string"&#xA;          },&#xA;          "loc": {&#xA;            "type": "geo_point"&#xA;          },&#xA;          "name": {&#xA;            "type": "string"&#xA;          },&#xA;          "pop": {&#xA;            "type": "string"&#xA;          },&#xA;          "tz": {&#xA;            "type": "string"&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;
<p>You should use <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-source-filtering.html" rel="nofollow">source filtering</a> instead of <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-fields.html" rel="nofollow">fields</a> and you'll get the <code>loc</code> field as you expect.</p>&#xA;&#xA;<pre><code>curl -XGET 'localhost:9200/DB/_search?_source=loc'&#xA;</code></pre>&#xA;&#xA;<p>Quoting from the official documentation on fields (emphasis added):</p>&#xA;&#xA;<blockquote>&#xA;  <p>The fields parameter is about fields that are explicitly marked as stored in the mapping, which is <strong>off by default</strong> and generally not recommended. Use source filtering instead to select subsets of the original source document to be returned.</p>&#xA;</blockquote>&#xA;