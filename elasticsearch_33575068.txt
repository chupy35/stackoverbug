33575068
How to use phrase suggester results as part of a query
<p>Having spent ages reading the docs and various websites. I don't understand how one is supposed to use the phrase suggester to influence the results of a query. My understanding was that running the following query and suggester, the results from the suggester would be used for the query.</p>&#xA;&#xA;<pre><code>        POST test/test/_search&#xA;        {&#xA;        "query": {&#xA;          "multi_match": {&#xA;            "query": "anti-inefffective",&#xA;            "fields": ["*@value"]&#xA;          }&#xA;        },&#xA;        "highlight" : {&#xA;                        "fields" : {&#xA;                            "*@value" : {&#xA;                              "pre_tags" : ["&lt;mark&gt;"],&#xA;                              "post_tags" : ["&lt;/mark&gt;"]&#xA;                            }&#xA;                        }&#xA;                    },&#xA;         "suggest" : {&#xA;            "text" : "anti-inefffective"",&#xA;            "simple_phrase" : {&#xA;              "phrase" : {&#xA;                "analyzer" : "default",&#xA;                "field" : "_all",&#xA;                "size" : 1,&#xA;                "real_word_error_likelihood" : 0.95,&#xA;                "max_errors" : 0.5,&#xA;                "gram_size" : 2,&#xA;                "direct_generator" : [ {&#xA;                  "field" : "_all",&#xA;                  "suggest_mode" : "always",&#xA;                  "min_word_length" : 1&#xA;                } ],&#xA;                "highlight": {&#xA;                  "pre_tag": "&lt;em&gt;",&#xA;                  "post_tag": "&lt;/em&gt;"&#xA;                }&#xA;              }&#xA;            }&#xA;          }           &#xA;        }&#xA;</code></pre>&#xA;&#xA;<p>How can I get the results of the suggester to be used for the query term all within a json request?  All the examples I've seen have the phrase suggester executed after the query which seems bizarre to me. The only way I can see to do this would be to run a phrase suggester query then extract the value and then add it programatically to a query and then run the query with the suggested text.</p>&#xA;&#xA;<p>In other words I would like to be able to do what Google does, if you type "cancerous tummour" in Google it returns results for "cancerous tumour" but gives you the option to use the incorrect phrase but the corrected phrase is used automatically for the query.</p>&#xA;
<p>You should take a look at the <code>collate</code>+<code>query</code> option of the Phrase Suggester when used together with the <code>confidence</code> parameter.</p>&#xA;&#xA;<p>The phrase suggester workflow looks like this:</p>&#xA;&#xA;<ol>&#xA;<li><p>Suggests candidate terms for <code>cancerous</code> and <code>tummour</code> based on&#xA;the parameters passed to the candidate generator section.</p></li>&#xA;<li><p>Generates a number of 'mad-lib' phrase suggestions using the term&#xA;candidates, combining the word-frequency of the phrase terms to&#xA;generate a score for each suggestion.</p></li>&#xA;<li><p>With the collate/match option, actually <strong>runs</strong> each candidate&#xA;inside a query template (defined by you, the query author) so&#xA;that queries w/zero-results can be discarded.</p></li>&#xA;</ol>&#xA;&#xA;<hr>&#xA;&#xA;<p>To emulate the Google functionality you describe, when you run the user's query you'd also:</p>&#xA;&#xA;<ol>&#xA;<li><p>Use the phrase suggester to generate the #1 <code>"size": 1</code>, top-scoring, collated/non-zero results phrase suggestion for the original user input query.</p></li>&#xA;<li><p>With the default <code>"confidence": 1.0</code> the phrase suggester will only give you a phrase suggestion the suggester considers to be of higher confidence compared to the original user input query.</p></li>&#xA;<li><p>When you see the (higher-confidence) suggestion come back alongside the original query result, your client could decide to <strong><em>take the suggestion</em></strong> and execute the suggested query in place of the original query (while preserving the original query-text to display as a fallback search option).</p></li>&#xA;</ol>&#xA;&#xA;<hr>&#xA;&#xA;<p><strong>Short answer</strong>:  There's no option to automatically use the top suggestion within Elasticsearch as the query text.  But you could build that in your search client using the functionality currently provided by the phrase suggester.</p>&#xA;