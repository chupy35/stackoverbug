30408950
FInd the distance between current location and surrounding hotels in elasticsearch
<p>Im currently building a restaurant search website. I have listed the data regarding restaurants and indexed them using elasticsearch. A sample document is given below:</p>&#xA;&#xA;<pre><code>{&#xA;    "name" : "My Paris restaurant",&#xA;    "cuisines": "chinese",&#xA;    "location" : {&#xA;        "lat" : 1.10,&#xA;        "lon" : 1.54&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Here as you can see I have listed the geographical location data. Now I want to calculate the distance between the current location of the user to the listed hotels.&#xA;How can I do that in elasticsearch?</p>&#xA;
<p>From what I understand,you need to find out the nearest hotels from the current user location.&#xA;I assume you have done the geo_point mapping to the location fields. So here is the query explaining,how we can achieve what you are looking for:</p>&#xA;&#xA;<pre><code>{&#xA;  "query": {&#xA;    "function_score": {&#xA;      "functions": [&#xA;        {&#xA;          "gauss": {&#xA;            "location": {&#xA;              "scale": "1km",&#xA;              "origin": [&#xA;                1.231,&#xA;                1.012&#xA;              ]&#xA;            }&#xA;          }&#xA;        }&#xA;      ]&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Here there is a field called origin,which needed to be fed the user's current location. This will calculate the distance to the nearest hotels as well as then score them based on their proximity using the "function_score" query. The nearest restaurant in proximity is given more score.</p>&#xA;&#xA;<p>Or if you need to find the actual distance , there are some methods i have explained in this <a href="https://qbox.io/blog/computing-distance-from-a-reference-point-with-script-fields-and-the-explain-api" rel="nofollow">blog</a>.</p>&#xA;