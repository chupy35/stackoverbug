33411821
Elasticsearch does not assign automatically shards of lost nodes
<p>I have three elasticsearch data nodes:</p>&#xA;&#xA;<pre><code>{&#xA;  "cluster_name" : "elastic_berries",&#xA;  "status" : "green",&#xA;  "timed_out" : false,&#xA;  "number_of_nodes" : 5,&#xA;  "number_of_data_nodes" : 3,&#xA;  "active_primary_shards" : 50,&#xA;  "active_shards" : 100,&#xA;  "relocating_shards" : 0,&#xA;  "initializing_shards" : 0,&#xA;  "unassigned_shards" : 0,&#xA;  "delayed_unassigned_shards" : 0,&#xA;  "number_of_pending_tasks" : 0,&#xA;  "number_of_in_flight_fetch" : 0&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>When I remove the first node, I go into this state with some delayed_unassigned nodes which is normal:</p>&#xA;&#xA;<pre><code>{&#xA;  "cluster_name" : "elastic_berries",&#xA;  "status" : "yellow",&#xA;  "timed_out" : false,&#xA;  "number_of_nodes" : 4,&#xA;  "number_of_data_nodes" : 2,&#xA;  "active_primary_shards" : 50,&#xA;  "active_shards" : 66,&#xA;  "relocating_shards" : 0,&#xA;  "initializing_shards" : 0,&#xA;  "unassigned_shards" : 34,&#xA;  "delayed_unassigned_shards" : 34,&#xA;  "number_of_pending_tasks" : 0,&#xA;  "number_of_in_flight_fetch" : 0&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Then: </p>&#xA;&#xA;<pre><code>{&#xA;  "cluster_name" : "elastic_berries",&#xA;  "status" : "yellow",&#xA;  "timed_out" : false,&#xA;  "number_of_nodes" : 4,&#xA;  "number_of_data_nodes" : 2,&#xA;  "active_primary_shards" : 50,&#xA;  "active_shards" : 66,&#xA;  "relocating_shards" : 0,&#xA;  "initializing_shards" : 0,&#xA;  "unassigned_shards" : 34,&#xA;  "delayed_unassigned_shards" : 0,&#xA;  "number_of_pending_tasks" : 0,&#xA;  "number_of_in_flight_fetch" : 0&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>However, I am requesting only one replica, the cluster should automatically assigned unassigned shards and go back into green status. I have to run manually this command:</p>&#xA;&#xA;<blockquote>&#xA;  <p>curl -XPUT 'localhost:9200/_cluster/settings' -d '{&#xA;      "transient" : {&#xA;          "cluster.routing.allocation.enable" : "all"&#xA;      } }'</p>&#xA;</blockquote>&#xA;&#xA;<p>To go back into green state. Is there a way to make this feature automatic? </p>&#xA;