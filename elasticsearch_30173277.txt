30173277
elasticsearch how to find number of occurrences
<p>I wonder if it's possible to convert this sql query into ES query?&#xA;<strong>select top 10 app, cat, count(*) from err group by app, cat</strong></p>&#xA;&#xA;<p>Or in English it would be answering: "Show top app, cat and their counts", so this will be grouping by multiple fields and returning name and count. </p>&#xA;
<p><a href="http://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-terms-aggregation.html" rel="nofollow">Terms aggregation</a> is what you are looking for.</p>&#xA;
<p>For aggregating on a combination of multiple fields, you have to use scripting in <code>Terms Aggregation</code> like below:</p>&#xA;&#xA;<pre><code>POST &lt;index name&gt;/&lt;type name&gt;/_search?search_type=count&#xA;{&#xA;  "aggs": {&#xA;    "app_cat": {&#xA;      "terms": {&#xA;        "script" : "doc['app'].value + '#' + doc['cat'].value",&#xA;        "size": 10&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>I am using <code>#</code> as a delimiter assuming that it is not present in any value of <code>app</code> and/or <code>cat</code> fields. You can use any other delimiter of your choice. You'll get a response something like below:</p>&#xA;&#xA;<pre><code>{&#xA;   "took": 3,&#xA;   "timed_out": false,&#xA;   "_shards": {&#xA;      "total": 5,&#xA;      "successful": 5,&#xA;      "failed": 0&#xA;   },&#xA;   "hits": {&#xA;      "total": 10,&#xA;      "max_score": 0,&#xA;      "hits": []&#xA;   },&#xA;   "aggregations": {&#xA;      "app_cat": {&#xA;         "buckets": [&#xA;            {&#xA;               "key": "app2#cat2",&#xA;               "doc_count": 4&#xA;            },&#xA;            {&#xA;               "key": "app1#cat1",&#xA;               "doc_count": 3&#xA;            },&#xA;            {&#xA;               "key": "app2#cat1",&#xA;               "doc_count": 2&#xA;            },&#xA;            {&#xA;               "key": "app1#cat2",&#xA;               "doc_count": 1&#xA;            }&#xA;         ]&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>On the client side, you can get the individual values of <code>app</code> and <code>cat</code> fields from the aggregation response by string manipulations.</p>&#xA;&#xA;<p>In newer versions of Elasticsearch, scripting is disabled by default due to security reasons. If you want to enable scripting, read <a href="http://www.elastic.co/guide/en/elasticsearch/reference/current/modules-scripting.html" rel="nofollow">this</a>.</p>&#xA;