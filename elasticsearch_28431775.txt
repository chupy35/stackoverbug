28431775
does elasticsearch support queries of queries?
<p>I have an index which has two types:</p>&#xA;&#xA;<ul>&#xA;<li><code>marker</code>, with fields <code>name</code> and <code>age</code></li>&#xA;<li><code>data</code>, with the fields <code>name</code>, <code>age</code> and <code>car</code></li>&#xA;</ul>&#xA;&#xA;<p><code>marker</code> has 20k entries, <code>data</code> - 200k.</p>&#xA;&#xA;<p>I would like to understand if this is possible natively to issue a query of the type</p>&#xA;&#xA;<blockquote>&#xA;  <p>find in <code>data</code> all entries where <code>name</code> and <code>age</code> match an entry in <code>marker</code></p>&#xA;</blockquote>&#xA;&#xA;<p>An an example, if <code>marker</code> has</p>&#xA;&#xA;<pre><code>"name": "john", "age": 23&#xA;"name": "john", "age": 30&#xA;"name": "monica", "age": 27&#xA;</code></pre>&#xA;&#xA;<p>and <code>data</code> </p>&#xA;&#xA;<pre><code>"name": "john", "age": 30, "car": "renault"&#xA;"name": "john", "age": 30, "car": "peugeot"&#xA;"name": "john", "age": 99, "car": "fiat"&#xA;"name": "bob", "age": 42, "car": "fiat"&#xA;</code></pre>&#xA;&#xA;<p>the result would be </p>&#xA;&#xA;<pre><code>"name": "john", "age": 30, "car": "renault"&#xA;"name": "john", "age": 30, "car": "peugeot"&#xA;</code></pre>&#xA;&#xA;<p>because only these two matched an entry in <code>marker</code> for <code>name</code> and <code>age</code>.</p>&#xA;&#xA;<p>I am planning to do this match in Python by getting everything in <code>markers</code> and <code>data</code>, munching the data and send back in bulk the results (to a new index). It looks to me that this is an awfully inefficient way to do such queries, particularly if sizes are not in thousands but in tens of millions of entries.</p>&#xA;
<p>That's not possible. You either need to use nested or parent/child documents (which you are not at the moment) or use a two step process (get all the values in <code>marker</code> and then match them against <code>data</code>), but that's not practical with so many entries.</p>&#xA;