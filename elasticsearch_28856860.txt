28856860
QueryParsingException failed to find geo_point field
<p>I am getting <code>QueryParsingException[[listings] failed to find geo_point field [location.coords]]; }]</code> and can't quite figure out why.</p>&#xA;&#xA;<p>My Query</p>&#xA;&#xA;<pre><code>esClient.search({&#xA;    index: 'listings',&#xA;    body: {&#xA;        query: {&#xA;            filtered: {&#xA;                query: {&#xA;                    match_all: {}&#xA;                },&#xA;                filter: {&#xA;                    geo_distance: {&#xA;                        distance: '10km',&#xA;                        'location.coords': {&#xA;                            lat: parseFloat(query.point.lat),&#xA;                            lon: parseFloat(query.point.lon)&#xA;                        }&#xA;                    }&#xA;                }&#xA;            }&#xA;        }&#xA;    }&#xA;}, function(err, response) {&#xA;    if(err) return console.log(err);&#xA;    console.log(response);&#xA;});&#xA;</code></pre>&#xA;&#xA;<p>My mapping (as you can see -yes, I did use geo_point type)</p>&#xA;&#xA;<pre><code>    body: {&#xA;        properties: {&#xA;            location: {&#xA;                type: 'object',&#xA;                properties: {&#xA;                    country: {&#xA;                        type: 'integer'&#xA;                    },&#xA;                    address: {&#xA;                        type: 'string'&#xA;                    },&#xA;                    suburb: {&#xA;                        type: 'string'&#xA;                    },&#xA;                    coords: {&#xA;                        type: 'geo_point',&#xA;                        precision: '3m'&#xA;                    }&#xA;                }&#xA;            }&#xA;        }&#xA;    }&#xA;</code></pre>&#xA;&#xA;<p>EDIT:</p>&#xA;&#xA;<p>After looking up <a href="http://localhost:9200/listings/_mapping/my-mapping" rel="nofollow noreferrer">http://localhost:9200/listings/_mapping/my-mapping</a>, I noticed the coords field have the lat, lon set to double - could this have something to do with it.</p>&#xA;&#xA;<p><img src="https://i.stack.imgur.com/wYsXT.png" alt="json response"></p>&#xA;
<p>Ok so it turns out this was happening because of how I was defining the geo_point's precision (needs to be wrapped in fielddata property), oddly the JS api i'm using didn't throw any kind of error that I recall:</p>&#xA;&#xA;<p><strong>Correct:</strong></p>&#xA;&#xA;<pre><code>coords: {&#xA;    type: 'geo_point',&#xA;    fielddata: {&#xA;        format: 'compressed',&#xA;        precision: '3m'&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p><strong>Incorrect:</strong></p>&#xA;&#xA;<pre><code>coords: {&#xA;        type: 'geo_point',&#xA;        precision: '3m'&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>And voila...</p>&#xA;&#xA;<p><img src="https://i.stack.imgur.com/jEagx.png" alt="correct geopoint mapping"></p>&#xA;