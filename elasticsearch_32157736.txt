32157736
Filtered query - retrieve the number of filtered documents per filter
<p>When executing a filtered query with 3 filters, is there a way to know which filter, filtered how many documents? </p>&#xA;&#xA;<p>I have like 20 more filters, and sometimes only one of the filter is problematic filtering all the documents, I would like to get indication for this.</p>&#xA;&#xA;<p>Does this make sense?</p>&#xA;
<p>Yes, you can do it with a <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-filters-aggregation.html" rel="nofollow"><code>filters</code> aggregation</a>. Put each of your filters in the inner <code>filters</code> hash and in the response you'll see the <code>doc_count</code> matching each filter.</p>&#xA;&#xA;<pre><code>{&#xA;  "size": 0,&#xA;  "aggs": {&#xA;    "messages": {&#xA;      "filters": {&#xA;        "filters": {&#xA;          "filter1": {&#xA;            "term": {&#xA;              "field1": "sample1"&#xA;            }&#xA;          },&#xA;          "filter2": {&#xA;            "term": {&#xA;              "field2": "sample2"&#xA;            }&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Then when you have that information, it's a good idea to rework your query and order your filters starting with the ones selecting the fewest documents, so that the next filters down the chain work on as few document as possible.</p>&#xA;