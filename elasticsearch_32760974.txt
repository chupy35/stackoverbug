32760974
Elasticsearch additional boost if multiple conditions are met
<p>Imagine I have a document, which looks like this:</p>&#xA;&#xA;<pre><code>{&#xA;  "Title": "Smartphones in United Kingdom",&#xA;  "Text": "A huge text about the topic",&#xA;  "CategoryTags": [&#xA;    {&#xA;      "CategoryID": 1,&#xA;      "CategoryName": "Smartphone"&#xA;    },&#xA;    {&#xA;      "CategoryID": 2,&#xA;      "CategoryName": "Apple"&#xA;    },&#xA;    {&#xA;      "CategoryID": 3,&#xA;      "CategoryName": "Samsung"&#xA;    }&#xA;  ],&#xA;  "GeographyTags": [&#xA;    {&#xA;      "GeographyID": 1,&#xA;      "GeographyName": "Western Europe"&#xA;    },&#xA;    {&#xA;      "GeographyID": 2,&#xA;      "GeographyName": "United Kingdom"&#xA;    }&#xA;  ]&#xA;}&#xA;</code></pre>&#xA;&#xA;<p><code>CategoryTags</code> and <code>GeographyTags</code> are stored as nested subdocuments.</p>&#xA;&#xA;<p>I'd be looking for "apple united kingdom" in my search bar. How'd I make a query that would boost this document if it has both matching category and geography at the same time?</p>&#xA;&#xA;<p>I was thinking of <a href="https://www.elastic.co/guide/en/elasticsearch/reference/1.4/query-dsl-multi-match-query.html" rel="nofollow">multi_match</a> query, but I didn't figure out how would I deal with nested documents here...</p>&#xA;&#xA;<p>I was thinking of nesting must into should statement. Would that make any sense?</p>&#xA;&#xA;<pre><code>POST /_search&#xA;{&#xA;  "template": {&#xA;    "size": "50",&#xA;    "_source": {&#xA;      "include": "Title"&#xA;    },&#xA;    "query": {&#xA;      "filtered": {&#xA;        "query": {&#xA;          "bool": {&#xA;            "minimum_number_should_match": "2&lt;50%",&#xA;            "must": [&#xA;              {&#xA;                "match": {&#xA;                  "Text": {&#xA;                    "query": "{{SearchPhrase}}"&#xA;                  }&#xA;                }&#xA;              }&#xA;            ],&#xA;            "should": [&#xA;              {&#xA;                "match": {&#xA;                  "Title": {&#xA;                    "query": "{{SearchPhrase}}",&#xA;                    "type": "phrase",&#xA;                    "boost": "20"&#xA;                  }&#xA;                }&#xA;              },&#xA;              {&#xA;                "bool": {&#xA;                  "must": [&#xA;                    {&#xA;                      "nested": {&#xA;                        "path": "CategoryTags",&#xA;                        "query": {&#xA;                          "match": {&#xA;                            "CategoryTags.CategoryName": "{{SearchPhrase}}"&#xA;                          }&#xA;                        }&#xA;                      }&#xA;                    },&#xA;                    {&#xA;                      "nested": {&#xA;                        "path": "GeographyTags",&#xA;                        "query": {&#xA;                          "match": {&#xA;                            "GeographyTags.GeographyName": "{{SearchPhrase}}"&#xA;                          }&#xA;                        }&#xA;                      }&#xA;                    }&#xA;                  ]&#xA;                }&#xA;              }&#xA;            ]&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;