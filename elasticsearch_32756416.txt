32756416
How to filter out elements from an array that doesnâ€™t match the query?
<p>stackoverflow won't let me write that much example code so I put it on gist.</p>&#xA;&#xA;<p>So I have this <a href="https://gist.github.com/Alino/4f7a80ee63012275605e#file-index" rel="nofollow">index</a></p>&#xA;&#xA;<p>with this <a href="https://gist.github.com/Alino/4f7a80ee63012275605e#file-mapping" rel="nofollow">mapping</a> </p>&#xA;&#xA;<p>here is a <a href="https://gist.github.com/Alino/4f7a80ee63012275605e#file-sample-product" rel="nofollow">sample document</a> I insert into newly created mapping</p>&#xA;&#xA;<hr>&#xA;&#xA;<p>this is my query</p>&#xA;&#xA;<pre><code>GET products/paramSuggestions/_search&#xA;{&#xA;   "size": 10,&#xA;   "query": {&#xA;      "filtered": {&#xA;         "query": {&#xA;            "match": {&#xA;               "paramName": {&#xA;                  "query": "col",&#xA;                  "operator": "and"&#xA;               }&#xA;            }&#xA;         }&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>this is the <strong>unwanted</strong> result I get from previous query</p>&#xA;&#xA;<pre><code>{&#xA;   "took": 2,&#xA;   "timed_out": false,&#xA;   "_shards": {&#xA;      "total": 5,&#xA;      "successful": 5,&#xA;      "failed": 0&#xA;   },&#xA;   "hits": {&#xA;      "total": 1,&#xA;      "max_score": 0.33217794,&#xA;      "hits": [&#xA;         {&#xA;            "_index": "products",&#xA;            "_type": "paramSuggestions",&#xA;            "_id": "1",&#xA;            "_score": 0.33217794,&#xA;            "_source": {&#xA;               "productName": "iphone 6",&#xA;               "params": [&#xA;                  {&#xA;                     "paramName": "color",&#xA;                     "value": "white"&#xA;                  },&#xA;                  {&#xA;                     "paramName": "capacity",&#xA;                     "value": "32GB"&#xA;                  }&#xA;               ]&#xA;            }&#xA;         }&#xA;      ]&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>and finally the <strong>wanted</strong> result, how I want the query result to look like</p>&#xA;&#xA;<pre><code>{&#xA;   "took": 2,&#xA;   "timed_out": false,&#xA;   "_shards": {&#xA;      "total": 5,&#xA;      "successful": 5,&#xA;      "failed": 0&#xA;   },&#xA;   "hits": {&#xA;      "total": 1,&#xA;      "max_score": 0.33217794,&#xA;      "hits": [&#xA;         {&#xA;            "_index": "products",&#xA;            "_type": "paramSuggestions",&#xA;            "_id": "1",&#xA;            "_score": 0.33217794,&#xA;            "_source": {&#xA;               "productName": "iphone 6",&#xA;               "params": [&#xA;                  {&#xA;                     "paramName": "color",&#xA;                     "value": "white"&#xA;                  },&#xA;               ]&#xA;            }&#xA;         }&#xA;      ]&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>How should the query look like to achieve the wanted result with filtered array field which matches the query? In other words, <strong>all other non-matching array items should not appear in the final result</strong>.</p>&#xA;
<p>The final result is the <code>_source</code> document that you indexed.  There is no feature that lets you <em>mask</em> field elements of your document out of the Elasticsearch response.   </p>&#xA;&#xA;<p>That said, depending on your goal, you can look into how <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.0/search-request-highlighting.html" rel="nofollow">Highlighters</a> and <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.0/search-suggesters.html" rel="nofollow">Suggesters</a> identify result terms matching the query, or possibly, roll-your-own client-side masking using <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-explain.html" rel="nofollow">info returned</a> from setting <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-explain.html" rel="nofollow">"explain": true</a> in your query.</p>&#xA;