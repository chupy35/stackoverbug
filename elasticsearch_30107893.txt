30107893
Elasticsearch external document "terms" search query not working
<p>I am trying to do "terms" query using document on other index as the source for search string. However I am not getting any hits.</p>&#xA;&#xA;<p>-- index the information for user with id 2, specifically, its followers</p>&#xA;&#xA;<pre><code>curl -XPUT localhost:9200/users/user/2 -d '{&#xA;   "followers" : ["1", "3"]&#xA;}'&#xA;</code></pre>&#xA;&#xA;<p>-- index a tweet, from user with id 2</p>&#xA;&#xA;<pre><code>curl -XPUT localhost:9200/tweets/tweet/1 -d '{&#xA;   "user" : "2"&#xA;}'&#xA;</code></pre>&#xA;&#xA;<p>-- search on all the tweets that match the followers of user 2</p>&#xA;&#xA;<pre><code>curl -XGET localhost:9200/tweets/_search -d '{&#xA;  "query" : {&#xA;    "filtered" : {&#xA;      "filter" : {&#xA;        "terms" : {&#xA;          "user" : {&#xA;            "index" : "users",&#xA;            "type" : "user",&#xA;            "id" : "2",&#xA;            "path" : "followers"&#xA;          },&#xA;          "_cache_key" : "user_2_friends"&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}'&#xA;</code></pre>&#xA;&#xA;<p>Result: 0 hits.</p>&#xA;&#xA;<p>However if I change the query to:</p>&#xA;&#xA;<pre><code>{&#xA;  "query" : {&#xA;    "filtered" : {&#xA;      "filter" : {&#xA;        "terms" : {&#xA;          "user" : [2]&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}'&#xA;</code></pre>&#xA;&#xA;<p>Above query gives me 1 hit, which means there is some problem with the external search query.</p>&#xA;&#xA;<p>Details:&#xA;<a href="http://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-terms-filter.html" rel="nofollow">http://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-terms-filter.html</a></p>&#xA;&#xA;<p>I am using ES version: 1.5.2 also tried the query in 1.4.</p>&#xA;&#xA;<p>Any suggestions?</p>&#xA;
<p>The query :</p>&#xA;&#xA;<pre><code>{&#xA;  "query" : {&#xA;    "filtered" : {&#xA;      "filter" : {&#xA;        "terms" : {&#xA;          "user" : [1,3]&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}'&#xA;</code></pre>&#xA;&#xA;<p>is the same as </p>&#xA;&#xA;<pre><code>{&#xA;  "query" : {&#xA;    "filtered" : {&#xA;      "filter" : {&#xA;        "terms" : {&#xA;          "user" : {&#xA;            "index" : "users",&#xA;            "type" : "user",&#xA;            "id" : "2",&#xA;            "path" : "followers"&#xA;          },&#xA;          "_cache_key" : "user_2_friends"&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>and not the one you have in the OP. &#xA;You probably did not index tweets for user 1 and 3.</p>&#xA;