33369955
low disk watermark [??%] exceeded on
<p>I use Elasticsearch 1.4.4 in my development machine (a single notebook). Everything is set as default because I never changed any settings.</p>&#xA;&#xA;<p>When I start it, I usually get the following message: </p>&#xA;&#xA;<pre><code>[2015-10-27 09:38:31,588][INFO ][node                     ] [Milan] version[1.4.4], pid[33932], build[c88f77f/2015-02-19T13:05:36Z]&#xA;[2015-10-27 09:38:31,588][INFO ][node                     ] [Milan] initializing ...&#xA;[2015-10-27 09:38:31,592][INFO ][plugins                  ] [Milan] loaded [], sites []&#xA;[2015-10-27 09:38:34,665][INFO ][node                     ] [Milan] initialized&#xA;[2015-10-27 09:38:34,665][INFO ][node                     ] [Milan] starting ...&#xA;[2015-10-27 09:38:34,849][INFO ][transport                ] [Milan] bound_address {inet[/0:0:0:0:0:0:0:0:9300]}, publish_address {inet[/10.81.1.108:9300]}&#xA;[2015-10-27 09:38:35,022][INFO ][discovery                ] [Milan] elasticsearch/DZqnmWIZRpapZY_TPkkMBw&#xA;[2015-10-27 09:38:38,787][INFO ][cluster.service          ] [Milan] new_master [Milan][DZqnmWIZRpapZY_TPkkMBw][THINKANDACT1301][inet[/10.81.1.108:9300]], reason: zen-disco-join (elected_as_master)&#xA;[2015-10-27 09:38:38,908][INFO ][http                     ] [Milan] bound_address {inet[/0:0:0:0:0:0:0:0:9200]}, publish_address {inet[/10.81.1.108:9200]}&#xA;[2015-10-27 09:38:38,908][INFO ][node                     ] [Milan] started&#xA;[2015-10-27 09:38:39,220][INFO ][gateway                  ] [Milan] recovered [4] indices into cluster_state&#xA;[2015-10-27 09:39:08,801][INFO ][cluster.routing.allocation.decider] [Milan] low disk watermark [15%] exceeded on [DZqnmWIZRpapZY_TPkkMBw][Milan] free: 58.6gb[12.6%], replicas will not be assigned to this node&#xA;[2015-10-27 09:39:38,798][INFO ][cluster.routing.allocation.decider] [Milan] low disk watermark [15%] exceeded on [DZqnmWIZRpapZY_TPkkMBw][Milan] free: 58.6gb[12.6%], replicas will not be assigned to this node&#xA;[2015-10-27 09:40:08,801][INFO ][cluster.routing.allocation.decider] [Milan] low disk watermark [15%] exceeded on [DZqnmWIZRpapZY_TPkkMBw][Milan] free: 58.6gb[12.6%], replicas will not be assigned to this node&#xA;....&#xA;</code></pre>&#xA;&#xA;<p>I see a lot of these "low disk watermark ... exceeded on..." messages. What went wrong in my case? How to fix it? Thanks!</p>&#xA;&#xA;<p><strong>UPDATE</strong></p>&#xA;&#xA;<p>Before this post, I searched SO for related posts. I found one related to "high watermark..." and in that case, the disk space is low. In my case, I checked and <strong>there is still 56GB left on my disk.</strong></p>&#xA;&#xA;<p><strong>UPDATE</strong></p>&#xA;&#xA;<p>According to the input from Andrei Stefan, I need to change settings. Should I do it the following way:</p>&#xA;&#xA;<pre><code>curl -XPUT localhost:9200/_cluster/settings -d '{&#xA;    "transient" : {&#xA;        "cluster.routing.allocation.disk.threshold_enabled" : false&#xA;    }&#xA;}'&#xA;</code></pre>&#xA;&#xA;<p>Or is there any settings file I can edit to set it?</p>&#xA;&#xA;<p>Thanks!</p>&#xA;
<p>If you like me have a lot of disk you can tune the watermark setting:</p>&#xA;&#xA;<blockquote>&#xA;  <p>cluster.routing.allocation.disk.watermark.low</p>&#xA;  &#xA;  <p>Controls the low watermark for disk usage. It defaults to 85%, meaning ES will not allocate new shards to nodes once they have more than 85% disk used. It can also be set to an absolute byte value (like 500mb) to prevent ES from allocating shards if less than the configured amount of space is available.</p>&#xA;</blockquote>&#xA;&#xA;<p>And</p>&#xA;&#xA;<blockquote>&#xA;  <p>cluster.routing.allocation.disk.watermark.high</p>&#xA;  &#xA;  <p>Controls the high watermark. It defaults to 90%, meaning ES will attempt to relocate shards to another node if the node disk usage rises above 90%. It can also be set to an absolute byte value (similar to the low watermark) to relocate shards once less than the configured amount of space is available on the node.</p>&#xA;</blockquote>&#xA;&#xA;<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/disk-allocator.html" rel="noreferrer">https://www.elastic.co/guide/en/elasticsearch/reference/current/disk-allocator.html</a></p>&#xA;&#xA;<p>Please note:</p>&#xA;&#xA;<blockquote>&#xA;  <p>Percentage values refer to used disk space, while byte values refer to free disk space. This can be confusing, since it flips the meaning of high and low. For example, it makes sense to set the low watermark to 10gb and the high watermark to 5gb, but not the other way around.</p>&#xA;</blockquote>&#xA;&#xA;<p>On my 5TB disk I've set:</p>&#xA;&#xA;<pre><code># /etc/elasticsearch/elasticsearch.yml&#xA;cluster.routing.allocation.disk.threshold_enabled: true&#xA;cluster.routing.allocation.disk.watermark.low: 30gb&#xA;cluster.routing.allocation.disk.watermark.high: 20gb&#xA;</code></pre>&#xA;
<p>I added the following lines to my <code>elasticsearch.yaml</code> file (elastic_search_folder\config):</p>&#xA;&#xA;<pre><code>cluster.routing.allocation.disk.threshold_enabled: true&#xA;cluster.routing.allocation.disk.watermark.low: 93%&#xA;cluster.routing.allocation.disk.watermark.high: 95%&#xA;</code></pre>&#xA;&#xA;<p>For some reason, specifying watermark in gb like in the other answer didn't work for me. Also, make sure your <code>watermark.high</code> is less or equal to the flood watermark (it's usually set to 95%).</p>&#xA;
<p>I know it is old post, but my comment can make someone happy. In order to specify watermark in bytes values (gb or mb) you have to add &#xA;cluster.routing.allocation.disk.watermark.flood_stage to your elasticsearch settings file - elasticsearch.yml. Complete example: </p>&#xA;&#xA;<pre><code>  cluster.routing.allocation.disk.threshold_enabled: true &#xA;  cluster.routing.allocation.disk.watermark.flood_stage: 200mb&#xA;  cluster.routing.allocation.disk.watermark.low: 500mb &#xA;  cluster.routing.allocation.disk.watermark.high: 300mb&#xA;</code></pre>&#xA;&#xA;<p>Note: without specifying cluster.routing.allocation.disk.watermark.flood_stage it will not work with bytes value (gb or mb)  </p>&#xA;