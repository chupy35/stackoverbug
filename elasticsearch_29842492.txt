29842492
Elasticsearch context suggester, bool on contexts
<p>I'm using context suggester and am wondering if we can set the scope of the context to be used for suggestions rather that using all contexts.</p>&#xA;&#xA;<p>Currently the query needs to match all contexts. Can we add an "OR" operation on the contexts and/or specify which context to use for  a particular query?</p>&#xA;&#xA;<p>Taking the example from <a href="https://www.elastic.co/blog/elasticsearch-1-2-adding-context-suggestions">here</a> :&#xA;Mapping :</p>&#xA;&#xA;<pre><code>PUT /venues/poi/_mapping&#xA;{&#xA;  "poi" : {&#xA;    "properties" : {&#xA;      "suggest_field": {&#xA;        "type": "completion",&#xA;        "context": {&#xA;          "type": { &#xA;            "type": "category"&#xA;          },        &#xA;          "location": { &#xA;            "type": "geo",&#xA;            "precision" : "500m"&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Then I index a document :</p>&#xA;&#xA;<pre><code> {&#xA;  "suggest_field": {&#xA;    "input": ["The Shed", "shed"],&#xA;    "output" : "The Shed - fresh sea food",&#xA;    "context": {&#xA;      "location": {&#xA;        "lat": 51.9481442,&#xA;        "lon": -5.1817516&#xA;      },      &#xA;      "type" : "restaurant"&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Query: </p>&#xA;&#xA;<pre><code>{&#xA;  "suggest" : {&#xA;    "text" : "s",&#xA;    "completion" : {&#xA;      "field" : "suggest_field",&#xA;      "context": {&#xA;        "location": {&#xA;          "value": {&#xA;            "lat": 51.938119,&#xA;            "lon": -5.174051&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>If I query using only one Context ("location" in the above example) it gives an error, I need to pass both the contexts, is it possible to specify which context to use? Or pass something like a "Context_Operation" parameter set to "OR".</p>&#xA;
<p>You have 2 choices:</p>&#xA;&#xA;<p>First you add all available type values as default in your mapping (not scalable)</p>&#xA;&#xA;<pre><code>{&#xA;  "poi" : {&#xA;    "properties" : {&#xA;      "suggest_field": {&#xA;        "type": "completion",&#xA;        "context": {&#xA;          "type": { &#xA;            "type": "category",&#xA;            "default": ["restaurant", "pool", "..."]&#xA;          },        &#xA;          "location": { &#xA;            "type": "geo",&#xA;            "precision" : "500m"&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Second option, you add a default value to every indexed document, and you add only this value as default</p>&#xA;&#xA;<p>Mapping:</p>&#xA;&#xA;<pre><code>{&#xA;  "poi" : {&#xA;    "properties" : {&#xA;      "suggest_field": {&#xA;        "type": "completion",&#xA;        "context": {&#xA;          "type": { &#xA;            "type": "category",&#xA;            "default": "any"&#xA;          },        &#xA;          "location": { &#xA;            "type": "geo",&#xA;            "precision" : "500m"&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Document:</p>&#xA;&#xA;<pre><code>{&#xA;  "suggest_field": {&#xA;    "input": ["The Shed", "shed"],&#xA;    "output" : "The Shed - fresh sea food",&#xA;    "context": {&#xA;      "location": {&#xA;        "lat": 51.9481442,&#xA;        "lon": -5.1817516&#xA;      },      &#xA;      "type" : ["any", "restaurant"]&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;