32386866
Elasticsearch query_string with both explicit field and fields attribute
<p>If I were to create a query like this:</p>&#xA;&#xA;<pre><code>"query": {&#xA;  "query_string": {&#xA;    "query": "User:mjohnst",&#xA;    "default_field": "Text",&#xA;    "fields": [&#xA;       "Text",&#xA;       "ProcessedText"&#xA;    ], &#xA;    "default_operator": "and",&#xA;    "lowercase_expanded_terms": false&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Where the <code>query_string</code> -> <code>query</code> is specifying a field explicitly, but the <code>fields</code> property is set to other fields, what is the expected behavior? Will <code>User</code>, <code>Text</code>, and <code>ProcessedText</code> be searched, or just <code>User</code>?</p>&#xA;
<p>Tested this out on some documents and it will only return the documents that match the search on just <code>User</code></p>&#xA;
<p>The simplest way to test it is by using validate query API:</p>&#xA;&#xA;<pre><code>curl "localhost:9200/test/doc/_validate/query?pretty&amp;explain" -d '{&#xA;    "query": {&#xA;        "query_string": {&#xA;            "query": "User:mjohnst blah",&#xA;            "default_field": "Text",&#xA;            "fields": [&#xA;                "Text",&#xA;                "ProcessedText"&#xA;            ],&#xA;            "default_operator": "and",&#xA;            "lowercase_expanded_terms": false&#xA;        }&#xA;    }&#xA;}'&#xA;&#xA;{&#xA;  "valid" : true,&#xA;  "_shards" : {&#xA;    "total" : 1,&#xA;    "successful" : 1,&#xA;    "failed" : 0&#xA;  },&#xA;  "explanations" : [ {&#xA;    "index" : "test",&#xA;    "valid" : true,&#xA;    "explanation" : "filtered(+User:mjohnst +(Text:blah | ProcessedText:blah))-&gt;cache(_type:doc)"&#xA;  } ]&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>As you can see the term with explicitly specified field <code>mjonst</code> is searched against this field (<code>User</code>) the term <code>blah</code>without field is searched against all fields in the <code>fields</code> list.</p>&#xA;