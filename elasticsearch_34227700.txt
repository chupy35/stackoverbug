34227700
ElasticSearch - Upgraded indexed field to a Multi Field - new field is empty
<p>Having noticed my sort on an indexed string field doesn't work properly, I've discovered that it's sorting analyzed strings so "bags of words" and if I want it to work properly I have to sort on the non-analyzed string. My plan was to just change the string field to a multi-field, using information I found in those two articles:</p>&#xA;&#xA;<p><a href="https://www.elastic.co/blog/changing-mapping-with-zero-downtime" rel="nofollow">https://www.elastic.co/blog/changing-mapping-with-zero-downtime</a>  (Upgrade to a multi-field part)&#xA;<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-put-mapping.html" rel="nofollow">https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-put-mapping.html</a></p>&#xA;&#xA;<p>Using Sense I've created this field mapping</p>&#xA;&#xA;<pre><code>PUT myindex/_mapping/type&#xA;{&#xA;   "properties": {&#xA;      "Title": {&#xA;         "type": "string",&#xA;         "fields": {&#xA;            "Raw": {&#xA;               "type": "string",&#xA;               "index": "not_analyzed"&#xA;            }&#xA;         }&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>And then I try to sort my search results using the newly made field. I've put all of the name variations I could think of after reading the articles:</p>&#xA;&#xA;<pre><code>POST myindex/_search&#xA;{&#xA;    "_source" : ["Title","titlemap.Raw","titlemap.Title","titlemap.Title.Raw","Title.Title","Raw","Title.Raw"],&#xA;    "size": 6,&#xA;    "query": {&#xA;        "multi_match": {&#xA;            "query": "title",&#xA;            "fields": ["Title^5"&#xA;            ],&#xA;            "fuzziness": "auto",&#xA;            "type": "best_fields"&#xA;        }&#xA;    },&#xA;    "sort": {&#xA;        "Title.Raw": "asc"&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>And that's what I get in response:</p>&#xA;&#xA;<pre><code>{&#xA;    "_index": "myindex_2015_11_26_12_22_38",&#xA;    "_type": "type",&#xA;    "_id": "1205",&#xA;    "_score": null,&#xA;    "_source": {&#xA;       "Title": "The title of the item"&#xA;    },&#xA;    "sort": [&#xA;       null&#xA;    ]&#xA; }&#xA;</code></pre>&#xA;&#xA;<p>Only the Title field's value is shown in the response and the sort criterium is null for every result.</p>&#xA;&#xA;<p>Am I doing something wrong, or is there another way to do that?</p>&#xA;
<p>The index name is not the same after re-indexing and thus the default mapping gets installed... that's probably why. </p>&#xA;&#xA;<p>I suggest using an <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-templates.html" rel="nofollow">index template</a> instead, so you don't have to care when to create the index and ES will do it for you. The idea is to create a template with the proper mapping you need and then ES will create every new index whenever it deems necessary, add the <code>myindex</code> alias and apply the proper mapping to it.</p>&#xA;&#xA;<pre><code>curl -XPUT localhost:9200/_template/myindex_template -d '{&#xA;  "template": "myindex_*",&#xA;  "settings": {&#xA;    "number_of_shards": 1&#xA;  },&#xA;  "aliases": {&#xA;     "myindex": {}&#xA;  },&#xA;  "mappings": {&#xA;    "type": {&#xA;      "properties": {&#xA;        "Title": {&#xA;          "type": "string",&#xA;          "fields": {&#xA;            "Raw": {&#xA;              "type": "string",&#xA;              "index": "not_analyzed"&#xA;            }&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}'&#xA;</code></pre>&#xA;&#xA;<p>Then whenever you launch your re-indexing process a new index with a new name will be created BUT with the proper mapping and the proper alias.</p>&#xA;