32014539
Elasticsearch as a solution for automapping different data
<p>This is a tricky one.</p>&#xA;&#xA;<p>I'm currently working in a travel agency that needs to map its hotels to other agencies hotels. So let's say that we got an hotel like this one:</p>&#xA;&#xA;<p><strong>Code123, Hotel name 123, street 123, postcode132, country123</strong></p>&#xA;&#xA;<p>And we want to map it to other hotel that is:</p>&#xA;&#xA;<p><strong>ACode123, Hotel 123 name, st 123, pc132, country123</strong></p>&#xA;&#xA;<p>Regarding this, I want to ask two questions:&#xA;Is elasticsearch a good solution for this case? So far, I've gotten some good results thanks to elasticsearch nice features regarding search but I've also gotten some misleading matches (for instance, when having long addresses that should match with short addresses).</p>&#xA;&#xA;<p>The other one is, if it's a good solution, which approach should I take?&#xA;To give you more context, this is what I got so far:</p>&#xA;&#xA;<pre><code>{&#xA;  "query": {&#xA;    "bool": {&#xA;      "must": [&#xA;        {&#xA;          "bool": {&#xA;            "must": [&#xA;              {&#xA;                "bool": {&#xA;                  "must": [&#xA;                    {&#xA;                      "bool": {&#xA;                        "must": [&#xA;                          {&#xA;                            "bool": {&#xA;                              "must": [&#xA;                                {&#xA;                                  "bool": {&#xA;                                    "must": [&#xA;                                      {&#xA;                                        "bool": {&#xA;                                          "must": [&#xA;                                            {&#xA;                                              "query_string": {&#xA;                                                "default_field": "name",&#xA;                                                "query": "Holiday~ Inn~ Express~ Tianjin~ ",&#xA;                                                "fuzzy_min_sim": 0.9&#xA;                                              }&#xA;                                            }&#xA;                                          ]&#xA;                                        }&#xA;                                      }&#xA;                                    ],&#xA;                                    "should": [&#xA;                                      {&#xA;                                        "filtered": {&#xA;                                          "query": {&#xA;                                            "bool": {&#xA;                                              "must": [&#xA;                                                {&#xA;                                                  "match": {&#xA;                                                    "name": {&#xA;                                                      "query": "Holiday Inn Express Tianjin",&#xA;                                                      "boost": 1&#xA;                                                    }&#xA;                                                  }&#xA;                                                },&#xA;                                                {&#xA;                                                  "query_string": {&#xA;                                                    "default_field": "country",&#xA;                                                    "query": "CHINA~ ",&#xA;                                                    "fuzzy_min_sim": 0.9&#xA;                                                  }&#xA;                                                }&#xA;                                              ],&#xA;                                              "should": [&#xA;                                                {&#xA;                                                  "wildcard": {&#xA;                                                    "nameTerm": {&#xA;                                                      "wildcard": "*Holiday* Inn*",&#xA;                                                      "boost": 1&#xA;                                                    }&#xA;                                                  }&#xA;                                                }&#xA;                                              ]&#xA;                                            }&#xA;                                          },&#xA;                                          "filter": {&#xA;                                            "geo_distance": {&#xA;                                              "distance": "2000m",&#xA;                                              "coordinates": {&#xA;                                                "lon": 117.1852,&#xA;                                                "lat": 39.12841&#xA;                                              }&#xA;                                            }&#xA;                                          }&#xA;                                        }&#xA;                                      }&#xA;                                    ]&#xA;                                  }&#xA;                                }&#xA;                              ],&#xA;                              "should": [&#xA;                                {&#xA;                                  "filtered": {&#xA;                                    "query": {&#xA;                                      "bool": {&#xA;                                        "must": [&#xA;                                          {&#xA;                                            "match": {&#xA;                                              "name": {&#xA;                                                "query": "Holiday Inn Express Tianjin",&#xA;                                                "boost": 1&#xA;                                              }&#xA;                                            }&#xA;                                          },&#xA;                                          {&#xA;                                            "query_string": {&#xA;                                              "default_field": "country",&#xA;                                              "query": "CHINA~ ",&#xA;                                              "fuzzy_min_sim": 0.9&#xA;                                            }&#xA;                                          }&#xA;                                        ],&#xA;                                        "should": [&#xA;                                          {&#xA;                                            "wildcard": {&#xA;                                              "nameTerm": {&#xA;                                                "wildcard": "*Holiday* Inn* Express*",&#xA;                                                "boost": 1.5&#xA;                                              }&#xA;                                            }&#xA;                                          }&#xA;                                        ]&#xA;                                      }&#xA;                                    },&#xA;                                    "filter": {&#xA;                                      "geo_distance": {&#xA;                                        "distance": "1500m",&#xA;                                        "coordinates": {&#xA;                                          "lon": 117.1852,&#xA;                                          "lat": 39.12841&#xA;                                        }&#xA;                                      }&#xA;                                    }&#xA;                                  }&#xA;                                }&#xA;                              ]&#xA;                            }&#xA;                          }&#xA;                        ],&#xA;                        "should": [&#xA;                          {&#xA;                            "filtered": {&#xA;                              "query": {&#xA;                                "bool": {&#xA;                                  "must": [&#xA;                                    {&#xA;                                      "match": {&#xA;                                        "name": {&#xA;                                          "query": "Holiday Inn Express Tianjin",&#xA;                                          "boost": 1&#xA;                                        }&#xA;                                      }&#xA;                                    },&#xA;                                    {&#xA;                                      "query_string": {&#xA;                                        "default_field": "country",&#xA;                                        "query": "CHINA~ ",&#xA;                                        "fuzzy_min_sim": 0.9&#xA;                                      }&#xA;                                    }&#xA;                                  ],&#xA;                                  "should": [&#xA;                                    {&#xA;                                      "query_string": {&#xA;                                        "default_field": "addressNoNumbers",&#xA;                                        "query": " ZHONGSHAN ROAD HEBEI DISTRICT",&#xA;                                        "fuzzy_min_sim": 0.8&#xA;                                      }&#xA;                                    },&#xA;                                    {&#xA;                                      "match": {&#xA;                                        "addressNumbers": {&#xA;                                          "query": "288",&#xA;                                          "boost": 1.5&#xA;                                        }&#xA;                                      }&#xA;                                    },&#xA;                                    {&#xA;                                      "term": {&#xA;                                        "nameTerm": {&#xA;                                          "value": "Holiday Inn Express Tianjin",&#xA;                                          "boost": 2&#xA;                                        }&#xA;                                      }&#xA;                                    }&#xA;                                  ]&#xA;                                }&#xA;                              },&#xA;                              "filter": {&#xA;                                "geo_distance": {&#xA;                                  "distance": "1000m",&#xA;                                  "coordinates": {&#xA;                                    "lon": 117.1852,&#xA;                                    "lat": 39.12841&#xA;                                  }&#xA;                                }&#xA;                              }&#xA;                            }&#xA;                          }&#xA;                        ]&#xA;                      }&#xA;                    }&#xA;                  ],&#xA;                  "should": [&#xA;                    {&#xA;                      "filtered": {&#xA;                        "query": {&#xA;                          "bool": {&#xA;                            "must": [&#xA;                              {&#xA;                                "match": {&#xA;                                  "name": {&#xA;                                    "query": "Holiday Inn Express Tianjin",&#xA;                                    "boost": 1&#xA;                                  }&#xA;                                }&#xA;                              }&#xA;                            ],&#xA;                            "should": [&#xA;                              {&#xA;                                "match": {&#xA;                                  "addressNumbers": {&#xA;                                    "query": "288",&#xA;                                    "boost": 1.5&#xA;                                  }&#xA;                                }&#xA;                              },&#xA;                              {&#xA;                                "wildcard": {&#xA;                                  "addressTerm": {&#xA;                                    "wildcard": "*ZHONGSHAN* ROAD*",&#xA;                                    "boost": 1&#xA;                                  }&#xA;                                }&#xA;                              },&#xA;                              {&#xA;                                "term": {&#xA;                                  "nameTerm": {&#xA;                                    "value": "Holiday Inn Express Tianjin",&#xA;                                    "boost": 2&#xA;                                  }&#xA;                                }&#xA;                              }&#xA;                            ]&#xA;                          }&#xA;                        },&#xA;                        "filter": {&#xA;                          "geo_distance": {&#xA;                            "distance": "500m",&#xA;                            "coordinates": {&#xA;                              "lon": 117.1852,&#xA;                              "lat": 39.12841&#xA;                            }&#xA;                          }&#xA;                        }&#xA;                      }&#xA;                    }&#xA;                  ]&#xA;                }&#xA;              }&#xA;            ],&#xA;            "should": [&#xA;              {&#xA;                "filtered": {&#xA;                  "query": {&#xA;                    "bool": {&#xA;                      "must": [&#xA;                        {&#xA;                          "match": {&#xA;                            "name": {&#xA;                              "query": "Holiday Inn Express Tianjin",&#xA;                              "boost": 1&#xA;                            }&#xA;                          }&#xA;                        }&#xA;                      ],&#xA;                      "should": [&#xA;                        {&#xA;                          "match": {&#xA;                            "addressNumbers": {&#xA;                              "query": "288",&#xA;                              "boost": 1.5&#xA;                            }&#xA;                          }&#xA;                        },&#xA;                        {&#xA;                          "wildcard": {&#xA;                            "addressTerm": {&#xA;                              "wildcard": "*ZHONGSHAN* ROAD*",&#xA;                              "boost": 1&#xA;                            }&#xA;                          }&#xA;                        },&#xA;                        {&#xA;                          "term": {&#xA;                            "nameTerm": {&#xA;                              "value": "Holiday Inn Express Tianjin",&#xA;                              "boost": 2&#xA;                            }&#xA;                          }&#xA;                        }&#xA;                      ]&#xA;                    }&#xA;                  },&#xA;                  "filter": {&#xA;                    "geo_distance": {&#xA;                      "distance": "300m",&#xA;                      "coordinates": {&#xA;                        "lon": 117.1852,&#xA;                        "lat": 39.12841&#xA;                      }&#xA;                    }&#xA;                  }&#xA;                }&#xA;              }&#xA;            ]&#xA;          }&#xA;        }&#xA;      ],&#xA;      "should": [&#xA;        {&#xA;          "filtered": {&#xA;            "query": {&#xA;              "bool": {&#xA;                "must": [&#xA;                  {&#xA;                    "match": {&#xA;                      "name": {&#xA;                        "query": "Holiday Inn Express Tianjin",&#xA;                        "boost": 1&#xA;                      }&#xA;                    }&#xA;                  }&#xA;                ],&#xA;                "should": [&#xA;                  {&#xA;                    "match": {&#xA;                      "addressNumbers": {&#xA;                        "query": "288",&#xA;                        "boost": 1.5&#xA;                      }&#xA;                    }&#xA;                  },&#xA;                  {&#xA;                    "wildcard": {&#xA;                      "addressTerm": {&#xA;                        "wildcard": "*ZHONGSHAN* ROAD*",&#xA;                        "boost": 1&#xA;                      }&#xA;                    }&#xA;                  },&#xA;                  {&#xA;                    "term": {&#xA;                      "nameTerm": {&#xA;                        "value": "Holiday Inn Express Tianjin",&#xA;                        "boost": 2&#xA;                      }&#xA;                    }&#xA;                  }&#xA;                ]&#xA;              }&#xA;            },&#xA;            "filter": {&#xA;              "geo_distance": {&#xA;                "distance": "100m",&#xA;                "coordinates": {&#xA;                  "lon": 117.1852,&#xA;                  "lat": 39.12841&#xA;                }&#xA;              }&#xA;            }&#xA;          }&#xA;        }&#xA;      ]&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>So lots of nesting, that work quite well when I'm getting all the fields but not that much when I'm missing coordinate. </p>&#xA;&#xA;<p>But anyway, my main concern is if I should go with elasticsearch or not (and which could be the alternative!)&#xA;Thanks in advance!</p>&#xA;