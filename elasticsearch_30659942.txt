30659942
How to compare fields and remove fields using scripts in elasticsearch?
<p>I want to compare two fields and check if they are the same. If they are found to be equal,I need to delete one of the fields from the document.&#xA;How can I achieve this in elasticsearch by using scripts?</p>&#xA;
<p>Using the <a href="https://github.com/yakaz/elasticsearch-action-updatebyquery" rel="nofollow">update-by-query plugin</a> you can achieve this easily. That plugin allows one to pass a query to match documents and a script to modify the matching documents. So in your case, you can use it like this:</p>&#xA;&#xA;<pre><code>curl -XPOST localhost:9200/your_index/your_type/_update_by_query -d '&#xA;{&#xA;  "query": {&#xA;    "filtered": {&#xA;      "filter": {&#xA;        "script": {&#xA;          "script": "doc.field1.value == doc.field2.value"&#xA;        }&#xA;      }&#xA;    }&#xA;  },&#xA;  "script": "ctx._source.remove(\"field2\");"&#xA;}'&#xA;</code></pre>&#xA;
<p>You can make use of <a href="http://blog.qbox.io/introduction-to-elasticsearch-scripting" rel="nofollow">scripts</a> and <a href="https://github.com/yakaz/elasticsearch-action-updatebyquery" rel="nofollow">update by script</a> for doing this. It can be done by making use of filters,by first comparing the fields and then removing any of the desired fields by using "remove" method like below:</p>&#xA;&#xA;<pre><code>{&#xA;  "query": {&#xA;    "filtered": {&#xA;      "filter": {&#xA;        "script": {&#xA;          "script": "doc[\"fieldA\"].value == doc[\"fieldB\"].value"&#xA;}&#xA;      }&#xA;    }&#xA;  },&#xA;  "script": "ctx._source.remove(\"fieldA\");"&#xA;}&#xA;</code></pre>&#xA;