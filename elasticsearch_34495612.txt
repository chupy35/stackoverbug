34495612
Elasticsearch analysis on field not working as intended
<p>I'm playing with ES 2.1 analyzers on the following index (aptly named my_index) :</p>&#xA;&#xA;<pre><code>$ curl -XPUT 'localhost:9200/my_index/' -d '&#xA;{&#xA;    "settings" : {&#xA;        "analysis" : {&#xA;            "analyzer" : {&#xA;                "my_synonym_analyzer" : {&#xA;                    "tokenizer" : "standard",&#xA;                    "filter" : [ "my_synonym_filter" ]&#xA;                }&#xA;            },&#xA;            "filter" : {&#xA;                "my_synonym_filter" : {&#xA;                    "type" : "synonym",&#xA;                    "synonyms" : [ "foo, bar" ]&#xA;                }&#xA;            }&#xA;        }&#xA;    },&#xA;    "mappings" : {&#xA;        "my_type" : {&#xA;            "properties" : {&#xA;                "my_field" : {&#xA;                   "type" : "string",&#xA;                   "analyzer" : "my_synonym_analyzer"&#xA;                }&#xA;            }&#xA;        }&#xA;    }&#xA;}'&#xA;</code></pre>&#xA;&#xA;<p>The following analyses work as expected:</p>&#xA;&#xA;<pre><code>$ curl -XGET 'localhost:9200/my_index/_analyze?analyzer=my_synonym_analyzer&amp;text=foo'&#xA;$ curl -XGET 'localhost:9200/my_index/_analyze?field=my_field&amp;text=foo'&#xA;&#xA;{&#xA;    "tokens" : [ {&#xA;        "token" : "foo",&#xA;        "start_offset" : 0,&#xA;        "end_offset" : 3,&#xA;        "type" : "&lt;ALPHANUM&gt;",&#xA;        "position" : 0&#xA;    }, {&#xA;        "token" : "bar",&#xA;        "start_offset" : 0,&#xA;        "end_offset" : 3,&#xA;        "type" : "SYNONYM",&#xA;        "position" : 0&#xA;    } ]&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>However this one is not. I expect the same output as above, as stated in the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-analyze.html" rel="nofollow">reference</a>.</p>&#xA;&#xA;<pre><code>$ curl -XGET 'localhost:9200/my_index/_analyze?field=my_type.my_field&amp;text=foo'&#xA;&#xA;{&#xA;    "tokens" : [ {&#xA;        "token" : "foo",&#xA;        "start_offset" : 0,&#xA;        "end_offset" : 3,&#xA;        "type" : "&lt;ALPHANUM&gt;",&#xA;        "position" : 0&#xA;    } ]&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Am I missing something ?</p>&#xA;
<p>Starting in ES 2.0, <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/breaking_20_mapping_changes.html#_type_name_prefix_removed" rel="nofollow">field names may not be prefixed with the type name</a> anymore, even though it used to work with pre-2.x releases of Elasticsearch.</p>&#xA;&#xA;<p>So if you're using Elasticsearch 2.x, what you're observing is what you're supposed to get, i.e. </p>&#xA;&#xA;<ul>&#xA;<li>analyzing with <code>field=my_field</code> works</li>&#xA;<li>while analyzing with <code>field=my_type.my_field</code> does not anymore.</li>&#xA;</ul>&#xA;