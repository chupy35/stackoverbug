33094521
Sub query in elasticsearch
<p>I have a mysql query. How do i model this query in elasticsearch?&#xA;Query is-<br>&#xA;<pre>select targetId from mytable where actorId=? and targetId in (select actorId from mytable where targetId = ?)</pre><br>mytable has only two columns actorId and targetId. <br>Currently I am running inner query separately and passing the result to outer query. Is there a way to do it in one shot.My elasticsearch query is as follows.<br></p>&#xA;&#xA;<pre><code>{&#xA;"filtered" : {&#xA;    "query" : {&#xA;     "match_all" : { }&#xA;    },&#xA;    "filter" : {&#xA;      "bool" : {&#xA;        "must" : [ {&#xA;          "term" : {&#xA;            "actorId" : 3432079&#xA;          }&#xA;        }, &#xA;        {&#xA;          "not" : {&#xA;            "filter" : {&#xA;              "terms" : {&#xA;                "targetId" : [3435089, 3435093]&#xA;              }&#xA;            }&#xA;          }&#xA;        }]&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p><br>&#xA;Edit:<br>&#xA;Instead of above i want to do it as follows</p>&#xA;&#xA;<pre><code>{&#xA;    "filtered" : {&#xA;        "query" : {&#xA;         "match_all" : { }&#xA;        },&#xA;        "filter" : {&#xA;          "bool" : {&#xA;            "must" : [ {&#xA;              "term" : {&#xA;                "actorId" : 3432079&#xA;              }&#xA;            }, &#xA;            {&#xA;              "not" : {&#xA;                "filter" : {&#xA;                  "terms" : {&#xA;                    "targetId" : (inner query which returns target ids)&#xA;                  }&#xA;                }&#xA;              }&#xA;            }]&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;</code></pre>&#xA;