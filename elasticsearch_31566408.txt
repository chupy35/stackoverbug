31566408
elasticsearch, documents with data in field1 OR field2
<p>How do I instruct elasticsearch to return all documents which have data in one of the following fields: ['field1','field2']?</p>&#xA;&#xA;<p>I have tried:</p>&#xA;&#xA;<pre><code>{&#xA;'query': {&#xA;    'bool':{&#xA;        'must':[&#xA;            'multi_match':{&#xA;                'fields':['field1','field2'],&#xA;                     'operator':'AND',&#xA;                     'tie_breaker':1.0,&#xA;                     'query': '*',&#xA;                     'type':'cross_fields'&#xA;                 }&#xA;             ]&#xA;         }&#xA;     }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>I also tried:</p>&#xA;&#xA;<pre><code>{&#xA;    "query":{&#xA;        "wildcard":&#xA;            {&#xA;                 "field1":"*"&#xA;            }&#xA;        }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>which works, but:</p>&#xA;&#xA;<pre><code>{&#xA;    "query":{&#xA;        "wildcard":&#xA;            {&#xA;                 "field*":"*"&#xA;            }&#xA;        }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>does not</p>&#xA;
<p>You can do it with two <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-exists-filter.html" rel="nofollow">exists</a> filters in a <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-bool-filter.html" rel="nofollow">bool filter</a></p>&#xA;&#xA;<p>As an example, I set up a simple index and gave it some data:</p>&#xA;&#xA;<pre><code>PUT /test_index&#xA;&#xA;POST /test_index/doc/_bulk&#xA;{"index":{"_id":1}}&#xA;{"field1":"foo","field2":"bar"}&#xA;{"index":{"_id":2}}&#xA;{"field2":"foo","field3":"bar"}&#xA;{"index":{"_id":3}}&#xA;{"field3":"foo","field4":"bar"}&#xA;{"index":{"_id":4}}&#xA;{"field4":"foo","field5":"bar"}&#xA;</code></pre>&#xA;&#xA;<p>If I want to find all documents that have <code>"field1</code>" or <code>"field3"</code>, I can do this:</p>&#xA;&#xA;<pre><code>POST /test_index/_search&#xA;{&#xA;   "query": {&#xA;      "filtered": {&#xA;         "query": {&#xA;            "match_all": {}&#xA;         },&#xA;         "filter": {&#xA;            "bool": {&#xA;               "should": [&#xA;                  { "exists": { "field": "field1" } },&#xA;                  { "exists": { "field": "field3" } }&#xA;               ]&#xA;            }&#xA;         }&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>It returns what I expect:   </p>&#xA;&#xA;<pre><code>{&#xA;   "took": 1,&#xA;   "timed_out": false,&#xA;   "_shards": {&#xA;      "total": 1,&#xA;      "successful": 1,&#xA;      "failed": 0&#xA;   },&#xA;   "hits": {&#xA;      "total": 3,&#xA;      "max_score": 1,&#xA;      "hits": [&#xA;         {&#xA;            "_index": "test_index",&#xA;            "_type": "doc",&#xA;            "_id": "1",&#xA;            "_score": 1,&#xA;            "_source": {&#xA;               "field1": "foo",&#xA;               "field2": "bar"&#xA;            }&#xA;         },&#xA;         {&#xA;            "_index": "test_index",&#xA;            "_type": "doc",&#xA;            "_id": "2",&#xA;            "_score": 1,&#xA;            "_source": {&#xA;               "field2": "foo",&#xA;               "field3": "bar"&#xA;            }&#xA;         },&#xA;         {&#xA;            "_index": "test_index",&#xA;            "_type": "doc",&#xA;            "_id": "3",&#xA;            "_score": 1,&#xA;            "_source": {&#xA;               "field3": "foo",&#xA;               "field4": "bar"&#xA;            }&#xA;         }&#xA;      ]&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Here's the code I used:</p>&#xA;&#xA;<p><a href="http://sense.qbox.io/gist/991b828de250e5125fd372bf7e6b066acec55fcd" rel="nofollow">http://sense.qbox.io/gist/991b828de250e5125fd372bf7e6b066acec55fcd</a></p>&#xA;