31297164
ElasticSearch: query for checking if exist element with specified field value
<p>I have a list of element ids (for example: [1, 23, 42, 45]) and I'm looking for the fastest way to check if in ES database elements with those ids already exist or not. In result I want to recieve response containing only ids which are present in Elasticsearch: for example [1, 42] - what means that elements with ids 1 and 42 are yet in DB.</p>&#xA;&#xA;<p>Now I send a query for all element ids in the DB and then check if on those list are my [1, 23, 42, 45] or not. Is there any faster way ?</p>&#xA;
<p>You can use <a href="https://www.elastic.co/guide/en/elasticsearch/reference/1.6/query-dsl-ids-query.html" rel="nofollow"><code>ids</code> query</a>:</p>&#xA;&#xA;<pre><code>GET /your_index/your_type/_search&#xA;{&#xA;  "query": {&#xA;    "ids": {&#xA;      "values": [1, 23, 42, 45]&#xA;    }&#xA;  },&#xA;  "fields": []&#xA;}&#xA;</code></pre>&#xA;
<p>Here's another way, if what you are wanting is just a list of existing ids from the list you supply (I can't tell if that's what you're asking for or not):</p>&#xA;&#xA;<pre><code>POST /test_index/_search?search_type=count&#xA;{&#xA;    "aggs": {&#xA;        "id_terms": {&#xA;            "terms": {&#xA;                "field": "id",&#xA;                "include": [1, 23, 42, 45]&#xA;            }&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>If I have documents with ids <code>1,2,3,42</code>, the response is:</p>&#xA;&#xA;<pre><code>{&#xA;   "took": 1,&#xA;   "timed_out": false,&#xA;   "_shards": {&#xA;      "total": 1,&#xA;      "successful": 1,&#xA;      "failed": 0&#xA;   },&#xA;   "hits": {&#xA;      "total": 4,&#xA;      "max_score": 0,&#xA;      "hits": []&#xA;   },&#xA;   "aggregations": {&#xA;      "id_terms": {&#xA;         "doc_count_error_upper_bound": 0,&#xA;         "sum_other_doc_count": 0,&#xA;         "buckets": [&#xA;            {&#xA;               "key": 1,&#xA;               "doc_count": 1&#xA;            },&#xA;            {&#xA;               "key": 42,&#xA;               "doc_count": 1&#xA;            }&#xA;         ]&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Here is the code I used to test it:</p>&#xA;&#xA;<p><a href="http://sense.qbox.io/gist/96d8d27078e74f7645eee85044b59899c57d0022" rel="nofollow">http://sense.qbox.io/gist/96d8d27078e74f7645eee85044b59899c57d0022</a></p>&#xA;