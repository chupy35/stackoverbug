32122554
elasticsearch boolean search syntax
<p>Can anybody please explain why this elasticsearch syntax is incorrect. I'm struggling to get my head around basic syntaxing</p>&#xA;&#xA;<p>This works</p>&#xA;&#xA;<pre><code>"query": {&#xA;    "filtered": {&#xA;        "filter": {&#xA;           "bool" : {&#xA;               "should": {&#xA;                   "terms": {&#xA;                       "headline":["aut"]&#xA;                   }                        &#xA;               },&#xA;               "must": {&#xA;                    "range": {&#xA;                        "date_at" : {&#xA;                           "gt": "1900-01-01 00:00:00",&#xA;                           "lt": "1980-01-01 00:00:00"&#xA;                        }&#xA;                    }                       &#xA;               }&#xA;           }&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>However, this query doesn't work</p>&#xA;&#xA;<pre><code>"query": {&#xA;    "filtered": {&#xA;        "filter": {&#xA;           "bool" : {&#xA;               "should": {&#xA;                   "terms": {&#xA;                       "headline":["aut"]&#xA;                   }                        &#xA;               },&#xA;               "must": {&#xA;                    "range": {&#xA;                        "date_at" : {&#xA;                           "gt": "1900-01-01 00:00:00",&#xA;                           "lt": "1980-01-01 00:00:00"&#xA;                        }&#xA;                    },&#xA;                    "term": {&#xA;                        "headline": "et" &#xA;                    }&#xA;               }&#xA;           }&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>The addition of the "term" clause inside the boolean "must" is causing a syntax error, all shards broken etc... The issue appears to be I want to use the same index twice inside two different bools specifically</p>&#xA;&#xA;<p>headline MUST contain "foo"</p>&#xA;&#xA;<p>headline SHOULD contain "bar"</p>&#xA;&#xA;<p>Is it possible?</p>&#xA;
<p>Have you tried this?</p>&#xA;&#xA;<pre><code>{&#xA;   "query": {&#xA;      "filtered": {&#xA;         "filter": {&#xA;            "bool": {&#xA;               "should": [&#xA;                  {&#xA;                     "terms": {&#xA;                        "headline": [&#xA;                           "aut"&#xA;                        ]&#xA;                     }&#xA;                  }&#xA;               ],&#xA;               "must": [&#xA;                  {&#xA;                     "range": {&#xA;                        "date_at": {&#xA;                           "gt": "1900-01-01 00:00:00",&#xA;                           "lt": "1980-01-01 00:00:00"&#xA;                        }&#xA;                     }&#xA;                  },&#xA;                  {&#xA;                     "term": {&#xA;                        "headline": "et"&#xA;                     }&#xA;                  }&#xA;               ]&#xA;            }&#xA;         }&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>That would be the direct interpretation of what you're trying to do, but this is probably what you actually need:</p>&#xA;&#xA;<pre><code>{&#xA;   "query": {&#xA;      "filtered": {&#xA;         "filter": {&#xA;            "bool": {&#xA;               "must": [&#xA;                  {&#xA;                     "range": {&#xA;                        "date_at": {&#xA;                           "gt": "1900-01-01 00:00:00",&#xA;                           "lt": "1980-01-01 00:00:00"&#xA;                        }&#xA;                     }&#xA;                  },&#xA;                  {&#xA;                     "term": {&#xA;                        "headline": "et"&#xA;                     }&#xA;                  }&#xA;               ]&#xA;            }&#xA;         }&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Here is some code I used to play around with it:</p>&#xA;&#xA;<p><a href="http://sense.qbox.io/gist/ea16ff321397c2187ef503541019d52c564b7460" rel="nofollow">http://sense.qbox.io/gist/ea16ff321397c2187ef503541019d52c564b7460</a></p>&#xA;