31534963
List of all users who have more than 40 documents each in ElasticSearch
<p>I want to query list of all users who have more than 40 documents each.&#xA;I've created aggregation:</p>&#xA;&#xA;<pre><code>*"aggs" : {&#xA;"user-ids" : {&#xA;"terms" : {&#xA;"field" : "user-id",&#xA;"size": 0&#xA;}&#xA;}&#xA;}*    &#xA;</code></pre>&#xA;&#xA;<p>where all my users in response:</p>&#xA;&#xA;<pre><code>*{&#xA;"key": 683696,&#xA;"doc_count": 4086&#xA;},&#xA;&#xA;{&#xA;"key": 678776,&#xA;"doc_count": 3625&#xA;},&#xA;&#xA;{&#xA;"key": 683191,&#xA;"doc_count": 3304&#xA;},&#xA;&#xA;{&#xA;"key": 684065,&#xA;"doc_count": 3287&#xA;},&#xA;&#xA;.....*&#xA;</code></pre>&#xA;&#xA;<p>I want to leave only buckets with "doc_count" more than 40. Is it possible?</p>&#xA;
<p>Yes, you can achieve this with the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-terms-aggregation.html#_minimum_document_count" rel="nofollow"><code>min_doc_count</code> setting</a>. Try this:</p>&#xA;&#xA;<pre><code>{&#xA;   "aggs" : {&#xA;      "user-ids" : {&#xA;         "terms" : {&#xA;            "field" : "user-id",&#xA;            "min_doc_count": 40     &lt;--- use this setting&#xA;         }&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;