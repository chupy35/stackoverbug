31892152
Elastic Search : Match Query not working in Nested Bool Filters
<p>I am able to get data for the following elastic search query :</p>&#xA;&#xA;<pre><code>{&#xA;  "query": {&#xA;    "filtered": {&#xA;      "query": [],&#xA;      "filter": {&#xA;        "bool": {&#xA;          "must": [&#xA;            {&#xA;              "bool": {&#xA;                "should": [&#xA;                  {&#xA;                    "term": {&#xA;                      "gender": "malE"&#xA;                    }&#xA;                  },&#xA;                  {&#xA;                    "term": {&#xA;                      "sentiment": "positive"&#xA;                    }&#xA;                  }&#xA;                ]&#xA;              }&#xA;            }&#xA;          ]&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>However, If I query using "match" - I get error message with 400 status response</p>&#xA;&#xA;<pre><code>{&#xA;  "query": {&#xA;    "filtered": {&#xA;      "query": [],&#xA;      "filter": {&#xA;        "bool": {&#xA;          "must": [&#xA;            {&#xA;              "bool": {&#xA;                "should": [&#xA;                  {&#xA;                    "match": {&#xA;                      "gender": "malE"&#xA;                    }&#xA;                  },&#xA;                  {&#xA;                    "term": {&#xA;                      "sentiment": "positive"&#xA;                    }&#xA;                  }&#xA;                ]&#xA;              }&#xA;            }&#xA;          ]&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Is match query not supported in nested bool filters ?</p>&#xA;&#xA;<p>Since the term query looks for the exact term in the fieldâ€™s inverted index and I want to query gender data as case_insensitive field - Which approach shall I try ?</p>&#xA;&#xA;<p>Settings of the index :</p>&#xA;&#xA;<pre><code>{&#xA;  "settings": {&#xA;    "index": {&#xA;      "analysis": {&#xA;        "analyzer": {&#xA;          "analyzer_keyword": {&#xA;            "tokenizer": "keyword",&#xA;            "filter": "lowercase"&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Mapping for field Gender:</p>&#xA;&#xA;<pre><code>{"type":"string","analyzer":"analyzer_keyword"}&#xA;</code></pre>&#xA;
<p>The reason you're getting an error 400 is because there is no <code>match</code> filter, only <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query.html" rel="nofollow"><code>match</code> queries</a>, even though there are both <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-term-query.html" rel="nofollow"><code>term</code> queries</a> and <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-term-filter.html" rel="nofollow"><code>term</code> filters</a>.</p>&#xA;&#xA;<p>Your query can be as simple as this, i.e. no need for a <code>filtered</code> query, simply put your <code>term</code> and <code>match</code> queries into a <code>bool/should</code>:</p>&#xA;&#xA;<pre><code>{&#xA;  "query": {&#xA;    "bool": {&#xA;      "should": [&#xA;        {&#xA;          "match": {&#xA;            "gender": "male"&#xA;          }&#xA;        },&#xA;        {&#xA;          "term": {&#xA;            "sentiment": "positive"&#xA;          }&#xA;        }&#xA;      ]&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;