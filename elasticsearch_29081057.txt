29081057
elasticsearch returning unique values
<p>I have a field named 'category'.</p>&#xA;&#xA;<p>I can return the list of possible categories by just doing:</p>&#xA;&#xA;<pre><code>$searchParams['body']['aggs']['category']['terms']['field'] = 'category'; &#xA;</code></pre>&#xA;&#xA;<p>But I want to search inside that field and return only categories matching my query.</p>&#xA;&#xA;<p>Example list:</p>&#xA;&#xA;<ol>&#xA;<li>Pizza</li>&#xA;<li>Apple pie</li>&#xA;<li>Orange pie</li>&#xA;<li>Cupcake</li>&#xA;<li>Burger</li>&#xA;</ol>&#xA;&#xA;<p>I want to search for "pie" and have the following result:</p>&#xA;&#xA;<ol>&#xA;<li>Apple pie</li>&#xA;<li>Orange pie</li>&#xA;</ol>&#xA;&#xA;<p>There are more than 200 categories. I want to do this the elasticsearch way, not using MySQL as the search.</p>&#xA;&#xA;<p>Thanks for all the help :)</p>&#xA;
<p>Aggregations operate in the <a href="http://www.elastic.co/guide/en/elasticsearch/guide/current/_scoping_aggregations.html" rel="nofollow">"scope" of the query</a>.  So if you execute a search query for <code>"pie"</code>, the aggregation will only see (and aggregate) "pie" documents.</p>&#xA;&#xA;<pre><code>$query = [&#xA;    'index' =&gt; 'my_index',&#xA;    'type' =&gt; 'my_type',&#xA;    'search_type' =&gt; 'count',  // &lt;-- Note search_type = count, to ignore search hits&#xA;    'body' =&gt; [&#xA;        'query' =&gt; [&#xA;            'match' =&gt; [&#xA;                'category' =&gt; 'pie'&#xA;            ]&#xA;        ],&#xA;        'aggs' =&gt; [&#xA;            'category' =&gt; [&#xA;                'terms' =&gt; [&#xA;                    'field' =&gt; 'category'&#xA;                ]&#xA;            ]&#xA;        ]&#xA;    ]&#xA;];&#xA;&#xA;$results = $client-&gt;search($query);&#xA;</code></pre>&#xA;