31069586
Elasticsearch error when trying to register Percolator with geo_distance filter
<p>I'm using elasticsearch with marvel/sense plugin to create index of shapes with dot type and then register geo_distance filter in percolator:</p>&#xA;&#xA;<pre><code>PUT shapes&#xA;{&#xA;  "mappings": {&#xA;    "dot": {&#xA;      "properties": {&#xA;        "location": {&#xA;          "type": "geo_point",&#xA;          "fielddata": {&#xA;            "lat_lon": "true",&#xA;            "precision": "1cm"&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;&#xA;PUT shapes/.percolator/in_sight&#xA;{&#xA;    "filtered" : {&#xA;        "query" : {&#xA;            "match_all" : {}&#xA;        },&#xA;        "filter" : {&#xA;            "geo_distance" : {&#xA;                "distance" : "200km",&#xA;                "location" : {&#xA;                    "lat" : 40,&#xA;                    "lon" : -70&#xA;                }&#xA;            }&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>this yields the following error:</p>&#xA;&#xA;<pre><code>{&#xA;   "error": "PercolatorException[[shapes] failed to parse query [in_sight]]; nested: NullPointerException; ",&#xA;   "status": 500&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>any idea?</p>&#xA;&#xA;<p>Thanks.</p>&#xA;
<p>Found the answer, it's all about syntax which is hard to guess with elasticsearch:</p>&#xA;&#xA;<pre><code>    #Create mappings for dot and ellipse types&#xA;PUT shapes&#xA;{&#xA;  "mappings": {&#xA;    "dot": {&#xA;      "properties": {&#xA;        "tag" : { "type" : "string" },&#xA;        "location": {&#xA;          "type": "geo_point",&#xA;          "fielddata": {&#xA;            "lat_lon": "true"&#xA;          }&#xA;        }&#xA;      }&#xA;    },&#xA;    "ellipse": {&#xA;      "properties": {&#xA;        "tag" : { "type" : "string" },&#xA;        "location": {&#xA;          "type": "geo_point",&#xA;          "fielddata": {&#xA;            "lat_lon": "true"&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;&#xA;#Register geo_distance with percolator&#xA;PUT shapes/.percolator/in_sight&#xA;{&#xA;  "query": {&#xA;    "filtered": {&#xA;      "filter": {&#xA;        "geo_distance": {&#xA;          "distance": "250km",&#xA;          "location": {&#xA;            "lat": 30,&#xA;            "lon": 31&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;&#xA;#Query doc against percolator.&#xA;POST shapes/ellipse/_percolate&#xA;{&#xA;  "doc": {&#xA;    "tag": "t3",&#xA;    "location": {&#xA;      "lat": 30,&#xA;      "lon": 30&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;