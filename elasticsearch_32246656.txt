32246656
Elasticsearch query response influenced by _id
<p>I created an index with the following mappings and settings:</p>&#xA;&#xA;<pre><code>{&#xA;  "settings": {&#xA;    "analysis": {&#xA;      "analyzer": {&#xA;        "case_insensitive_index": {&#xA;          "type": "custom",&#xA;          "tokenizer": "filename",&#xA;          "filter": ["icu_folding", "edge_ngram"]&#xA;        },&#xA;        "default_search": {&#xA;          "type":"standard",&#xA;          "tokenizer": "filename",&#xA;          "filter": [&#xA;            "icu_folding"&#xA;          ]&#xA;        }&#xA;      },&#xA;      "tokenizer" : {&#xA;        "filename" : {&#xA;          "pattern" : "[^\\p{L}\\d]+",&#xA;          "type" : "pattern"&#xA;        }&#xA;      },&#xA;      "filter" : {&#xA;        "edge_ngram" : {&#xA;          "side" : "front",&#xA;          "max_gram" : 20,&#xA;          "min_gram" : 3,&#xA;          "type" : "edgeNGram"&#xA;        }&#xA;      }&#xA;    }&#xA;  },&#xA;  "mappings": {&#xA;    "metadata": {&#xA;      "properties": {&#xA;        "title": {&#xA;          "type": "string",&#xA;          "analyzer": "case_insensitive_index"&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>I have the following documents:</p>&#xA;&#xA;<pre><code>{"title":"P-20150531-27332_News.jpg"}&#xA;{"title":"P-20150531-27341_News.jpg"}&#xA;{"title":"P-20150531-27512_News.jpg"}&#xA;{"title":"P-20150531-27343_News.jpg"}&#xA;</code></pre>&#xA;&#xA;<p>creating a document with simple numerical ids </p>&#xA;&#xA;<pre><code>111&#xA;112&#xA;113&#xA;114&#xA;</code></pre>&#xA;&#xA;<p>and querying using the query </p>&#xA;&#xA;<pre><code>{&#xA;      "from" : 0,&#xA;      "size" : 10,&#xA;      "query" : {&#xA;        "match" : {&#xA;          "title" : {&#xA;            "query" : "P-20150531-27332_News.jpg",&#xA;            "type" : "boolean",&#xA;            "fuzziness" : "AUTO"&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;</code></pre>&#xA;&#xA;<p>results in the correct scoring and ordering of the documents returned:</p>&#xA;&#xA;<pre><code>P-20150531-27332_News.jpg -&gt; 2.780985 &#xA;P-20150531-27341_News.jpg -&gt; 0.8262239 &#xA;P-20150531-27512_News.jpg -&gt; 0.8120311 &#xA;P-20150531-27343_News.jpg -&gt; 0.7687101&#xA;</code></pre>&#xA;&#xA;<p>Strangely, creating the same documents with UUIDs</p>&#xA;&#xA;<pre><code>557eec2e3b00002c03de96bd&#xA;557eec0f3b00001b03de96b8&#xA;557eec0c3b00001b03de96b7&#xA;557eec123b00003a03de96ba&#xA;</code></pre>&#xA;&#xA;<p>as IDs results in different scorings of the documents:</p>&#xA;&#xA;<pre><code>P-20150531-27341_News.jpg -&gt; 2.646321&#xA;P-20150531-27332_News.jpg -&gt; 2.1998127     &#xA;P-20150531-27512_News.jpg -&gt; 1.7725387 &#xA;P-20150531-27343_News.jpg -&gt; 1.2718291&#xA;</code></pre>&#xA;&#xA;<p>Is this an intentional behaviour of Elasticsearch? If yes - how can I preserve the correct ordering regardless of the IDs used?</p>&#xA;
<p>In the query it looks like you should be using 'default_search' as the analyzer for <code>match query</code> unless you actuall intended to use <code>egde-ngram</code> on the search query too.&#xA;Example :</p>&#xA;&#xA;<pre><code>{&#xA;      "from" : 0,&#xA;      "size" : 10,&#xA;      "query" : {&#xA;        "match" : {&#xA;          "title" : {&#xA;            "query" : "P-20150531-27332_News.jpg",&#xA;            "type" : "boolean",&#xA;            "fuzziness" : "AUTO",&#xA;             "analyzer" : "default_search"&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;</code></pre>&#xA;&#xA;<p><code>default_search</code> would be the default-search analyzer only if there is are no explicit <code>search_analyzer</code> or <code>analyzer</code> specified in the mapping of the field.</p>&#xA;&#xA;<p>The article<a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/_controlling_analysis.html#_default_analyzers" rel="nofollow">here</a> gives a good explanation of the rules by which analyzers are applied.</p>&#xA;&#xA;<p>Also to ensure <code>idf</code> takes into account documents across shards you could use <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-search-type.html#dfs-query-then-fetch" rel="nofollow">search_type=dfs_query_then_fetch</a></p>&#xA;