29216094
elasticsearch: "More like this" combined with additional constraint
<p>I just bumped into "more like this" functionality/api. Is there a possibility to combine the result from more_like_this with some additional search constraint?</p>&#xA;&#xA;<p>I have two following ES query which works:</p>&#xA;&#xA;<pre><code>POST /h/B/_search&#xA;{&#xA;   "query": {&#xA;      "more_like_this": {&#xA;         "fields": [&#xA;            "desc"&#xA;         ],&#xA;         "ids": [&#xA;            "511111260"&#xA;         ],&#xA;         "min_term_freq": 1,&#xA;         "max_query_terms": 25&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Which returns </p>&#xA;&#xA;<pre><code>{&#xA;   "took": 16,&#xA;   "timed_out": false,&#xA;   "_shards": {&#xA;      "total": 3,&#xA;      "successful": 3,&#xA;      "failed": 0&#xA;   },&#xA;   "hits": {&#xA;      "total": 53,&#xA;      "max_score": 3.2860293,&#xA;      "hits": [&#xA;      ...&#xA;</code></pre>&#xA;&#xA;<p>Which is fine but I need to specify additional constraint over other field of the underlying document which works separately fine:</p>&#xA;&#xA;<pre><code>POST /h/B/_search&#xA;{&#xA;   "query": {&#xA;      "bool": {&#xA;         "must": {&#xA;            "match": {&#xA;               "Kind": "Pen"&#xA;            }&#xA;         }&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>I would love to combine those two to one, as the query should state: "Find a similar items to items labelled with Pen". I tried following with nested query but that gives me some error back:</p>&#xA;&#xA;<pre><code>POST /h/B/_search&#xA;{&#xA;   "query": {&#xA;      "more_like_this": {&#xA;         "fields": [&#xA;            "desc"&#xA;         ],&#xA;         "ids": [&#xA;            "511111260"&#xA;         ],&#xA;         "min_term_freq": 1,&#xA;         "max_query_terms": 25&#xA;      },&#xA;      "nested": {&#xA;         "query": {&#xA;            "bool": {&#xA;               "must": {&#xA;                  "match": {&#xA;                     "Kind": "Pen"&#xA;                  }&#xA;               }&#xA;            }&#xA;         }&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>I tried several variant for combining those two search criteria but so far with no luck. &#xA;If someone more experienced could provide some hint that would be really appreciated.</p>&#xA;&#xA;<p>Thanks</p>&#xA;
<p><a href="http://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-bool-query.html" rel="noreferrer"><code>bool</code> queries</a> are used exactly for this purpose. A <code>bool must</code> is basically equivalent to the <code>Boolean AND</code> operation. Similarly you can use <code>bool should</code> for <code>Boolean OR</code> and <code>bool must_not</code> for <code>Boolean NOT</code> operations.</p>&#xA;&#xA;<pre><code>POST /h/B/_search&#xA;{&#xA;   "query": {&#xA;      "bool": {&#xA;         "must": [&#xA;            {&#xA;               "more_like_this": {&#xA;                  "fields": [&#xA;                     "desc"&#xA;                  ],&#xA;                  "ids": [&#xA;                     "511111260"&#xA;                  ],&#xA;                  "min_term_freq": 1,&#xA;                  "max_query_terms": 25&#xA;               }&#xA;            },&#xA;            {&#xA;               "match": {&#xA;                  "Kind": "Pen"&#xA;               }&#xA;            }&#xA;         ]&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;