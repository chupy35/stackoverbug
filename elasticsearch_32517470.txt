32517470
How to use the Phrase Suggester in the Elasticsearch?
<p>I want to use the Phrase Suggester in the Elasticsearch 1.7.</p>&#xA;&#xA;<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-suggesters-phrase.html" rel="nofollow">https://www.elastic.co/guide/en/elasticsearch/reference/current/search-suggesters-phrase.html</a></p>&#xA;&#xA;<p>So, I created below query like domcument pages sample, but I have gotten the error.</p>&#xA;&#xA;<blockquote>&#xA;  <p>nested: ElasticsearchIllegalArgumentException[No mapping found for&#xA;  field [itemname]];</p>&#xA;</blockquote>&#xA;&#xA;<pre><code>$ curl -XPOST 'localhost:9200/_search?pretty' -d '{&#xA;  "query": {&#xA;    "function_score": {&#xA;      "query": {&#xA;        "filtered": {&#xA;          "query": {&#xA;            "query_string": {&#xA;              "fields": [&#xA;                "itemname"&#xA;              ],&#xA;              "query": "cola"&#xA;            }&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  },&#xA;  "suggest": {&#xA;    "text": "cola",&#xA;    "simple_phrase": {&#xA;      "phrase": {&#xA;        "field": "itemname",&#xA;        "size": 5,&#xA;        "real_word_error_likelihood": 0.95,&#xA;        "max_errors": 0.5,&#xA;        "gram_size": 2&#xA;      }&#xA;    }&#xA;  }&#xA;}'&#xA;</code></pre>&#xA;&#xA;<p>But the <strong><em>field [itemname]]</em></strong> is definitely defined.<br>&#xA;In fact, I can search from the itemname field with this query.  </p>&#xA;&#xA;<pre><code>$ curl -XPOST 'localhost:9200/_search?pretty' -d '{&#xA;  "query": {&#xA;    "function_score": {&#xA;      "query": {&#xA;        "filtered": {&#xA;          "query": {&#xA;            "query_string": {&#xA;              "fields": [&#xA;                "itemname"&#xA;              ],&#xA;              "query": "cola"&#xA;            }&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}'&#xA;{&#xA;  "took" : 9,&#xA;  "timed_out" : false,&#xA;  "_shards" : {&#xA;    "total" : 15,&#xA;    "successful" : 15,&#xA;    "failed" : 0&#xA;  },&#xA;  "hits" : {&#xA;    "total" : 97,&#xA;    "max_score" : 11.625176,&#xA;    "hits" : [ {&#xA;      "_index" : "my_index",&#xA;      "_type" : "my_type",&#xA;      "_id" : "20615",&#xA;      "_score" : 11.625176,&#xA;      "_source":{"itemid":"20615","itemname":"cola 500ml"}&#xA;    }, {&#xA;</code></pre>&#xA;&#xA;<p>In this case what's wrong with me ?<br>&#xA;Does anyone advise me how to use the Phrase Suggester properly ?  </p>&#xA;&#xA;<p>Thanks.</p>&#xA;&#xA;<p>Add my settings</p>&#xA;&#xA;<pre><code># curl -XGET 'http://localhost:9200/my_index?pretty'&#xA;{&#xA;  "my_index" : {&#xA;    "aliases" : { },&#xA;    "mappings" : {&#xA;      "my_type" : {&#xA;        "_all" : {&#xA;          "enabled" : true,&#xA;          "analyzer" : "kuromoji_analyzer"&#xA;        },&#xA;        "properties" : {&#xA;          "itemid" : {&#xA;            "type" : "string",&#xA;            "index" : "not_analyzed",&#xA;            "store" : true&#xA;          },&#xA;          "catname" : {&#xA;            "type" : "string",&#xA;            "store" : true,&#xA;            "analyzer" : "kuromoji_analyzer"&#xA;          },&#xA;          "itemname" : {&#xA;            "type" : "string",&#xA;            "store" : true,&#xA;            "analyzer" : "kuromoji_analyzer"&#xA;          },&#xA;          "myscore" : {&#xA;            "type" : "double",&#xA;            "store" : true&#xA;          },&#xA;          "subcatname" : {&#xA;            "type" : "string",&#xA;            "store" : true,&#xA;            "analyzer" : "kuromoji_analyzer"&#xA;          }&#xA;        }&#xA;      }&#xA;    },&#xA;</code></pre>&#xA;
<p>I think since you're running your suggester query on the root endpoint <code>/</code>, your search hits another index which doesn't have any mapping type defining the <code>itemname</code> field.</p>&#xA;&#xA;<p>Try running your query directly on the index which has the mapping type that defines the <code>itemname</code> field.</p>&#xA;&#xA;<p>According to the results of your second query, you should try running your suggester on <code>/my_index/my_type</code> instead of the root endpoint <code>/</code></p>&#xA;&#xA;<pre><code>                        add the index and the type&#xA;                                |      |&#xA;                                v      v&#xA;curl -XPOST 'localhost:9200/my_index/my_type/_search?pretty' -d '{&#xA;  "query": {&#xA;    "function_score": {&#xA;      "query": {&#xA;        "filtered": {&#xA;          "query": {&#xA;            "query_string": {&#xA;              "fields": [&#xA;                "itemname"&#xA;              ],&#xA;              "query": "cola"&#xA;            }&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  },&#xA;  "suggest": {&#xA;    "text": "cola",&#xA;    "simple_phrase": {&#xA;      "phrase": {&#xA;        "field": "itemname",&#xA;        "size": 5,&#xA;        "real_word_error_likelihood": 0.95,&#xA;        "max_errors": 0.5,&#xA;        "gram_size": 2&#xA;      }&#xA;    }&#xA;  }&#xA;}'&#xA;</code></pre>&#xA;