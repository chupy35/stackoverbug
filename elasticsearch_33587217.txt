33587217
Elastic Search bulk index fails with date detection off
<pre><code>DELETE /rosetta_account&#xA;&#xA;POST /rosetta_account/account_number&#xA;{&#xA;      "settings" : {&#xA;        "number_of_shards" : 20,&#xA;        "number_of_replicas" : 2,&#xA;        "index_analyzer" : "standard",&#xA;        "search_analyzer" : "standard",&#xA;         "date_detection" : false&#xA;    }&#xA;}&#xA;&#xA;curl -s -XPOST localhost:9200/rosetta_account/account_number/_bulk --data-binary @data.file&#xA;&#xA;&#xA;{"took":68,"errors":true,"items":[{"create":{"_index":"rosetta_account","_type":"account_number","_id":"123456789","status":400,"error":"WriteFailureException; nested: MapperParsingException[failed to parse [customer_upgrade_dt]]; nested: MapperParsingException[failed to parse date field [], tried both date format [dateOptionalTime], and timestamp number with locale []]; nested: IllegalArgumentException[Invalid format: \"\"]; "}}&#xA;</code></pre>&#xA;
<p>According to the error you get:</p>&#xA;&#xA;<pre><code>failed to parse [customer_upgrade_dt] ... &#xA;tried both date format [dateOptionalTime], and timestamp number with locale ...&#xA;Invalid format: \"\"&#xA;</code></pre>&#xA;&#xA;<p>It means that in one of your JSON documents contained in <code>data.file</code>, you have a field called <code>customer_upgrade_dt</code> whose value is an empty string <code>""</code> and that's not valid for a date field, if the field doesn't have any value, you either need to set it to <code>null</code> or not include the field in the document at all. In clear, dates are still being detected.</p>&#xA;&#xA;<p>The reason is because you're setting <code>date_detection</code> to false in the index settings, but that's not the correct place to put that parameter, you need to add it inside your mapping not in the index settings, i.e. create your index like this instead:</p>&#xA;&#xA;<pre><code>POST /rosetta_account/account_number&#xA;{&#xA;    "settings" : {&#xA;        "number_of_shards" : 20,&#xA;        "number_of_replicas" : 2,&#xA;        "index_analyzer" : "standard",&#xA;        "search_analyzer" : "standard"&#xA;    },&#xA;    "mappings": {&#xA;      "account_number": {&#xA;        "date_detection": false&#xA;      }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;