29447836
ElasticSearch Aggregation Missing Data
<p>On elastic search, when I run an aggregation query it only runs it on one index. How do I get it to run on multiple indicies?</p>&#xA;
<p>Do a <a href="http://www.elastic.co/guide/en/elasticsearch/reference/current/search-search.html#search-multi-index-type" rel="nofollow">multi-index search</a>.</p>&#xA;&#xA;<p>As an example, I created a couple of indexes (implicitly) by bulk indexing some data:</p>&#xA;&#xA;<pre><code>POST /_bulk&#xA;{ "index": {"_index": "test_index", "_type":"doc"}}&#xA;{ "name": "Brown foxes"}&#xA;{ "index": {"_index": "test_index_2", "_type":"doc"}}&#xA;{ "name": "Yellow furballs" }&#xA;{ "index": {"_index": "test_index", "_type":"doc"}}&#xA;{ "name": "my discovery" }&#xA;{ "index": {"_index": "test_index_2", "_type":"doc"}}&#xA;{ "name": "myself is fun" }&#xA;{ "index": {"_index": "test_index", "_type":"doc"}}&#xA;{ "name": ["foxy", "foo"]    }&#xA;{ "index": {"_index": "test_index_2", "_type":"doc"}}&#xA;{ "name": ["foo bar", "baz"] }&#xA;</code></pre>&#xA;&#xA;<p>Then I can run an aggregation on both indexes:</p>&#xA;&#xA;<pre><code>POST /test_index,test_index_2/_search?search_type=count&#xA;{&#xA;    "aggs": {&#xA;        "name_terms": {&#xA;            "terms": {&#xA;                "field": "name"&#xA;            }&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>and I get back all the terms from both:</p>&#xA;&#xA;<pre><code>{&#xA;   "took": 2,&#xA;   "timed_out": false,&#xA;   "_shards": {&#xA;      "total": 10,&#xA;      "successful": 10,&#xA;      "failed": 0&#xA;   },&#xA;   "hits": {&#xA;      "total": 6,&#xA;      "max_score": 0,&#xA;      "hits": []&#xA;   },&#xA;   "aggregations": {&#xA;      "name_terms": {&#xA;         "buckets": [&#xA;            {&#xA;               "key": "foo",&#xA;               "doc_count": 2&#xA;            },&#xA;            {&#xA;               "key": "bar",&#xA;               "doc_count": 1&#xA;            },&#xA;            {&#xA;               "key": "baz",&#xA;               "doc_count": 1&#xA;            },&#xA;            {&#xA;               "key": "brown",&#xA;               "doc_count": 1&#xA;            },&#xA;            {&#xA;               "key": "discovery",&#xA;               "doc_count": 1&#xA;            },&#xA;            {&#xA;               "key": "foxes",&#xA;               "doc_count": 1&#xA;            },&#xA;            {&#xA;               "key": "foxy",&#xA;               "doc_count": 1&#xA;            },&#xA;            {&#xA;               "key": "fun",&#xA;               "doc_count": 1&#xA;            },&#xA;            {&#xA;               "key": "furballs",&#xA;               "doc_count": 1&#xA;            },&#xA;            {&#xA;               "key": "is",&#xA;               "doc_count": 1&#xA;            }&#xA;         ]&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Here's the code:</p>&#xA;&#xA;<p><a href="http://sense.qbox.io/gist/e053a0c6c5453eae68d7b7ff2ff12588669b046e" rel="nofollow">http://sense.qbox.io/gist/e053a0c6c5453eae68d7b7ff2ff12588669b046e</a></p>&#xA;