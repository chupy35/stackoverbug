34271031
Elasticsearch when a file system goes read-only
<p>We have a 3 node Elasticsearch cluster, running 1.7.3. Every node is both a data and master node. Last night, one of the machines corrupted its file system and re-mounted it read-only. From that point, the cluster returned errors on insertion, like</p>&#xA;&#xA;<pre><code>RemoteTransportException[[db06][inet[/IPREMOVED:9300]][indices:data/write/index]]; nested: IndexFailedEngineException[[messages_201503071849][1] Index failed for [message#586279]]; nested: FileNotFoundException[/data/nodes/0/indices/messages_201503071849/1/index/_1v70.fdx (Read-only file system)];&#xA;</code></pre>&#xA;&#xA;<p>Is there any way to configure the system to handle this error better (ie. for that node to take itself out of the cluster)? We want to be able to continue with writes in this situation.</p>&#xA;
<p>Actually reading from several places (mainly ElasticSearch's forum) it appears that Elastic nodes have no way to recover by themselves of this error, and even worse, the cluster will lock itself in case of a failure. </p>&#xA;&#xA;<p>The reason why this happens (from <a href="https://discuss.elastic.co/t/cluster-locks-up-if-master-node-filesystem-becomes-read-only/38245/3" rel="nofollow noreferrer">here</a>):</p>&#xA;&#xA;<blockquote>&#xA;  <p>The reason why ES is not shutting down automatically is because&#xA;  org.elasticsearch.env.NodeEnviroment keeps a java.nio.file.FileStore&#xA;  which is never monitored by calling isReadOnly() method regularly.</p>&#xA;</blockquote>&#xA;&#xA;<p>See <a href="https://discuss.elastic.co/t/cluster-locks-up-if-master-node-filesystem-becomes-read-only/38245/3" rel="nofollow noreferrer">the same post</a> for 2 possible solutions</p>&#xA;