34229115
Multi field analyzer not working as expected
<p>I'm confused. I have the following document indexed:</p>&#xA;&#xA;<pre><code>    POST test/topic&#xA;    {&#xA;      "title": "antiemetics"&#xA;    }&#xA;</code></pre>&#xA;&#xA;<p>With the following query:</p>&#xA;&#xA;<pre><code>    {&#xA;        "query": { &#xA;                        "query_string" : {&#xA;                            "fields" : ["title*"],&#xA;                            "default_operator": "AND", &#xA;                            "query" :"anti emetics",&#xA;                            "use_dis_max" : true&#xA;                        }&#xA;                    },&#xA;                   "highlight" : {&#xA;                        "fields" : {&#xA;                            "*" : {&#xA;                                "fragment_size" : 200,&#xA;                                "pre_tags" : ["&lt;mark&gt;"],&#xA;                                "post_tags" : ["&lt;/mark&gt;"]&#xA;                            }&#xA;                        }&#xA;                    }&#xA;    }&#xA;</code></pre>&#xA;&#xA;<p>and the following settings and mappings:</p>&#xA;&#xA;<pre><code>     POST test{&#xA;           "settings":{&#xA;              "index":{&#xA;                 "number_of_shards":1,&#xA;                 "analysis":{&#xA;                    "analyzer":{&#xA;                       "merge":{&#xA;                          "type":"custom",&#xA;                          "tokenizer":"keyword",&#xA;                          "filter":[&#xA;                             "lowercase"&#xA;                          ],&#xA;                          "char_filter":[&#xA;                             "hyphen",&#xA;                             "space",&#xA;                             "html_strip"&#xA;                          ]&#xA;                       }&#xA;                    },&#xA;                    "char_filter":{&#xA;                       "hyphen":{&#xA;                          "type":"pattern_replace",&#xA;                          "pattern":"[-]",&#xA;                          "replacement":""&#xA;                       },&#xA;                       "space":{&#xA;                          "type":"pattern_replace",&#xA;                          "pattern":" ",&#xA;                          "replacement":""&#xA;                       }&#xA;                    }&#xA;                 }&#xA;              }&#xA;           },&#xA;           "mappings":{&#xA;              "topic":{&#xA;                 "properties":{&#xA;                    "title":{&#xA;                       "analyzer":"standard",&#xA;                       "search_analyzer":"standard",&#xA;                       "type":"string",&#xA;                       "fields":{&#xA;                          "specialised":{&#xA;                             "type":"string",&#xA;                             "index":"analyzed",&#xA;                             "analyzer":"standard",&#xA;                             "search_analyzer":"merge"&#xA;                          }&#xA;                       }&#xA;                    }&#xA;                 }&#xA;              }&#xA;           }&#xA;        }&#xA;</code></pre>&#xA;&#xA;<p>I know my use of a multi-field doesn't make sense as I'm using the same index analyzer as the title so please just ignore that however I'm more interested in my understanding with regard to analyzers. I was expecting the merge analyzer to change the following query "anti emetics" to "antiemetics" and I was hoping the multifield setting that has the analyzer applied would match against the token "antiemetics" but I don't get any results back even though I have tested that the analyzer is removing white spaces from the query by running the analyze API. Any idea why?</p>&#xA;
<p>This seems to work with your setup:</p>&#xA;&#xA;<pre><code>POST /test_index/_search&#xA;{&#xA;   "query": {&#xA;      "match": {&#xA;         "title.specialised": "anti emetics"&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Here's some code I set up to play with it:</p>&#xA;&#xA;<p><a href="http://sense.qbox.io/gist/3ef6926644213cf7db568557a801fec6cb15eaf9" rel="nofollow">http://sense.qbox.io/gist/3ef6926644213cf7db568557a801fec6cb15eaf9</a></p>&#xA;