33291766
how to copy ElasticSearch field to another field
<p>I have 100GB ES index now. Right now I need to change one field to multi-fields, such as: <code>username</code> to <code>username.username</code> and <code>username.raw</code> (<code>not_analyzed</code>). I know it will apply to the incoming data. But how can I make this change affect on the old data? Should I using index scroll to copy the whole index to a new one, Or there is a better solution to just copy one filed please.</p>&#xA;
<p>There's a way to achieve this <strong>without reindexing</strong> all your data by using the <a href="https://github.com/yakaz/elasticsearch-action-updatebyquery" rel="nofollow">update by query plugin</a>. </p>&#xA;&#xA;<p>Basically, after installing the plugin, you can run the following query and all your documents will get the multi-field re-populated.</p>&#xA;&#xA;<pre><code>curl -XPOST 'localhost:9200/your_index/_update_by_query' -d '{&#xA;    "query" : {&#xA;        "match_all" : {}&#xA;    },&#xA;    "script" : "ctx._source.username = ctx._source.username;"&#xA;}'&#xA;</code></pre>&#xA;&#xA;<p>It might take a while to run on 100GB docs, but after this runs, the <code>username.raw</code> field will be populated.</p>&#xA;&#xA;<p>Note: for this plugin to work, one needs to have <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-scripting.html#enable-dynamic-scripting" rel="nofollow">scripting enabled</a>.</p>&#xA;
<p>POST index/type/_update_by_query</p>&#xA;&#xA;<pre><code>{&#xA;  "query" : {&#xA;        "match_all" : {}&#xA;    },&#xA;    "script" :{&#xA;      "inline" : "ctx._source.username = ctx._source.username;",&#xA;      "lang" : "painless"&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>This worked for me on es 5.6, above one did not!</p>&#xA;