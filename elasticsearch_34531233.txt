34531233
Indexing only single object field in ElasticSearch
<p>Imagine i have some document that has relations to other type of document, say, <em>building</em> that is related to <em>regions</em>:</p>&#xA;&#xA;<pre><code>building:&#xA;  country: region&#xA;  city: region&#xA;  nearbyParks: [region]&#xA;  closestNuclearHideout: region&#xA;</code></pre>&#xA;&#xA;<p>I need to be able to perform a search by any region that is related to building, so i'm converting this structure to:</p>&#xA;&#xA;<pre><code>building:&#xA;  countryId: &lt;uuid&gt;&#xA;  cityId: &lt;uuid&gt;&#xA;  nearbyParkIds: [&lt;uuid&gt;]&#xA;  closestNuclearHideoutId: &lt;uuid&gt;&#xA;  regions: [region]&#xA;</code></pre>&#xA;&#xA;<p>However, by this very moment i need to perform searches only by related region id, and would love to forbid ElasticSearch to index every <code>regions.*</code> field (except for <code>regions.id</code>) to keep things clean. Is this possible using current mapping API? I would love to keep my elastic documents as small as possible and also keep them in sync with backend output, so adding <code>regionIds</code> uuid array field is an option, but an unwanted one.</p>&#xA;
<p>Yes, you can turn off <code>dynamic</code> mappings for a given field. In the mappings, you can therefore define the fields you <em>do</em> want to map, while effectively disabling the rest for search.</p>&#xA;&#xA;<pre><code>{&#xA;  "mappings": {&#xA;    "type": {&#xA;      "properties": {&#xA;        "regions": {&#xA;          "type": "object",&#xA;          "dynamic": false,&#xA;          "properties": {&#xA;            "id": {&#xA;              "type": "string",&#xA;              "index": "not_analyzed",&#xA;              "doc_values" : true&#xA;            }&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>So, imagining that you indexed this document:</p>&#xA;&#xA;<pre><code>{&#xA;  "regions" : [&#xA;    {&#xA;      "id" : "xyzabc",&#xA;      "field1" : "ignored",&#xA;      "field2" : "ignored"&#xA;    },&#xA;    {&#xA;      "id" : "abcdef",&#xA;      "field1" : "ignored",&#xA;      "field2" : "ignored",&#xA;      "field3" : "ignored"&#xA;    }&#xA;  ]&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>The non-<code>id</code> fields would be ignored by the mapping and they would therefore not be searchable (without a script), but you <em>would</em> get them back as <code>_source</code> results in your hits.</p>&#xA;