29088653
Elasticsearch: Get report of unmatched should elements in a bool query
<p>I'm looking for a way to get a report of unmatched should querys and display it.&#xA;For instance I have two user objects</p>&#xA;&#xA;<p>User 1:</p>&#xA;&#xA;<pre><code>{&#xA;"username": "user1"&#xA;"docType": "user"&#xA;"level": "Professor"&#xA;"discipline": "Sciences"&#xA;"sub-discipline": "Mathematical"&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>User 2:</p>&#xA;&#xA;<pre><code>{&#xA;"username": "user1"&#xA;"docType": "user"&#xA;"level": "Professor"&#xA;"discipline": "Sciences"&#xA;"subDiscipline": "Physics"&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>When I do a bool query where the matching discipline is in must query and the sub-discipline is in the should query</p>&#xA;&#xA;<pre><code>bool:&#xA;  must: [{&#xA;    term: { "doc.docType": "user" }&#xA;  },{&#xA;    term: { "doc.level": "professor" }&#xA;  },{&#xA;    term: { "doc.discipline": "sciences" }&#xA;  }],&#xA;  should: [{&#xA;    term: { "subDiscipline": "physics" }&#xA;  }]&#xA;</code></pre>&#xA;&#xA;<p>How can I get the unmatched elements in my result like that:</p>&#xA;&#xA;<pre><code>Result 1: user1 match 100%&#xA;Result 2: user2 match 70% (unmatch subdiscipine "physics")&#xA;</code></pre>&#xA;&#xA;<p>I had a look into the explainApi but the result doesn't seems to be provided for that use case and seems very complicated to parse.</p>&#xA;
<p>You will need to use <a href="http://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-named-queries-and-filters.html" rel="nofollow">named queries</a> for this.&#xA;Using the same , create a bool query like below - </p>&#xA;&#xA;<pre><code>{&#xA;  "query": {&#xA;    "bool": {&#xA;      "must": [&#xA;        {&#xA;          "match": {&#xA;            "SourceName": {&#xA;              "query": "CNN",&#xA;              "_name": "sourceMatch"&#xA;            }&#xA;          }&#xA;        },&#xA;        {&#xA;          "match": {&#xA;            "author": {&#xA;              "query": "qbox.io",&#xA;              "_name": "author"&#xA;            }&#xA;          }&#xA;        }&#xA;      ]&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>In the result section , it will tell which all named queries matched.&#xA;You can use this information to fabricate the stats you are looking for. </p>&#xA;