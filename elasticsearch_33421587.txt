33421587
Elasticsearch Automatic Synonyms
<p>I am looking at Elasticsearch to handle search queries made by users in on my website.</p>&#xA;&#xA;<p>Say that I have a document <code>person</code> with field <code>vehicles_owned</code> which is a list of strings. For example:</p>&#xA;&#xA;<pre><code>{&#xA;    "name":"james",&#xA;    "surname":"smith",&#xA;    "vehicles_owned":["car","bike","ship"]&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>I would like to query which people own a certain vehicle. I understand it's possible to configure ES so that <code>boat</code> is treated as a synonym of <code>ship</code> and if I query with <code>boat</code> I am returned the user <code>james</code> who owns a ship.</p>&#xA;&#xA;<p>What I don't understand is whether this is done automatically, or if I have to import lists of synonyms.</p>&#xA;
<p>The idea is to create a custom analyzer for the <code>vehicles_owned</code> field which leverages the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-synonym-tokenfilter.html" rel="nofollow"><code>synonym</code> token filter</a>.</p>&#xA;&#xA;<p>So you first need to define your index like this:</p>&#xA;&#xA;<pre><code>curl -XPUT localhost:9200/your_index -d '{&#xA;  "settings": {&#xA;    "index": {&#xA;      "analysis": {&#xA;        "analyzer": {&#xA;          "synonym": {&#xA;            "tokenizer": "whitespace",&#xA;            "filter": [&#xA;              "synonym"&#xA;            ]&#xA;          }&#xA;        },&#xA;        "filter": {&#xA;          "synonym": {&#xA;            "type": "synonym",&#xA;            "synonyms_path": "synonyms.txt"    &lt;-- your synonym file&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  },&#xA;  "mappings": {&#xA;    "syn": {&#xA;      "properties": {&#xA;        "name": {&#xA;          "type": "string"&#xA;        },&#xA;        "surname": {&#xA;          "type": "string"&#xA;        },&#xA;        "vehicles_owned": {&#xA;          "type": "string",&#xA;          "index_analyzer": "synonym"     &lt;-- use the synonym analyzer here&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}'&#xA;</code></pre>&#xA;&#xA;<p>Then you can add all the synonyms you want to handle in the <code>$ES_HOME/config/synonyms.txt</code> file using the supported <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-synonym-tokenfilter.html#_solr_synonyms" rel="nofollow">formats</a>, for instance:</p>&#xA;&#xA;<pre><code>boat, ship&#xA;</code></pre>&#xA;&#xA;<p>Next, you can index your documents:</p>&#xA;&#xA;<pre><code>curl -XPUT localhost:9200/your_index/your_type/1 -d '{&#xA;    "name":"james",&#xA;    "surname":"smith",&#xA;    "vehicles_owned":["car","bike","ship"]&#xA;}'&#xA;</code></pre>&#xA;&#xA;<p>And finally searching for either <code>ship</code> or <code>boat</code> will get you the above document we just indexed:</p>&#xA;&#xA;<pre><code>curl -XGET localhost:9200/your_index/your_type/_search?q=vehicles_owned:boat&#xA;curl -XGET localhost:9200/your_index/your_type/_search?q=vehicles_owned:ship&#xA;</code></pre>&#xA;