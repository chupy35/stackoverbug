28596980
Combining Multiple Queries with 'OR' or 'AND' in Elasticsearch
<p>I have two distinct query, and I want to combine them with an 'OR'/'AND' in between. How do I do that?</p>&#xA;&#xA;<p>For example, for the given queries&#xA;I just want to run Query1 OR Query2 in the elasticsearch.</p>&#xA;&#xA;<p>Query1:</p>&#xA;&#xA;<pre><code>{&#xA;   "query": {&#xA;      "filtered": {&#xA;         "query": { &#xA;            "query_string":{  &#xA;               "query":"Batman",&#xA;               "default_operator":"AND",&#xA;               "fields"::[  &#xA;                  "Movies._all"&#xA;               ]&#xA;            }&#xA;         },&#xA;         "filter": {&#xA;            "bool": {&#xA;               "must": [  &#xA;                  {  &#xA;                     "query":{  &#xA;                        "filtered":{  &#xA;                           "filter":{  &#xA;                              "and":[  &#xA;                                 {  &#xA;                                    "term":{  &#xA;                                       "cast.firstName":"Christian "&#xA;                                    }&#xA;                                 },&#xA;                                 {  &#xA;                                    "term":{  &#xA;                                       "cast.lastName":"Bale"&#xA;                                    }&#xA;                                 }&#xA;                              ]&#xA;                           }&#xA;                        }&#xA;                     }&#xA;                  }&#xA;               ]&#xA;            }&#xA;         }&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Query2:</p>&#xA;&#xA;<pre><code>{&#xA;   "query": {&#xA;      "filtered": {&#xA;         "query": { &#xA;            "query_string":{  &#xA;               "query":"Dark Knight",&#xA;               "default_operator":"AND",&#xA;               "fields"::[  &#xA;                  "Movies._all"&#xA;               ]&#xA;            }&#xA;         },&#xA;         "filter": {&#xA;            "bool": {&#xA;               "must": [  &#xA;                  {  &#xA;                     "query":{  &#xA;                        "filtered":{  &#xA;                           "filter":{  &#xA;                              "and":[  &#xA;                                 {  &#xA;                                    "term":{  &#xA;                                       "director.firstName":"Christopher"&#xA;                                    }&#xA;                                 },&#xA;                                 {  &#xA;                                    "term":{  &#xA;                                       "director.lastName":"Nolan"&#xA;                                    }&#xA;                                 }&#xA;                              ]&#xA;                           }&#xA;                        }&#xA;                     }&#xA;                  }&#xA;               ]&#xA;            }&#xA;         }&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;
<p>You need to use a <a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/query-dsl-bool-query.html" rel="noreferrer">bool query</a> &#xA;Something like below will work fine - </p>&#xA;&#xA;<pre><code>{&#xA;  "query" : {&#xA;    "bool" : { &#xA;      "must" : [&#xA;        { // Query1 },&#xA;        { // Query2}&#xA;      ]&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Use must for AND and should for OR</p>&#xA;