33120223
elasticsearch date-range query 0 hits
<p>I'm trying to query my docs with a date-range query.</p>&#xA;&#xA;<p>Doing a get for one of my docs gives me something like that:</p>&#xA;&#xA;<pre><code>{&#xA;  "_index": "offer",&#xA;  "_type": "offer",&#xA;  "_id": "offer3",&#xA;  "_score": 1,&#xA;  "_source": {&#xA;    "offer": {&#xA;      "properties": {&#xA;        "starts_at": "12/10/2015T14:27:49.197962+00:00",&#xA;        "ends_at": "14/11/2016T07:59:49.197962+00:00",&#xA;        "duration": "1.0"&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>I have a query in this form, where I have the exact value of ends_at copied into my query, but I still get 0 hits. Where am I going wrong?</p>&#xA;&#xA;<pre><code>curl -XGET "http://localhost:9200/offer/offer/_search" -d'&#xA;{&#xA;  "query": {&#xA;    "range": {&#xA;      "ends_at": {&#xA;        "lte": "14/11/2016T07:59:49.197962+00:00"&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;
<p>Since your date format is <code>dateOptionalTime</code> your documents need to have the correct <a href="https://en.wikipedia.org/wiki/ISO_8601" rel="nofollow">ISO8601 date format</a>, i.e. either <code>yyyy-MM-dd</code> (without time) or <code>yyyy-MM-ddTHH:mm:ss.SSSZ</code> (with time)</p>&#xA;&#xA;<p>In your case that would mean that your dates need to be formatted like this instead:</p>&#xA;&#xA;<pre><code>2016-11-14T07:59:49.197+00:00&#xA;</code></pre>&#xA;&#xA;<p>You need to wipe your index, fix your mapping and re-index your data properly.</p>&#xA;&#xA;<p>Then you'll be able to search using this query:</p>&#xA;&#xA;<pre><code>curl -XGET "http://localhost:9200/offer/offer/_search" -d'&#xA;{&#xA;  "query": {&#xA;    "range": {&#xA;  "properties.ends_at": {&#xA;     "lte":"2016-11-14T07:59:49.197+00:00"&#xA;  }&#xA;}&#xA;}&#xA;}'&#xA;</code></pre>&#xA;