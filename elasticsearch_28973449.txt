28973449
Elasticsearch 1.3.8 transform with groovy script file
<p>Due to a security vulnerability with ES 1.3.4 we upgraded to ES 1.3.9 which disabled dynamic groovy scripting, as a result the mapping transformations are failing with the error message "dynamic scripting for [groovy] disabled". I tried the approach in <a href="https://www.elastic.co/guide/en/elasticsearch/reference/1.3/modules-scripting.html" rel="nofollow">https://www.elastic.co/guide/en/elasticsearch/reference/1.3/modules-scripting.html</a> by externalizing the script to a script file but the script file is not getting invoked or the transformation is not working. How can we achieve the transformation using a script file</p>&#xA;&#xA;<p>Mapping file transform is as follows:</p>&#xA;&#xA;<pre><code>"transform" : [{&#xA;      "script" : "ctx._source['downloadCountInt'] = (ctx._source['downloadCount']==null)? ctx._source['downloadCount'] : ctx._source['downloadCount'].replaceAll(/\\D/, '');",&#xA;      "lang" : "groovy"&#xA;    }]&#xA;</code></pre>&#xA;&#xA;<p>Tried putting the script <code>ctx._source['downloadCountInt'] = (ctx._source['downloadCount']==null)? ctx._source['downloadCount'] : ctx._source['downloadCount'].replaceAll(/\\D/, '');</code> into a script file named "transform_download_count.groovy" in /etc/elasticsearch/scripts/transform_download_count.groovy and the log messages show that it was compiled correctly but the transformation is never invoked.</p>&#xA;
<p>With the script file <code>/etc/elasticsearch/scripts/transform_download_count.groovy</code> in place try:</p>&#xA;&#xA;<pre><code>"transform" : {&#xA;  "script_file" : "transform_download_count",&#xA;  "lang" : "groovy"&#xA;}&#xA;</code></pre>&#xA;