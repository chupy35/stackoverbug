30599311
WHERE IN for Elastic search
<p>How can I implement the following logic in elastic search  </p>&#xA;&#xA;<pre><code>SELECT COUNT(*)&#xA;FROM type1&#xA;WHERE type1.field_name IN (&#xA;    SELECT field_name&#xA;    FROM type2&#xA;    WHERE &#xA;        date_filed_name BETWEEN 'date1' AND 'date2');&#xA;</code></pre>&#xA;&#xA;<p>AND</p>&#xA;&#xA;<pre><code>SELECT COUNT(DISTINCT field3)&#xA;FROM type1&#xA;WHERE type1.field_name IN (&#xA;    SELECT field_name&#xA;    FROM type2&#xA;    WHERE &#xA;        date_filed_name BETWEEN 'date1' AND 'date2');&#xA;</code></pre>&#xA;&#xA;<p>I have two types in ES and need to implement this logic. I tried by fetching from one type and used it in the other by using two ES queries using bool filter. But is it possible to combine these two queries using something like "Term filter Lookup" ?</p>&#xA;&#xA;<p>I have the sub-query result results more than 1500 unique ids</p>&#xA;&#xA;<p>I am using PHP and please find the array below for the query.</p>&#xA;&#xA;<pre><code>$reportParams['body']['query'] = array(&#xA;    "filtered" =&gt; array(&#xA;        "filter" =&gt; array(&#xA;            "bool" =&gt; array(&#xA;                "must" =&gt; array(&#xA;                    "range" =&gt; array(&#xA;                        "time" =&gt; array(&#xA;                            "gt" =&gt; $start,&#xA;                            "lt" =&gt; $end&#xA;                        )&#xA;                    )&#xA;                ),&#xA;                "should" =&gt;$termFilter&#xA;            )&#xA;        )&#xA;    )&#xA;    );&#xA;&#xA;$reportParams['body']['aggs'] = array(&#xA;"distinct_user_count" =&gt; array(&#xA;    "cardinality" =&gt; array(&#xA;        "field" =&gt; $details-&gt;agg_field&#xA;    )&#xA;),&#xA;"daily_event_count" =&gt; array(&#xA;    "value_count" =&gt; array(&#xA;        "field" =&gt; $details-&gt;agg_field&#xA;    )&#xA;)&#xA;);&#xA;</code></pre>&#xA;&#xA;<p>and termsFilter will be like</p>&#xA;&#xA;<pre><code>[0] =&gt; Array&#xA;        (&#xA;            [term] =&gt; Array&#xA;                (&#xA;                    [andi] =&gt; 84cc04c6059fb490&#xA;                )&#xA;&#xA;        )&#xA;&#xA;    [1] =&gt; Array&#xA;        (&#xA;            [term] =&gt; Array&#xA;                (&#xA;                    [andi] =&gt; af9cbd253100f2c7&#xA;                )&#xA;&#xA;        )&#xA;&#xA;    [2] =&gt; Array&#xA;        (&#xA;            [term] =&gt; Array&#xA;                (&#xA;                    [andi] =&gt; c1a3fcf0fefe7107&#xA;                )&#xA;&#xA;        )&#xA;&#xA;    [3] =&gt; Array&#xA;        (&#xA;            [term] =&gt; Array&#xA;                (&#xA;                    [andi] =&gt; b3a630084347fb2f&#xA;                )&#xA;&#xA;        )&#xA;</code></pre>&#xA;&#xA;<p>The "agg_field" is "andi". I have created the termsFilter by doing another query and looping it through PHP.</p>&#xA;