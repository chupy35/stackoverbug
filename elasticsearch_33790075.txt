33790075
Range strange results
<p>I'm using this code for ranges. To show accommodations in a price range (<code>weekly_price</code>)</p>&#xA;&#xA;<pre><code>GET /accommodations/_search&#xA;{&#xA;    "query": {&#xA;        "filtered": {&#xA;            "query":  {"match_all":{}},&#xA;            "filter": {"and":[{"range":{"weekly_price":{"gte":0,"lte":500}}}]}&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>The results are strange. Sometimes I get the correct results (showing the accommodations between 0 and 500 euro and sometimes I get also accommodations of a <code>weekly_price</code> of 2000. </p>&#xA;&#xA;<p>What am I doing wrong? </p>&#xA;
<p>The only way this is possible is if your <code>weekly_price</code> field is a string instead of a number field (<code>integer</code>, <code>long</code>, etc). When retrieving strings within the range <code>"0"</code> and <code>"500"</code>, then the string <code>"2000"</code> lexically falls within that range, because <code>"2"</code> is "bigger" than <code>"0"</code> and "smaller" than <code>"5"</code>.</p>&#xA;&#xA;<p>If you retrieve your mapping using</p>&#xA;&#xA;<pre><code>curl -XGET localhost:9200/accommodations/_mapping&#xA;</code></pre>&#xA;&#xA;<p>You should see your <code>weekly_price</code> field as being of type <code>string</code>. </p>&#xA;&#xA;<p>You need to change that type to <code>integer</code> or another number type that makes sense for your data, wipe your index and recreate it with the new mapping like shown below. After doing so, your query will work as expected.</p>&#xA;&#xA;<pre><code>// delete your index&#xA;curl -XDELETE localhost:9200/accommodations &#xA;&#xA;// re-create your index with the proper mapping&#xA;curl -XPUT localhost:9200/accommodations -d '{&#xA;    "mappings": {&#xA;        "your_type": {&#xA;            "properties": {&#xA;                "weekly_price": {&#xA;                    "type": "integer"&#xA;                },&#xA;                ... other properties&#xA;            }&#xA;        }&#xA;    }&#xA;}'&#xA;&#xA;// re-populate your index&#xA;curl -XPOST localhost:9200/accommodations/_bulk&#xA;</code></pre>&#xA;
<p>If you want to use range filter , you should have a valid mapping for example; for date you should have ;</p>&#xA;&#xA;<pre><code>"properties": {&#xA;    "date": {&#xA;                "type": "date",&#xA;                "format": "date"&#xA;              }&#xA;</code></pre>&#xA;&#xA;<p>also for integer field Mr. Val wrote it above. Than you can use range filter.</p>&#xA;