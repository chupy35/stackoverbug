32694958
Elasticsearch query without stop words in aggregation result
<p>In my index-template, I have defined a custom analyzer, where a stop words filter is included. See following snippet:</p>&#xA;&#xA;<pre><code>  "settings": {&#xA;     "index.analysis.filter.german_stemmer.type": "stemmer",&#xA;     "index.analysis.filter.german_stop.type": "stop",&#xA;     "index.analysis.filter.german_stemmer.language": "light_german",&#xA;     "index.analysis.filter.german_keywords.keywords.0": "",&#xA;     "index.analysis.filter.german_stop.stopwords": "_german_",&#xA;     "index.analysis.filter.german_keywords.type": "keyword_marker",&#xA;     "index.analysis.analyzer.unigram.filter.0": "lowercase",&#xA;     "index.analysis.analyzer.unigram.filter.1": "german_stop",&#xA;     "index.analysis.analyzer.unigram.filter.2": "german_keywords",&#xA;     "index.analysis.analyzer.unigram.filter.3": "german_normalization",&#xA;     "index.analysis.analyzer.unigram.filter.4": "german_stemmer",&#xA;     "index.analysis.analyzer.unigram.tokenizer": "standard",&#xA;  }&#xA;</code></pre>&#xA;&#xA;<p>I have also defined a mapping for unigram on the <code>textBody</code>-field. At next I try to get the most frequent words, by looking at the top-100 document counts: </p>&#xA;&#xA;<pre><code>  "aggs":{&#xA;    "wordcounts":{&#xA;      "terms":{&#xA;        "field" : "textBody",&#xA;        "size" : 100&#xA;      }&#xA;    }&#xA;  }&#xA;</code></pre>&#xA;&#xA;<p>Unfortunately in this approach, there are also stop words included in the results. This stop words have a high document count, but zero word frequency (follow up query via <code>script field tf()</code>). Is there a way to remove the stop words from my aggregation result? </p>&#xA;&#xA;<p>P.S.: The significant terms query also gives me stop words in my result set.</p>&#xA;&#xA;<p>Examples for german stop words: "viel", "muss", "soll", "war", "weg", "den", ... </p>&#xA;&#xA;<p>I am using elasticsearch-groovy:1.7.0, which is build on top of: </p>&#xA;&#xA;<ul>&#xA;<li>elasticsearch:1.7.0</li>&#xA;<li>lucene-core:4.10.4</li>&#xA;</ul>&#xA;&#xA;<p><strong>update:</strong></p>&#xA;&#xA;<p>I figured out, that there are some word forms which are reduced to the words mentioned above. For example "muss" is in the text in the following word forms: "muss", "muesse", "muessen", "muß", "muße", "müsse" and "müsser". These words all get reduced to the stemmed word "muss". If I query for the word "muss", then I get zero results, because it gets filtered by the stop words filter.</p>&#xA;&#xA;<p>In some queries (e.g. must_not filter) it is even possible to query "muss" and as a result I get the aggregated count of all other word forms then "muss".</p>&#xA;
<p>Lucene versions prior to 5.0 appear to use an hard coded list of stopwords. <a href="http://grepcode.com/file/repo1.maven.org/maven2/org.apache.lucene/lucene-analyzers-common/4.10.4/org/apache/lucene/analysis/de/GermanAnalyzer.java?av=f" rel="nofollow">(view source code)</a>. This does not include "viel", "muss", "soll", "weg", "den". It does include "war".</p>&#xA;&#xA;<p>Hovever, you can specify a <code>stopwords_path</code> to a file containing all the stopwords that you need to have (See <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/using-stopwords.html" rel="nofollow">https://www.elastic.co/guide/en/elasticsearch/guide/current/using-stopwords.html</a>).</p>&#xA;&#xA;<p>From version 5.0 the stopwords are always read from file, but I could not find the text of the default file. I found some files and they where richer than the hard coded list of version 4.10.4, but I don't know which one is used by default (<a href="https://github.com/buric/GermanStopWords/blob/master/de_DE_stop.txt" rel="nofollow">here is one</a>)</p>&#xA;