32629234
querying multiple indexes in elasticsearch and remove duplicates
<p>We have some documents indexed in two (or more than two) indexes in <code>elasticsearch</code>. </p>&#xA;&#xA;<p>How can I get all the documents from the two indexes without duplication?</p>&#xA;
<p>Change the <code>_id</code> to be indexed and then use a <code>terms</code> aggregation.</p>&#xA;&#xA;<p>The mapping change:</p>&#xA;&#xA;<pre><code>{&#xA;  "mappings": {&#xA;    "test": {&#xA;      "_id": {&#xA;        "store": true,&#xA;        "index": "not_analyzed"&#xA;      }&#xA;...&#xA;</code></pre>&#xA;&#xA;<p>The query:</p>&#xA;&#xA;<pre><code>GET /test*/_search&#xA;{&#xA;  "aggs": {&#xA;    "NAME": {&#xA;      "terms": {&#xA;        "field": "_id",&#xA;        "size": 10&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>The tricky part is with "get all the documents from the two indexes". Increasing the <code>size</code> from the <code>terms</code> aggregation will eat a lot of memory.</p>&#xA;