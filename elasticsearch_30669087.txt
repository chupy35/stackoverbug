30669087
Elasticsearch Geospatial giving me exaggerated distance measurements
<p>Problem: </p>&#xA;&#xA;<p>I am using Elasticsearch to index some listings on my site and I keep getting ridiculously exaggerated distances. Even when I search using the same coordinates my document has I still get distances upward of 3000km.   </p>&#xA;&#xA;<p>Post:</p>&#xA;&#xA;<pre><code>    [{&#xA;        "expiryDate": "2014-04-11 02:32:16",&#xA;        "geo": {&#xA;          "lon": 45.297,&#xA;          "lat": 75.0755&#xA;        },&#xA;        "id": "5571afb7ae2c287f4d54b713",&#xA;        "images": [],&#xA;        "imagesLinks": [],&#xA;&#xA;    }]&#xA;</code></pre>&#xA;&#xA;<p>Mapping:</p>&#xA;&#xA;<pre><code>   {&#xA;    "listingsell" : {&#xA;        "properties" : {&#xA;            "geo" : {&#xA;              "type" : "geo_point",&#xA;              "fielddata" : {&#xA;                    "format" : "compressed",&#xA;                    "precision" : "1m"&#xA;                }  &#xA;             }&#xA;        } &#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Query:</p>&#xA;&#xA;<pre><code>       {&#xA;&#xA;    "query": {&#xA;        "filtered" : {&#xA;            "query" : {&#xA;                "match_all" : {}&#xA;            },&#xA;            "filter" : {&#xA;                "geo_distance" : {&#xA;                    "distance" : "90000mi",&#xA;                    "geo" : {&#xA;                        "lat" : 45.1339,&#xA;                        "lon" : 75.019&#xA;                    }&#xA;                }&#xA;            }&#xA;        }&#xA;    },&#xA;    "sort" : [&#xA;      {&#xA;          "_geo_distance" : {&#xA;              "geo" : {&#xA;                    "lat" : 45.1339,&#xA;                    "lon" : 75.019&#xA;              }, &#xA;              "order" : "asc",&#xA;              "unit" : "mi"&#xA;          }&#xA;      }&#xA;  ],&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Result :</p>&#xA;&#xA;<pre><code>  {&#xA;"sort":[2247.4929]&#xA;   }&#xA;</code></pre>&#xA;
<p>You have the <code>geo_point</code> indexed in a wrong way:</p>&#xA;&#xA;<pre><code>       "geo": {&#xA;          "lon": 45.297,&#xA;          "lat": 75.0755&#xA;        }&#xA;</code></pre>&#xA;&#xA;<p>or the sorting is done in a wrong way:</p>&#xA;&#xA;<pre><code>              "geo" : {&#xA;                    "lat" : 45.1339,&#xA;                    "lon" : 75.019&#xA;              }&#xA;</code></pre>&#xA;&#xA;<p>Meaning you mixed up <code>lat</code> with <code>lon</code>.</p>&#xA;