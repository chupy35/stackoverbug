29867301
How to write a conditional query with Elasticsearch?
<p>I have a simple JSON query for Elasticsearch that looks like this:</p>&#xA;&#xA;<pre><code>"query": {&#xA;  "bool": {&#xA;    "must": { "match": { "id": "1" }} ,&#xA;    "must": { "match": { "tags.name": "a1"}}&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>How can I execute the second 'must' criteria ONLY if the value ('a1' in this case) is not empty? </p>&#xA;
<p>You can achieve it using the following - </p>&#xA;&#xA;<pre><code>{&#xA;  "query": {&#xA;    "bool": {&#xA;      "must": [&#xA;        {&#xA;          "match": {&#xA;            "id": "1"&#xA;          }&#xA;        },&#xA;        {&#xA;          "bool": {&#xA;            "should": [&#xA;              {&#xA;                "missing": {&#xA;                  "field": "tags.name"&#xA;                }&#xA;              },&#xA;              {&#xA;                "match": {&#xA;                  "tags.name": "a1"&#xA;                }&#xA;              }&#xA;            ]&#xA;          }&#xA;        }&#xA;      ]&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;
<p>I don't think "missing" can be used in the latest versions of elasticsearch.&#xA;But one can use Conditional Clauses instead.&#xA;<a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.3/search-template.html#_conditional_clauses" rel="nofollow noreferrer">https://www.elastic.co/guide/en/elasticsearch/reference/6.3/search-template.html#_conditional_clauses</a></p>&#xA;