29465484
Elasticsearch v-1.5 showing high CPU & memory utilization
<p>We've recently started using elasticsearch(V-1.5) on one of our app &amp; started facing following issues..</p>&#xA;&#xA;<ul>&#xA;<li><p>Generating Logs ( Exceptionally very high viz.. 5 min 5GB log )</p></li>&#xA;<li><p>High CPU Utilization</p></li>&#xA;<li><p>In-spite of deleting logs, disk space was not released. Needed Hard &#xA;boot the server to release the logs space.</p></li>&#xA;</ul>&#xA;&#xA;<p><strong>System Configuration</strong></p>&#xA;&#xA;<ul>&#xA;<li>OS - Linux 14.04 LTS 64bit Ubuntu.</li>&#xA;<li>vCPU - 2 Core</li>&#xA;<li>vRAM - 8 GB</li>&#xA;<li>Disk Space - 100 GB</li>&#xA;</ul>&#xA;&#xA;<p>Don't know what's going wrong. Any clue... </p>&#xA;&#xA;<h2>Elastic search error log</h2>&#xA;&#xA;<pre><code>Caused by: org.elasticsearch.index.gateway.IndexShardGatewayRecoveryException: [.marvel-2015.03.16][0] shard allocated for local recovery (post ap&#xA;i), should exist, but doesn't, current files: []&#xA;        at org.elasticsearch.index.gateway.local.LocalIndexShardGateway.recover(LocalIndexShardGateway.java:131)&#xA;        ... 4 more&#xA;Caused by: org.apache.lucene.index.IndexNotFoundException: no segments* file found in store(least_used[rate_limited(default(mmapfs(/DATA/www/elast&#xA;icsearch/data/elasticsearch/nodes/0/indices/.marvel-2015.03.16/0/index),niofs(/DATA/www/elasticsearch/data/elasticsearch/nodes/0/indices/.marvel-2&#xA;015.03.16/0/index)), type=MERGE, rate=20.0)]): files: []&#xA;        at org.apache.lucene.index.SegmentInfos$FindSegmentsFile.run(SegmentInfos.java:881)&#xA;        at org.apache.lucene.index.SegmentInfos$FindSegmentsFile.run(SegmentInfos.java:769)&#xA;        at org.apache.lucene.index.SegmentInfos.read(SegmentInfos.java:458)&#xA;        at org.elasticsearch.common.lucene.Lucene.readSegmentInfos(Lucene.java:89)&#xA;        at org.elasticsearch.index.gateway.local.LocalIndexShardGateway.recover(LocalIndexShardGateway.java:122)&#xA;        ... 4 more&#xA;[2015-04-04 15:18:01,064][WARN ][cluster.action.shard     ] [Trick Shot] [.marvel-2015.03.16][0] sending failed shard for [.marvel-2015.03.16][0],&#xA; node[4YS3jneRTn624zDl6C29Zg], [P], s[INITIALIZING], indexUUID [FKpoioArTI-KxevMFlQKAQ], reason [Failed to start shard, message [IndexShardGateway&#xA;RecoveryException[[.marvel-2015.03.16][0] failed to fetch index version after copying it over]; nested: IndexShardGatewayRecoveryException[[.marve&#xA;l-2015.03.16][0] shard allocated for local recovery (post api), should exist, but doesn't, current files: []]; nested: IndexNotFoundException[no s&#xA;egments* file found in store(least_used[rate_limited(default(mmapfs(/DATA/www/elasticsearch/data/elasticsearch/nodes/0/indices/.marvel-2015.03.16/&#xA;0/index),niofs(/DATA/www/elasticsearch/data/elasticsearch/nodes/0/indices/.marvel-2015.03.16/0/index)), type=MERGE, rate=20.0)]): files: []]; ]]&#xA;[2015-04-04 15:18:01,064][WARN ][cluster.action.shard     ] [Trick Shot] [.marvel-2015.03.16][0] received shard failed for [.marvel-2015.03.16][0]&#xA;, node[4YS3jneRTn624zDl6C29Zg], [P], s[INITIALIZING], indexUUID [FKpoioArTI-KxevMFlQKAQ], reason [Failed to start shard, message [IndexShardGatewa&#xA;yRecoveryException[[.marvel-2015.03.16][0] failed to fetch index version after copying it over]; nested: IndexShardGatewayRecoveryException[[.marv&#xA;el-2015.03.16][0] shard allocated for local recovery (post api), should exist, but doesn't, current files: []]; nested: IndexNotFoundException[no&#xA;segments* file found in store(least_used[rate_limited(default(mmapfs(/DATA/www/elasticsearch/data/elasticsearch/nodes/0/indices/.marvel-2015.03.16&#xA;/0/index),niofs(/DATA/www/elasticsearch/data/elasticsearch/nodes/0/indices/.marvel-2015.03.16/0/index)), type=MERGE, rate=20.0)]): files: []]; ]]&#xA;[2015-04-04 15:18:01,079][WARN ][cluster.action.shard     ] [Trick Shot] [.marvel-2015.03.16][0] received shard failed for [.marvel-2015.03.16][0]&#xA;, node[4YS3jneRTn624zDl6C29Zg], [P], s[INITIALIZING], indexUUID [FKpoioArTI-KxevMFlQKAQ], reason [master [Trick Shot][4YS3jneRTn624zDl6C29Zg][E2pr&#xA;o-ESP-06][inet[/10.9.46.65:9300]] marked shard as initializing, but shard is marked as failed, resend shard failure]&#xA;[2015-04-04 15:18:01,080][WARN ][indices.cluster          ] [Trick Shot] [.marvel-2015.03.15][0] sending failed shard after recovery failure&#xA;org.elasticsearch.index.gateway.IndexShardGatewayRecoveryException: [.marvel-2015.03.15][0] failed to fetch index version after copying it over&#xA;        at org.elasticsearch.index.gateway.local.LocalIndexShardGateway.recover(LocalIndexShardGateway.java:157)&#xA;        at org.elasticsearch.index.gateway.IndexShardGatewayService$1.run(IndexShardGatewayService.java:112)&#xA;        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)&#xA;        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)&#xA;        at java.lang.Thread.run(Thread.java:745)&#xA;Caused by: org.elasticsearch.index.gateway.IndexShardGatewayRecoveryException: [.marvel-2015.03.15][0] shard allocated for local recovery (post ap&#xA;i), should exist, but doesn't, current files: []&#xA;        at org.elasticsearch.index.gateway.local.LocalIndexShardGateway.recover(LocalIndexShardGateway.java:131)&#xA;        ... 4 more&#xA;Caused by: org.apache.lucene.index.IndexNotFoundException: no segments* file found in store(least_used[rate_limited(default(mmapfs(/DATA/www/elast&#xA;icsearch/data/elasticsearch/nodes/0/indices/.marvel-2015.03.15/0/index),niofs(/DATA/www/elasticsearch/data/elasticsearch/nodes/0/indices/.marvel-2&#xA;015.03.15/0/index)), type=MERGE, rate=20.0)]): files: []&#xA;        at org.apache.lucene.index.SegmentInfos$FindSegmentsFile.run(SegmentInfos.java:881)&#xA;        at org.apache.lucene.index.SegmentInfos$FindSegmentsFile.run(SegmentInfos.java:769)&#xA;        at org.apache.lucene.index.SegmentInfos.read(SegmentInfos.java:458)&#xA;        at org.elasticsearch.common.lucene.Lucene.readSegmentInfos(Lucene.java:89)&#xA;        at org.elasticsearch.index.gateway.local.LocalIndexShardGateway.recover(LocalIndexShardGateway.java:122)&#xA;        ... 4 more&#xA;[2015-04-04 15:18:01,080][WARN ][cluster.action.shard     ] [Trick Shot] [.marvel-2015.03.15][0] sending failed shard for [.marvel-2015.03.15][0],&#xA; node[4YS3jneRTn624zDl6C29Zg], [P], s[INITIALIZING], indexUUID [uFZ3KaB6Te2igqubyvkFHA], reason [Failed to start shard, message [IndexShardGateway&#xA;RecoveryException[[.marvel-2015.03.15][0] failed to fetch index version after copying it over]; nested: IndexShardGatewayRecoveryException[[.marve&#xA;l-2015.03.15][0] shard allocated for local recovery (post api), should exist, but doesn't, current files: []]; nested: IndexNotFoundException[no s&#xA;egments* file found in store(least_used[rate_limited(default(mmapfs(/DATA/www/elasticsearch/data/elasticsearch/nodes/0/indices/.marvel-2015.03.15/&#xA;0/index),niofs(/DATA/www/elasticsearch/data/elasticsearch/nodes/0/indices/.marvel-2015.03.15/0/index)), type=MERGE, rate=20.0)]): files: []]; ]]&#xA;[2015-04-04 15:18:01,080][WARN ][cluster.action.shard     ] [Trick Shot] [.marvel-2015.03.15][0] received shard failed for [.marvel-2015.03.15][0]&#xA;, node[4YS3jneRTn624zDl6C29Zg], [P], s[INITIALIZING], indexUUID [uFZ3KaB6Te2igqubyvkFHA], reason [Failed to start shard, message [IndexShardGatewa&#xA;yRecoveryException[[.marvel-2015.03.15][0] failed to fetch index version after copying it over]; nested: IndexShardGatewayRecoveryException[[.marv&#xA;el-2015.03.15][0] shard allocated for local recovery (post api), should exist, but doesn't, current files: []]; nested: IndexNotFoundException[no&#xA;segments* file found in store(least_used[rate_limited(default(mmapfs(/DATA/www/elasticsearch/data/elasticsearch/nodes/0/indices/.marvel-2015.03.15&#xA;/0/index),niofs(/DATA/www/elasticsearch/data/elasticsearch/nodes/0/indices/.marvel-2015.03.15/0/index)), type=MERGE, rate=20.0)]): files: []]; ]]&#xA;[2015-04-04 15:18:01,094][WARN ][cluster.action.shard     ] [Trick Shot] [.marvel-2015.03.15][0] received shard failed for [.marvel-2015.03.15][0]&#xA;, node[4YS3jneRTn624zDl6C29Zg], [P], s[INITIALIZING], indexUUID [uFZ3KaB6Te2igqubyvkFHA], reason [master [Trick Shot][4YS3jneRTn624zDl6C29Zg][E2pr&#xA;o-ESP-06][inet[/10.9.46.65:9300]] marked shard as initializing, but shard is marked as failed, resend shard failure]&#xA;[2015-04-04 15:18:01,096][WARN ][indices.cluster          ] [Trick Shot] [.marvel-2015.03.13][0] sending failed shard after recovery failure&#xA;org.elasticsearch.index.gateway.IndexShardGatewayRecoveryException: [.marvel-2015.03.13][0] failed to fetch index version after copying it over&#xA;        at org.elasticsearch.index.gateway.local.LocalIndexShardGateway.recover(LocalIndexShardGateway.java:157)&#xA;        at org.elasticsearch.index.gateway.IndexShardGatewayService$1.run(IndexShardGatewayService.java:112)&#xA;        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)&#xA;        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)&#xA;        at java.lang.Thread.run(Thread.java:745) &#xA;</code></pre>&#xA;