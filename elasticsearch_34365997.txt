34365997
Elasticsearch cluster configuration is not discovering any nodes under both unicast and multicast
<p>I've been trying to use the lovely <a href="https://github.com/Traackr/ansible-elasticsearch" rel="noreferrer">ansible-elasticsearch</a> project to set up a nine-node Elasticsearch cluster.</p>&#xA;&#xA;<p>Each node is up and running... but they are not communcating with each other. The master nodes think there are zero data nodes. The data nodes are not connecting to the master nodes.</p>&#xA;&#xA;<p>They all have the same <code>cluster.name</code>. I have tried with multicast enabled (<code>discovery.zen.ping.multicast.enabled: true</code>) and disabled (previous setting to false, and <code>discovery.zen.ping.unicast.hosts:["host1","host2",..."host9"]</code>) but in either case the nodes are not communicating.</p>&#xA;&#xA;<p>They have network connectivity to one another - verified via telnet over port 9300.</p>&#xA;&#xA;<p>Sample output:&#xA;<code>$ curl host1:9200/_cluster/health&#xA;{"error":{"root_cause":[{"type":"master_not_discovered_exception","reason":"waited for [30s]"}],"type":"master_not_discovered_exception","reason":"waited for [30s]"},"status":503}</code></p>&#xA;&#xA;<p>I cannot think of any more reasons why they wouldn't connect - looking for any more ideas of what to try.</p>&#xA;&#xA;<p>Edit: I finally resolved this issue. The settings that worked were <code>publish_host</code> to <code>"_non_loopback:ipv4_"</code> and unicast with <code>discovery.zen.ping.unicast.hosts</code> set to <code>["host1:9300","host2:9300","host3:9300"]</code> - listing only the dedicated master nodes. I have a minimum master node count of 2.</p>&#xA;
<p>The only reasons I can think that can cause that behavior are:</p>&#xA;&#xA;<ol>&#xA;<li><p>Connectivity issues - Ping is not a good tool to check that nodes can connect to each other. Use telnet and try connecting from host1 to host2 on port 9300.</p></li>&#xA;<li><p>Your <code>elasticsearch.yml</code> is set to bind <code>127.0.0.1</code> or the wrong host (if you're not sure, bind 0.0.0.0 to see if that solves your connectivity issues and then it's important to change it to bind only internal hosts to avoid exposure of elasticsearch directly to the internet).</p></li>&#xA;<li><p>Your publish_host is incorrect - This usually happens when you run ES inside a docker container for example, you need to make sure that the publish_host is set to an address that can be accessed via other hosts.</p></li>&#xA;</ol>&#xA;