29384418
Does analyzer prevent fields from highlighting?
<p>could you help me with little problem regarding language-specific analyzers and highliting in elasticsearch?</p>&#xA;&#xA;<p>I need search documents by a query string and highlight matched strings.&#xA;here is my mapping:</p>&#xA;&#xA;<pre><code>{&#xA;    "usr": {&#xA;        "properties": {&#xA;            "text0": {&#xA;                "type": "string",&#xA;                "analyzer": "english"&#xA;            },&#xA;            "text1": {&#xA;                "type": "string"&#xA;            }&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Note, that for "text0" field "english" analyzer is set, and for "text1" field is used standard analyzer by default.</p>&#xA;&#xA;<p>In my index there is one document for now:</p>&#xA;&#xA;<pre><code>hits": [{&#xA;    "_index": "tt",&#xA;    "_type": "usr",&#xA;    "_id": "AUxvIPAv84ayQMZV-3Ll",&#xA;    "_score": 1,&#xA;    "_source": {&#xA;        "text0": "highlighted. need to be highlighted.",&#xA;        "text1": "highlighted. need to be highlighted."&#xA;    }&#xA;}]&#xA;</code></pre>&#xA;&#xA;<p>Consider following query:</p>&#xA;&#xA;<pre><code>{&#xA;    "query": {&#xA;        "query_string" : {&#xA;            "query" : "highlighted"&#xA;        }&#xA;    },&#xA;    "highlight" : {&#xA;        "fields" : {&#xA;            "*" : {}&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>I've expected each field in the document to be highlighted, but highlighting appeared only in "text1" field (where is no analyzer set):</p>&#xA;&#xA;<pre><code>"hits": [{&#xA;    "_type": "usr", &#xA;    "_source": {&#xA;        "text0": "highlighted. need to be highlighted.", &#xA;        "text1": "highlighted. need to be highlighted."&#xA;    }, &#xA;    "_score": 0.19178301, &#xA;    "_index": "tt", &#xA;    "highlight": {&#xA;        "text1": [&#xA;            "&lt;em&gt;highlighted&lt;/em&gt;. need to be &lt;em&gt;highlighted&lt;/em&gt;."&#xA;        ]&#xA;    }, &#xA;    "_id": "AUxvIPAv84ayQMZV-3Ll"&#xA;}]&#xA;</code></pre>&#xA;&#xA;<p>Let's consider the following query(I expected "highlighted" matches "highlight" because of analyzer):</p>&#xA;&#xA;<pre><code>{&#xA;    "query": {&#xA;        "query_string" : {&#xA;                "query" : "highlight"&#xA;            }&#xA;        },&#xA;    "highlight" : {&#xA;             "fields" : {&#xA;                 "*" : {}&#xA;             }&#xA;        }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>But there was no hist in response at all: (Did the english analyzer even work here?)</p>&#xA;&#xA;<pre><code>"hits": {&#xA;    "hits": [], &#xA;    "total": 0, &#xA;    "max_score": null&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>At last, consider some curl commands (requests and responses):</p>&#xA;&#xA;<pre><code>curl "http://localhost:9200/tt/_analyze?field=text0" -d "highlighted"&#xA;&#xA;{"tokens":[{ &#xA;    "token":"highlight",&#xA;    "start_offset":0,&#xA;    "end_offset":11,&#xA;    "type":"&lt;ALPHANUM&gt;",&#xA;    "position":1&#xA;}]}&#xA;&#xA;curl "http://localhost:9200/tt/_analyze?field=text1" -d "highlighted" &#xA;&#xA;{"tokens":[{&#xA;    "token":"highlighted",&#xA;    "start_offset":0,&#xA;    "end_offset":11,&#xA;    "type":"&lt;ALPHANUM&gt;",&#xA;    "position":1&#xA;}]}&#xA;</code></pre>&#xA;&#xA;<p>We see, by passing text through the english and standard analyzers, the result is different.&#xA;Finally, the question: does analyzer prevent fields from highlighting? How can I get my fields highlighted while full-text search?</p>&#xA;&#xA;<p>P.S. I use elasticsearch v1.4.4 on my local machine with windows 8.1.</p>&#xA;
<p>It has to do with your query. You are using the <code>query_string</code> query and you are not specifying the field so it is searching on the <a href="http://www.elastic.co/guide/en/elasticsearch/reference/master/mapping-all-field.html" rel="nofollow"><code>_all</code></a> field by default. &#xA;That is why you're seeing the strange results. Change your query to a <a href="http://www.elastic.co/guide/en/elasticsearch/reference/1.3/query-dsl-multi-match-query.html" rel="nofollow"><code>multi_match</code></a> query that searches on both fields:</p>&#xA;&#xA;<pre><code>{&#xA;    "query": {&#xA;        "multi_match": {&#xA;            "fields": [&#xA;                "text1",&#xA;                "text0"&#xA;            ],&#xA;            "query": "highlighted"&#xA;        }&#xA;    },&#xA;    "highlight": {&#xA;        "fields": {&#xA;            "*": {}&#xA;        }&#xA;    }&#xA;} &#xA;</code></pre>&#xA;&#xA;<p>Now highlight results for both fields will returned in the response.</p>&#xA;