32088349
Elasticsearch query on inner list and get only matching objects from list instead of entire list in result document
<p>In following elastic  search documents need to find comments from specific name eg "Mary Brown". Basically query on inner list and get only matching objects from list instead of entire list in result document.  Is it possible. I have defined nested as mapping for 'comments' </p>&#xA;&#xA;<pre><code>{&#xA;  "title": "Investment secrets",&#xA;  "body":  "What they don't tell you ...",&#xA;  "tags":  [ "shares", "equities" ],&#xA;  "comments": [&#xA;    {&#xA;      "name":    "Mary Brown",&#xA;      "comment": "Lies, lies, lies",&#xA;      "age":     42,&#xA;      "stars":   1,&#xA;      "date":    "2014-10-18"&#xA;    },&#xA;    {&#xA;      "name":    "John Smith",&#xA;      "comment": "You're making it up!",&#xA;      "age":     28,&#xA;      "stars":   2,&#xA;      "date":    "2014-10-16"&#xA;    }, &#xA;     {&#xA;      "name":    "Mary Brown",&#xA;      "comment": "making it!!!",&#xA;      "age":     42,&#xA;      "stars":   3,&#xA;      "date":    "2014-10-20"&#xA;    }&#xA;  ]&#xA;}&#xA;</code></pre>&#xA;
<p>Since you have properly mapped your <code>comments</code> field as <code>nested</code>, then yes this is possible using <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-inner-hits.html#nested-inner-hits" rel="nofollow"><code>inner_hits</code></a>, like this:</p>&#xA;&#xA;<pre><code>{&#xA;  "_source": false,&#xA;  "query": {&#xA;    "nested": {&#xA;      "path": "comments",&#xA;      "inner_hits": {        &lt;---- use inner_hits here&#xA;        "_source": [&#xA;          "comment", "date"&#xA;        ]&#xA;      },&#xA;      "query": {&#xA;        "bool": {&#xA;          "must": [&#xA;            {&#xA;              "term": {&#xA;                "comments.name": "Mary Brown"&#xA;              }&#xA;            }&#xA;          ]&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;