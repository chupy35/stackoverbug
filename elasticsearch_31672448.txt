31672448
How can an aggregation be greater than the total number of hits?
<p>I have records of the type</p>&#xA;&#xA;<pre><code> {&#xA;   "_index": "constant",&#xA;   "_type": "host",&#xA;   "_id": "AU7TX249tNLhGJRMfUXb",&#xA;   "_score": 1,&#xA;   "_source": {&#xA;               "private": true,&#xA;               "host-ip": "172.22.69.64",&#xA;               }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>If I look for aggregates of <code>private</code> and <code>host-ip</code> via</p>&#xA;&#xA;<pre><code>POST constant/host/_search&#xA;{&#xA;   "query": {&#xA;      "match_all": {}&#xA;   },&#xA;   "size": 0,&#xA;   "aggs":{&#xA;       "test":{&#xA;           "cardinality":{&#xA;               "field": "host-ip"&#xA;           }&#xA;       },&#xA;      "test2":{&#xA;            "cardinality":{&#xA;                "field": "private"&#xA;           }&#xA;       }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>I get as a result</p>&#xA;&#xA;<pre><code>{&#xA;   "took": 7,&#xA;   "timed_out": false,&#xA;   "_shards": {&#xA;      "total": 5,&#xA;      "successful": 5,&#xA;      "failed": 0&#xA;   },&#xA;   "hits": {&#xA;      "total": 7730,&#xA;      "max_score": 0,&#xA;      "hits": []&#xA;   },&#xA;   "aggregations": {&#xA;      "test": {&#xA;         "value": 7860&#xA;      },&#xA;      "test2": {&#xA;         "value": 2&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>My understanding of the result above is the following:</p>&#xA;&#xA;<ul>&#xA;<li>there is a total of 7730 documents of type <code>host</code> in the index <code>constant</code></li>&#xA;<li>there are two different values for <code>private</code> (this is expected)</li>&#xA;</ul>&#xA;&#xA;<p>What I do not understand is how it is possible to have 7860 distinct values of <code>host-ip</code> when the total number of documents in the index is 7730?</p>&#xA;&#xA;<p>Is my understanding of <code>total</code> in <code>hits</code> correct?</p>&#xA;
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics-cardinality-aggregation.html" rel="nofollow">Cardinality aggregation</a> is not exact. As the doc says:</p>&#xA;&#xA;<blockquote>&#xA;  <p>A single-value metrics aggregation that calculates an approximate count of distinct values</p>&#xA;</blockquote>&#xA;&#xA;<p>So, that's the reason behind the greater number. </p>&#xA;&#xA;<p>You can play with the option <code>precision_threshold</code> to make results more accurate, but it will consume more resources. </p>&#xA;