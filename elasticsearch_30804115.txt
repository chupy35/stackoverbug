30804115
And + Or query using elastic search REST API
<p>How do we combine AND/OR Query in elastic search. For Eg, Below are the documents we have</p>&#xA;&#xA;<pre><code>{"title": "MI2", "brand": "Xiomi","operatingSystem": "Android"},&#xA;{"title": "Nexus","brand": "Google","operatingSystem": "Android"},&#xA;{"title": "Samsung Note","brand": "Samsung","operatingSystem": "Android"},&#xA;{"title": "Samsung Galaxy","brand": "Samsung","operatingSystem": "Android"}&#xA;</code></pre>&#xA;&#xA;<p>Now How do we query Android phones from either Samsung or Xiomi.</p>&#xA;&#xA;<p>( operatingSystem == "Android" ) AND ( brand == "Samsung" OR  brand == "Xiomi")</p>&#xA;
<p>AND/OR Logic can be applied as a Filter.</p>&#xA;&#xA;<p>Filters in elasticsearch will evaluate before a query is executed, so if you need to apply this logic to a call that also contains a string query, it will still be efficient and applicable.</p>&#xA;&#xA;<p>As your OR code is evaluating the <strong>same</strong> property, in this case brand, you can use the Terms Filter within an AND statement. Your ES call would look like the following:</p>&#xA;&#xA;<pre><code>{&#xA;   "query": {&#xA;    "filtered": {&#xA;      "query": {&#xA;        "query_string": {&#xA;          "query": "your search string"&#xA;        }&#xA;      },&#xA;      "filter": {&#xA;        "and": [&#xA;          {&#xA;            "term": { "operatingSystem": "Android" }&#xA;          },&#xA;          {&#xA;            "terms": { "brand": ["Samsung", "Xiomi"] }&#xA;          }&#xA;        ]&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>You may see the documentation for Terms <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-terms-filter.html" rel="nofollow">here</a>. The default is a boolean OR, returning documents who match any of the values provided.</p>&#xA;&#xA;<p>To expand upon your question, if you wish the second part to evaluate an OR statement that is on <strong>different</strong> properties, for example with your data structure using title and brand, it would look as follows:</p>&#xA;&#xA;<pre><code>{&#xA;   "query": {&#xA;    "filtered": {&#xA;      "query": {&#xA;        "query_string": {&#xA;          "query": "your search string"&#xA;        }&#xA;      },&#xA;      "filter": {&#xA;        "and": [&#xA;          {&#xA;            "term": { "operatingSystem": "Android" }&#xA;          },&#xA;          {&#xA;            "or": [&#xA;              {&#xA;                "term": { "brand": "Xiomi" }&#xA;              },&#xA;              {&#xA;                "term": { "title": "Samsung Note" }&#xA;              }&#xA;            ]&#xA;          }&#xA;        ]&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>The latter is equivalent to:</p>&#xA;&#xA;<pre><code>( operatingSystem == "Android" ) AND ( title == "Samsung Note" OR brand == "Xiomi")&#xA;</code></pre>&#xA;