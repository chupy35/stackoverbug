32392203
Groupby functionality on multiple fields in elastic search
<p>I have a requirement where I need to groupby status_value as per regions and regions as per given date. For the same I have written a query and it is not exactly working in the ES. It would be a great help, if someone look into this and provide me with the solution.</p>&#xA;&#xA;<p>Note: I would like to get the result for the last day (i.e. previous day).</p>&#xA;&#xA;<pre><code>{&#xA;  "query": {&#xA;    "filtered": {&#xA;      "query": {&#xA;        "match_all": {}&#xA;      },&#xA;      "filter": {&#xA;        "term": {&#xA;          "UsagePoint_Asset_lifecycle_installationDate": "2014-07-13T16:55:00.0-07:00"&#xA;        }&#xA;      }&#xA;    }&#xA;  },&#xA;    "aggs" : {&#xA;        "product" : {&#xA;            "terms" : {&#xA;                "field" : "UsagePoint_ServiceLocation_region"&#xA;            },&#xA;            "aggs" : {&#xA;                "material" : {&#xA;                    "terms" : {&#xA;                        "field" : "UsagePoint_status_value"&#xA;                    }&#xA;                }&#xA;            }&#xA;        }       &#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>my sql query may be like below:</p>&#xA;&#xA;<pre><code>select count(status_value)&#xA;from products &#xA;where date = "yesterday"&#xA;group by region , date&#xA;</code></pre>&#xA;&#xA;<p>Please check below query is working, but I would like to get the values for a specific day or dates.</p>&#xA;&#xA;<pre><code>{&#xA;    "agg1": {&#xA;        "terms": {&#xA;           "field":"UsagePoint_Asset_lifecycle_installationDate"&#xA;        },&#xA;        "aggs" : {&#xA;        "product" : {&#xA;            "terms" : {&#xA;                "field" : "UsagePoint_ServiceLocation_region"&#xA;            },&#xA;            "aggs" : {&#xA;                "material" : {&#xA;                    "terms" : {&#xA;                        "field" : "UsagePoint_status_value"&#xA;                    }&#xA;                }&#xA;            }&#xA;        }       &#xA;    }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;
<p>If you need the group by info for yesterday , the following is a solution.&#xA;For any other custom dates , change the value in gte ( Greater than or equals to ) and lt ( Less than )</p>&#xA;&#xA;<pre><code>{&#xA;  "query": {&#xA;    "filtered": {&#xA;      "query": {&#xA;        "match_all": {}&#xA;      },&#xA;      "filter": {&#xA;        "range": {&#xA;          "UsagePoint_Asset_lifecycle_installationDate": {&#xA;            "gte": "now-1d",&#xA;            "lt": "now"&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  },&#xA;  "aggs": {&#xA;    "product": {&#xA;      "terms": {&#xA;        "field": "UsagePoint_ServiceLocation_region"&#xA;      },&#xA;      "aggs": {&#xA;        "material": {&#xA;          "terms": {&#xA;            "field": "UsagePoint_status_value"&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;