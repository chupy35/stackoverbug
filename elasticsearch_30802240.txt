30802240
Elasticsearch - Unable to get filter to work with query_string
<p>I'm trying to get filter the results to only return the items that has the tag 'news'  </p>&#xA;&#xA;<pre><code>-&gt; POST https://host.com/harvester-dev/entries/_search?&#xA;   _source=description%2Cimage%2Ctitle%2CupdateTime%2Ctags%2Curl&#xA;  {&#xA;    "filtered": {&#xA;      "query": {&#xA;        "query_string": {&#xA;          "query": "suksess-duo",&#xA;          "default_operator": "AND"&#xA;        }&#xA;      },&#xA;      "filter": {&#xA;        "bool": {&#xA;          "must": {&#xA;            "term": {&#xA;              "tags": "news"&#xA;            }&#xA;          }&#xA;        }&#xA;      }&#xA;    },&#xA;    "aggs": {&#xA;      "harvester-test": {&#xA;        "global": {}&#xA;      }&#xA;    }&#xA;  }&#xA;  &lt;- 400&#xA;  {&#xA;    "error": "SearchPhaseExecutionException[Failed to execute phase [query], all shards failed; shardFailures {[yXZEi0emQkuToiYBcj1wUA][harvester-dev][0]: SearchParseException[[harvester-dev][0]: from[-1],size[-1]: Parse Failure [Failed to parse source [{\"filtered\":{\"query\":{\"query_string\":{\"query\":\"suksess-duo\",\"default_operator\":\"AND\"}},\"filter\":{\"bool\":{\"must\":{\"term\":{\"tags\":\"news\"}}}}},\"aggs\":{\"harvester-test\":{\"global\":{}}}}]]]; nested: SearchParseException[[harvester-dev][0]: from[-1],size[-1]: Parse Failure [No parser for element [filtered]]]; }{[6gUDVyvDTSGUeYnoIN8N8Q][harvester-dev][1]: RemoteTransportException[[elastic_search148_aws_eu_west_1_data_0_dblayer_com][inet[/NN.NN.NN.NN:9300]][indices:data/read/search[phase/query]]]; nested: SearchParseException[[harvester-dev][1]: from[-1],size[-1]: Parse Failure [Failed to parse source&#xA;</code></pre>&#xA;&#xA;<p>This is how the data looks like:</p>&#xA;&#xA;<pre><code>{&#xA;  hits: {&#xA;    total: 15921,&#xA;    max_score: 1,&#xA;    hits: [&#xA;    {&#xA;      _index: "harvester-dev",&#xA;      _type: "entries",&#xA;      _id: "5574156f",&#xA;      _score: 1,&#xA;      _source: {&#xA;        image: "image-url",&#xA;        description: "fine description",&#xA;        updateTime: "2015-06-07T09:57:03.654Z",&#xA;        title: "our title",&#xA;        url: "http://example.com",&#xA;        tags: [&#xA;          "computers",&#xA;          "news"&#xA;        ]&#xA;      }&#xA;    },]}}&#xA;</code></pre>&#xA;&#xA;<p>I would love to only fetch the documents that has the tag "news". E.g documents matching "computers" with the tag "news". How should I craft my query?</p>&#xA;
<p>My bad. <code>filtered</code> news must  be nested within a <code>query</code>.</p>&#xA;&#xA;<pre><code>  {&#xA;    "query": {&#xA;      "filtered": {&#xA;        "query": {&#xA;          "query_string": {&#xA;            "query": "computers",&#xA;            "default_operator": "AND"&#xA;          }&#xA;        },&#xA;        "filter": {&#xA;          "bool": {&#xA;            "must": {&#xA;              "term": {&#xA;                "tags": "news"&#xA;              }&#xA;            }&#xA;          }&#xA;        }&#xA;      }&#xA;    },&#xA;</code></pre>&#xA;