31928083
Elasticsearch using nested object mappings in has_parent filter
<p>Is it possible to use nested object mappings in a <code>has_parent</code> query or filter? Whenever I try I always get:</p>&#xA;&#xA;<blockquote>&#xA;  <p>[customers_and_messages] [nested] nested object under path [accounts]&#xA;  is not of nested type]</p>&#xA;</blockquote>&#xA;&#xA;<p><strong>Mapping</strong></p>&#xA;&#xA;<pre><code>{&#xA;  "customer": {&#xA;    "properties": {&#xA;      "name": {&#xA;        "analyzer": "name_edge_ngram_analyzer",&#xA;        "type": "string"&#xA;      },&#xA;      "phone_number": {&#xA;        "analyzer": "phone_number_edge_ngram_analyzer",&#xA;        "type": "string"&#xA;      },&#xA;      "location_id": {&#xA;        "index": "not_analyzed",&#xA;        "type": "string"&#xA;      },&#xA;      "accounts": {&#xA;        "type": "nested",&#xA;        "properties": {&#xA;          "id": {&#xA;            "index": "not_analyzed",&#xA;            "type": "string"&#xA;          },&#xA;          "tags": {&#xA;            "type": "string"&#xA;          },&#xA;          "notes": {&#xA;            "type": "string"&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p><strong>Query</strong></p>&#xA;&#xA;<pre><code>{&#xA;  "query": {&#xA;    "filtered": {&#xA;      "filter": {&#xA;        "bool": {&#xA;          "must": [&#xA;            {&#xA;              "has_parent": {&#xA;                "type": "customer",&#xA;                "filter": {&#xA;                  "nested": {&#xA;                    "path": "accounts",&#xA;                    "filter": {&#xA;                      "term": {&#xA;                        "accounts.id": "8392f356-d6ec-11e4-8737-b74c1bacfb15"&#xA;                      }&#xA;                    }&#xA;                  }&#xA;                }&#xA;              }&#xA;            }&#xA;          ],&#xA;          "should": [&#xA;            {&#xA;              "term": {&#xA;                "kind": "task"&#xA;              }&#xA;            },&#xA;            {&#xA;              "term": {&#xA;                "kind": "alert"&#xA;              }&#xA;            }&#xA;          ]&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;