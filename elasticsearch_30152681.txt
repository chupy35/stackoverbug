30152681
Delete specific logs from elastic search
<p>I have logs saved in elastic search and I want to delete logs that have a @timestamp field in May 2015 - all logs prior to this are ok.</p>&#xA;&#xA;<p>I saved the following code in a file called 'delete.conf' </p>&#xA;&#xA;<pre><code>curl -XDELETE 'http://localhost:9200/_all/_query' -d '&#xA;&#xA;{&#xA;    "range" : {&#xA;        "@timestamp" : { "from" : "2015-05-01 00:00:01", "to" : "2015-05-09 11:59:59"}&#xA;    }&#xA;}'&#xA;</code></pre>&#xA;&#xA;<p>I run this file in logstash using the following command:</p>&#xA;&#xA;<pre><code>logstash -f delete.conf&#xA;</code></pre>&#xA;&#xA;<p>The results were like so ...</p>&#xA;&#xA;<pre><code>UOD-220076:bin student$ logstash -f delete.conf&#xA;Error: Expected one of #, input, filter, output at line 1, column 1 (byte 1) after &#xA;You may be interested in the '--configtest' flag which you can&#xA;use to validate logstash's configuration before you choose&#xA;to restart a running system.&#xA;</code></pre>&#xA;&#xA;<p>I have checked and re-checked but can't get what's wrong with my code.&#xA;In addition, would this be the 'correct' way to accomplish the deletion ?</p>&#xA;
<p>Logstash configuration files cannot contain any arbitrary commands. They have a specific layout which looks like this (more info <a href="http://www.elastic.co/guide/en/logstash/current/configuration.html" rel="nofollow">here</a>):</p>&#xA;&#xA;<pre><code>input {&#xA;    ...&#xA;}&#xA;filter {&#xA;    ...&#xA;}&#xA;output {&#xA;    ...&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>If you want to execute your curl command in a shell, it won't work either because your query is missing the <code>query</code> part, it should look like this:</p>&#xA;&#xA;<pre><code>curl -XDELETE 'http://localhost:9200/_all/_query' -d '&#xA;{&#xA;    "query": {&#xA;        "range" : {&#xA;            "@timestamp" : { "gte" : "2015-05-01 00:00:01", "lte" : "2015-05-09 11:59:59"}&#xA;        }&#xA;    }&#xA;}'&#xA;</code></pre>&#xA;&#xA;<p>Note that <code>from/to</code> in a <code>range</code> query are deprecated in favor of <code>gt/gte</code> and <code>lt/lte</code>.</p>&#xA;&#xA;<p>Finally, if you want to delete all logs in May 2015, I would suggest setting the end date to <code>2015-05-31 23:59:59</code> instead.</p>&#xA;