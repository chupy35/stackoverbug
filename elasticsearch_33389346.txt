33389346
Status yellow elasticsearch after adding and removing a node
<p>I have a elasticsearch cluster with 2 data nodes with one replica node (green status). If I add a new node, the status will still be green. If I shutdown elasticsearch on the newly added node, I get a yellow status. How could I make understand to revert back to 2 nodes instead of 3 and get a green status? </p>&#xA;&#xA;<p>Before shutdown:</p>&#xA;&#xA;<pre><code>{&#xA;  "cluster_name" : "elastic_poiuytrez",&#xA;  "status" : "green",&#xA;  "timed_out" : false,&#xA;  "number_of_nodes" : 5,&#xA;  "number_of_data_nodes" : 3,&#xA;  "active_primary_shards" : 65,&#xA;  "active_shards" : 130,&#xA;  "relocating_shards" : 0,&#xA;  "initializing_shards" : 0,&#xA;  "unassigned_shards" : 0,&#xA;  "delayed_unassigned_shards" : 0,&#xA;  "number_of_pending_tasks" : 0,&#xA;  "number_of_in_flight_fetch" : 0&#xA;}&#xA;&#xA;curl -XGET http://localhost:9200/_cluster/settings?pretty=true&#xA;{&#xA;  "persistent" : { },&#xA;  "transient" : { }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>This is what I get when I shutdown one of the node:</p>&#xA;&#xA;<pre><code>{&#xA;  "cluster_name" : "elastic_poiuytrez",&#xA;  "status" : "yellow",&#xA;  "timed_out" : false,&#xA;  "number_of_nodes" : 4,&#xA;  "number_of_data_nodes" : 2,&#xA;  "active_primary_shards" : 65,&#xA;  "active_shards" : 87,&#xA;  "relocating_shards" : 0,&#xA;  "initializing_shards" : 0,&#xA;  "unassigned_shards" : 43,&#xA;  "delayed_unassigned_shards" : 0,&#xA;  "number_of_pending_tasks" : 0,&#xA;  "number_of_in_flight_fetch" : 0&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Nodes settings: <a href="http://pastebin.com/wpmsRAbK" rel="nofollow">http://pastebin.com/wpmsRAbK</a> (elastic-node-1 is down)</p>&#xA;
<p>From my experience of cluster status green/yellow/red:</p>&#xA;&#xA;<p>a) Depending on number of replicas: Some replicas have been put on the new node, and have to be recreated or moved to remaining node(s)</p>&#xA;&#xA;<p>b) If ES ran tight on memory, and for other reasons (like removing a node) one or more replicas can go to unassigned. The cluster will be yellow until "unassigned_shards" goes down to 0</p>&#xA;&#xA;<p>Looking at your post, notice:</p>&#xA;&#xA;<pre><code>  "unassigned_shards" : 43,&#xA;</code></pre>&#xA;&#xA;<p>That will cause the cluster to be in yellow status. It may take some time to get everything shuffled around on the remaining nodes.</p>&#xA;&#xA;<p>Watching "unassigned_shards"  can show you "progress toward green"</p>&#xA;