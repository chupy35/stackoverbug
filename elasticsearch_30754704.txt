30754704
ElasticSearch - Setting doc_values on existing index
<p>According to <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/fielddata-formats.html" rel="nofollow">this article</a>:</p>&#xA;&#xA;<blockquote>&#xA;  <p>It is possible to change the field data format (and the field data settings in general) on a live index by using the update mapping API.</p>&#xA;</blockquote>&#xA;&#xA;<p>But when I try:</p>&#xA;&#xA;<pre><code>curl -XPUT 'http://es1:123/my_index/my_type/_mapping' -d '&#xA;{&#xA;    "my_type": {&#xA;        "properties": {&#xA;            "my_prop": {&#xA;                "index": "not_analyzed",&#xA;                "fielddata": {&#xA;                    "format": "doc_values"&#xA;                },&#xA;                "type": "string",&#xA;                "fields": {&#xA;                    "hash": {&#xA;                        "type": "murmur3"&#xA;                    }&#xA;                }&#xA;            }&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>I get:</p>&#xA;&#xA;<pre><code>MergeMappingException[Merge failed with failures {[mapper [my_prop] has different doc_values values]}]&#xA;</code></pre>&#xA;&#xA;<p>Any idea?</p>&#xA;
<p>You need to re-create the mapping for your index and to re-index all the documents in it.</p>&#xA;&#xA;<p>You don't have <code>doc_values</code> enabled for that field: <code>"doc_values": true</code>. But you want your fielddata format to be <code>doc_values</code>. This is not possible.</p>&#xA;&#xA;<p>To be able to change the fielddata format from whatever format <strong>to</strong> <code>doc_values</code> and vice-versa you need to have doc_values enabled: <code>"doc_values": true</code>. Note, though, that even if doc_values are not enabled you can freely change any in-memory format, meaning anything from <code>fst</code> to <code>paged_bytes</code> and vice-versa is possible.</p>&#xA;