31805326
Range aggregation on multiple field
<p>I have two fields in the search document such as <code>salary_from</code> and <code>salary_to</code> and want the aggregation of salary ranges such as 0 - 10 , 10 - 20, etc.</p>&#xA;&#xA;<p>Is there any ways to set multiple fields to the Elastic Range Aggregation. (I can set one field by using <code>setField</code> function)</p>&#xA;&#xA;<p>I just need to get the aggregated count of salary ranges or slabs by considering the two fields <code>salary_from</code> and <code>salary_to</code>.</p>&#xA;&#xA;<p>Please help me.</p>&#xA;
<p>If I understand your question correctly, below is what you need.</p>&#xA;&#xA;<pre><code>{&#xA;   "size": 0,&#xA;   "aggs": {&#xA;      "salary_ranges": {&#xA;         "terms": {&#xA;            "script": "doc['salary_from'].value + ' to ' + doc['salary_to'].value",&#xA;            "size": 0&#xA;         }&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>It basically uses a script for <code>Terms Aggregation</code>. Read more about it <a href="https://www.elastic.co/guide/en/elasticsearch/reference/1.6/search-aggregations-bucket-terms-aggregation.html#search-aggregations-bucket-terms-aggregation-script" rel="nofollow">here</a>.</p>&#xA;&#xA;<p>If say, you have 3 documents with <code>salary_from</code> set to 3 and <code>salary_to</code> set to 5 and then you have 2 documents with <code>salary_from</code> set to 10 and <code>salary_to</code> set to 25, the result of the query above will look something like below:</p>&#xA;&#xA;<pre><code>{&#xA;   "took": 3,&#xA;   "timed_out": false,&#xA;   "_shards": {&#xA;      "total": 5,&#xA;      "successful": 5,&#xA;      "failed": 0&#xA;   },&#xA;   "hits": {&#xA;      "total": 5,&#xA;      "max_score": 0,&#xA;      "hits": []&#xA;   },&#xA;   "aggregations": {&#xA;      "salary_ranges": {&#xA;         "doc_count_error_upper_bound": 0,&#xA;         "sum_other_doc_count": 0,&#xA;         "buckets": [&#xA;            {&#xA;               "key": "3 to 5",&#xA;               "doc_count": 3&#xA;            },&#xA;            {&#xA;               "key": "10 to 25",&#xA;               "doc_count": 2&#xA;            }&#xA;         ]&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;