34284094
Simple Search trouble on ElasticSearch
<p>I'm using elasticsearch 2.1. I'm not quite figuring out what I'm doing wrong. It baffles me the differents between queries, filters... Could you help me please?</p>&#xA;&#xA;<p>I'm trying to perform this query. It returns me an empty result:</p>&#xA;&#xA;<pre><code>curl -XGET 'http://ESNode01:9201/living_team/inputs/_search?pretty' -d '&#xA;{&#xA;    "query": {&#xA;        "filtered": { &#xA;            "query": { "match_all": {} },&#xA;            "filter": { "term": { "channel": "Feina" } }&#xA;        }&#xA;     }&#xA;}&#xA;'&#xA;</code></pre>&#xA;&#xA;<p>However, when I perform this query without filters it returns me everything:</p>&#xA;&#xA;<pre><code>curl -XGET 'http://ESNode01:9201/living_team/inputs/_search?pretty' -d '&#xA;{&#xA;    "query": {&#xA;        "filtered": { &#xA;            "query": { "match_all": {} },&#xA;        }&#xA;     }&#xA;}&#xA;'&#xA;</code></pre>&#xA;&#xA;<p>This is a document sample:</p>&#xA;&#xA;<pre><code>{&#xA;  "user":"living_team",&#xA;  "timestamp":"2015-12-14T18:06:47.085Z",&#xA;  "matter":"snip2.PNG",&#xA;  "comment":"Archive",&#xA;  "channel":"Feina",&#xA;  "feedTypes":[&#xA;     20&#xA;  ],&#xA;  "property_general_ldate":"2015-12-14T18:06:47.085Z",&#xA;  "property_tSize":7595.0,&#xA;  "resources":[&#xA;     {&#xA;        "timestamp":"2015-12-14T16:58:00.598Z",&#xA;        "matter":"snip2.PNG",&#xA;        "comment":"Archive",&#xA;        "channel":"Feina",&#xA;        "feedType":20,&#xA;        "mime":"image/png",&#xA;        "source":{&#xA;           "sourceId":{&#xA;              "id":"C:\\Users\\Beep\\Desktop\\share\\snip2.PNG",&#xA;              "batch":"c38eec2d-a282-11e5-baf4-382c4ab9e433",&#xA;              "client":"VIM12HCNZL"&#xA;           },&#xA;           "feedType":20,&#xA;           "property_folder":"C:\\Users\\Beep\\Desktop\\share",&#xA;           "property_lastAccessFolder_ldate":1450111821506&#xA;        },&#xA;        "property_size":7595.0,&#xA;        "property_creation_ldate":"2015-12-14T16:50:20.578Z",&#xA;        "property_name":"snip2.PNG",&#xA;        "nestedResources":[&#xA;&#xA;        ]&#xA;     }&#xA;  ]&#xA;</code></pre>&#xA;
<p>Your <code>channel</code> field is probably <code>analyzed</code> and hence it is indexed as a lowercased string. The following query will work instead (i.e. with <code>feina</code> in lowercase):</p>&#xA;&#xA;<pre><code>curl -XGET 'http://ESNode01:9201/living_team/inputs/_search?pretty' -d '&#xA;{&#xA;    "query": {&#xA;        "filtered": { &#xA;            "query": { "match_all": {} },&#xA;            "filter": { "term": { "channel": "feina" } }&#xA;        }&#xA;     }&#xA;}&#xA;'&#xA;</code></pre>&#xA;&#xA;<p>Another solution is to make your <code>channel</code> field a <code>not_analyzed</code> string in your mapping and your <code>term</code> filter would work with <code>Feina</code> (but not with <code>feina</code> anymore). In the end it depends on how you want to store and search your data.</p>&#xA;
<p>This should work.</p>&#xA;&#xA;<pre><code>curl - XGET 'http://ESNode01:9201/living_team/inputs/_search?pretty' - d ' {&#xA;{&#xA;    "query": {"match": {&#xA;       "channel": "feina"    }}&#xA;}'&#xA;</code></pre>&#xA;