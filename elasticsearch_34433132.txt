34433132
Multimatch query on documents with multiple IPs
<p>I have following sample documents:</p>&#xA;&#xA;<pre><code>doc1&#xA;{&#xA; "privateIp": "172.31.97.21",&#xA; "instanceType": "production",&#xA; "publicIp": "172.31.8.12",&#xA; "avZone": "cmp019",&#xA; "instanceId": "i-00000039",&#xA; "instanceState": "running",&#xA; "description": "common node"&#xA;}&#xA;&#xA;doc2&#xA;{&#xA; "privateIp": "172.31.97.12",&#xA; "instanceType": "production",&#xA; "publicIp": "172.31.8.4",&#xA; "avZone": "cmp019",&#xA; "instanceId": "i-00000038",&#xA; "instanceState": "running",&#xA; "description": "common node"&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>And I need to query it with multimatch query. However when I execute following query:</p>&#xA;&#xA;<pre><code>{&#xA;   "query": {&#xA;      "multi_match" : {&#xA;         "query":    "172.31.8.12", &#xA;         "fields": ["instanceId", "description", "privateIp", "publicIp"],&#xA;         "operator": "AND",&#xA;         "type": "cross_fields",&#xA;         "lenient": true&#xA;}}}&#xA;</code></pre>&#xA;&#xA;<p>I get back both documents which is undesirable - I only want <strong>doc1</strong>. Moreover <strong>doc2</strong> has higher score than <strong>doc1</strong>.</p>&#xA;&#xA;<p>Both <strong>publicIp</strong> and <strong>privateIp</strong> are mapped as IP Type.</p>&#xA;&#xA;<p>How can I get back only doc1? </p>&#xA;
<p><strong>cross_fields</strong> is used for term-centric matching</p>&#xA;&#xA;<p>by default the analyzer will split the values of Ip into multiple parts with separator dot</p>&#xA;&#xA;<p>you should make Ip field as not analyzed in mapping in order to match the entire Ip </p>&#xA;