29961075
Is it possible to update nested field by query?
<p>I am using update by query plugin (<a href="https://github.com/yakaz/elasticsearch-action-updatebyquery/" rel="nofollow">https://github.com/yakaz/elasticsearch-action-updatebyquery/</a>) to update documents by query.&#xA;In my case, there is nested field in document, the mapping is something like this:</p>&#xA;&#xA;<pre><code>"mappings": {&#xA;  "mytype": {&#xA;    "properties": {&#xA;      "Myfield1": {&#xA;        "type": "nested",&#xA;        "properties": {&#xA;          "field1": {&#xA;            "type": "string"&#xA;          },&#xA;          "field2": {&#xA;            "type": "long"&#xA;          }&#xA;        }&#xA;      },&#xA;      "Title": {&#xA;        "type": "string"&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Then I want to update the nested field <code>Myfield1</code> by query with following request:</p>&#xA;&#xA;<p>But unfortunately, it does not work.</p>&#xA;&#xA;<pre><code>{&#xA;  "query": {&#xA;    "match": {&#xA;      "Title": "elasticsearch"&#xA;    }&#xA;  },&#xA;  "script": "ctx._source.Myfield1 = [{'nestfield1':'foo blabla...','nestfield2':100},{'nestfield1':'abc...','nestfield2':200}]"&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Does update by query support nested object?</p>&#xA;&#xA;<p>BTW: any other ways to update document by query? </p>&#xA;&#xA;<p>Is the update by query plugin the only choice?</p>&#xA;
<p>You can try with <code>params</code>, something like this:</p>&#xA;&#xA;<pre><code>"query" : {&#xA;    "match_all" : {}&#xA;},&#xA;"script" : "ctx._source.Myfield1 = Myfield1;",&#xA;"params": {&#xA;  "Myfield1": {&#xA;    "nestfield1": "foo blabla..."&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>In my case I'm moving the data from not nested fields in nested fields. I need to add fake information to initialize the nested field. It looks like that:</p>&#xA;&#xA;<pre><code>"query" : {&#xA;    "match_all" : {}&#xA;},&#xA;"script" : "ctx._source.Myfield1 = Myfield1; ctx._source.Myfield1.nestfield1 = ctx._source.Myfield1Nestfield1;  ctx._source.Myfield1.nestfield2 = ctx._source.Myfield1Nestfield2;",&#xA;"params": {&#xA;  "Myfield1": {&#xA;    "nestfield1": "init_data"&#xA;  }&#xA;}&#xA;</code></pre>&#xA;