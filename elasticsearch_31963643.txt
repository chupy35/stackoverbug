31963643
escaping forward slashes in elasticsearch
<p>I am doing a general search against elasticsearch (1.7) and all is well except my account numbers have forward slashes in them.  The account number field is not the id field and is "not_analyzed".  </p>&#xA;&#xA;<p>If I do a search on an account number e.g. AC/1234/A01 then I get thousands of results, presumably because it is doing a regex search (?). </p>&#xA;&#xA;<pre><code>{&#xA;   "query" : { "query_string" : {"query" : "AC/1234/A01"} }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>I can get the result I want by doing an exact match search  </p>&#xA;&#xA;<pre><code>  {&#xA;    "query" : { "query_string" : {"query" : "\"AC/1234/A01\""} }&#xA;  }&#xA;</code></pre>&#xA;&#xA;<p>This actually gives me the result I want and probably will fit the bill as a backup option (surrounding all 'single word' searches with quotes).  However I'm thinking if they do a multiple word search including the account number I will be back to thousands of results and although I can't see the value of that search I would like to avoid it happening.</p>&#xA;&#xA;<p>Essentially I have a java app querying elastic search and I would like to escape all forward slashes entered in the GUI.  </p>&#xA;&#xA;<p>My Googling has told me that </p>&#xA;&#xA;<pre><code>{&#xA;  "query" : { "query_string" : {"query" : "AC\\/1234\\/A01"} }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>ought to do this but it makes no difference, the query works but I still get thousands of results.</p>&#xA;&#xA;<p>Could anyone point me in the right direction ?</p>&#xA;
<p>You should get what you want without escaping anything simply by specifying a <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-keyword-analyzer.html" rel="nofollow noreferrer"><code>keyword</code> analyzer</a> for the query string, like this:</p>&#xA;&#xA;<pre><code>{&#xA;  "query" : { &#xA;     "query_string" : {&#xA;        "query" : "AC\\/1234\\/A01",&#xA;        "analyzer": "keyword"         &lt;---- add this line&#xA;     } &#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>If you don't do this, the standard analyzer is used (and will tokenize your query string) whatever the type of your field is or whether it is <code>not_analyzed</code> or not.</p>&#xA;
<p>Use this query as example:</p>&#xA;&#xA;<pre><code>{&#xA;  "query": {&#xA;    "query_string": {&#xA;      "fields": [&#xA;        "account_number.keyword"&#xA;      ],&#xA;      "query": "AC\\/1234\\/A01",&#xA;      "analyzer": "keyword"&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;