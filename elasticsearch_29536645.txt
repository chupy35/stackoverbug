29536645
function_score tries to use field from excluded index in elasticsearch
<p>I have three own indices: <strong>A</strong>, <strong>B</strong>, <strong>C</strong>. Additionally I have <strong>.marvel-kibana</strong> index. All documents in <strong>A</strong>, <strong>B</strong>, <strong>C</strong> indices have <em>global_priorty</em> field.</p>&#xA;&#xA;<p>I was wondering, why despite having excluded all but ABC indices, elastic throws exception: <strong>ElasticsearchException[Unable to find a field mapper for field [global_priorty]]</strong> in <strong>.marvel-kibana</strong> index? Isn't that index excluded (included to no_match_filter by default)?</p>&#xA;&#xA;<p>My code:</p>&#xA;&#xA;<pre><code>GET /_search&#xA;{&#xA;  "query": {&#xA;    "filtered": {&#xA;      "query": {&#xA;        "function_score": {&#xA;          "query": { ... },&#xA;          "functions": [ &#xA;            {&#xA;              "field_value_factor": {&#xA;                "field": "global_priorty",&#xA;                "factor": 1,&#xA;                "modifier": "sqrt"&#xA;              }&#xA;            }&#xA;          ]&#xA;        }&#xA;      },&#xA;      "filter": {&#xA;        "indices": {&#xA;          "indices": [ "A", "B", "C" ],&#xA;          "filter": { ... },&#xA;          "no_match_filter": "none"&#xA;        }&#xA;      }&#xA;    }&#xA;  },&#xA;  "indices_boost": { ... },&#xA;  "highlight": { ... }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;
<p>Karol,</p>&#xA;&#xA;<p>I am not sure you are achieving here what you intended. Listing index in indices filter doesn't automatically mean it's excluded from the search.</p>&#xA;&#xA;<p>The filter works like this:&#xA;for the indices in the <em>indices</em> list use <em>filter</em>. For others use <em>no_match_filter</em>.</p>&#xA;&#xA;<p>How does your <em>filter</em> look like?</p>&#xA;&#xA;<p>The preferred way to search only selected indices is to use them in the search endpoint. Something like:</p>&#xA;&#xA;<pre><code>get /A,B,C/_search &#xA;{&#xA;....&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Word of caution: I remember having some problems with Java API while setting multiple indices and types. But it was ages ago, though. </p>&#xA;&#xA;<p>You should give it a try!</p>&#xA;&#xA;<p>Regards,&#xA;Karol</p>&#xA;&#xA;<p>P.S. &#xA;Powodzenia! BTW: Parafrazując: Wszystkie Karole to porządne chłopaki!</p>&#xA;