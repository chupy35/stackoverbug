33035486
Source filtering for first of nested objects
<p>I'm using <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-source-filtering.html" rel="nofollow">source filtering</a> on a query to just return a small set of information and within that information I want the first photo url of an object:</p>&#xA;&#xA;<pre><code>"query" : { ... },&#xA;"_source" : ["name", "photos.thumbnail_url"]&#xA;</code></pre>&#xA;&#xA;<p>Of course this returns the <code>thumbnail_url</code> for all of the photos stored against each item.</p>&#xA;&#xA;<p>Is there any way to get just the first nested photo's <code>thumbnail_url</code> using source filtering?</p>&#xA;&#xA;<p>(I appreciate that one way to do it would be to index the first photo separately and just source filter to include that separate field but I'm asking whether it is possible without a separate field.)</p>&#xA;&#xA;<p>(I've guessed a few approaches without luck: <code>photos.0.thumbnail_url</code>, <code>photos[0].thumbnail_url</code>, <code>photos.first.thumbnail_url</code>)</p>&#xA;
<p>Just an attempt, as I don't know your mapping, with <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-inner-hits.html#_options" rel="nofollow">inner_hits</a>:</p>&#xA;&#xA;<pre><code>{&#xA;  "size": 5,&#xA;  "_source": ["name"], &#xA;  "query": {&#xA;    "filtered": {&#xA;      "query": {&#xA;        "match": {&#xA;          "name": "whatever"&#xA;        }&#xA;      },&#xA;      "filter": {&#xA;        "nested": {&#xA;          "path": "photos",&#xA;          "query": {&#xA;            "match_all": {}&#xA;          },&#xA;          "inner_hits": {&#xA;            "size": 1,&#xA;            "_source": ["thumbnail_url"]&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>or use a <a href="https://www.elastic.co/guide/en/elasticsearch/reference/1.7/search-request-script-fields.html" rel="nofollow">script field</a>:</p>&#xA;&#xA;<pre><code>  "script_fields": {&#xA;    "FIELD": {&#xA;      "script": "urls=_source.photos.thumbnail_url;return urls[0]"&#xA;    }&#xA;  }&#xA;</code></pre>&#xA;&#xA;<p>and I don't think it's possible to do this with source filtering.</p>&#xA;