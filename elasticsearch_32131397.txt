32131397
elasticsearch: how to sort by list of tags and a numeric field
<p>I have 3 documents in a mapping look like this</p>&#xA;&#xA;<p>{&#xA;"tags":["a"],&#xA;"count":10&#xA;}<br>&#xA;{&#xA;"tags":["a","b","c"],&#xA;"count":50&#xA;}<br>&#xA;{&#xA;"tags":["a","c"],&#xA;"count":100&#xA;}<br></p>&#xA;&#xA;<p>When I search by tags, say, &#xA;{"should":["tags":"a", "tags":"b"]}</p>&#xA;&#xA;<p>Want the result to be sorted by number of tag match, then by count desc, like this:</p>&#xA;&#xA;<p>{&#xA;"tags":["a","b","c"],&#xA;"count":50&#xA;}<br>&#xA;{&#xA;"tags":["a","c"],&#xA;"count":100&#xA;}<br>&#xA;{&#xA;"tags":["a"],&#xA;"count":10&#xA;}<br></p>&#xA;&#xA;<p>How can I achieve this? I tried sort [_score, {"count":"desc"}], however, because of the score values are all different, the {"count":"desc"} part never worked.</p>&#xA;&#xA;<p>Any help is appreciated. Thanks.</p>&#xA;
<pre><code> {&#xA;   "sort": [{"count": "desc"}],&#xA;   "query": {&#xA;     "filtered": {&#xA;       "filter": {&#xA;         "bool": {&#xA;           "should": [&#xA;             {"term": {"tag": "a"}},&#xA;             {"term": {"tag": "b"}}&#xA;         }&#xA;       }&#xA;     }&#xA;   }&#xA; }&#xA;</code></pre>&#xA;&#xA;<p>use <em>filter query</em> to ignore document <em>score</em>, and use <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-sort.html" rel="nofollow">sort</a> to sort.</p>&#xA;
<p>This will sort results by score and by count:</p>&#xA;&#xA;<pre><code>{&#xA;    "query": {&#xA;        "bool": {&#xA;            "should": [&#xA;                {"term": {"tag": "a"}},&#xA;                {"term": {"tag": "b"}}&#xA;            ]&#xA;        }&#xA;    },&#xA;    "sort": {&#xA;        "_score": {&#xA;            "order": "desc"&#xA;        },&#xA;        "count": {&#xA;            "order": "desc"&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;