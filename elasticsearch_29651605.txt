29651605
Aggregating list of values in elasticsearch
<pre><code>{&#xA;    ...&#xA;    "shirt_sizes":["XL","L","M","S"]&#xA;    ...&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>How to create aggregation of shirt_size field in elasticsearch ?</p>&#xA;
<p>Assuming I'm understanding your question correctly, you need to use a <a href="http://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-terms-aggregation.html" rel="nofollow">terms aggregation</a>. You probably also want the <code>"shirt_sizes"</code> field to be <a href="http://www.elastic.co/guide/en/elasticsearch/guide/current/mapping-intro.html#_index_2" rel="nofollow"><code>not_analyzed</code></a>.</p>&#xA;&#xA;<p>As a simple example, I set up an index with an un-analyzed field, and added a couple of docs:</p>&#xA;&#xA;<pre><code>PUT /test_index&#xA;{&#xA;   "mappings": {&#xA;      "doc": {&#xA;         "properties": {&#xA;            "shirt_sizes": {&#xA;               "type": "string",&#xA;               "index": "not_analyzed"&#xA;            }&#xA;         }&#xA;      }&#xA;   }&#xA;}&#xA;&#xA;POST /test_index/doc/_bulk&#xA;{"index":{"_id":1}}&#xA;{"shirt_sizes":["XL","L","M","S"]}&#xA;{"index":{"_id":2}}&#xA;{"shirt_sizes":["L","M","S","XS"]}&#xA;</code></pre>&#xA;&#xA;<p>Then I can get back all the sizes with a simple aggregation:</p>&#xA;&#xA;<pre><code>POST /test_index/_search?search_type=count&#xA;{&#xA;    "aggs": {&#xA;        "shirt_sizes_terms": {&#xA;            "terms": {&#xA;                "field": "shirt_sizes"&#xA;            }&#xA;        }&#xA;    }&#xA;}&#xA;...&#xA;{&#xA;   "took": 2,&#xA;   "timed_out": false,&#xA;   "_shards": {&#xA;      "total": 1,&#xA;      "successful": 1,&#xA;      "failed": 0&#xA;   },&#xA;   "hits": {&#xA;      "total": 2,&#xA;      "max_score": 0,&#xA;      "hits": []&#xA;   },&#xA;   "aggregations": {&#xA;      "shirt_sizes_terms": {&#xA;         "buckets": [&#xA;            {&#xA;               "key": "L",&#xA;               "doc_count": 2&#xA;            },&#xA;            {&#xA;               "key": "M",&#xA;               "doc_count": 2&#xA;            },&#xA;            {&#xA;               "key": "S",&#xA;               "doc_count": 2&#xA;            },&#xA;            {&#xA;               "key": "XL",&#xA;               "doc_count": 1&#xA;            },&#xA;            {&#xA;               "key": "XS",&#xA;               "doc_count": 1&#xA;            }&#xA;         ]&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Here is the code I used:</p>&#xA;&#xA;<p><a href="http://sense.qbox.io/gist/9d759c95c8794be7786b0248f58bfdec6da7510f" rel="nofollow">http://sense.qbox.io/gist/9d759c95c8794be7786b0248f58bfdec6da7510f</a></p>&#xA;