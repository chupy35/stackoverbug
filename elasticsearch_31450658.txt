31450658
Exclude subdocument in elasticsearch query
<p>Given document structure like this:</p>&#xA;&#xA;<pre><code>{&#xA;    "a": "vala",&#xA;    "b": "valb",&#xA;    "c": {&#xA;        "ca": "valca",&#xA;        "cb": "valcb"&#xA;    },&#xA;    "x": {&#xA;        "xa": "valxa",&#xA;        "xb": "valxb"&#xA;    },&#xA;    "d": "vald",&#xA;    ...&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>How to construct a query that whould return documents that have some "search_value" in any field of the document outside the "x" subdocument.</p>&#xA;&#xA;<p>Documents like this <strong>would</strong> be included:<br/>&#xA;{"a": "search_value"},<br/>&#xA;{"c": {"cb": "search_value"},<br/>&#xA;{"ggg": "search_value", "x": {"xa": "valxa"}}<br/>&#xA;{"ggg": "search_value", "x": {"xa": "search_value"}}</p>&#xA;&#xA;<p>Documents like this <strong>would not</strong> be included:<br/>&#xA;{"a": "vala"},<br/>&#xA;{"a": "vala", "x": {"xa": "search_value"}}<br/>&#xA;{"x": "search_value"}</p>&#xA;
<p>I think you can use <strong><em>highlight query</em></strong> to get your hits, and use wildcards to highlight all hits fields. so you need to filter <strong><em>x</em></strong> by your self.</p>&#xA;&#xA;<p>For example, search value in field <strong><em>x</em></strong>:</p>&#xA;&#xA;<pre><code>{&#xA;    "fields": [],&#xA;    "query": {&#xA;        "term": {&#xA;            "x": "search_value"&#xA;        }&#xA;    },&#xA;    "highlight": {&#xA;        "pre_tags" : [""],&#xA;        "post_tags" : [""],&#xA;        "fields": {&#xA;            "*": {}&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;