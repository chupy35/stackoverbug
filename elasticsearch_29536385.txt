29536385
how to make a query on a field I have not defined a mapping for
<p>I have a field current_country that I am adding to brands, and which has not been defined in my elasticsearch mapping. </p>&#xA;&#xA;<p>I would like to do a filtered query on this, since it is not defined I suppose it is not analyzed and a term query should work.</p>&#xA;&#xA;<p>This is the query I am doing</p>&#xA;&#xA;<pre><code>{&#xA;    "index": "products",&#xA;    "type": "brand",&#xA;    "body": {&#xA;        "from": 0,&#xA;        "size": 100,&#xA;        "sort": [&#xA;            {&#xA;                "n_name": "asc"&#xA;            }&#xA;        ],&#xA;        "query": {&#xA;            "filtered": {&#xA;                "query": {&#xA;                    "function_score": {&#xA;                        "filter": {&#xA;                            "bool": {&#xA;                                "must": [&#xA;                                    {&#xA;                                        "term": {&#xA;                                            "current_country": "DK"&#xA;                                        }&#xA;                                    }&#xA;                                ]&#xA;                            }&#xA;                        }&#xA;                    }&#xA;                }&#xA;            }&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>which returns no documents from the index.</p>&#xA;&#xA;<p>I run the following query to check if current country exists</p>&#xA;&#xA;<pre><code>{&#xA;    "index": "products",&#xA;    "type": "brand",&#xA;    "body": {&#xA;        "from": 0,&#xA;        "size": 100,&#xA;        "sort": [&#xA;            {&#xA;                "n_name": "asc"&#xA;            }&#xA;        ],&#xA;        "query": {&#xA;            "filtered": {&#xA;                "query": {&#xA;                    "function_score": {&#xA;                        "filter": {&#xA;                            "bool": {&#xA;                                "must": [&#xA;                                    {&#xA;                                        "exists": {&#xA;                                            "field": "current_country"&#xA;                                        }&#xA;                                    }&#xA;                                ]&#xA;                            }&#xA;                        }&#xA;                    }&#xA;                }&#xA;            }&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>which returns a total of 693 documents. </p>&#xA;&#xA;<p>here is an example document from the index, returned when I ran the query above. </p>&#xA;&#xA;<pre><code>{&#xA;    "_index": "products",&#xA;    "_type": "brand",&#xA;    "_id": "195da951241478LuxoLivingbrand",&#xA;    "_score": null,&#xA;    "_source": {&#xA;        "categories": [&#xA;            "Bordlamper og designer bordlamper der giver liv og lys"&#xA;        ],&#xA;        "image": "http://www.fotoagent.dk/single_picture/11385/138/mega/and_tradition_flowerpot_bordlampe_lilla.jpg",&#xA;        "top_price": 1695,&#xA;        "low_price": 1695,&#xA;        "n_name": "&amp;Tradition",&#xA;        "name": "&amp;Tradition",&#xA;        "current_country": "DK",&#xA;        "current_currency": "DKK"&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>How can I query against current_country (preferably a filtered query). </p>&#xA;
<p>If you do not define any mapping for a field, elasticsearch tries to detect the field as string/date/numeric. If it detects the field as string then it will use the default analyzer (standard analyzer) to analyze your input. Since <a href="http://www.elastic.co/guide/en/elasticsearch/reference/1.3/analysis-standard-analyzer.html" rel="nofollow">standard analyzer</a> uses lowercase token filter your input string is indexed as "dk". As term filters does not analyze the input, "DK" won't match "dk".</p>&#xA;&#xA;<p>It can be solved by various means. </p>&#xA;&#xA;<ol>&#xA;<li><p>(hack) You can lowercase your input filter term. this won't work for phrases.</p></li>&#xA;<li><p>(better) define a mapping for your input. You can dynamically change mapping/ <a href="http://www.elastic.co/guide/en/elasticsearch/reference/1.4/indices-put-mapping.html" rel="nofollow">add new mapping easily</a></p></li>&#xA;</ol>&#xA;