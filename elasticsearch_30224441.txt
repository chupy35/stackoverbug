30224441
ElasticSearch: How to write query where string field is either null or empty?
<p>I want to check for documents that have <code>media_url == '' || media_url == null</code>. I have a query:</p>&#xA;&#xA;<pre><code>{&#xA;    "engagements": [&#xA;        "blah"&#xA;    ],&#xA;    "query": {&#xA;        "from": 0,&#xA;        "size": 2,&#xA;        "sort": [&#xA;            {&#xA;                "bookmarked": {&#xA;                    "order": "desc"&#xA;                }&#xA;            },&#xA;            {&#xA;                "created_at": {&#xA;                    "order": "desc"&#xA;                }&#xA;            }&#xA;        ],&#xA;        "facets": {},&#xA;        "query": {&#xA;            "filtered": {&#xA;                "query": {&#xA;                    "match_all": {}&#xA;                },&#xA;                "filter": {&#xA;                    "bool": {&#xA;                        "must": [&#xA;                            {&#xA;                                "term": {&#xA;                                    "car_id": "78778"&#xA;                                }&#xA;                            },&#xA;                            {&#xA;                                "range": {&#xA;                                    "created_at": {&#xA;                                        "gte": "2015-04-12T04:00:00.000Z",&#xA;                                        "lte": "2015-05-13T03:59:59.999Z"&#xA;                                    }&#xA;                                }&#xA;                            },&#xA;                            {&#xA;                                "term": {&#xA;                                    "media_url": ""&#xA;                                }&#xA;                            }&#xA;                        ],&#xA;                        "should": [&#xA;                            {&#xA;                                "term": {&#xA;                                    "bookmarked": false&#xA;                                }&#xA;                            }&#xA;                        ]&#xA;                    }&#xA;                }&#xA;            }&#xA;        },&#xA;        "aggregations": {&#xA;            "word_frequencies": {&#xA;                "terms": {&#xA;                    "field": "text",&#xA;                    "size": 150&#xA;                }&#xA;            }&#xA;        },&#xA;        "highlight": {&#xA;            "fields": {&#xA;                "text": {&#xA;                    "fragment_size": 1500&#xA;                }&#xA;            }&#xA;        }&#xA;    },&#xA;    "api": "_search"&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>However, if I do what I do above, then records that are set to null wouldn't be returned. What should I do to return records with either '' or null as their media_url value?</p>&#xA;
<p>Perhaps you can try using the "or" filter.&#xA;<a href="http://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-or-filter.html" rel="nofollow">http://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-or-filter.html</a></p>&#xA;&#xA;<pre><code>{&#xA;  "or": [&#xA;    {&#xA;      "term": {&#xA;        "media_url": ""&#xA;      }&#xA;    },&#xA;    {&#xA;      "term": {&#xA;        "media_url": null&#xA;      }&#xA;    }&#xA;  ]&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Edit: Here's the full query (untested since I don't have an example document/index template)</p>&#xA;&#xA;<pre><code>{&#xA;    "engagements": [&#xA;        "blah"&#xA;    ],&#xA;    "query": {&#xA;      "from": 0,&#xA;      "size": 2,&#xA;      "sort": [&#xA;         {&#xA;            "bookmarked": {&#xA;               "order": "desc"&#xA;            }&#xA;         },&#xA;         {&#xA;            "created_at": {&#xA;               "order": "desc"&#xA;            }&#xA;         }&#xA;      ],&#xA;      "facets": {},&#xA;      "query": {&#xA;         "filtered": {&#xA;            "query": {&#xA;               "match_all": {}&#xA;            },&#xA;            "filter": {&#xA;               "bool": {&#xA;                  "must": [&#xA;                     {&#xA;                        "term": {&#xA;                           "car_id": "78778"&#xA;                        }&#xA;                     },&#xA;                     {&#xA;                        "range": {&#xA;                           "created_at": {&#xA;                              "gte": "2015-04-12T04:00:00.000Z",&#xA;                              "lte": "2015-05-13T03:59:59.999Z"&#xA;                           }&#xA;                        }&#xA;                     },&#xA;                     {&#xA;                        "or": [&#xA;                           {&#xA;                              "term": {&#xA;                                 "media_url": ""&#xA;                              }&#xA;                           },&#xA;                           {&#xA;                              "term": {&#xA;                                 "media_url": null&#xA;                              }&#xA;                           }&#xA;                        ]&#xA;                     }&#xA;                  ],&#xA;                  "should": [&#xA;                     {&#xA;                        "term": {&#xA;                           "bookmarked": false&#xA;                        }&#xA;                     }&#xA;                  ]&#xA;               }&#xA;            }&#xA;         }&#xA;      },&#xA;      "aggregations": {&#xA;         "word_frequencies": {&#xA;            "terms": {&#xA;               "field": "text",&#xA;               "size": 150&#xA;            }&#xA;         }&#xA;      },&#xA;      "highlight": {&#xA;         "fields": {&#xA;            "text": {&#xA;               "fragment_size": 1500&#xA;            }&#xA;         }&#xA;      }&#xA;   },&#xA;   "api": "_search"&#xA;}&#xA;</code></pre>&#xA;
<p>You can use the <a href="http://www.elastic.co/guide/en/elasticsearch/reference/0.90/query-dsl-missing-filter.html" rel="nofollow">missing filter</a> to take care of null value or field itself is missing. You can combine the same with an empty string term to achieve what you want.</p>&#xA;&#xA;<pre><code>{ &#xA;   "or": [&#xA;    {&#xA;      "term": {&#xA;        "media_url": ""&#xA;      }&#xA;    },&#xA;    {&#xA;      "missing": {&#xA;        "field": "media_url"&#xA;      }&#xA;    }   &#xA;    ]&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Use the above instead of the single term query for "media_url" in the must clause of your Boolean filter.</p>&#xA;