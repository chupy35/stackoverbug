30650999
How to prioritize my search on text fields in elasticsearch?
<p>This is how I have modeled the movie_ratings of 3 movie clubs about a particular film. </p>&#xA;&#xA;<pre><code>{&#xA;&#xA;    "movie_name": "avengers,the age of ultron"&#xA;    "movie_ratings":&#xA;     {&#xA;         "canvasFilms": "average"&#xA;         "playHouse": "bad"&#xA;         "tubeRaters": "good"&#xA;         "bannersUnlimited": "excellent"&#xA;     }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Now,I want to sort the movies based on their ratings,that is my order of preference is "excellent","good","average","bad". But since it is not numbers in the fields, I'm unable to do such a sorting. How can I do that?</p>&#xA;
<p>Here's one way you could do it, though it's a bit of a hack:</p>&#xA;&#xA;<pre><code>POST /test_index/_search&#xA;{&#xA;   "query": {&#xA;      "match_all": {}&#xA;   },&#xA;   "sort": {&#xA;      "_script": {&#xA;         "script": "if (doc[field_name].value=='excellent'){ 4 } else if (doc[field_name].value=='good'){ 3 } else if (doc[field_name].value=='average'){ 2 } else if (doc[field_name].value=='bad'){ 1 } else { 0 }",&#xA;         "type": "number",&#xA;         "params": {&#xA;            "field_name": "movie_ratings.playHouse"&#xA;         },&#xA;         "order": "desc"&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>You'll have to have dynamic scripting <a href="https://stackoverflow.com/a/24711344/2551686">enabled</a>.</p>&#xA;&#xA;<p>Here is some code I used to test it:</p>&#xA;&#xA;<p><a href="http://sense.qbox.io/gist/c47aa6f5cdb1765354f3383076954cb4d2f5505b" rel="nofollow noreferrer">http://sense.qbox.io/gist/c47aa6f5cdb1765354f3383076954cb4d2f5505b</a></p>&#xA;&#xA;<p>A better approach would be to map the ordinal rating values to numbers in another field when you're indexing, then just sort on that field.</p>&#xA;&#xA;<p><strong>Edit:</strong> Also have a look at <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-function-score-query.html#query-dsl-function-score-query" rel="nofollow noreferrer">function scoring</a>.</p>&#xA;