33897834
Query two fields, one nested and one on the root
<p>I'm trying to write a query that that search for a string in two different fields.&#xA;One off of the root, and one as part of a nested object.</p>&#xA;&#xA;<p>I've tried these two approaches, but neither results in matches on both fields.  </p>&#xA;&#xA;<p><strong>A <code>query_string</code> search off of the root</strong></p>&#xA;&#xA;<p>This results in matches on <code>name</code> only</p>&#xA;&#xA;<p>Note: If I don't specify the fields, it will search on all fields, including the two that I want.</p>&#xA;&#xA;<pre><code>{&#xA;    "query": {&#xA;        "query_string": {&#xA;            "query": "searchterm",&#xA;            "fields": ["name", "project.projectName"]&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p><strong>A <code>query_string</code> search off of the nested object</strong></p>&#xA;&#xA;<p>This results in matches on <code>project.projectName</code> only</p>&#xA;&#xA;<pre><code>{&#xA;    "query": {&#xA;        "nested": {&#xA;            "path": "project",&#xA;            "query": {&#xA;                "query_string": {&#xA;                    "query": "searchTerm",&#xA;                    "fields": [&#xA;                        "name",&#xA;                        "project.projectName"&#xA;                    ]&#xA;                }&#xA;            }&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;
<p>I think you can achieve this by <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.1/query-dsl-bool-query.html" rel="nofollow">bool query</a></p>&#xA;&#xA;<pre><code>{&#xA;  "query": {&#xA;    "bool": {&#xA;      "should": [&#xA;        {&#xA;          "query_string": {&#xA;            "fields": [&#xA;              "name"&#xA;            ],&#xA;            "query": "searchTerm"&#xA;          }&#xA;        },&#xA;        {&#xA;          "nested": {&#xA;            "path": "project",&#xA;            "query": {&#xA;              "query_string": {&#xA;                "query": "searchTerm",&#xA;                "fields": [&#xA;                  "project.projectName"&#xA;                ]&#xA;              }&#xA;            }&#xA;          }&#xA;        }&#xA;      ]&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p><strong>Note</strong> - If you want searchterm to match on both, you can replace <code>should</code> with <code>must</code></p>&#xA;