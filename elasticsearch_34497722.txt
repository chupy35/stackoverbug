34497722
Can max_children of 0 be used in elasticsearch has_child query?
<p>I want to be able to select parents that don't have any children matching a particular set of criteria. I thought that if I did:</p>&#xA;&#xA;<pre><code>        {&#xA;          "has_child": {&#xA;            "max_children": 0,&#xA;            "type": "event",&#xA;            "filter": {&#xA;              "bool": {&#xA;                "must": [&#xA;                  {&#xA;                    "bool": {&#xA;                      "must": [&#xA;                        {&#xA;                          "term": {&#xA;                            "cs_e": "eventF"&#xA;                          }&#xA;                        }&#xA;                      ],&#xA;                      "should": [],&#xA;                      "mustNot": []&#xA;                    }&#xA;                  }&#xA;                ],&#xA;                "should": [],&#xA;                "mustNot": []&#xA;              }&#xA;            }&#xA;          }&#xA;        }&#xA;</code></pre>&#xA;&#xA;<p>then this would return me parents who had a maximum of 0 children - ie the parents that don't match. Curiously, however, I do get one parent back from the query, and that parent has one child that matches.</p>&#xA;&#xA;<p>Is this expected? (Possibly I have messed up somewhere or misunderstood)?</p>&#xA;&#xA;<p>Many thanks!</p>&#xA;
<p>Found this cite in "Breaking changes in ES 5.0":</p>&#xA;&#xA;<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/breaking_50_search_changes.html" rel="nofollow noreferrer">https://www.elastic.co/guide/en/elasticsearch/reference/current/breaking_50_search_changes.html</a></p>&#xA;&#xA;<blockquote>&#xA;  <p>When the max_children parameter was set to 0 on the has_child query&#xA;  then there was no upper limit on how many child documents were allowed&#xA;  to match. Now, 0 really means that zero child documents are allowed.&#xA;  If no upper limit is needed then the max_children parameter shouldnâ€™t&#xA;  be specified at all.</p>&#xA;</blockquote>&#xA;&#xA;<p>so in ES >5.0 it should work, but for some reasons max_children=0 really doesn't work in 5.3.0</p>&#xA;