31871459
Elasticsearch Date histogram Query
<p>I am new to Elasticsearch and am working on clustering an index of photos by their dates. In particular, I would like to group photos that are taken in 1.5 hours. </p>&#xA;&#xA;<p>I know that Elasticsearch has the Date Histogram Aggregation property, but it only returns "doc_count". I need to see the items on the index, not just the numbers. </p>&#xA;&#xA;<p>What kind of query would help such need? </p>&#xA;&#xA;<p>For your reference, the query below:</p>&#xA;&#xA;<pre><code>GET /account_index/_search?&#xA;&#xA;&#xA;"aggs":{ &#xA;    "zamanlar":{&#xA;        "date_histogram" : {&#xA;            "field" : "EXIF DateTimeOriginal",&#xA;            "interval" : "1.5h"&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Returns this: </p>&#xA;&#xA;<pre><code>{&#xA;"took": 6,&#xA;"timed_out": false,&#xA;"_shards": {&#xA;  "total": 5,&#xA;  "successful": 5,&#xA;  "failed": 0&#xA;},&#xA; "hits": {&#xA;   "total": 1688,&#xA;   "max_score": 0,&#xA;   "hits": []&#xA;},&#xA; "aggregations": {&#xA;  "zamanlar": {&#xA;     "buckets": [&#xA;        {&#xA;           "key_as_string": "2007:08:11 15:00:00",&#xA;           "key": 1186844400000,&#xA;           "doc_count": 7&#xA;        },&#xA;        {&#xA;           "key_as_string": "2007:08:11 18:00:00",&#xA;           "key": 1186855200000,&#xA;           "doc_count": 1&#xA;        },&#xA;        {&#xA;           "key_as_string": "2007:08:12 00:00:00",&#xA;           "key": 1186876800000,&#xA;           "doc_count": 7&#xA;        }]}}}&#xA;</code></pre>&#xA;&#xA;<p>I DON'T want doc_count, which is just a number. I need to see the actual "group members." Thanks in advance. </p>&#xA;
<p>You can use the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics-top-hits-aggregation.html" rel="nofollow"><code>top_hits</code></a> sub-aggregation for each bucket. That way you'd get the hits for each date interval.</p>&#xA;&#xA;<pre><code>curl -XGET localhost:9200/account_index/_search -d '{&#xA;  "aggs":{ &#xA;    "zamanlar":{&#xA;        "date_histogram" : {&#xA;            "field" : "EXIF DateTimeOriginal",&#xA;            "interval" : "1.5h"&#xA;        },&#xA;        "aggs": {&#xA;            "hits": {&#xA;                "top_hits": {&#xA;                    "size": 10,              &lt;--- you can change the size&#xA;                    "sort": {"size":"desc"}  &lt;--- and the sorting, too&#xA;                }&#xA;            }&#xA;        }&#xA;    }&#xA;  }&#xA;}'&#xA;</code></pre>&#xA;