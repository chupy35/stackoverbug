30917089
get buckets count in elasticsearch aggregations
<p>I am using elasticsearch to search a database with a lot of duplicates.&#xA;I am using field colapse and it works, however it returns the amount of hits (including duplicates) and not the amount of buckets.</p>&#xA;&#xA;<pre><code>"aggs": {&#xA;        "uniques": {&#xA;            "terms": {&#xA;                "field": "guid"&#xA;            },&#xA;            "aggs": {&#xA;                "jobs": { "top_hits": { "_source": "title", "size": 1 }}  &#xA;            }&#xA;        }&#xA;    }&#xA;</code></pre>&#xA;&#xA;<p>I can count the buckets by making another request using cardinality (but it only returns count, not the documents):</p>&#xA;&#xA;<pre><code>{&#xA;    "aggs" : {&#xA;        "uniques" : {&#xA;            "cardinality" : {&#xA;                "field" : "guid"&#xA;            }&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Is there a way to return both requests (buckets + total bucket count) in one search?</p>&#xA;&#xA;<p>Thanks</p>&#xA;
<p>You can combine both of these aggregations into 1 request.</p>&#xA;&#xA;<pre><code>{&#xA;   "aggs" : {&#xA;    "uniques" : {&#xA;        "cardinality" : {&#xA;            "field" : "guid"&#xA;        }&#xA;    },&#xA;    "uniquesTerms": {&#xA;        "terms": {&#xA;            "field": "guid"&#xA;        },&#xA;        "aggs": {&#xA;            "jobs": { "top_hits": { "_source": "title", "size": 1 }}  &#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;