28554096
Searching for Records in ElasticSearch based on keys in the "_source" field
<p>I have the records in the elasticsearch in this format:</p>&#xA;&#xA;<pre><code> {&#xA;      "_index" : "feb14",&#xA;      "_type" : "apache_access",&#xA;      "_id" : "1EONaxeVR1-drG0EeQv2QA",&#xA;      "_score" : 1.0,&#xA;      "_source":{"message":"8.8.8.8 - kurt [18/May/2011:01:48:10 -0700] \"GET /admin HTTP/1.1\" 301 566 \"-\" \"Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.3\"","@version":"1","@timestamp":"2011-05-18T08:48:10.000Z","host":"amith-Dell-System-XPS-L502X","path":"/home/amith/Desktop/logstash-1.4.2/accesslog3","type":"apache_access","clientip":"8.8.8.8","ident":"-","auth":"kurt","timestamp":"18/May/2011:01:48:10 -0700","verb":"GET","request":"/admin","httpversion":"1.1","response":"301","bytes":"566","referrer":"\"-\"","agent":"\"Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.3\""}&#xA;    }&#xA;</code></pre>&#xA;&#xA;<p>I need to filter the records based on a field in the "_source" part of the record.Can anyone please tell me how can I do that?</p>&#xA;&#xA;<p>I have looked into search api's and scripting in elasticsearch.But I am not able combine them to obtain the result.</p>&#xA;
<p>You can use <a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html" rel="nofollow">http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html</a></p>&#xA;&#xA;<p>eg : You can search "Mozilla" OR "kurt" in "message" or "auth" fields :</p>&#xA;&#xA;<pre><code>"query": {&#xA;    "query_string": {&#xA;        "fields": ["message", "auth"],&#xA;        "default_operator": "OR", // or AND&#xA;        "query": "Mozilla kurt"&#xA;    }&#xA;}&#xA;</code></pre>&#xA;
<p>If I am reading your JSON structure correctly  "response": "301" field is a nested field inside the _source field. You can query by using any of the nested fields inside _source, by mapping _source as nested object.</p>&#xA;&#xA;<pre><code>&gt; &gt; {&#xA;&gt;     "nested" : {&#xA;&gt;         "path" : "obj1",&#xA;&gt;         "query" : {&#xA;&gt;             "bool" : {&#xA;&gt;                 "must" : [&#xA;&gt;                     {&#xA;&gt;                         "match" : {"_source.response" : "301"}&#xA;&gt;                     }&#xA;&gt;                 ]&#xA;&gt;             }&#xA;&gt;         }&#xA;&gt;     } }&#xA;</code></pre>&#xA;&#xA;<p>Have a look at mapping nested objects and nested queries:</p>&#xA;&#xA;<p><a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/query-dsl-nested-query.html" rel="nofollow">http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/query-dsl-nested-query.html</a></p>&#xA;&#xA;<p>Map _source as nested object:&#xA;<a href="http://www.elasticsearch.org/guide/en/elasticsearch/guide/current/nested-mapping.html" rel="nofollow">http://www.elasticsearch.org/guide/en/elasticsearch/guide/current/nested-mapping.html</a></p>&#xA;