33241558
elasticsearch nested aggregration total value
<p>I have documents with category, respsize, client name etc. as you see in picture below..&#xA;<a href="https://i.stack.imgur.com/O3SPT.png" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/O3SPT.png" alt="enter image description here"></a></p>&#xA;&#xA;<p>I want to get result by dsl query which returns filtered by category and grouped by clientname then total respsize in each category of that user.. here what I tried:&#xA;<a href="https://i.stack.imgur.com/Dddb1.png" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/Dddb1.png" alt="enter image description here"></a></p>&#xA;&#xA;<p>But I want respsize of each categories in this result also it should be like:</p>&#xA;&#xA;<pre><code>"buckets": [&#xA;                 {&#xA;                    "key": "50",&#xA;                    "doc_count": 87,&#xA;                    "respsize": 23213                     &#xA;                 },&#xA;                 {&#xA;                    "key": "49",&#xA;                    "doc_count": 25,&#xA;                    "respsize": 23213&#xA;                 }&#xA;</code></pre>&#xA;
<p>Try this agg ;-)</p>&#xA;&#xA;<pre><code>"aggs": {&#xA;    "by_clients": {&#xA;      "terms": {&#xA;        "field": "clientname"&#xA;      },&#xA;      "aggs": {&#xA;        "by_categories": {&#xA;          "terms": {&#xA;            "field": "category"&#xA;          },&#xA;          "aggs": {&#xA;            "total_respsize": {&#xA;              "sum": {"field": "respsize"}&#xA;            }&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;</code></pre>&#xA;