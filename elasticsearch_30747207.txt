30747207
Unexpected case sensitivty
<p>I am a noob running elastic search 1.5.9. I want to pull out all of the documents that have the field "PERSON" set to "Johnson." (Note the mixed casing). If I manually look at elastic search <a href="https://github.com/mobz/elasticsearch-head" rel="nofollow">head</a>, I can see a document with exactly those attributes. </p>&#xA;&#xA;<p>The <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/_finding_exact_values.html" rel="nofollow">docs</a> explain that I should construct a filter query to pull out this document. But when I do so, I get some unexpected behavior. </p>&#xA;&#xA;<p>This works. It returns exactly one document w/ Person = "Johnson", as expected</p>&#xA;&#xA;<pre><code>query = {"filter": {"term" : { "PERSON" : "johnson" }}}&#xA;</code></pre>&#xA;&#xA;<p>But this does not work</p>&#xA;&#xA;<pre><code>query = {"filter": {"term" : { "PERSON" : "Johnson" }}}&#xA;</code></pre>&#xA;&#xA;<p>If you look closely, you'll see that the good query is lowercase but the bad query is mixed case -- even though the PERSON field is set to "Johnson".</p>&#xA;&#xA;<p>Adding to the weirdness, I am lower casing everything that goes into the <code>full_text</code> field: <code>"_source": { "full_text": "all lower case"</code> So the full text includes <code>johnson</code> -- which I would think would be totally independent from the PERSON field.</p>&#xA;&#xA;<p>What's going on? How do I do a mixed case search on the PERSON field?</p>&#xA;
<p>Term query wont analyze your search text. &#xA;This means you need to analyzed and provide the query in token format for term query to actually work.&#xA;Use <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query.html" rel="nofollow">match query</a> instead , things will work like magic.</p>&#xA;&#xA;<p>So when a string like below goes to Elasticsearch , its tokenized ( or rather analyzed) and stored</p>&#xA;&#xA;<pre><code>"Green Apple" -&gt; ( "green" , "apple")&#xA;</code></pre>&#xA;&#xA;<p>This is the default behavior of analysis.&#xA;Now when you search using term query , the analysis wont happen.&#xA;Which means for the word Apple , it searches for the token Apple with case preserved. And hence fails.</p>&#xA;&#xA;<p>For match query , it does do the analysis. Which means if you search with Apple , it converts it to apple and then does the search. Which give good matches.</p>&#xA;&#xA;<p>You can learn more on analysis <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis.html" rel="nofollow">here</a>.</p>&#xA;