34277525
ElasticSearch failed to load plugins (License Module)
<p>I have to load ElasticSearch plugins with the offline instructions but it looks like I am getting a permissions error even when I open up permissions to the files completely and running as root! I've removed and reinstalled as well but this error is consistent. </p>&#xA;&#xA;<pre><code>[root@ip-10-94-146-130 bin]# ./plugin install file:///home/jmblnvr/shield/license-2.1.0.zip&#xA;-&gt; Installing from file:/home/jmblnvr/shield/license-2.1.0.zip...&#xA;Trying file:/home/jmblnvr/shield/license-2.1.0.zip ...&#xA;Downloading .DONE&#xA;Verifying file:/home/jmblnvr/shield/license-2.1.0.zip checksums if available ...&#xA;NOTE: Unable to verify checksum for downloaded plugin (unable to find .sha1 or .md5 file to verify)&#xA;Installed license into /usr/share/elasticsearch/plugins/license&#xA;[root@ip-10-94-146-130 bin]# service elasticsearch restart&#xA;Stopping elasticsearch:                                    [FAILED]&#xA;Starting elasticsearch: Exception in thread "main" java.lang.IllegalStateException: Unable to initialize plugins&#xA;Likely root cause: java.nio.file.AccessDeniedException: /usr/share/elasticsearch/plugins/license/plugin-descriptor.properties&#xA;    at sun.nio.fs.UnixException.translateToIOException(UnixException.java:84)&#xA;    at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:102)&#xA;    at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:107)&#xA;    at sun.nio.fs.UnixFileSystemProvider.newByteChannel(UnixFileSystemProvider.java:214)&#xA;    at java.nio.file.Files.newByteChannel(Files.java:361)&#xA;    at java.nio.file.Files.newByteChannel(Files.java:407)&#xA;    at java.nio.file.spi.FileSystemProvider.newInputStream(FileSystemProvider.java:384)&#xA;    at java.nio.file.Files.newInputStream(Files.java:152)&#xA;    at org.elasticsearch.plugins.PluginInfo.readFromProperties(PluginInfo.java:86)&#xA;    at org.elasticsearch.plugins.PluginsService.getPluginBundles(PluginsService.java:302)&#xA;    at org.elasticsearch.plugins.PluginsService.&lt;init&gt;(PluginsService.java:108)&#xA;    at org.elasticsearch.node.Node.&lt;init&gt;(Node.java:148)&#xA;    at org.elasticsearch.node.Node.&lt;init&gt;(Node.java:129)&#xA;    at org.elasticsearch.node.NodeBuilder.build(NodeBuilder.java:145)&#xA;    at org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:178)&#xA;    at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:285)&#xA;    at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:35)&#xA;Refer to the log for complete error details.&#xA;                                                           [FAILED]&#xA;</code></pre>&#xA;&#xA;<p>From /var/log:</p>&#xA;&#xA;<pre><code>[root@ip-10-94-146-130 elasticsearch]# cat elasticsearch.log&#xA;[2015-12-15 11:44:24,525][INFO ][node                     ] [Valtorr] stopping ...&#xA;[2015-12-15 11:44:24,639][INFO ][node                     ] [Valtorr] stopped&#xA;[2015-12-15 11:44:24,641][INFO ][node                     ] [Valtorr] closing ...&#xA;[2015-12-15 11:44:24,647][INFO ][node                     ] [Valtorr] closed&#xA;[2015-12-15 11:44:26,097][WARN ][bootstrap                ] unable to install syscall filter: seccomp unavailable: CONFIG_SECCOMP not compiled into kernel, CONFIG_SECCOMP and CONFIG_SECCOMP_FILTER are needed&#xA;[2015-12-15 11:44:26,314][INFO ][node                     ] [Agon] version[2.1.0], pid[21703], build[72cd1f1/2015-11-18T22:40:03Z]&#xA;[2015-12-15 11:44:26,314][INFO ][node                     ] [Agon] initializing ...&#xA;[2015-12-15 11:44:26,318][ERROR][bootstrap                ] Exception&#xA;java.lang.IllegalStateException: Unable to initialize plugins&#xA;    at org.elasticsearch.plugins.PluginsService.&lt;init&gt;(PluginsService.java:111)&#xA;    at org.elasticsearch.node.Node.&lt;init&gt;(Node.java:148)&#xA;    at org.elasticsearch.node.Node.&lt;init&gt;(Node.java:129)&#xA;    at org.elasticsearch.node.NodeBuilder.build(NodeBuilder.java:145)&#xA;    at org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:178)&#xA;    at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:285)&#xA;    at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:35)&#xA;Caused by: java.nio.file.AccessDeniedException: /usr/share/elasticsearch/plugins/license/plugin-descriptor.properties&#xA;    at sun.nio.fs.UnixException.translateToIOException(UnixException.java:84)&#xA;    at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:102)&#xA;    at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:107)&#xA;    at sun.nio.fs.UnixFileSystemProvider.newByteChannel(UnixFileSystemProvider.java:214)&#xA;    at java.nio.file.Files.newByteChannel(Files.java:361)&#xA;    at java.nio.file.Files.newByteChannel(Files.java:407)&#xA;    at java.nio.file.spi.FileSystemProvider.newInputStream(FileSystemProvider.java:384)&#xA;    at java.nio.file.Files.newInputStream(Files.java:152)&#xA;    at org.elasticsearch.plugins.PluginInfo.readFromProperties(PluginInfo.java:86)&#xA;    at org.elasticsearch.plugins.PluginsService.getPluginBundles(PluginsService.java:302)&#xA;    at org.elasticsearch.plugins.PluginsService.&lt;init&gt;(PluginsService.java:108)&#xA;    ... 6 more&#xA;</code></pre>&#xA;
<p>Thanks to Val, simple solution is after installing plugins you need to quickly change ownership/groups if you are using the RPM install of Elastic:</p>&#xA;&#xA;<pre><code>chown -R root:elasticsearch /usr/share/elasticsearch&#xA;</code></pre>&#xA;
<p>I was having the same sort of exception but after installing and while loading <strong>x-pack</strong> plugin on Elasticsearch 5.2.1:</p>&#xA;&#xA;<pre><code>Caused by: java.nio.file.AccessDeniedException: /usr/share/elasticsearch/plugins/x-pack/plugin-descriptor.properties&#xA;</code></pre>&#xA;&#xA;<p>In my case, I started by adding <em>elasticsearch</em> user to the root group:</p>&#xA;&#xA;<pre><code>usermod -aG root elasticsearch&#xA;</code></pre>&#xA;&#xA;<p>Afterwards, it was only necessary to modify the ownership of the <em>plugins</em> folder:</p>&#xA;&#xA;<pre><code>chown -R elasticsearch:elasticsearch /usr/share/elasticsearch/plugins/&#xA;</code></pre>&#xA;