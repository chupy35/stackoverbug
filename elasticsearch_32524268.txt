32524268
Elasticsearch No query registered for [exists]]
<p>After running the below query, i am getting the exception as No query registered for [exists]. Please help me. </p>&#xA;&#xA;<pre><code>{&#xA;  "query": {&#xA;    "function_score": {&#xA;      "query": {&#xA;        "bool": {&#xA;          "must": {&#xA;            "match": {&#xA;              "_all": {&#xA;                "query": "cardio new york"&#xA;              }&#xA;            }&#xA;          }&#xA;        }&#xA;      },&#xA;      "functions": [&#xA;        {&#xA;          "gauss": {&#xA;            "geo_location": {&#xA;              "origin": {&#xA;                "lat": 40.7127,&#xA;                "lon": -74.0059&#xA;              },&#xA;              "scale": "100km",&#xA;              "offset": "0km",&#xA;              "decay": 0.9&#xA;            }&#xA;          }&#xA;        },&#xA;        {&#xA;          "gauss": {&#xA;            "startdate": {&#xA;              "origin": "now",&#xA;              "scale": "30d",&#xA;              "offset": "30d"&#xA;            }&#xA;          },&#xA;          "weight": 0.5&#xA;        }&#xA;      ],&#xA;      "filter": {&#xA;        "query": {&#xA;          "bool": {&#xA;            "must": {&#xA;              "match": {&#xA;                "_all": {&#xA;                  "query": "cardio new york"&#xA;                }&#xA;              }&#xA;            },&#xA;            "should": {&#xA;              "exists": {&#xA;                "fields": [&#xA;                  "venue",&#xA;                  "geo_location"&#xA;                ]&#xA;              }&#xA;            }&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>I am trying to filter the search results after the function_score with combining bool match query. </p>&#xA;
<p><code>exists</code> is not a query, it's filter you cannot use it in a <code>bool</code> query, instead I would use <code>bool</code> filter and wrap only <code>match</code> into <code>query</code> filter like this:</p>&#xA;&#xA;<pre><code> "filter": {&#xA;    "bool": {&#xA;      "must": [{&#xA;        "query": {&#xA;          "match": {&#xA;            "_all": {&#xA;              "query": "cardio new york"&#xA;            }&#xA;          }&#xA;        }&#xA;      }, {&#xA;        "exists": {&#xA;          "fields": [&#xA;            "venue",&#xA;            "geo_location"&#xA;          ]&#xA;        }&#xA;      }]&#xA;    }&#xA;  }&#xA;</code></pre>&#xA;
<p>This depends on your version, before version 2.0 you would use the Exists filter, as demonstrated in imotov's answer. </p>&#xA;&#xA;<p>With <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.0/query-dsl-exists-filter.html" rel="nofollow">2.0 and after</a> exists filter has been replaced by exists query <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-exists-query.html" rel="nofollow">documentation for current version</a> </p>&#xA;&#xA;<p>thus the newer exists query would look like the following:</p>&#xA;&#xA;<pre><code>{&#xA; "index": "foobars",&#xA; "type": "foo",&#xA; "body": {&#xA;  "query": {&#xA;   "bool": {&#xA;    "must":&#xA;        {"exists" : { "field" : "bar" }}&#xA;   }&#xA;  },&#xA;  "from": 0,&#xA;  "size": 20&#xA; }&#xA;}&#xA;</code></pre>&#xA;