28905435
ElasticSearch filtered query not returning expected/desired score results
<p>ElasticSeach is not returning the desired results when querying for <b>iPad Mini 3 64GB AT&amp;T</b></p>&#xA;&#xA;<p>ElasticSearch highest scored result is <b>iPad Mini 2 64GB AT&amp;T</b> and <b>iPad Mini 3 64GB AT&amp;T</b> is 5th in the results. </p>&#xA;&#xA;<p>Here is the mapping section for BrandAndDeviceName:</p>&#xA;&#xA;<pre><code>"BrandAndDeviceName": {&#xA;     "type": "string",&#xA;     "fields": {&#xA;        "autocomplete": {&#xA;           "type": "string",&#xA;           "analyzer": "autocomplete"&#xA;        }&#xA;     }&#xA;},&#xA;</code></pre>&#xA;&#xA;<p>And REST call</p>&#xA;&#xA;<pre><code>GET /devices/device/_search/&#xA;{&#xA;  "query": {&#xA;    "filtered": {&#xA;      "query": {&#xA;        "query_string": {&#xA;          "query": "iPad Mini 3 64GB AT&amp;T",&#xA;          "default_field": "BrandAndDeviceName.autocomplete"&#xA;        }&#xA;      },&#xA;      "filter": {&#xA;        "and": [&#xA;          {&#xA;            "term": {&#xA;              "Active": true&#xA;            }&#xA;          }&#xA;        ]&#xA;      }&#xA;    }&#xA;  },&#xA;  "size": 12,&#xA;  "from": 0&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>This was the top result</p>&#xA;&#xA;<pre><code>{&#xA;        "_index": "devices",&#xA;        "_type": "device",&#xA;        "_id": "94698082-d5cb-4f54-829e-dc62e196c894",&#xA;        "_score": 9.904099,&#xA;        "_source": {&#xA;           "DeviceId": "94698082-d5cb-4f54-829e-dc62e196c894",&#xA;           "DeviceName": "iPad Mini 2 64GB AT&amp;T",&#xA;           "Active": true,&#xA;           "Brand": {&#xA;              "Id": "7d04b58b-3f2d-4f63-821f-7f081d7f1bd9",&#xA;              "Name": "Apple"&#xA;           },&#xA;           "Category": {&#xA;              "CategoryId": "41d45e60-9587-4dd9-828f-5dacf02a499f",&#xA;              "CategoryName": "Tablets"&#xA;           },&#xA;           "DeviceGroup": {&#xA;              "Id": "b362318d-5c24-4dd9-a371-3261c6b38ac6",&#xA;              "Name": "iPad Mini 2"&#xA;           },&#xA;           "BrandAndDeviceName": "Apple iPad Mini 2 64GB AT&amp;T"&#xA;        }&#xA; },&#xA;</code></pre>&#xA;&#xA;<p>Notice that <b>iPad Mini 2 64GB AT&amp;T</b> is returned with the highest score of 9.904099 and the expected document is the 5th one returned with a score of 9.483598</p>&#xA;&#xA;<pre><code>{&#xA;            "_index": "devices",&#xA;            "_type": "device",&#xA;            "_id": "5dd038b7-1dea-491d-8d69-fb349970b8a2",&#xA;            "_score": 9.483598,&#xA;            "_source": {&#xA;               "DeviceId": "5dd038b7-1dea-491d-8d69-fb349970b8a2",&#xA;               "DeviceName": "iPad Mini 3 64GB AT&amp;T",&#xA;               "Active": true,&#xA;               "Brand": {&#xA;                  "Id": "7d04b58b-3f2d-4f63-821f-7f081d7f1bd9",&#xA;                  "Name": "Apple"&#xA;               },&#xA;               "Category": {&#xA;                  "CategoryId": "41d45e60-9587-4dd9-828f-5dacf02a499f",&#xA;                  "CategoryName": "Tablets"&#xA;               },&#xA;               "BrandAndDeviceName": "Apple iPad Mini 3 64GB AT&amp;T"&#xA;            }&#xA;         },&#xA;</code></pre>&#xA;&#xA;<p>Why would <b>Apple iPad Mini 2 64GB AT&amp;T</b> get a higher score than <b>Apple iPad Mini 3 64GB AT&amp;T</b>?</p>&#xA;
<p>Filter queries are unscored; they are simply pass/fail.</p>&#xA;&#xA;<blockquote>&#xA;  <p>Filters are usually faster than queries because they don’t have to calculate the relevance _score for each document —  the answer is just a boolean “Yes, the document matches the filter” or “No, the document does not match the filter”.</p>&#xA;</blockquote>&#xA;&#xA;<p><a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/query-dsl-filtered-query.html" rel="nofollow">http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/query-dsl-filtered-query.html</a></p>&#xA;&#xA;<p>If you want scored results, just use a query, rather than a filter.</p>&#xA;&#xA;<pre><code>GET /devices/device/_search/&#xA;{&#xA;  "query": {&#xA;    "query_string": {&#xA;      "query": "iPad Mini 3 64GB AT&amp;T",&#xA;      "default_field": "BrandAndDeviceName.autocomplete"&#xA;    }&#xA;  },&#xA;  "filter": {&#xA;    "and": [&#xA;      {&#xA;        "term": {&#xA;          "Active": true&#xA;        }&#xA;      }&#xA;    ]&#xA;  },&#xA;  "size": 12,&#xA;  "from": 0&#xA;}&#xA;</code></pre>&#xA;