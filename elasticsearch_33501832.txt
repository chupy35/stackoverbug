33501832
How to aggregate on elasticsearch field of type string that includes a slash (/)
<p>How to aggregate on field of type string which has a format <code>11/03/2015</code> i.e. treat string as date without re-indexing? For example, Consider the mapping for an Elasticsearch <code>index:sport</code>, <code>type:athlete</code>:</p>&#xA;&#xA;<pre><code>curl -XPUT "http://localhost:9200/sports/" -d'&#xA;{&#xA;  "mappings": {&#xA;     "athlete": {&#xA;        "properties": {&#xA;           "birthdate": {&#xA;           "type": "string"    &#xA;           },&#xA;            "name": {&#xA;            "type": "string"&#xA;           },&#xA;            "score": {&#xA;            "type": "integer"&#xA;           },&#xA;            "sport": {&#xA;            "type": "string"&#xA;           }&#xA;        }&#xA;     }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Aggregating on <code>birthdate</code> appears to separate field using the <code>/</code> and therefore aggregates on <code>11/03/2015</code> as <code>11</code>, <code>03</code>, <code>2015</code> rather than taking as a whole and aggregating on it. How to fix this? :</p>&#xA;&#xA;<pre><code>"buckets": [&#xA;        {&#xA;           "key": "2015",&#xA;           "doc_count": 24&#xA;        },&#xA;        {&#xA;           "key": "11",&#xA;           "doc_count": 21&#xA;        },&#xA;        {&#xA;           "key": "03",&#xA;           "doc_count": 3&#xA;        }&#xA;      ] &#xA;</code></pre>&#xA;
<p>Your mapping for birthday should not be string type. Instead it should be "date". You can also specify format with the mapping if you want. This link will help you.</p>&#xA;&#xA;<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/1.4/mapping-core-types.html#date" rel="nofollow">https://www.elastic.co/guide/en/elasticsearch/reference/1.4/mapping-core-types.html#date</a></p>&#xA;
<p>ES mapping defaults to analyzer. Changing the index to <code>not_analyzed</code> fixed the problem:</p>&#xA;&#xA;<pre><code>curl -XPUT "http://localhost:9200/sports/" -d'&#xA;{&#xA; "mappings": {&#xA;    "athlete": {&#xA;      "properties": {&#xA;        "birthdate": {&#xA;          "type": "string", "index" : "not_analyzed"    &#xA;            },&#xA;        "name": {&#xA;        "type": "string"&#xA;       },&#xA;        "score": {&#xA;        "type": "integer"&#xA;       },&#xA;        "sport": {&#xA;        "type": "string"&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;</code></pre>&#xA;