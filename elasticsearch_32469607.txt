32469607
script_score the script could not be loaded scripts of type [inline], operation [search] and lang [groovy] are disabled
<p>Currently I use the Elastisearch 1.5.<br>&#xA;I want to update to the Elasticsearch 1.7.  </p>&#xA;&#xA;<p>And then when I run below query to the ES1.7, I got the error which is </p>&#xA;&#xA;<blockquote>&#xA;  <p>nested: QueryParsingException[[my_index] script_score the script could not be&#xA;  loaded]; nested: ScriptException[scripts of type [inline], operation&#xA;  [search] and lang [groovy] are disabled];&#xA;  .</p>&#xA;</blockquote>&#xA;&#xA;<p>This query definitely works on the ES 1.5 environment.&#xA;I want to use same query to the ES 1.7.</p>&#xA;&#xA;<pre><code>{&#xA;  "query": {&#xA;    "function_score": {&#xA;      "query": {&#xA;        "filtered": {&#xA;          "query": {&#xA;            "query_string": {&#xA;              "fields": [&#xA;                "itemname"&#xA;              ],&#xA;              "query": "coke"&#xA;            }&#xA;          }&#xA;        }&#xA;      },&#xA;      "script_score": {&#xA;        "script": "_score + doc['myscore'].value"&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>I have already read this document.&#xA;<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-scripting.html#enable-dynamic-scripting" rel="noreferrer">https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-scripting.html#enable-dynamic-scripting</a></p>&#xA;&#xA;<p>So, I have added below options to my elasticsearch.yml.</p>&#xA;&#xA;<pre><code>script.inline: on  &#xA;script.indexed: on &#xA;script.engine.groovy.inline.aggs: on  &#xA;</code></pre>&#xA;&#xA;<p>And I did to restart elasticsearch daemon and to create index again, but I still got the error.</p>&#xA;&#xA;<p>Does anyone advise me how can I solve this problem ?</p>&#xA;&#xA;<p>Added</p>&#xA;&#xA;<pre><code>[root@elasticsearch]# curl -XGET 'http://localhost:9200'&#xA;{&#xA;  "status" : 200,&#xA;  "name" : "Ghost Girl",&#xA;  "cluster_name" : "elasticsearch",&#xA;  "version" : {&#xA;    "number" : "1.7.1",&#xA;    "build_hash" : "b88f43fc40b0bcd7f173a1f9ee2e97816de80b19",&#xA;    "build_timestamp" : "2015-07-29T09:54:16Z",&#xA;    "build_snapshot" : false,&#xA;    "lucene_version" : "4.10.4"&#xA;  },&#xA;  "tagline" : "You Know, for Search"&#xA;}&#xA;&#xA;[root@elasticsearch]# tail -n 10 /etc/elasticsearch/elasticsearch.yml&#xA;# http server. With this enabled, it may pose a security risk, so disabling&#xA;# it unless you need it is recommended (it is disabled by default).&#xA;#&#xA;#http.jsonp.enable: true&#xA;&#xA;script.groovy.sandbox.enabled: true&#xA;script.inline: on&#xA;script.indexed: on&#xA;script.search: on&#xA;script.engine.groovy.inline.aggs: on&#xA;&#xA;[root@elasticsearch]# /etc/rc.d/init.d/elasticsearch restart&#xA;Stopping elasticsearch:                                    [  OK  ]&#xA;Starting elasticsearch:                                    [  OK  ]&#xA;&#xA;[root@elasticsearch]# curl -XPOST 'localhost:9200/my_index/_search?pretty' -d '{&#xA;&gt;   "query": {&#xA;&gt;     "function_score": {&#xA;&gt;       "query": {&#xA;&gt;         "filtered": {&#xA;&gt;           "query": {&#xA;&gt;             "query_string": {&#xA;&gt;               "fields": [&#xA;&gt;                 "itemname"&#xA;&gt;               ],&#xA;&gt;               "query": "coke"&#xA;&gt;             }&#xA;&gt;           }&#xA;&gt;         }&#xA;&gt;       },&#xA;&gt;       "script_score": {&#xA;&gt;         "script": "_score * 0.5"&#xA;&gt;       }&#xA;&gt;     }&#xA;&gt;   }&#xA;&gt; }'&#xA;{&#xA;  "took" : 3029,&#xA;  "timed_out" : false,&#xA;  "_shards" : {&#xA;    "total" : 5,&#xA;    "successful" : 3,&#xA;    "failed" : 2,&#xA;    "failures" : [ {&#xA;      "index" : "my_index",&#xA;      "shard" : 1,&#xA;      "status" : 400,&#xA;      "reason" : "RemoteTransportException[[Fury][inet[/xx.xx.xx.xx:9300]][indices:data/read/search[phase/query]]]; nested: SearchParseException[[ss][1]: from[-1],size[-1]: Parse Failure [Failed to parse source [{\n  \"query\": {\n    \"function_score\": {\n      \"query\": {\n        \"filtered\": {\n          \"query\": {\n            \"query_string\": {\n              \"fields\": [\n                \"itemname\"\n              ],\n              \"query\": \"coke\"\n            }\n          }\n        }\n      },\n      \"script_score\": {\n        \"script\": \"_score * 0.5\"\n      }\n    }\n  }\n}]]]; nested: QueryParsingException[[my_index] script_score the script could not be loaded]; nested: ScriptException[scripts of type [inline], operation [search] and lang [groovy] are disabled]; "&#xA;    }, {&#xA;      "index" : "my_index",&#xA;      "shard" : 4,&#xA;      "status" : 400,&#xA;      "reason" : "RemoteTransportException[[Fury][inet[/xx.xx.xx.xx:9300]][indices:data/read/search[phase/query]]]; nested: SearchParseException[[my_index][4]: from[-1],size[-1]: Parse Failure [Failed to parse source [{\n  \"query\": {\n    \"function_score\": {\n      \"query\": {\n        \"filtered\": {\n          \"query\": {\n            \"query_string\": {\n              \"fields\": [\n                \"itemname\"\n              ],\n              \"query\": \"coke\"\n            }\n          }\n        }\n      },\n      \"script_score\": {\n        \"script\": \"_score * 0.5\"\n      }\n    }\n  }\n}]]]; nested: QueryParsingException[[my_index] script_score the script could not be loaded]; nested: ScriptException[scripts of type [inline], operation [search] and lang [groovy] are disabled]; "&#xA;    } ]&#xA;  },&#xA;  "hits" : {&#xA;    "total" : 0,&#xA;    "max_score" : null,&#xA;    "hits" : [ ]&#xA;  }&#xA;}&#xA;</code></pre>&#xA;
<p>add <code>script.engine.groovy.inline.update: on</code> to the .yml file</p>&#xA;
<p>As the repond said :<code>nested: ScriptException[scripts of type [inline], operation [search] and lang [groovy] are disabled]</code></p>&#xA;&#xA;<p>You may add <code>script.engine.groovy.inline.search: on</code> in <code>.yml</code> file. </p>&#xA;