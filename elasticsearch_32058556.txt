32058556
simple group by in elastic search
<p>This is my search:</p>&#xA;&#xA;<pre><code>{&#xA; "query": {&#xA;   "filtered": { &#xA;     "filter": {&#xA;       "term": { "cityId": "10777"}&#xA;     },&#xA;     "query" : {&#xA;        "query_string": {&#xA;          "query": "pizza",&#xA;          "fields": ["name", "main", "category.name"]&#xA;        }&#xA;      }&#xA;   }&#xA; },&#xA; "sort": [&#xA;        { "premium":   { "order": "desc" } }&#xA;    ]&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>This works perfectly.&#xA;He brings me several categories, and I would like to group by them.&#xA;example:&#xA;Group by category "pizzerias"</p>&#xA;
<p>All you have to do is to add a <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-terms-aggregation.html" rel="nofollow"><code>terms</code> aggregation</a> to the mix and you're done.</p>&#xA;&#xA;<p>Supposing your category field is the <code>category.name</code> one, you can do it like this.</p>&#xA;&#xA;<pre><code>{&#xA;  "query": {&#xA;    "filtered": {&#xA;      "filter": {&#xA;        "term": {&#xA;          "cityId": "10777"&#xA;        }&#xA;      },&#xA;      "query": {&#xA;        "query_string": {&#xA;          "query": "pizza",&#xA;          "fields": [&#xA;            "name",&#xA;            "main",&#xA;            "category.name"&#xA;          ]&#xA;        }&#xA;      }&#xA;    }&#xA;  },&#xA;  "sort": [&#xA;    {&#xA;      "premium": {&#xA;        "order": "desc"&#xA;      }&#xA;    }&#xA;  ],&#xA;  "aggs": {&#xA;    "categories": {&#xA;      "terms": {&#xA;        "field": "category.name"&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;