28829139
how to improve elasticsearch suggest results
<p>I am using the elasticsearch _suggest endpoint to suggest spelling corrections ("did you mean").  One example that has come up is</p>&#xA;&#xA;<p>"gardeing with muclh"  </p>&#xA;&#xA;<p>My search request is:</p>&#xA;&#xA;<pre><code>{&#xA;  "phrase": {&#xA;    "phrase": {&#xA;      "field": "summary",&#xA;      "max_errors": 0.5,&#xA;      "analyzer": "standard",&#xA;      "highlight": {&#xA;        "pre_tag": "&lt;em&gt;",&#xA;        "post_tag": "&lt;/em&gt;"&#xA;      },&#xA;      "gram_size": 1,&#xA;      "real_word_error_likelihood": 0.95,&#xA;      "direct_generator": [&#xA;        {&#xA;          "field": "summary",&#xA;          "suggest_mode": "missing",&#xA;          "min_word_len": 3,&#xA;          "min_doc_freq": 5,&#xA;          "max_edits": 1&#xA;        }&#xA;      ]&#xA;    },&#xA;    "text": "gardeing with muclh"&#xA;  },&#xA;  "term": {&#xA;    "term": {&#xA;      "field": "summary",&#xA;      "analyzer": "standard",&#xA;      "suggest_mode": "missing",&#xA;      "size": 3&#xA;    },&#xA;    "text": "gardeing with muclh"&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>and it returns the results:</p>&#xA;&#xA;<pre><code>{&#xA;  "term": [&#xA;    {&#xA;      "text": "gardeing",&#xA;      "offset": 0,&#xA;      "length": 8,&#xA;      "options": [&#xA;        {&#xA;          "text": "gardening",&#xA;          "score": 0.875,&#xA;          "freq": 512&#xA;        },&#xA;        {&#xA;          "text": "gardenia",&#xA;          "score": 0.75,&#xA;          "freq": 71&#xA;        },&#xA;        {&#xA;          "text": "gardeninig",&#xA;          "score": 0.75,&#xA;          "freq": 1&#xA;        }&#xA;      ]&#xA;    },&#xA;    {&#xA;      "text": "with",&#xA;      "offset": 9,&#xA;      "length": 4,&#xA;      "options": []&#xA;    },&#xA;    {&#xA;      "text": "muclh",&#xA;      "offset": 14,&#xA;      "length": 5,&#xA;      "options": [&#xA;        {&#xA;          "text": "mulch",&#xA;          "score": 0.8,&#xA;          "freq": 190&#xA;        },&#xA;        {&#xA;          "text": "much",&#xA;          "score": 0.75,&#xA;          "freq": 527&#xA;        },&#xA;        {&#xA;          "text": "muscle",&#xA;          "score": 0.6,&#xA;          "freq": 1&#xA;        }&#xA;      ]&#xA;    }&#xA;  ],&#xA;  "phrase": [&#xA;    {&#xA;      "text": "gardeing with muclh",&#xA;      "offset": 0,&#xA;      "length": 19,&#xA;      "options": [&#xA;        {&#xA;          "text": "gardening with much",&#xA;          "highlighted": "&lt;em&gt;gardening&lt;/em&gt; with &lt;em&gt;much&lt;/em&gt;",&#xA;          "score": 0.000007876507&#xA;        },&#xA;        {&#xA;          "text": "gardening with mulch",&#xA;          "highlighted": "&lt;em&gt;gardening&lt;/em&gt; with &lt;em&gt;mulch&lt;/em&gt;",&#xA;          "score": 0.000005306385&#xA;        },&#xA;        {&#xA;          "text": "gardening with muclh",&#xA;          "highlighted": "&lt;em&gt;gardening&lt;/em&gt; with muclh",&#xA;          "score": 5.7017786e-7&#xA;        }&#xA;      ]&#xA;    }&#xA;  ]&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>The problem is that the correct version is "gardening with <a href="http://en.wikipedia.org/wiki/Mulch" rel="nofollow">mulch</a>" but the phrase match is coming back with "gardening with much".   Note that the term suggest score for "mulch" is higher than "much" for "muclh", I assume because they score a position change higher than an omission or addition.</p>&#xA;&#xA;<p>UPDATE:  I fixed this particular problem by adding a "maxTermFrequency" of .2 - but this seems just like a hack.  I would prefer to solve it more intelligently if possible.</p>&#xA;&#xA;<p>Is there a way to make "gardening with mulch" be the first suggestion instead of "gardening with much" without resorting to the MaxTermFrequency?</p>&#xA;