33701456
Bool query not working as expected
<pre><code>        POST /test/topic/_search&#xA;        {&#xA;          "query": {&#xA;            "bool": {&#xA;              "must": [&#xA;                {&#xA;                  "multi_match": {&#xA;                    "query": "Predisposition",&#xA;                    "fields": [&#xA;                      "_all"&#xA;                    ]&#xA;                  }&#xA;                },&#xA;                {&#xA;                  "multi_match": {&#xA;                    "query": "thrombosis",&#xA;                    "fields": [&#xA;                      "_all"&#xA;                    ]&#xA;                  }&#xA;                }&#xA;              ],&#xA;              "should": [&#xA;                {&#xA;                  "multi_match": {&#xA;                    "query": "cancer",&#xA;                    "fields": [&#xA;                      "_all"&#xA;                    ]&#xA;                  }&#xA;                }&#xA;              ]&#xA;            }&#xA;          }&#xA;        }&#xA;</code></pre>&#xA;&#xA;<p>My understanding of the above query is that it must match on <code>predisposition</code> <code>AND</code> <code>thrombosis</code> <code>OR</code> <code>cancer</code>, however I'm only getting a handful of documents that match on <code>predisposition</code> <code>AND</code> <code>thrombosis</code>, I was expecting lots of <code>cancer</code> documents but have zero. What am I missing?</p>&#xA;
<p>The way you are searching is, documents <strong>must have</strong> predisposition AND thrombosis regardless of cancer because they are inside must filter.&#xA;You basically need to wrap your <code>must clause</code> inside <code>should clause</code> like this</p>&#xA;&#xA;<pre><code>{&#xA;  "query": {&#xA;    "bool": {&#xA;      "should": [&#xA;        {&#xA;          "bool": {&#xA;            "must": [&#xA;              {&#xA;                "multi_match": {&#xA;                  "query": "predisposition",&#xA;                  "fields": "_all"&#xA;                }&#xA;              },&#xA;              {&#xA;                "multi_match": {&#xA;                  "query": "thrombosis",&#xA;                  "fields": "_all"&#xA;                }&#xA;              }&#xA;            ]&#xA;          }&#xA;        },&#xA;        {&#xA;          "multi_match": {&#xA;            "query": "cancer",&#xA;            "fields": "_all"&#xA;          }&#xA;        }&#xA;      ]&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>This will give you the desired results.</p>&#xA;
<p>The <code>must</code> needs to <strong>always</strong> match. <code>should</code> will only give a boost to the score <strong>if</strong> it matches.</p>&#xA;&#xA;<p>Also, there is another case when there are no <code>must</code> statements and in this case at least one <code>should</code> must match.</p>&#xA;&#xA;<p>I think you are looking for the following, instead:</p>&#xA;&#xA;<pre><code>{&#xA;  "query": {&#xA;    "bool": {&#xA;      "should": [&#xA;        {&#xA;          "bool": {&#xA;            "must": [&#xA;              {&#xA;                "multi_match": {&#xA;                  "query": "Predisposition",&#xA;                  "fields": [&#xA;                    "_all"&#xA;                  ]&#xA;                }&#xA;              },&#xA;              {&#xA;                "multi_match": {&#xA;                  "query": "thrombosis",&#xA;                  "fields": [&#xA;                    "_all"&#xA;                  ]&#xA;                }&#xA;              }&#xA;            ]&#xA;          }&#xA;        },&#xA;        {&#xA;          "bool": {&#xA;            "must": [&#xA;              {&#xA;                "multi_match": {&#xA;                  "query": "cancer",&#xA;                  "fields": [&#xA;                    "_all"&#xA;                  ]&#xA;                }&#xA;              }&#xA;            ]&#xA;          }&#xA;        }&#xA;      ]&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;