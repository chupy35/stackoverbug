33964318
es_rejected_execution_exception rejected execution
<p>I'm getting the following error when doing indexing.</p>&#xA;&#xA;<blockquote>&#xA;  <p><em>es_rejected_execution_exception rejected execution of org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryPhase$1@16248886&#xA;  on EsThreadPoolExecutor[bulk, queue capacity = 50,&#xA;  org.elasticsearch.common.util.concurrent.EsThreadPoolExecutor@739e3764[Running,&#xA;  pool size = 16, active threads = 16, queued tasks = 51, completed&#xA;  tasks = 407667]</em></p>&#xA;</blockquote>&#xA;&#xA;<p>My current setup:</p>&#xA;&#xA;<ul>&#xA;<li>Two nodes. One is the master (data: true, master: true) while the other one is data only (data: true, master: false). They are both EC2 I2.4XL (16 Cores, 122GB RAM, 320GB instance storage). 2 shards, 1 replication. </li>&#xA;<li>Those two nodes are being fed by our aggregation server which has 20 separate workers. Each worker makes bulk indexing request to our ES cluster with 50 items to index. Each item is between 1000-4000 characters.</li>&#xA;<li>Current server setup: 4x client facing servers -> aggregation server -> ElasticSearch. </li>&#xA;</ul>&#xA;&#xA;<p>Now the issue is this error only started occurring when we introduced the second node. Before when we had one machine, we got consistent indexing throughput of 20k request per second. Now with two machine, once it hits the 10k mark (~20% CPU usage)&#xA;we start getting some of the errors outlined above. </p>&#xA;&#xA;<p>But here is the interesting thing which I have noticed. We have a mock item generator which generates a random document to be indexed. Generally these documents are of the same size, but have random parameters. We use this to do the stress test and check the stability. This mock item generator sends requests to aggregation server which in turn passes them to Elasticsearch. The interesting thing is, we are able to index around 40-45k (@ ~80% CPU usage) items per second without getting this error. So it seems really interesting as to why we get this error. Has anyone seen this error or know what could be causing it? </p>&#xA;