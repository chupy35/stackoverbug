32255559
Modify default number of Elasticsearch shards
<p>If I have a 15 node cluster, do I have to change the </p>&#xA;&#xA;<p>index.number_of_shards</p>&#xA;&#xA;<p>value on all 15 nodes, and restart them, before the new value comes into effect for new indexes?</p>&#xA;
<p>Once you set the number of shards for an index in ElasticSearch, you cannot change them. You will need to create a new index with the desired number of shards, and depending on your use case, you may want then to transfer the data to the new index.</p>&#xA;&#xA;<p>I say depending on the use case because, for instance, if you are storing time based data such as log events, it is perfectly reasonable to close one index and open a new one with a different number of shards, and index all data going forward to that new index, keeping the old one for searches.</p>&#xA;&#xA;<p>However, if your use case is, for instance, storing blog documents, and your indices are by topic, then you will need to (a) create new indices as stated above with a different number of shards and (b) reindex your data. For (b) I recommend using the Scroll and Scan API to get the data out of the old index.</p>&#xA;
<p>That is right changing <code>index.number_of_shards</code> defaults in config file  would involve changing the setting on all nodes  and then restarting the instance ideally following the guidelines for <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/_rolling_restarts.html" rel="noreferrer">rolling restarts</a>.</p>&#xA;&#xA;<p>However if that is not an option and if explicitly specifying the <code>number_of_shards</code> in the settings while creating the new index is not ideal then the workaround would be  using <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-templates.html" rel="noreferrer">index templates</a></p>&#xA;&#xA;<p>Example:</p>&#xA;&#xA;<p>One can create an <code>index_defaults</code> default as below </p>&#xA;&#xA;<pre><code>PUT /_template/index_defaults &#xA;{&#xA;  "template": "*", &#xA;  "settings": {&#xA;    "number_of_shards": 4&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>This applies the setting specified in <code>index_defaults</code> template to all new indexes.</p>&#xA;
<p>Please remember that specifying the number of shards is a static operation and should be done when creating an index. But, any change after the index is created will require complete reindexing again which will take time.</p>&#xA;&#xA;<p>To create the number of shards when creating an index use this command. </p>&#xA;&#xA;<p><code>curl -XPUT ‘localhost:9200/my_sample_index?pretty’ -H ‘Content-Type: application/json’ -d’&#xA;{&#xA;  “settings:”{&#xA;    “number_of_shards”:2,&#xA;        “number_of_replicas”:0&#xA;  }&#xA;}</code></p>&#xA;&#xA;<p>you don't have to to run this on all the nodes. run them on any one node. All the nodes communicate with each other about the change to the elastic index.</p>&#xA;