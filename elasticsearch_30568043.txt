30568043
Elasticsearch query speed degrade
<p>I have elasticsearch(1.5.2) cluster (2 node with data) with 218M docs (22.3Gi). All elastic setting by default (5 shard and 1 replica), except memory: -Xmx5g -Xms5g</p>&#xA;&#xA;<p>My problem is that query request is very slow - 2sec. When index was small ~10K doc requery time was 100-200 ms. I'm running this with a load of 50 concurrent users and time increase up to 10-20 sec.</p>&#xA;&#xA;<p>Cluster machines:&#xA;2 dedicated vm nodes</p>&#xA;&#xA;<pre><code>Architecture:          x86_64&#xA;CPU(s):                16&#xA;Core(s) per socket:    8&#xA;Vendor ID:             GenuineIntel&#xA;Model name:            Intel(R) Xeon(R) CPU E5-2670 0 @ 2.60GHz&#xA;Memory:                16Gb&#xA;</code></pre>&#xA;&#xA;<p>Mapping:</p>&#xA;&#xA;<pre><code>{&#xA;"all": {&#xA;    "properties": {&#xA;        "schemarev": {&#xA;            "type": "long"&#xA;        },&#xA;        "schema": {&#xA;            "index": "not_analyzed",&#xA;            "type": "string"&#xA;        },&#xA;        "id": {&#xA;            "index": "not_analyzed",&#xA;            "type": "string"&#xA;        },&#xA;        "rev": {&#xA;            "type": "long"&#xA;        },&#xA;        "name": {&#xA;            "type": "string",&#xA;            "fields": {&#xA;                "raw": {&#xA;                    "index": "not_analyzed",&#xA;                    "type": "string"&#xA;                }&#xA;            }&#xA;        },&#xA;        "properties": {&#xA;            "properties": {&#xA;                "фио": {&#xA;                    "type": "string",&#xA;                    "fields": {&#xA;                        "raw": {&#xA;                            "index": "not_analyzed",&#xA;                            "type": "string"&#xA;                        }&#xA;                    }&#xA;                },&#xA;                "телефон": {&#xA;                    "type": "string",&#xA;                    "fields": {&#xA;                        "raw": {&#xA;                            "index": "not_analyzed",&#xA;                            "type": "string"&#xA;                        }&#xA;                    }&#xA;                },&#xA;                "возраст": {&#xA;                    "type": "integer"&#xA;                },&#xA;                "адрес": {&#xA;                    "type": "string",&#xA;                    "fields": {&#xA;                        "raw": {&#xA;                            "index": "not_analyzed",&#xA;                            "type": "string"&#xA;                        }&#xA;                    }&#xA;                },&#xA;                "email": {&#xA;                    "type": "string",&#xA;                    "fields": {&#xA;                        "raw": {&#xA;                            "index": "not_analyzed",&#xA;                            "type": "string"&#xA;                        }&#xA;                    }&#xA;                }&#xA;            },&#xA;            "type": "nested"&#xA;        },&#xA;        "_creator_id": {&#xA;            "index": "not_analyzed",&#xA;            "type": "string"&#xA;        },&#xA;        "type": {&#xA;            "index": "not_analyzed",&#xA;            "type": "string"&#xA;        },&#xA;        "schemaid": {&#xA;            "index": "not_analyzed",&#xA;            "type": "string"&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>}</p>&#xA;&#xA;<p>Document sample:</p>&#xA;&#xA;<pre><code>{&#xA;    "schemaId": "55eaf455-b0db-4359-95cd-b16b57ae7b3e",&#xA;    "name": "o1",&#xA;    "properties": {&#xA;        "фио": "asd",&#xA;        "телефон": "8967234",&#xA;        "адрес": "asfsdf",&#xA;        "возраст": 37&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Query like this, no aggregation: </p>&#xA;&#xA;<pre><code>{&#xA;    "match_all" : { }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>this size=10 and from=0</p>&#xA;&#xA;<p>Also in log there is:</p>&#xA;&#xA;<pre><code>[WARN ][monitor.jvm              ] [Master Order] [gc][young][50][9] duration [1s], collections [1]/[1.6s], total [1s]/[1.9s], memory [4.3gb]-&gt;[4.2gb]/[9.8gb], all_pools {[young] [748.1mb]-&gt;[32.5mb]/[865.3mb]}{[survivor] [108.1mb]-&gt;[108.1mb]/[108.1mb]}{[old] [3.4gb]-&gt;[4.1gb]/[8.9gb]}&#xA;</code></pre>&#xA;&#xA;<p>What can I do in this situation?</p>&#xA;