32364762
Can I reference the document itself in an elasticsearch query?
<p>I would like to get all documents where the value of fieldA is greater than the value of fieldB. What is the most efficient way to do this?</p>&#xA;&#xA;<p>Kind of like this:  </p>&#xA;&#xA;<pre><code>body: {&#xA;  query: {&#xA;    bool: {&#xA;      must: {&#xA;        range: {&#xA;          "fieldA": { gt: "this.fieldB" }&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;
<p>The most efficient way to do it is by indexing <code>fieldC</code> with the value of <code>fieldA - filedB</code> and using a range filter to find all records with <code>fieldC</code> greater than <code>0</code>. It can be also a boolean field that will have <code>true</code> if <code>fieldA</code> is greater than <code>fieldB</code> and <code>false</code> otherwise. </p>&#xA;&#xA;<p>If reindexing is not an option it's possible to use <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-script-filter.html" rel="nofollow">script filter</a> to perform this check, but it will essentially mean a full index scan for every search, so it is not going to scale.</p>&#xA;