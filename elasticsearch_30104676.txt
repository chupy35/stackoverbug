30104676
Elasticsearch and geo_shape
<p>I'm trying to add some geographic features to an existing application using <strong>elasticsearch 1.1.2</strong>. This application have some <code>person</code>, with an attribute <code>pin</code> representing a geolocalized point.</p>&#xA;&#xA;<p>Here is the mapping:</p>&#xA;&#xA;<pre><code>{"person":{"properties":{"pin":{"type":"geo_point"}}}}&#xA;</code></pre>&#xA;&#xA;<p>Here is the an example of an update of a person :</p>&#xA;&#xA;<pre><code>{"doc":{&#xA;  "full_name":"Oleta Yost",&#xA;  "pin":{"lat":47.123, "lon":-1.15}&#xA;}}&#xA;</code></pre>&#xA;&#xA;<p>And my query :</p>&#xA;&#xA;<pre><code>{ "from":0,&#xA;  "size":24,&#xA;  "query":{&#xA;    "filtered":{&#xA;      "filter":{&#xA;        "and":[&#xA;          {"or":[&#xA;            {"term": /* some term filter */ },&#xA;            {"term": /* some term filter */ }&#xA;          ]},&#xA;          { "geo_shape":{&#xA;              "person.pin":{&#xA;                "shape":{&#xA;                  "type":"envelope",&#xA;                  "coordinates":[[46,47],[-10,10]]&#xA;                }&#xA;              }&#xA;            }&#xA;          }&#xA;        ]&#xA;      },&#xA;      "query":{&#xA;        "query_string":{&#xA;          "fields":["person.full_name^10"],&#xA;          "query":"full_name:\"Oleta Yost\""&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>This query is raising an exception :</p>&#xA;&#xA;<pre><code>Field [person.pin] is not a geo_shape&#xA;</code></pre>&#xA;&#xA;<p>I tried a lot of solutions</p>&#xA;&#xA;<ul>&#xA;<li>using a string or an array to define my <code>pin</code> update, e.g.)</li>&#xA;<li><a href="https://github.com/elastic/elasticsearch/issues/10500" rel="nofollow">https://github.com/elastic/elasticsearch/issues/10500</a></li>&#xA;</ul>&#xA;&#xA;<p>I have no idea where is my issue... Can you point me ?</p>&#xA;
<p>The above query uses <a href="http://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-geo-shape-query.html" rel="nofollow">geoshape query</a> which works only on fields with type <a href="http://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-geo-shape-type.html" rel="nofollow">geoshape</a>.&#xA;In the above mapping the field is <a href="http://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-geo-point-type.html" rel="nofollow">geopoint</a>. </p>&#xA;&#xA;<p>One way would be to change the type to geoshape :</p>&#xA;&#xA;<pre><code>"person": {&#xA;      "properties": {&#xA;         "pin": {&#xA;            "type": "geo_shape"&#xA;         }&#xA;      }&#xA;   }&#xA;</code></pre>&#xA;&#xA;<p>And the json data for pin would be :</p>&#xA;&#xA;<pre><code>pin : {&#xA;   "type" : "Point",&#xA;   "coordinates" : [ 46,47]&#xA;}&#xA;</code></pre>&#xA;