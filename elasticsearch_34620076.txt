34620076
Elasticsearch nested query for getting threshold hit
<p>I have the nested index structure as following:</p>&#xA;&#xA;<pre><code>{&#xA;   "customersData": {&#xA;      "mappings": {&#xA;         "type1": {&#xA;            "properties": {&#xA;               "md5": {&#xA;                  "type": "string"&#xA;               },&#xA;               "uscan": {&#xA;                  "properties": {&#xA;                     "ibm": {&#xA;                        "properties": {&#xA;                           "found": {&#xA;                              "type": "boolean"&#xA;                           }&#xA;                        }&#xA;                     },&#xA;                      "google": {&#xA;                        "properties": {&#xA;                           "found": {&#xA;                              "type": "boolean"&#xA;                           }&#xA;                        }&#xA;                     },&#xA;                      "ebay": {&#xA;                        "properties": {&#xA;                           "found": {&#xA;                              "type": "boolean"&#xA;                           }&#xA;                        }&#xA;                     } &#xA;                     ...&#xA;                    }&#xA;                },&#xA;               "plink":{"type":"string"}&#xA;            }&#xA;        }&#xA;     }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>The example data such as: <code>uscan.ebay.found:true,uscan.ibm.found:true,uscan.google.found:false,...</code></p>&#xA;&#xA;<p>Each record may have one hundred customers, I wanna query the found=true greater than 5 (each record at least have 5 customers found=true). Any ideas please, thanks! </p>&#xA;
<p>You can use <code>minimum_should_match</code> for this to specify the minimum number of conditions in a <code>should</code> clause that should match. Use the query below:</p>&#xA;&#xA;<pre><code>{&#xA;  "query": {&#xA;    "bool": {&#xA;      "should": [&#xA;        {&#xA;          "term": {&#xA;            "uscan.ibm.found": true&#xA;          }&#xA;        },&#xA;        {&#xA;          "term": {&#xA;            "uscan.google.found": true&#xA;          }&#xA;        },&#xA;        {&#xA;          "term": {&#xA;            "uscan.ebay.found": true&#xA;          }&#xA;        },&#xA;        ... &#xA;      ],&#xA;      "minimum_number_should_match": 5&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;