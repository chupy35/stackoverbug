28899341
ElasticSearch - Different results for searching same index with 5 or 1 shards
<p>I am running a single node with ElasticSearch (1.4.4) and I have two indexes with the same documents indexed. The only difference is in the number of shards:</p>&#xA;&#xA;<ul>&#xA;<li>Index 1: 5 shards, 0 replicas</li>&#xA;<li>Index 2: 1 shard, 0 replicas</li>&#xA;</ul>&#xA;&#xA;<p>When I run a test of 100 different queries using the Java API, I get different results for each index. I have tried using DFS Query Then Fetch for both of them, but I still get different results.</p>&#xA;&#xA;<p>I am wondering what's happening. I am not sure how elasticsearch is performing the queries in order to get different results.</p>&#xA;&#xA;<p><strong>UPDATE:</strong></p>&#xA;&#xA;<p>These are the settings and mappings for my indexes:</p>&#xA;&#xA;<pre><code>"settings": {&#xA;      "number_of_shards" :   1, // or 5 for the other index&#xA;      "number_of_replicas" : 0,&#xA;      "analysis": {&#xA;               "filter": {&#xA;                  "worddelimiter": {&#xA;                     "type": "word_delimiter"&#xA;                  }&#xA;               },&#xA;               "analyzer": {&#xA;                  "custom_analyzer": {&#xA;                     "type": "custom",&#xA;                     "filter": [&#xA;                        "lowercase",&#xA;                        "asciifolding",&#xA;                        "worddelimiter"&#xA;                     ],&#xA;                     "tokenizer": "standard"&#xA;                  }&#xA;               }&#xA;            }&#xA;  }&#xA;&#xA;"mappings": {&#xA;     "faq": {&#xA;        "properties": {&#xA;           "answer": {&#xA;              "type": "string",&#xA;              "analyzer": "custom_analyzer"&#xA;           },&#xA;           "answer_id": {&#xA;              "type": "long"&#xA;           },&#xA;           "path": {&#xA;              "type": "string",&#xA;              "analyzer": "custom_analyzer"&#xA;           },&#xA;           "question": {&#xA;              "type": "string",&#xA;              "analyzer": "custom_analyzer"&#xA;           }&#xA;        }&#xA;     }&#xA;  }&#xA;</code></pre>&#xA;&#xA;<p>And this is the query:</p>&#xA;&#xA;<pre><code>client.prepareSearch(index)&#xA;                    .setTypes(type)&#xA;                    .setSearchType(SearchType.DFS_QUERY_THEN_FETCH) &#xA;                    .setQuery(QueryBuilders.multiMatchQuery(inputText, "questions","answer^2","paths")&#xA;                    .setSize(BUFFER_SIZE)&#xA;                    .setFrom(i * BUFFER_SIZE)&#xA;                    .execute()&#xA;                    .actionGet();&#xA;</code></pre>&#xA;