33802054
How to debug when the index size is too large in elasticsearch?
<p>Im indexing only 1000 documents and the index shows a size 0f 300MB. This doesnt look normal. How can I debug this behavior and check if something is wrong?</p>&#xA;
<p>The weight of an index is not only made of the document bytes, but also the deleted documents, which are all the old versions of the documents + all the ones that have been deleted. Every time your re-index a document with the same ID, the old version that was previously stored goes to the deleted segments, and as a result, the size of your index grows. </p>&#xA;&#xA;<p>You can try to <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-optimize.html" rel="nofollow">optimize</a> your index with <code>max_num_segments=1</code></p>&#xA;&#xA;<pre><code>curl -XPOST 'http://localhost:9200/your_index/_optimize?max_num_segments=1'&#xA;</code></pre>&#xA;&#xA;<p><strong>UPDATE</strong></p>&#xA;&#xA;<p>Note that as of ES 2.1, the Optimize API has been deprecated and renamed to <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-forcemerge.html" rel="nofollow">Force Merge API</a></p>&#xA;
<p>I feel you might have some large documents or malformed documents with lots of data that your code added by bug. This has happened to me. What i did was to enable size parameter in the mapping and then i did a sort based on size to see which document has the highest size.</p>&#xA;&#xA;<p>Size mapping - <a href="https://www.elastic.co/guide/en/elasticsearch/reference/1.4/mapping-size-field.html" rel="nofollow">https://www.elastic.co/guide/en/elasticsearch/reference/1.4/mapping-size-field.html</a></p>&#xA;&#xA;<p>Once this is done , just so a sort like below - </p>&#xA;&#xA;<pre><code>{&#xA;  "sort": {&#xA;    "_size": {&#xA;      "order": "desc"&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;