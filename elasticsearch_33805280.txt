33805280
Elastic Search fulltext search query and filters
<p>I wanna perform a full-text search, but I also wanna use one or many possible filters. The simplified structure of my document, when searching with <code>/things/_search?q=*foo*</code>:</p>&#xA;&#xA;<pre><code>{&#xA;    "took": 5,&#xA;    "timed_out": false,&#xA;    "_shards": {&#xA;        "total": 1,&#xA;        "successful": 1,&#xA;        "failed": 0&#xA;    },&#xA;    "hits": {&#xA;        "total": 1,&#xA;        "max_score": 1,&#xA;        "hits": [&#xA;            {&#xA;                "_index": "things",&#xA;                "_type": "thing",&#xA;                "_id": "63",&#xA;                "_score": 1,&#xA;                "fields": {&#xA;                    "name": [&#xA;                        "foo bar"&#xA;                    ],&#xA;                    "description": [&#xA;                        "this is my description"&#xA;                    ],&#xA;                    "type": [&#xA;                        "inanimate"&#xA;                    ]&#xA;                }&#xA;            }&#xA;        ]&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>This works well enough, but how do I combine filters with a query? Let's say I wanna search for "foo" in an index with multiple documents, but I only want to get those with type == "inanimate"?</p>&#xA;&#xA;<p>This is my attempt so far:</p>&#xA;&#xA;<pre><code>{&#xA;    "query": {&#xA;        "filtered": {&#xA;            "query": {&#xA;                "query_string": {&#xA;                    "query": "*foo*"&#xA;                }&#xA;            },&#xA;            "filter": {&#xA;                "bool": {&#xA;                    "must": {&#xA;                        "term": { "type": "inanimate" }&#xA;                    }&#xA;                }&#xA;            }&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>When I remove the <code>filter</code> part, it returns an accurate set of document hits. But with this filter-definition it does not return anything, even though I can manually verify that there are documents with <code>type == "inanimate"</code>.</p>&#xA;
<p>Since you have not done explicit mapping, <code>term</code> query is looking for an <strong>exact</strong> match. you need to add <code>"index : not_analyzed"</code> to <em>type</em> field and then your query will work.</p>&#xA;&#xA;<p>This will give you correct documents</p>&#xA;&#xA;<pre><code>{&#xA;  "query": {&#xA;    "match": {&#xA;      "type": "inanimate"&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>but this is not the solution, You need do explicit mapping as I said.</p>&#xA;