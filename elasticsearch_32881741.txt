32881741
not equal query in elasticsearch
<p>I have a field in my index contain a string data.. I run dsl query below expected documents which category fields is not equal to "-" character.. but as you see pic it returns.. &#xA;What is the way of retrieve these data ? </p>&#xA;&#xA;<pre><code>GET webproxylog/_search&#xA;{&#xA;  "query": {&#xA;    "filtered": {&#xA;      "query": {"match_all": {}},&#xA;      "filter": {&#xA;        "not": {&#xA;          "filter": {&#xA;            "term": {&#xA;              "category": "-"&#xA;            }&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p><a href="https://i.stack.imgur.com/MWqnx.png" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/MWqnx.png" alt="enter image description here"></a></p>&#xA;&#xA;<p>mappings:</p>&#xA;&#xA;<pre><code>{&#xA;   "webproxylog": {&#xA;      "mappings": {&#xA;         "accesslog": {&#xA;            "properties": {&#xA;               "category": {&#xA;                  "type": "string"&#xA;               },&#xA;               "clientip": {&#xA;                  "type": "string",&#xA;                  "index": "not_analyzed"&#xA;               },&#xA;               "clientmac": {&#xA;                  "type": "string",&#xA;                  "index": "not_analyzed"&#xA;               },&#xA;               "clientname": {&#xA;                  "type": "string"&#xA;               },&#xA;               "duration": {&#xA;                  "type": "long"&#xA;               },&#xA;               "filetype": {&#xA;                  "type": "string",&#xA;                  "index": "not_analyzed"&#xA;               },&#xA;               "hierarchycode": {&#xA;                  "type": "string",&#xA;                  "index": "not_analyzed"&#xA;               },&#xA;               "loggingdate": {&#xA;                  "type": "date",&#xA;                  "format": "dateOptionalTime"&#xA;               },&#xA;               "reqmethod": {&#xA;                  "type": "string",&#xA;                  "index": "not_analyzed"&#xA;               },&#xA;               "respsize": {&#xA;                  "type": "long"&#xA;               },&#xA;               "resultcode": {&#xA;                  "type": "string",&#xA;                  "index": "not_analyzed"&#xA;               },&#xA;               "url": {&#xA;                  "type": "string",&#xA;                  "index": "not_analyzed"&#xA;               },&#xA;               "user": {&#xA;                  "type": "string",&#xA;                  "index": "not_analyzed"&#xA;               }&#xA;            }&#xA;         }&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;
<p>My test with ES 1.7.1:</p>&#xA;&#xA;<pre><code>{&#xA;  "settings": {&#xA;    "number_of_shards": 1,&#xA;    "number_of_replicas": 0&#xA;  },&#xA;  "mappings": {&#xA;    "user": {&#xA;      "properties": {&#xA;        "number": { "type": "integer" },&#xA;        "name": {&#xA;          "type": "string",&#xA;          "index": "not_analyzed"&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>docs:</p>&#xA;&#xA;<pre><code>{"number":1, "name":"abc"}&#xA;{"number":2, "name":"-"}&#xA;</code></pre>&#xA;&#xA;<p>Query:</p>&#xA;&#xA;<pre><code>{&#xA;  "size": 2,&#xA;  "query": {&#xA;    "filtered": {&#xA;      "filter": {&#xA;        "not": {&#xA;          "term": {&#xA;            "name": "-"&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Result:</p>&#xA;&#xA;<pre><code>{&#xA;    took: 1&#xA;    timed_out: false&#xA;    _shards: {&#xA;        total: 1&#xA;        successful: 1&#xA;        failed: 0&#xA;    }&#xA;    hits: {&#xA;        total: 1&#xA;        max_score: 1&#xA;        hits: [&#xA;            {&#xA;                _index: test_index&#xA;                _type: user&#xA;                _id: AVAiYtEjMfj2vcjSSqVr&#xA;                _score: 1&#xA;                _source: {&#xA;                    number: 1&#xA;                    name: abc&#xA;                }&#xA;            }&#xA;        ]&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Without <code>"index": "not_analyzed"</code> I see the reported behavior, I didn't check how "-" gets tokenized in that case (forgot the query to do that :P)</p>&#xA;