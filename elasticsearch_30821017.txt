30821017
Elasticsearch order by type
<p>I'm searching an index with multiple types by simply using '<a href="http://es:9200/products/_search?q=sony">http://es:9200/products/_search?q=sony</a>'. This will return a lot of hits with many different types. The hits array contains all the results but not in the order I want it to; i want the 'television' type to always show before the rest. Is it possible at all to order by type?</p>&#xA;
<p>You can achieve this by <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-sort.html" rel="nofollow"><code>sorting</code></a> on the pre-defined field <code>_type</code>. The query below sorts results in ascending order of document types.</p>&#xA;&#xA;<pre><code>POST &lt;indexname&gt;/_search&#xA;{&#xA;   "sort": [&#xA;      {&#xA;         "_type": {&#xA;            "order": "asc"&#xA;         }&#xA;      }&#xA;   ],&#xA;   "query": {&#xA;      &lt;query goes here&gt;&#xA;   }&#xA;}&#xA;</code></pre>&#xA;
<p>I do it by adding a numeric field <code>_is_OF_TYPE</code> to the indexed documents and set it to <code>1</code> for those docs that are of the given type. Then just sort on those fields in any order you want.</p>&#xA;&#xA;<p>For example:</p>&#xA;&#xA;<pre><code>Document A:&#xA;{ &#xA;   _is_television: 1,&#xA;   ... some television props here ...&#xA;}&#xA;&#xA;Document B:&#xA;{ &#xA;   _is_television: 1,&#xA;   ... another television props here ...&#xA;}&#xA;&#xA;Document C:&#xA;{ &#xA;   _is_radio: 1,&#xA;   ... some radio props here ...&#xA;}&#xA;&#xA;and so on...&#xA;</code></pre>&#xA;&#xA;<p>Then in ElasricSearch query:</p>&#xA;&#xA;<pre><code>POST radio,television,foo,bar,baz/_search&#xA;{&#xA;   "sort": [&#xA;      {"_is_television":   {"unmapped_type" : "long"}},  // television goes first&#xA;      {"_is_radio":        {"unmapped_type" : "long"}},  // then radio&#xA;      {"_is_another_type": {"unmapped_type" : "long"}}   // ... and so on&#xA;   ]&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>The benefit of this solution is speed. You simply sort on numeric fields. No script sorting required.</p>&#xA;