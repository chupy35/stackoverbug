34287934
How can I exclude an array of ids from a query_string in Elastic Search?
<p>I have a query String like this: </p>&#xA;&#xA;<pre><code>"(( name_first.raw:goda )) AND !( _uid:*566ade1cec8d83647a000061* OR _uid:*566ade1cec8d83647a000062* OR _uid:*566ade1cec8d83647a000063* OR _uid:*566ade1cec8d83647a000064*)"&#xA;</code></pre>&#xA;&#xA;<p>How can I write this query in a more efficient way?</p>&#xA;
<p>I think this would work,</p>&#xA;&#xA;<pre><code>GET /yourindex/yourType/_search&#xA;{&#xA;    "query": {&#xA;        "filtered": {&#xA;           "query": {&#xA;           "match": {&#xA;              "name_first.raw": "goda"&#xA;           }&#xA;           },&#xA;           "filter": {&#xA;               "bool": {&#xA;                   "must_not": [&#xA;                      {&#xA;                          "terms": {&#xA;                             "_uid": [&#xA;                                "566ade1cec8d83647a000061",&#xA;                                "566ade1cec8d83647a000062",&#xA;                                "566ade1cec8d83647a000063"&#xA;                             ]&#xA;                          }&#xA;                      }&#xA;                   ]&#xA;               }&#xA;           }&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;
<p>You can use the query below:    </p>&#xA;&#xA;<pre><code>POST &lt;index&gt;/&lt;type&gt;/_search&#xA;{&#xA;  "query": {&#xA;    "filtered": {&#xA;      "query": {&#xA;        "term": {&#xA;          "name_first.raw": "goda"&#xA;        }&#xA;      },&#xA;      "filter": {&#xA;        "bool": {&#xA;          "must_not": [&#xA;            {&#xA;              "terms": {&#xA;                "_uid": [&#xA;                  "566ade1cec8d83647a000061",&#xA;                  "566ade1cec8d83647a000062",&#xA;                  "566ade1cec8d83647a000063"&#xA;                ]&#xA;              }&#xA;            }&#xA;          ]&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;
<p>This should work, (<code>+</code> => "must" and <code>-</code> => "must_not")</p>&#xA;&#xA;<pre><code>"+name_first.raw:goda -_uid:*566ade1cec8d83647a000061* -_uid:*566ade1cec8d83647a000062* -_uid:*566ade1cec8d83647a000063*  -_uid:*566ade1cec8d83647a000064*"&#xA;</code></pre>&#xA;&#xA;<p>What worries me is that the processing of the leading wildcards could really slow this down.  Do you absolutely need wildcards?  If you find yourself needing to optimize this, and can start using the DSL, check out <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.1/search-request-post-filter.html" rel="nofollow">post_filter</a> for your exclusion criteria.</p>&#xA;