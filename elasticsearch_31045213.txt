31045213
elasticsearch: All primary shards become inactive when restart a single node cluster
<p>I started a new elasticsearch cluster and added a new index, then I shut it down.&#xA;When I try to start it again there is no active shards any more. All the shards became inactive and unassigned.&#xA;I use this index settings below:</p>&#xA;&#xA;<pre><code>"settings": {&#xA;            "number_of_shards": 32,&#xA;            "number_of_replicas": 3&#xA;        }&#xA;</code></pre>&#xA;&#xA;<p>Here is health output:</p>&#xA;&#xA;<pre><code>{&#xA;  "cluster_name" : "sailcraft",&#xA;  "status" : "red",&#xA;  "timed_out" : false,&#xA;  "number_of_nodes" : 1,&#xA;  "number_of_data_nodes" : 1,&#xA;  "active_primary_shards" : 0,&#xA;  "active_shards" : 0,&#xA;  "relocating_shards" : 0,&#xA;  "initializing_shards" : 0,&#xA;  "unassigned_shards" : 128,&#xA;  "number_of_pending_tasks" : 0&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Here is the <a href="https://stackoverflow.com/questions/20729704/cannot-seem-to-restart-elastic-search-without-red-status?answertab=active#tab-top">same problem which has been marked solved</a>. But I don't think that's the solution. </p>&#xA;&#xA;<p>EDIT:</p>&#xA;&#xA;<p>It's the same question but I think that post does not get the right answer. It said that we need 2 more nodes if we have 2 more replica shards. I read all the related docs and there is not any such restrictions.</p>&#xA;&#xA;<p>EDIT2:&#xA;<strong>Solution:&#xA;he setting index.recovery.initial_shards provides the following:&#xA;Basically, when using a local gateway, a "shard" will be recovered once a quorum of its copies are found among the nodes in the cluster.&#xA;Lets take N shard, with 1 replica (2 copies for each shard). The default (quorum) means that once a singe copy of a shard is found, it will be recovered. If you have 2 replicas (3 copies), it will only recover that shard once 2 copies are found.&#xA;You can set this setting, in case you lost a large number of nodes, and quorum is a too strict setting. You can actually set it on a "live" index (which is in a "red" state, obviously, because not all shards are recovered).</strong></p>&#xA;
<p>Here's <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-update-settings.html" rel="nofollow">the documentation</a> mentioning this. Indeed, it's not evident, but it's there:</p>&#xA;&#xA;<blockquote>&#xA;  <p><code>index.recovery.initial_shards</code></p>&#xA;  &#xA;  <p>When using local gateway a particular shard is recovered only if there can be allocated quorum shards in the cluster. It can be set to:</p>&#xA;  &#xA;  <p>quorum (default)</p>&#xA;  &#xA;  <p>quorum-1 (or half)</p>&#xA;  &#xA;  <p>full</p>&#xA;  &#xA;  <p>full-1.</p>&#xA;  &#xA;  <p>Number values are also supported, e.g. 1.</p>&#xA;</blockquote>&#xA;&#xA;<p>If you really want to have your node running, set <code>index.recovery.initial_shards: 1</code> in <code>elasticsearch.yml</code> file.</p>&#xA;