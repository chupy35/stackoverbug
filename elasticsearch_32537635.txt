32537635
elasticsearch run any query on field exists
<p>I want to run the any query/filter based on the field exists. In our case if user answers a particular field then only we will store that value, other wise will not store that field it self. How can I run the query?</p>&#xA;&#xA;<p>Below is my mapping:</p>&#xA;&#xA;<pre><code>"mappings": {&#xA;     "responses_10_57": {&#xA;        "properties": {&#xA;           "rid: {&#xA;              "type": "long"&#xA;           },&#xA;           "end_time": {&#xA;              "type": "date",&#xA;              "format": "dateOptionalTime"&#xA;           },&#xA;           "start_time": {&#xA;              "type": "date",&#xA;              "format": "dateOptionalTime"&#xA;           },&#xA;       "qid_1": {&#xA;              "type": "string",&#xA;              "fields": {&#xA;                 "raw": {&#xA;                    "type": "string",&#xA;                    "analyzer": "str_params"&#xA;                 }&#xA;              }&#xA;           },&#xA;    "qid_2": {&#xA;              "type": "string",&#xA;              "fields": {&#xA;                 "raw": {&#xA;                    "type": "string",&#xA;                    "analyzer": "str_params"&#xA;                 }&#xA;              }&#xA;           },&#xA;    "qid_3": {&#xA;              "properties": {&#xA;                 "msg_text": {&#xA;                    "type": "string"&#xA;                 },&#xA;         "msg_tags": {&#xA;                    "type": "string",&#xA;                    "fields": {&#xA;                       "raw": {&#xA;                          "type": "string",&#xA;                          "analyzer": "str_params"&#xA;                       }&#xA;                    }&#xA;                 }&#xA;              }&#xA;           }&#xA;   }&#xA;  }&#xA;</code></pre>&#xA;&#xA;<p>}</p>&#xA;&#xA;<p>qid_1 is the name field, qid_2 is the category field, qid_3 is the text message field.</p>&#xA;&#xA;<p>But the qid_3 is not a mandatory field. So we will not insert the record if user doesn't entered any text message.</p>&#xA;&#xA;<p>1) I want each category wide count those who responded the third question. </p>&#xA;&#xA;<p>2) I have to search the names who answered the third question.</p>&#xA;&#xA;<p>How can I write these two queries?</p>&#xA;
<p>Both queries should have an <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-exists-filter.html" rel="nofollow noreferrer" title="exists filter">exists filter</a> to limit the response to only those documents where the qid_3 exists (is not null). For your first query you could try a <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-terms-aggregation.html#search-aggregations-bucket-terms-aggregation" rel="nofollow noreferrer">terms aggregation</a>. For your second query, you can filter the source to include only the names in the response or <a href="https://stackoverflow.com/questions/17103047/why-do-i-need-storeyes-in-elasticsearch">store the field</a> and use <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-fields.html" rel="nofollow noreferrer">fields</a>.</p>&#xA;&#xA;<p>1)</p>&#xA;&#xA;<pre><code>{&#xA;    "size": 0,&#xA;    "filter" : {&#xA;        "exists" : { "field" : "quid_3" }&#xA;    },&#xA;    "aggs" : {&#xA;      "group_by_category" : {&#xA;        "terms" : { "field" : "qid_2" }&#xA;      }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>2)</p>&#xA;&#xA;<pre><code>{&#xA;  "filter" : {&#xA;    "exists" : { "field" : "quid_3" }&#xA;  },&#xA;  "_source": [ "qid_1"]&#xA;}&#xA;</code></pre>&#xA;