34449342
Installed elastic search on server but cannot connect to it if from another machine
<p><strong>Context</strong></p>&#xA;&#xA;<p>Have just started using <code>elastic search</code>, installed it on server, can <code>curl</code> and <code>telnet</code> to <code>port 9200</code> on <code>local machine(server)</code> but cannot connect to it if from another machine.</p>&#xA;&#xA;<p>I disabled firewall on both the server and client as solutions I got from internet were suggesting and also tried suggestions found on the link below but couldn't get it working.</p>&#xA;&#xA;<p><a href="https://discuss.elastic.co/t/accessing-port-9200-remotely/21840" rel="noreferrer">https://discuss.elastic.co/t/accessing-port-9200-remotely/21840</a> </p>&#xA;&#xA;<p><strong>Question</strong></p>&#xA;&#xA;<p>Can some one help me on how to get this working, thanks in advance</p>&#xA;
<p>Since you just installed Elasticsearch, I suppose you're using ES 2.0 or 2.1. You need to know that since the 2.0 release, Elasticsearch <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/breaking_20_network_changes.html#_bind_to_localhost">binds to localhost by default</a> (as a security measure to prevent your node from connecting to other nodes on the network without you knowing it). </p>&#xA;&#xA;<p>So what you need to do is simply to edit your <code>elasticsearch.yml</code> configuration file and change the <code>network.bind_host</code> setting like this:</p>&#xA;&#xA;<pre><code>network.bind_host: 0&#xA;</code></pre>&#xA;&#xA;<p>Then, you need to restart your node and it will be accessible from a remote host.</p>&#xA;
<p>Let's recreate your scenario. I started freshly installed elasticsearch on my machine. Now I am able to perform curl on <strong>port 9200</strong></p>&#xA;&#xA;<pre><code>[root@kali ~]# hostname -i&#xA;192.168.109.128&#xA;&#xA;[root@kali ~]# curl http://localhost:9200&#xA;&#xA;{&#xA;  "status" : 200,&#xA;  "name" : "Kali Node",&#xA;  "cluster_name" : "kali",&#xA;  "version" : {&#xA;    "number" : "1.7.1",&#xA;    "build_hash" : "b88f43fc40b0bcd7f173a1f9ee2e97816de80b19",&#xA;    "build_timestamp" : "2015-07-29T09:54:16Z",&#xA;    "build_snapshot" : false,&#xA;    "lucene_version" : "4.10.4"&#xA;  },&#xA;  "tagline" : "You Know, for Search"&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>If you check the listening tcp ports on your server that java service has opened.</p>&#xA;&#xA;<pre><code>[root@kali ~]# netstat -ntlp | awk '/[j]ava/'&#xA;tcp6       0      0 127.0.0.1:9200          :::*                    LISTEN      3422/java&#xA;&#xA;tcp6       0      0 127.0.0.1:9300          :::*                    LISTEN      3422/java&#xA;</code></pre>&#xA;&#xA;<p>You can see elasticsearch is listening on <strong>127.0.0.1</strong> so it is obvious that you can't access port 9200 from the network. Let's verify it using wget from remote server.</p>&#xA;&#xA;<pre><code>$ wget.exe 192.168.109.128:9200&#xA;&#xA;--2015-12-25 13:30:18--  http://192.168.109.128:9200/&#xA;Connecting to 192.168.109.128:9200... failed: Connection refused.&#xA;</code></pre>&#xA;&#xA;<p>lets change the elasticsearch configuration to fix the issue using below command</p>&#xA;&#xA;<pre><code>[root@kali ~]# sed -i '/^network.bind_host:/s/network.bind_host: .*/network.bind_host: 0.0.0.0/' /etc/elasticsearch/elasticsearch.yml&#xA;</code></pre>&#xA;&#xA;<p>or </p>&#xA;&#xA;<p>just open elasticsearch configuration file and find "<strong>network.bind_host</strong>" and do following changes below</p>&#xA;&#xA;<pre><code>network.bind_host: 0.0.0.0&#xA;</code></pre>&#xA;&#xA;<p>then restart your elasticsearch service</p>&#xA;&#xA;<pre><code>[root@kali ~]# service elasticsearch restart&#xA;Restarting elasticsearch (via systemctl):                  [  OK  ]&#xA;&#xA;Now lets check the listening tcp port of java&#xA;&#xA;[root@kali ~]# netstat -ntlp | awk '/[j]ava/'&#xA;&#xA;tcp6       0      0 :::9200                 :::*                    LISTEN      3759/java&#xA;&#xA;tcp6       0      0 :::9300                 :::*                    LISTEN      3759/java&#xA;</code></pre>&#xA;&#xA;<p>Now you can it is listening on all interface.</p>&#xA;&#xA;<p>Lets try the wget command from remote machine</p>&#xA;&#xA;<pre><code>$ wget.exe 192.168.109.128:9200&#xA;&#xA;--2015-12-25 13:39:12--  http://192.168.109.128:9200/&#xA;Connecting to 192.168.109.128:9200... connected.&#xA;HTTP request sent, awaiting response... 200 OK&#xA;Length: 328 [application/json]&#xA;Saving to: ‘index.html.1’&#xA;&#xA;index.html.1                   100%[====================================================&gt;]     328  --.-KB/s   in 0.009s&#xA;&#xA;2015-12-25 13:39:12 (37.1 KB/s) - ‘index.html.1’ saved [328/328]&#xA;&#xA;Try curl command&#xA;&#xA;$ curl.exe http://192.168.109.128:9200&#xA;&#xA;{&#xA;  "status" : 200,&#xA;  "name" : "Kali Node",&#xA;  "cluster_name" : "kali",&#xA;  "version" : {&#xA;    "number" : "1.7.1",&#xA;    "build_hash" : "b88f43fc40b0bcd7f173a1f9ee2e97816de80b19",&#xA;    "build_timestamp" : "2015-07-29T09:54:16Z",&#xA;    "build_snapshot" : false,&#xA;    "lucene_version" : "4.10.4"&#xA;  },&#xA;  "tagline" : "You Know, for Search"&#xA;}&#xA;</code></pre>&#xA;
<p>For ElasticSearch version 5, you can edit the configuration file <code>/etc/elasticsearch/elasticsearch.yml</code> and add the following lines </p>&#xA;&#xA;<pre><code>network.bind_host: 0&#xA;http.cors.allow-origin: "*"&#xA;http.cors.enabled: true&#xA;</code></pre>&#xA;&#xA;<p>The cors are needed for plugins like Head or HQ on remote machine, because they make Ajax XMLHttpRequest requests </p>&#xA;&#xA;<p>You can also define <code>network.host: 0</code> since it is a shortcut which sets the bind_host and the publish_host</p>&#xA;&#xA;<p>Sources:</p>&#xA;&#xA;<ul>&#xA;<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-http.html" rel="nofollow noreferrer">https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-http.html</a></li>&#xA;<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-network.html" rel="nofollow noreferrer">https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-network.html</a></li>&#xA;</ul>&#xA;