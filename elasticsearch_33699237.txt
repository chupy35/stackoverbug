33699237
Elastic Search Won't Match For Arrays
<p>I'm trying to search a document with the following structure:</p>&#xA;&#xA;<pre><code>  {&#xA;        "_index": "XXX",&#xA;        "_type": "business",&#xA;        "_id": "1252809",&#xA;        "_score": 1,&#xA;        "_source": {&#xA;           "url": "http://Samuraijapanese.com",&#xA;           "raw_name": "Samurai Restaurant",&#xA;           "categories": [&#xA;              {&#xA;                 "name": "Cafe"&#xA;              },&#xA;              {&#xA;                 "name": "Cajun Restaurant"&#xA;              },&#xA;              {&#xA;                 "name": "Candy Stores"&#xA;              }&#xA;           ],&#xA;           "location": {&#xA;              "lat": "32.9948649",&#xA;              "lon": "-117.2528171"&#xA;           },&#xA;           "address": "979 Lomas Santa Fe Dr",&#xA;           "zip": "92075",&#xA;           "phone": "8584810032",&#xA;           "short_name": "samurai-restaurant",&#xA;           "name": "Samurai Restaurant",&#xA;           "apt": "",&#xA;           "state": "CA",&#xA;           "stdhours": "",&#xA;           "city": "Solana Beach",&#xA;           "hours": "",&#xA;           "yelp": "",&#xA;           "twitter": "",&#xA;           "closed": 0&#xA;        }&#xA;     }&#xA;</code></pre>&#xA;&#xA;<p>Searching it for url, raw_name, address, etc, all work, but searching the categories returns nothing. I'm trying to search like so: If I switch anything else in for categories.name it works:</p>&#xA;&#xA;<pre><code>"query": {&#xA;  "filtered" : {&#xA;     "filter" : {&#xA;        "geo_distance" : {&#xA;           "location" : {&#xA;              "lon" : "-117.15726",&#xA;              "lat" : "32.71533"&#xA;           },&#xA;           "distance" : "5mi"&#xA;        }&#xA;     },&#xA;     "query" : {&#xA;        "multi_match" : {&#xA;           "query" : "Cafe",&#xA;           "fields" : [&#xA;              "categories.name"&#xA;           ]&#xA;        }&#xA;     }&#xA;  }&#xA;&#xA;&#xA; },&#xA;  "sort": [&#xA;    {&#xA;     "_score" : {&#xA;        "order" : "desc"&#xA;     }&#xA;    },&#xA;    {&#xA;      "_geo_distance": {&#xA;        "location": {&#xA;          "lat": 32.71533,&#xA;          "lon": -117.15726&#xA;        },&#xA;        "order": "asc",&#xA;        "sort_mode": "min"&#xA;      }&#xA;    }&#xA;  ],&#xA;  "script_fields": {&#xA;    "distance_from_origin": {&#xA;      "script": "doc['location'].arcDistanceInKm(32.71533,-117.15726)"&#xA;    }&#xA;  },&#xA;  "fields": ["_source"],&#xA;  "from": 0,&#xA;  "size": 10&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>If I switch out, for example, categories.name with address, and change the search term to Lomas, it returns the result</p>&#xA;
<p>Without seeing your type mapping I can't answer definitively, but I would guess you have mapped categories as <code>nested</code>. When querying sub-documents of type <code>nested</code> (opposed to <code>object</code>) you have to use a <a href="https://www.elastic.co/guide/en/elasticsearch/reference/1.4/query-dsl-nested-query.html" rel="nofollow">nested query</a>.</p>&#xA;