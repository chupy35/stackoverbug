33953234
what's difference between "filter and aggs" and "filter in aggs"
<p>I got two ways to aggs my data.</p>&#xA;&#xA;<p>First, i filter mysql data and aggs it </p>&#xA;&#xA;<p>Second ,i aggs data which is filtered in aggs.&#xA;as below:</p>&#xA;&#xA;<p>I found different result and I don't know why.</p>&#xA;&#xA;<p>Anyone can explain it ?</p>&#xA;&#xA;<p><a href="https://i.stack.imgur.com/0ScN3.jpg" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/0ScN3.jpg" alt="case 1"></a></p>&#xA;&#xA;<p><a href="https://i.stack.imgur.com/j3Sy1.jpg" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/j3Sy1.jpg" alt="case 2"></a></p>&#xA;
<p>From the <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/_scoping_aggregations.html" rel="nofollow">Docs</a></p>&#xA;&#xA;<blockquote>&#xA;  <p>By default, aggregations operate in the same scope as the query. Put another way, aggregations are calculated on the set of documents that match your query.</p>&#xA;</blockquote>&#xA;&#xA;<p>so in the first case, you are getting documents which match your criteria of <code>"site_id" : 1167639</code> and then <code>aggregation</code> is performed on those documents.</p>&#xA;&#xA;<p>In the second case, you have not specified any query so by default it is <code>match_all</code> query and you get back all the documents in your <code>hits</code> which is 65773792. Then you use <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.0/search-aggregations-bucket-filter-aggregation.html" rel="nofollow">filter</a> to narrow down your aggregation criteria.</p>&#xA;