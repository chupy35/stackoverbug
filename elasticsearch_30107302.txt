30107302
Inconsistent doc count
<p>Hi I am running Elasticsearch 1.5.2</p>&#xA;&#xA;<p>I indexed 6,761,727 documents in one of my indexes.</p>&#xA;&#xA;<p>When I run the following query....</p>&#xA;&#xA;<pre><code>GET myindex/mytype/_search&#xA;{&#xA;    "size": 0&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>The hits.total count keeps alternating between 2 values...</p>&#xA;&#xA;<pre><code>"hits": {&#xA;    "total": 6761727,&#xA;    "max_score": 0,&#xA;    "hits": []&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>and</p>&#xA;&#xA;<pre><code>"hits": {&#xA;    "total": 6760368,&#xA;    "max_score": 0,&#xA;    "hits": []&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>No matter how many times I run the query the count goes back and forth between the 2.</p>&#xA;&#xA;<p>I searched around a bit and found out that it seems that primary vs replica shards don't have exact same number of docs. If I use preference=primary then the doc count returned is correct.</p>&#xA;&#xA;<p>What is the easiest way to check which shard is the culprit and try to fix him without re-indexing everything?</p>&#xA;
<p>Set the replica count to 0 for that index </p>&#xA;&#xA;&#xA;&#xA;<pre><code>PUT /my_index/_settings&#xA;{&#xA;  "index": {&#xA;    "number_of_replicas": 0&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>wait to see no more replicas for that index when you do <code>GET /_cat/shards/my_index?v</code> and then set back to the initial number of replicas.</p>&#xA;&#xA;<p>This will delete all the replicas for that index and then make a new copy of the primaries.</p>&#xA;