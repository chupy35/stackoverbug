29504051
Fielddata never gets evicted even though it uses more than indices.fielddata.cache.size
<p>We set <code>indices.fielddata.cache.size = '6gb'</code> but even though the field data cache uses more than that, evictions are never happening. The circuit breaker eventually triggers:</p>&#xA;&#xA;<p><code>"RemoteTransportException[[elasticsearch][inet[/0.0.0.0:9300]][indices:data/read/search[phase/query]]]; nested: ElasticsearchException[org.elasticsearch.common.breaker.CircuitBreakingException: [FIELDDATA] Data too large, data for [myField] would be larger than limit of [9437184000/8.7gb]]; nested: UncheckedExecutionException[org.elasticsearch.common.breaker.CircuitBreakingException: [FIELDDATA] Data too large, data for [myField] would be larger than limit of [9437184000/8.7gb]]; nested: CircuitBreakingException[[FIELDDATA] Data too large, data for [myField] would be larger than limit of [9437184000/8.7gb]];</code></p>&#xA;&#xA;<p>All the field data settings:</p>&#xA;&#xA;<pre><code>indices.fielddata.cache.size: "6gb"&#xA;indices.breaker.fielddata.limit: "60%"&#xA;indices.breaker.request.limit: "30%"&#xA;indices.breaker.total.limit: "70%"&#xA;</code></pre>&#xA;&#xA;<p>Here's what our field data size looks like for the cluster (call to <code>/_stats/fielddata?fields=*&amp;human&amp;pretty</code>):</p>&#xA;&#xA;<pre><code>"fielddata" : {&#xA;  "memory_size" : "168.1gb",&#xA;  "memory_size_in_bytes" : 180591558840,&#xA;  "evictions" : 0&#xA;},&#xA;</code></pre>&#xA;&#xA;<p>From my understanding the max size should be capped at 6 gb * 24 nodes = 144 gb.</p>&#xA;