32889681
Unexpected Geo_shape query behaviour
<p>My documents have geo_shapes to associate them to an area. If I give ES (1.7) a geo_point I'm wanting it to give me back the documents where the point falls within that area.</p>&#xA;&#xA;<p>I've recreated with the following toy example:-</p>&#xA;&#xA;<pre><code># create the index&#xA;put location_test&#xA;put location_test/_mapping/place&#xA;{&#xA;  "place": {&#xA;    "properties": {&#xA;      "message": {"type": "string"},&#xA;      "coverage": {"type": "geo_shape"}&#xA;    }&#xA;  }&#xA;}&#xA;# check the mapping is correct&#xA;get location_test/place/_mapping&#xA;&#xA;# location 1&#xA;put location_test/place/1 &#xA;{&#xA;  "message": "we will be in this box",&#xA;  "coverage": {&#xA;    "type" : "envelope",&#xA;        "coordinates" : [[1, 0], [0, 1] ]&#xA;    }&#xA;}&#xA;&#xA;# location 2&#xA;put location_test/place/2&#xA;{&#xA;  "message": "we will be outside this box",&#xA;  "coverage": {&#xA;    "type" : "envelope",&#xA;        "coordinates" : [[2, 1], [1, 2] ]&#xA;    }&#xA;}&#xA;&#xA;# all documents returned - OK &#xA;get location_test/place/_search&#xA;{&#xA;  "query": { "match_all": {}}&#xA;}&#xA;&#xA;# should only get document 1, but get both.&#xA;get location_test/place/_search &#xA;{&#xA;  "query": {&#xA;    "geo_shape": {&#xA;      "coverage": {&#xA;        "shape": {&#xA;          "type": "point"&#xA;          "coordinates": [0.1,0.1]&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;
<p>Besides the fact that you're missing a comma after <code>"type": "point"</code> in your last query, I do get a single point when POSTing the query to the <code>_search</code> endpoint:</p>&#xA;&#xA;<pre><code>curl -XPOST localhost:9200/location_test/place/_search -d '{&#xA;  "query": {&#xA;    "geo_shape": {&#xA;      "coverage": {&#xA;        "shape": {&#xA;          "type": "point",               &lt;---- comma missing here&#xA;          "coordinates": [0.1,0.1]&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}'&#xA;</code></pre>&#xA;&#xA;<p>Results:</p>&#xA;&#xA;<pre><code>{&#xA;  "took" : 1,&#xA;  "timed_out" : false,&#xA;  "_shards" : {&#xA;    "total" : 5,&#xA;    "successful" : 5,&#xA;    "failed" : 0&#xA;  },&#xA;  "hits" : {&#xA;    "total" : 1,&#xA;    "max_score" : 1.0,&#xA;    "hits" : [ {&#xA;      "_index" : "location_test",&#xA;      "_type" : "place",&#xA;      "_id" : "1",&#xA;      "_score" : 1.0,&#xA;      "_source":{"message":"we will be in this box","coverage":{"type":"envelope","coordinates":[[1,0],[0,1]]}}&#xA;    } ]&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>When sending a payload you should use POST instead of GET as not all HTTP clients send payload when using GET.</p>&#xA;