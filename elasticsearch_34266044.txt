34266044
Elasticsearch indexing multi_field with array field
<p>I'm new to elasticsearch and I'm trying to create a multi_field index with <code>string</code> and <code>array of strings</code> fields. With the <code>string</code> fields it's all working great but when I try to get some results when they are inside an array, it returns an empty one.</p>&#xA;&#xA;<p><strong>My data:</strong></p>&#xA;&#xA;<pre><code>{&#xA;  "string_field_one": "one",&#xA;  "string_field_two": "two",&#xA;  "array_of_strings_field": [&#xA;     "2010", "2011", "2012", "2013"&#xA;  ]&#xA;}&#xA;</code></pre>&#xA;&#xA;<p><strong>Mappings:</strong></p>&#xA;&#xA;<pre><code>{&#xA;    "string_field_one" : {&#xA;        "type" : "string",&#xA;        "analyzer": "snowball",&#xA;         "copy_to": "group"&#xA;     },&#xA;    "string_field_two" : {&#xA;        "type" : "string",&#xA;        "analyzer": "snowball",&#xA;         "copy_to": "group"&#xA;     },&#xA;    "array_of_strings_field" : {&#xA;         "type" : "string",&#xA;         "analyzer": "keyword",&#xA;         "copy_to": "group"&#xA;    }&#xA;    "group" : {&#xA;        "type": "multi_field"&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p><strong>Search:</strong></p>&#xA;&#xA;<pre><code> "body": {&#xA;          "query": {&#xA;              "multi_match": {&#xA;                  "query": "one two 2010",&#xA;                  type: "cross_fields",&#xA;                  operator: "and",&#xA;                  fields: [&#xA;                      "string_field_one",&#xA;                      "string_field_two",&#xA;                      "array_of_strings_field",&#xA;                      "group"&#xA;                  ]&#xA;              }&#xA;          }&#xA;      }&#xA;</code></pre>&#xA;&#xA;<p><strong>Expecting:</strong></p>&#xA;&#xA;<ul>&#xA;<li>Searching by <code>one</code>, <code>two</code>, or <code>2010</code> should return the result</li>&#xA;<li>Searching by <code>one two</code> should return the result</li>&#xA;<li>Searching by <code>one two 2010</code> should return the result</li>&#xA;<li>Searching by <code>one two 2008</code> should not return the result</li>&#xA;</ul>&#xA;&#xA;<p><strong>What am I missing?</strong></p>&#xA;
<p>Cross_fields has the constraint all fields should have the same <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-multi-match-query.html#_literal_cross_field_literal_and_analysis" rel="nofollow">search analyzer</a> or rather all the query terms should occur in fields with same search analyzer. Which is not the case here.&#xA;You would need to  use <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html" rel="nofollow">query_string</a> for the above case:</p>&#xA;&#xA;<p>Example: </p>&#xA;&#xA;<pre><code>"body": {&#xA;           "query": {&#xA;              "query_string": {&#xA;                  "query": "one two 2010",&#xA;                  "default_operator": "AND",&#xA;                  "fields": [&#xA;                      "string_field_one",&#xA;                      "string_field_two",&#xA;                      "array_of_strings_field",&#xA;                      "group"&#xA;                  ]&#xA;&#xA;              }&#xA;          }&#xA;   }&#xA;</code></pre>&#xA;