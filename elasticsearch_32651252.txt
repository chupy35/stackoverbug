32651252
How to query special character in elasticsearch
<p>I have a piece of data in elasticsearch like this:</p>&#xA;&#xA;<pre><code>   {"_index": "my_index",&#xA;    "_type": "my_type",&#xA;    "_id": "test_id",&#xA;    "_version": 1,&#xA;    "_score": 1,&#xA;    "_source": {&#xA;        "d2": "*",&#xA;        "d1": "test_data"&#xA;    }}&#xA;</code></pre>&#xA;&#xA;<p>So I can search this data by this clause:</p>&#xA;&#xA;<pre><code>{"query": {"filtered":{"filter":{"term":{"d1":"test"}}}}}&#xA;</code></pre>&#xA;&#xA;<p>However, because the field "d2" has a specical character "*", I am confused that how to search this data by d2. These two methods below are both incorrect.</p>&#xA;&#xA;<pre><code>{"query": {"filtered":{"filter":{"term":{"d2":"*"}}}}}&#xA;</code></pre>&#xA;&#xA;<p>or</p>&#xA;&#xA;<pre><code>{"query": {"filtered":{"filter":{"term":{"d2":"\*"}}}}}&#xA;</code></pre>&#xA;
<p>Your problem is that your index doesn't contain anything!</p>&#xA;&#xA;<p>If you don't have setup a specific mapping, the dynamic mapping that has been used has setup a field with type <code>string</code>, which is <strong>analyzed</strong> by default with <code>standard</code> analyzer.</p>&#xA;&#xA;<p>If you check the result of analyzing <code>*</code> with the standard analyzer, you will see that you don't have any token as a result :</p>&#xA;&#xA;<pre><code>GET _analyze?analyzer=standard&amp;text=*&#xA;</code></pre>&#xA;&#xA;<p>ElasticSearch response :</p>&#xA;&#xA;<pre><code>{&#xA;   "tokens": []&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Change your mapping to have the <code>d2</code> field indexed as <code>not_analyzed</code> and the document will match your queries.</p>&#xA;&#xA;<p>Example :</p>&#xA;&#xA;<pre><code>POST /special/&#xA;{&#xA;  "mappings":{&#xA;    "character":{&#xA;      "properties":{&#xA;        "d2":{&#xA;          "type":"string",&#xA;          "index":"not_analyzed"&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;&#xA;POST /special/character/&#xA;{&#xA;  "d2":"*"&#xA;}&#xA;&#xA;POST /special/_search&#xA;{&#xA;  "query": {&#xA;    "term": {&#xA;      "d2": "*"&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>And you finally have your result :</p>&#xA;&#xA;<pre><code>"hits": {&#xA;      "total": 1,&#xA;      "max_score": 0.30685282,&#xA;      "hits": [&#xA;         {&#xA;            "_index": "special",&#xA;            "_type": "character",&#xA;            "_id": "AU_gcWOBn6s1TzYZvmTv",&#xA;            "_score": 0.30685282,&#xA;            "_source": {&#xA;               "d2": "*"&#xA;            }&#xA;         }&#xA;      ]&#xA;   }&#xA;</code></pre>&#xA;&#xA;<p>Analysis is a very important concept of ElasticSearch : take the time to read about it and you'll save yourself a large amount of time trying to understand what's going on.</p>&#xA;&#xA;<p>To answer more generally to how to query on these special characters, you must control your analysis not to delete them or query on a dedicated field which is not analyzed.</p>&#xA;