29313139
Add non existing cluster settings in elasticsearch
<p>Recently i have built elasticsearch with fluentd and Kibana and all is working fine, but we are facing high cpu load while performing search caused by java. </p>&#xA;&#xA;<p>I have 60 GB Ram and 16 processors and each processor has 2 cores. </p>&#xA;&#xA;<blockquote>&#xA;  <p>ES_HEAP_SIZE=32g</p>&#xA;</blockquote>&#xA;&#xA;<p>-find below more details </p>&#xA;&#xA;<pre><code>curl "localhost:9200/_cat/thread_pool?v&amp;h=search.rejected"&#xA;</code></pre>&#xA;&#xA;<blockquote>&#xA;  <p>search.rejected &#xA;              387</p>&#xA;</blockquote>&#xA;&#xA;<pre><code>curl "localhost:9200/_cat/thread_pool?v&amp;h=index.rejected" &#xA;</code></pre>&#xA;&#xA;<blockquote>&#xA;  <p>index.rejected &#xA;               0</p>&#xA;</blockquote>&#xA;&#xA;<ul>&#xA;<li>snapshot from elasticsearch.log </li>&#xA;</ul>&#xA;&#xA;<blockquote>&#xA;  <p>[DEBUG][action.search.type       ] [Hulk 2099]&#xA;  [logstash-2015.03.14][4], node[qxcAN3lURs65Lf1GMhB_qg], [P],&#xA;  s[STARTED]: Failed to execute&#xA;  [org.elasticsearch.action.search.SearchRequest@7c71025f] lastShard&#xA;  [true] &#xA;  org.elasticsearch.common.util.concurrent.EsRejectedExecutionException:&#xA;  rejected execution (queue capacity 1000) on&#xA;  org.elasticsearch.search.action.SearchServiceTransportAction$23@1d7c9f0f</p>&#xA;&#xA;<pre><code>    at org.elasticsearch.common.util.concurrent.EsAbortPolicy.rejectedExecution(EsAbortPolicy.java:62)&#xA;&#xA;    at java.util.concurrent.ThreadPoolExecutor.reject(ThreadPoolExecutor.java:821)&#xA;&#xA;    at java.util.concurrent.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:1372)&#xA;&#xA;    at org.elasticsearch.search.action.SearchServiceTransportAction.execute(SearchServiceTransportAction.java:551)&#xA;&#xA;    at org.elasticsearch.search.action.SearchServiceTransportAction.sendExecuteQuery(SearchServiceTransportAction.java:228)&#xA;&#xA;    at org.elasticsearch.action.search.type.TransportSearchCountAction$AsyncAction.sendExecuteFirstPhase(TransportSearchCountAction.java:71)&#xA;&#xA;    at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction.performFirstPhase(TransportSearchTypeAction.java:171)&#xA;</code></pre>&#xA;</blockquote>&#xA;&#xA;<p>Now i read that i have to update the threadpool settings in ES and i have now </p>&#xA;&#xA;<pre><code> curl -XGET localhost:9200/_cluster/settings?pretty &#xA;</code></pre>&#xA;&#xA;<blockquote>&#xA;  <p>{   "persistent" : { },    "transient" : { }  }</p>&#xA;</blockquote>&#xA;&#xA;<p>i'm trying to update the settings with the below commands </p>&#xA;&#xA;<pre><code>curl -XPUT localhost:9200/_cluster/settings -d '{ &#xA;&#xA;"threadpool" : {    "index": { &#xA;    "type": "fixed", &#xA;    "size": 32, &#xA;    "queue_size": 1000    },    "bulk": { &#xA;    "type": "fixed", &#xA;    "size": 32, &#xA;    "queue_size": 1000    },    "search": { &#xA;    "type": "fixed", &#xA;    "size": 96, &#xA;    "queue_size": 1000   }  }  }'&#xA;</code></pre>&#xA;&#xA;<p>but i keep getting </p>&#xA;&#xA;<blockquote>&#xA;  <p>{"error":"ActionRequestValidationException[Validation Failed: 1: no&#xA;  settings to update;]","status":400}</p>&#xA;</blockquote>&#xA;&#xA;<p>What's wrong with this command? is it the right solution for my issue ? </p>&#xA;&#xA;<p>Please advise </p>&#xA;&#xA;<p>Thanks. </p>&#xA;&#xA;<p>Ayman</p>&#xA;
<p>You need to specify if the updates are <code>permanent</code> (applied across all restarts) or <code>transient</code> (will not survive a full cluster restart). Find more information <a href="http://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html" rel="nofollow">here</a>.</p>&#xA;&#xA;<p>If you want to apply your settings transiently, use the command below:</p>&#xA;&#xA;<pre><code>curl -XPUT localhost:9200/_cluster/settings -d '{ &#xA;    "transient": {&#xA;        "threadpool": {&#xA;            "index": {&#xA;                "type": "fixed",&#xA;                "size": 32,&#xA;                "queue_size": 1000&#xA;            },&#xA;            "bulk": {&#xA;                "type": "fixed",&#xA;                "size": 32,&#xA;                "queue_size": 1000&#xA;            },&#xA;            "search": {&#xA;                "type": "fixed",&#xA;                "size": 96,&#xA;                "queue_size": 1000&#xA;            }&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>To apply them permanently, replace <code>transient</code> with <code>permanent</code>. Note that you can also set individual settings transiently or permanently by grouping them accordingly in the cluster update command.</p>&#xA;