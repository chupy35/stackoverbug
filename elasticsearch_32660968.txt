32660968
Elasticsearch: can this complex filtere query be simplified?
<p>I have the following filtered query:</p>&#xA;&#xA;<pre><code>{&#xA;  "query": {&#xA;        "filtered" : {&#xA;            "query": { &#xA;                ....&#xA;            },&#xA;            "filter" : {&#xA;                "bool" : {&#xA;                    "should" : [&#xA;                        {&#xA;                            bool : {&#xA;                                "must" : [&#xA;                                    { "term1" : { "name1" : "value1" } },&#xA;                                    { "term2" : { "name2" : "value2" } }&#xA;                                ]&#xA;                            }&#xA;                        },&#xA;                        {&#xA;                            "bool" : {&#xA;                                "must" : [&#xA;                                    ......&#xA;                                ]&#xA;                            }&#xA;                        },&#xA;                        {&#xA;                            "bool" : {&#xA;                                "must" : [ &#xA;                                    ......&#xA;                                ]&#xA;                            }&#xA;                        },  &#xA;                        {&#xA;                            "bool" : {&#xA;                                "must" : [&#xA;                                    .......&#xA;                                ]&#xA;                            }&#xA;                        }&#xA;                    ]&#xA;                }&#xA;            }&#xA;        }&#xA;    }  &#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Is there any room for me to improve the complex filters without harming performance? How?</p>&#xA;&#xA;<p>I feel the filter part can be simplified, but not sure. Also not sure about any performance impact.</p>&#xA;&#xA;<p>Thanks!</p>&#xA;&#xA;<p><strong>UPDATE</strong></p>&#xA;&#xA;<p>Under each must clause, there is a GROUP of clauses. See the first must clause for an example.</p>&#xA;&#xA;<p><strong>UPDATE 2</strong></p>&#xA;&#xA;<p>According to Duc's input and Mario's updated answer, I am very happy that what I have so far is the right way. No changes are is needed.</p>&#xA;&#xA;<p><em>I choose Mario's response as the answer because it confirms that mine is right.</em></p>&#xA;
<p>You don't need <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-bool-query.html" rel="nofollow">Bool</a> with only one must clause. You put your conditions directly within the outer <code>should</code>.</p>&#xA;&#xA;<pre><code>{&#xA;  "query": {&#xA;        "filtered" : {&#xA;            "query": { &#xA;                ....&#xA;            },&#xA;            "filter" : {&#xA;                "bool" : {&#xA;                    "should" : [&#xA;                        {&#xA;                                    .......&#xA;                        },&#xA;                        {&#xA;                                    .......&#xA;                        },&#xA;                        {&#xA;                                    .......&#xA;                        },  &#xA;                        {&#xA;                                    .......&#xA;                        }&#xA;                    ]&#xA;                }&#xA;            }&#xA;        }&#xA;    }  &#xA;}&#xA;</code></pre>&#xA;&#xA;<p><strong>UPDATE:</strong> since I see from your update that you have several clauses within your nested <code>must</code> statements, my suggestion is no longer valid. Your query filter is ok like it is (except that <code>term1</code> and <code>term2</code> aren't valid, but that's not the point of the question)</p>&#xA;