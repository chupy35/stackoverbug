30634800
Boosting Filtered query based on field value
<p>I have the following filtered query and want to use the custom_score query or the custom_filters_score query to boost the results based on a specific field value. However, I'm hitting errors such as: </p>&#xA;&#xA;<pre><code>No query registered for [custom_filters_score]]; &#xA;No query registered for [custom_score]]; &#xA;</code></pre>&#xA;&#xA;<p>Where am I going wrong? Any help greatly appreciated ! </p>&#xA;&#xA;<p>Here is the query: </p>&#xA;&#xA;<pre><code>{&#xA;"query": {&#xA;    "custom_score": {&#xA;        "query": {&#xA;            "filtered": {&#xA;                "query": {&#xA;                    "bool": {&#xA;                        "should": [&#xA;                            {&#xA;                                "constant_score": {&#xA;                                    "query": {&#xA;                                        "match": {&#xA;                                            "question": {&#xA;                                                "query": "diabetes"&#xA;                                            }&#xA;                                        }&#xA;                                    },&#xA;                                    "boost": 1&#xA;                                }&#xA;                            },&#xA;                            {&#xA;                                "dis_max": {&#xA;                                    "queries": [&#xA;                                        {&#xA;                                            "constant_score": {&#xA;                                                "query": {&#xA;                                                    "match": {&#xA;                                                        "question": {&#xA;                                                            "query": "diabetes"&#xA;                                                        }&#xA;                                                    }&#xA;                                                },&#xA;                                                "boost": 0.01&#xA;                                            }&#xA;                                        },&#xA;                                        {&#xA;                                            "constant_score": {&#xA;                                                "query": {&#xA;                                                    "match": {&#xA;                                                        "answer_text": {&#xA;                                                            "query": "diabetes"&#xA;                                                        }&#xA;                                                    }&#xA;                                                },&#xA;                                                "boost": 0.0001&#xA;                                            }&#xA;                                        }&#xA;                                    ]&#xA;                                }&#xA;                            },&#xA;                            {&#xA;                                "dis_max": {&#xA;                                    "queries": [&#xA;                                        {&#xA;                                            "constant_score": {&#xA;                                                "query": {&#xA;                                                    "match_phrase": {&#xA;                                                        "question_phrase": {&#xA;                                                            "query": "what is diabetes",&#xA;                                                            "slop": 0&#xA;                                                        }&#xA;                                                    }&#xA;                                                },&#xA;                                                "boost": 100&#xA;                                            }&#xA;                                        },&#xA;                                        {&#xA;                                            "constant_score": {&#xA;                                                "query": {&#xA;                                                    "match_phrase": {&#xA;                                                        "question_phrase": {&#xA;                                                            "query": "what is diabetes",&#xA;                                                            "slop": 1&#xA;                                                        }&#xA;                                                    }&#xA;                                                },&#xA;                                                "boost": 50&#xA;                                            }&#xA;                                        },&#xA;                                        {&#xA;                                            "constant_score": {&#xA;                                                "query": {&#xA;                                                    "match_phrase": {&#xA;                                                        "question_phrase": {&#xA;                                                            "query": "what is diabetes",&#xA;                                                            "slop": 2&#xA;                                                        }&#xA;                                                    }&#xA;                                                },&#xA;                                                "boost": 33&#xA;                                            }&#xA;                                        },&#xA;                                        {&#xA;                                            "constant_score": {&#xA;                                                "query": {&#xA;                                                    "match_phrase": {&#xA;                                                        "question_phrase": {&#xA;                                                            "query": "what is diabetes",&#xA;                                                            "slop": 3&#xA;                                                        }&#xA;                                                    }&#xA;                                                },&#xA;                                                "boost": 25&#xA;                                            }&#xA;                                        },&#xA;                                        {&#xA;                                            "constant_score": {&#xA;                                                "query": {&#xA;                                                    "query_string": {&#xA;                                                        "default_field": "question_group_four",&#xA;                                                        "query": "what__is__diabetes"&#xA;                                                    }&#xA;                                                },&#xA;                                                "boost": 0.1&#xA;                                            }&#xA;                                        },&#xA;                                        {&#xA;                                            "constant_score": {&#xA;                                                "query": {&#xA;                                                    "query_string": {&#xA;                                                        "default_field": "question_group_five",&#xA;                                                        "query": "what__is__diabetes"&#xA;                                                    }&#xA;                                                },&#xA;                                                "boost": 0.15&#xA;                                            }&#xA;                                        },&#xA;                                        {&#xA;                                            "constant_score": {&#xA;                                                "query": {&#xA;                                                    "query_string": {&#xA;                                                        "default_field": "concept_words_no_synonyms_20",&#xA;                                                        "query": "what__is__diabetes"&#xA;                                                    }&#xA;                                                },&#xA;                                                "boost": 35&#xA;                                            }&#xA;                                        },&#xA;                                        {&#xA;                                            "constant_score": {&#xA;                                                "query": {&#xA;                                                    "query_string": {&#xA;                                                        "default_field": "concept_words_no_synonyms_15",&#xA;                                                        "query": "what__is__diabetes"&#xA;                                                    }&#xA;                                                },&#xA;                                                "boost": 25&#xA;                                            }&#xA;                                        },&#xA;                                        {&#xA;                                            "constant_score": {&#xA;                                                "query": {&#xA;                                                    "query_string": {&#xA;                                                        "default_field": "concept_words_no_synonyms_10",&#xA;                                                        "query": "what__is__diabetes"&#xA;                                                    }&#xA;                                                },&#xA;                                                "boost": 15&#xA;                                            }&#xA;                                        },&#xA;                                        {&#xA;                                            "constant_score": {&#xA;                                                "query": {&#xA;                                                    "query_string": {&#xA;                                                        "default_field": "concept_words_20",&#xA;                                                        "query": "what__is__diabetes"&#xA;                                                    }&#xA;                                                },&#xA;                                                "boost": 28&#xA;                                            }&#xA;                                        },&#xA;                                        {&#xA;                                            "constant_score": {&#xA;                                                "query": {&#xA;                                                    "query_string": {&#xA;                                                        "default_field": "concept_words_15",&#xA;                                                        "query": "what__is__diabetes"&#xA;                                                    }&#xA;                                                },&#xA;                                                "boost": 16&#xA;                                            }&#xA;                                        },&#xA;                                        {&#xA;                                            "constant_score": {&#xA;                                                "query": {&#xA;                                                    "query_string": {&#xA;                                                        "default_field": "concept_words_10",&#xA;                                                        "query": "what__is__diabetes"&#xA;                                                    }&#xA;                                                },&#xA;                                                "boost": 13&#xA;                                            }&#xA;                                        },&#xA;                                        {&#xA;                                            "constant_score": {&#xA;                                                "query": {&#xA;                                                    "query_string": {&#xA;                                                        "default_field": "concept_words_05",&#xA;                                                        "query": "what__is__diabetes"&#xA;                                                    }&#xA;                                                },&#xA;                                                "boost": 4&#xA;                                            }&#xA;                                        }&#xA;                                    ]&#xA;                                }&#xA;                            },&#xA;                            {&#xA;                                "dis_max": {&#xA;                                    "queries": [&#xA;                                        {&#xA;                                            "constant_score": {&#xA;                                                "query": {&#xA;                                                    "query_string": {&#xA;                                                        "default_field": "question_group_four",&#xA;                                                        "query": "diabetes"&#xA;                                                    }&#xA;                                                },&#xA;                                                "boost": 0.1&#xA;                                            }&#xA;                                        },&#xA;                                        {&#xA;                                            "constant_score": {&#xA;                                                "query": {&#xA;                                                    "query_string": {&#xA;                                                        "default_field": "question_group_five",&#xA;                                                        "query": "diabetes"&#xA;                                                    }&#xA;                                                },&#xA;                                                "boost": 0.15&#xA;                                            }&#xA;                                        },&#xA;                                        {&#xA;                                            "constant_score": {&#xA;                                                "query": {&#xA;                                                    "query_string": {&#xA;                                                        "default_field": "concept_words_no_synonyms_20",&#xA;                                                        "query": "diabetes"&#xA;                                                    }&#xA;                                                },&#xA;                                                "boost": 35&#xA;                                            }&#xA;                                        },&#xA;                                        {&#xA;                                            "constant_score": {&#xA;                                                "query": {&#xA;                                                    "query_string": {&#xA;                                                        "default_field": "concept_words_no_synonyms_15",&#xA;                                                        "query": "diabetes"&#xA;                                                    }&#xA;                                                },&#xA;                                                "boost": 25&#xA;                                            }&#xA;                                        },&#xA;                                        {&#xA;                                            "constant_score": {&#xA;                                                "query": {&#xA;                                                    "query_string": {&#xA;                                                        "default_field": "concept_words_no_synonyms_10",&#xA;                                                        "query": "diabetes"&#xA;                                                    }&#xA;                                                },&#xA;                                                "boost": 15&#xA;                                            }&#xA;                                        },&#xA;                                        {&#xA;                                            "constant_score": {&#xA;                                                "query": {&#xA;                                                    "query_string": {&#xA;                                                        "default_field": "concept_words_20",&#xA;                                                        "query": "diabetes"&#xA;                                                    }&#xA;                                                },&#xA;                                                "boost": 28&#xA;                                            }&#xA;                                        },&#xA;                                        {&#xA;                                            "constant_score": {&#xA;                                                "query": {&#xA;                                                    "query_string": {&#xA;                                                        "default_field": "concept_words_15",&#xA;                                                        "query": "diabetes"&#xA;                                                    }&#xA;                                                },&#xA;                                                "boost": 16&#xA;                                            }&#xA;                                        },&#xA;                                        {&#xA;                                            "constant_score": {&#xA;                                                "query": {&#xA;                                                    "query_string": {&#xA;                                                        "default_field": "concept_words_10",&#xA;                                                        "query": "diabetes"&#xA;                                                    }&#xA;                                                },&#xA;                                                "boost": 13&#xA;                                            }&#xA;                                        },&#xA;                                        {&#xA;                                            "constant_score": {&#xA;                                                "query": {&#xA;                                                    "query_string": {&#xA;                                                        "default_field": "concept_words_05",&#xA;                                                        "query": "diabetes"&#xA;                                                    }&#xA;                                                },&#xA;                                                "boost": 4&#xA;                                            }&#xA;                                        }&#xA;                                    ]&#xA;                                }&#xA;                            }&#xA;                        ],&#xA;                        "disable_coord": true&#xA;                    }&#xA;                },&#xA;                "filter": {&#xA;                    "and": [&#xA;                        {&#xA;                            "term": {&#xA;                                "posted_by_expert": false&#xA;                            }&#xA;                        },&#xA;                        {&#xA;                            "term": {&#xA;                                "tip_question": false&#xA;                            }&#xA;                        },&#xA;                        {&#xA;                            "term": {&#xA;                                "show_in_work_queue": true&#xA;                            }&#xA;                        },&#xA;                        {&#xA;                            "range": {&#xA;                                "verified_answers_count": {&#xA;                                    "gt": 0&#xA;                                }&#xA;                            }&#xA;                        }&#xA;                    ]&#xA;                }&#xA;            }&#xA;        },&#xA;        "script": "_score * doc['my_numeric_field'].value"&#xA;    }&#xA;},&#xA;"sort": [&#xA;    "_score",&#xA;    {&#xA;        "count_words_with_high_concepts": {&#xA;            "order": "asc"&#xA;        }&#xA;    },&#xA;    {&#xA;        "popularity": {&#xA;            "order": "desc"&#xA;        }&#xA;    },&#xA;    {&#xA;        "length": {&#xA;            "order": "asc"&#xA;        }&#xA;    }&#xA;],&#xA;"fields": [],&#xA;"size": 10,&#xA;"from": 0}&#xA;</code></pre>&#xA;
<p>These two queries are not available in latest versions of elastic search after 0.90.4 . So if you are using elastic search > 0.90.4( which is a pretty old version), you will have to use <a href="https://www.elastic.co/guide/en/elasticsearch/reference/0.90/query-dsl-function-score-query.html" rel="noreferrer"> Function Score Query </a> which replaced <a href="https://www.elastic.co/guide/en/elasticsearch/reference/0.90/query-dsl-custom-filters-score-query.html#query-dsl-custom-filters-score-query" rel="noreferrer"> Custom Filters Score Query </a> after 0.90.4 version</p>&#xA;