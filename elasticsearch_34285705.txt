34285705
Query by UUID format-like field on elasticsearch
<p>I've indexed documents like that's been created on the fly, so I mean the mapping has been created on at the same time new fields were created (dynamically).</p>&#xA;&#xA;<pre><code>{&#xA;  "user":"living_team",&#xA;  "timestamp":"2015-12-14T18:06:47.085Z",&#xA;  "matter":"snip2.PNG",&#xA;  "comment":"Archive",&#xA;  "channel":"Feina",&#xA;  "feedTypes":[&#xA;     20&#xA;  ],&#xA;  "property_general_ldate":"2015-12-14T18:06:47.085Z",&#xA;  "property_tSize":7595.0,&#xA;  "resources":[&#xA;     {&#xA;        "timestamp":"2015-12-14T16:58:00.598Z",&#xA;        "matter":"snip2.PNG",&#xA;        "comment":"Archive",&#xA;        "channel":"Feina",&#xA;        "feedType":20,&#xA;        "mime":"image/png",&#xA;        "source":{&#xA;           "sourceId":{&#xA;              "id":"C:\\Users\\Beep\\Desktop\\share\\snip2.PNG",&#xA;              "batch":"c38eec2d-a282-11e5-baf4-382c4ab9e433",&#xA;              "client":"VIM12HCNZL"&#xA;           },&#xA;           "feedType":20,&#xA;           "property_folder":"C:\\Users\\Beep\\Desktop\\share",&#xA;           "property_lastAccessFolder_ldate":1450111821506&#xA;        },&#xA;        "property_size":7595.0,&#xA;        "property_creation_ldate":"2015-12-14T16:50:20.578Z",&#xA;        "property_name":"snip2.PNG",&#xA;        "nestedResources":[&#xA;&#xA;        ]&#xA;     }&#xA;  ]&#xA;</code></pre>&#xA;&#xA;<p>}</p>&#xA;&#xA;<p>I need to get documents that: <code>resources.source.sourceId.id is exactly "X"</code>. I've tried with this query, however its results is empty.</p>&#xA;&#xA;<pre><code>curl -XGET 'http://ESNode01:9201/living_team/inputs/_search?pretty' -d '{&#xA;  "query":{&#xA;     "filtered":{&#xA;        "query":{&#xA;           "term":{&#xA;              "resources.source.sourceId.batch":"3fcb8905-a307-11e5-88de-382c4ab9e433"&#xA;           }&#xA;        },&#xA;        "filter":{&#xA;           "match":{&#xA;              "channel":"FeINa"&#xA;           }&#xA;        }&#xA;     }&#xA;  }&#xA;}'&#xA;</code></pre>&#xA;
<p>That's the same issue as in <a href="https://stackoverflow.com/questions/34284094/simple-search-trouble-on-elasticsearch">your other question</a>, namely that the <code>resources.source.sourceId.batch</code> string field has been created as an <code>analyzed</code> field and thus the value <code>c38eec2d-a282-11e5-baf4-382c4ab9e433</code> has been tokenized into the five tokens <code>c38eec2d</code>, <code>a282</code>, <code>11e5</code>, <code>baf4</code>, <code>382c4ab9e433</code>.</p>&#xA;&#xA;<p>The correct way to handle this is to set a specific <code>not_analyzed</code> mapping for that field.</p>&#xA;&#xA;<p>Another temporary way out of this would be to use a <code>query_string</code> query with an exact match:</p>&#xA;&#xA;<pre><code>curl -XGET 'http://ESNode01:9201/living_team/inputs/_search?pretty' -d '{&#xA;  "query":{&#xA;     "filtered":{&#xA;        "query":{&#xA;           "query_string":{&#xA;              "query": "resources.source.sourceId.batch:\"3fcb8905-a307-11e5-88de-382c4ab9e433\""&#xA;           }&#xA;        },&#xA;        "filter":{&#xA;           "match":{&#xA;              "channel":"FeINa"&#xA;           }&#xA;        }&#xA;     }&#xA;  }&#xA;}'&#xA;</code></pre>&#xA;
<p>Also, if you don't want to add each UUID fields in your template you can use the <code>terms</code> condition instead or <code>term</code> and split your UUID string on each <code>-</code>.</p>&#xA;&#xA;<p>I'm not sure about the performance... but it does the trick.</p>&#xA;&#xA;<p>You should have something like that in your query:</p>&#xA;&#xA;<pre><code>curl -XGET 'http://ESNode01:9201/living_team/inputs/_search?pretty' -d '{&#xA;  "query":{&#xA;     "filtered":{&#xA;        "query":{&#xA;           "terms":{&#xA;              "resources.source.sourceId.batch":["3fcb8905", "a307", "11e5", "88de", "382c4ab9e433"]&#xA;           }&#xA;        },&#xA;        "filter":{&#xA;           "match":{&#xA;              "channel":"FeINa"&#xA;           }&#xA;        }&#xA;     }&#xA;  }&#xA;}'&#xA;</code></pre>&#xA;