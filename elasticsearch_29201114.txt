29201114
Best way to store votes in elasticsearch for a reddit like system
<p>I am building a site similar to reddit using elasticsearch and trying to decide where is the best place to store the up/down votes.  I can think of couple options.</p>&#xA;&#xA;<ul>&#xA;<li><p>Store as part of the document.<br>&#xA;In this case, any vote will trigger an update on the document.  According to  elasticsearch document, this is essentially a replace of the whole document.  That seems to be a very expensive operation.</p></li>&#xA;<li><p>Store in another database.<br>&#xA;Store votes in other database like SQL/MongoDB and update elasticsearch periodically. In this case, we have to tolerate some delay for the new votes to affect search result which is not so ideal and will also increase complexity and maintenance cost. </p></li>&#xA;<li><p>Store in another index in elasticsearch<br>&#xA;This can separate the concern by index - one mostly RO, one RW.  Is there an efficient way to merge the two indices so that I can order by votes at query time?</p></li>&#xA;</ul>&#xA;&#xA;<p>Any suggestions on those options or other better way to handle this?</p>&#xA;
<p>There is a forth option - store votes in a separate document with a different type but in the same index as the original document. The votes type can be made a <a href="http://www.elastic.co/guide/en/elasticsearch/guide/current/parent-child.html" rel="nofollow">child</a> of the article type. This setup will enable you to perform queries against articles and votes at the same time using <a href="http://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-has-child-filter.html" rel="nofollow">has_child</a> filters and queries. It will also require reindexing of only a small votes document every time a vote occurs instead of the large article document. On the negative side, the <code>has_child</code> and <code>has_parent</code> queries require loading of the parent/child map into memory, so this approach has a non-trivial memory footprint comparing to all other options that you have described. </p>&#xA;