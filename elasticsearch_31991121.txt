31991121
Elasticsearch - corpus size / overall term frequency
<p>Is there a way to get the corpus size of a field in a subset of my data? In other words, I want to count all words of a certain field. The words are in documents, which satisfy a query conditon. </p>&#xA;&#xA;<p>This information is provided by term vectors. Term vectors could be applied on particular documents, but not on multiple documents. <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-multi-termvectors.html" rel="nofollow">Multi-term vectors</a> allow to specify a list of document-ids to retrieve each term vector statistic for each term in each document. Unfortunately they are not aggregated, I have to aggregate them by myself. </p>&#xA;&#xA;<p>Is there a more elastic way, to achieve a aggregated term statistic? Could I use <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-scripting.html" rel="nofollow">groovy scripts</a> to aggregate term vectors?</p>&#xA;&#xA;<p><strong>Solution:</strong>&#xA;@Val, thanks for the solution. The query for all documents with <code>my_int_value=1</code> looks like:</p>&#xA;&#xA;<pre><code>GET /index/type/_search?search_type=count&#xA;{&#xA;  "query": {&#xA;    "filtered": {&#xA;      "filter": {&#xA;        "term": {&#xA;          "my_int_value": 1&#xA;        }&#xA;      }&#xA;    }&#xA;  },&#xA;  "aggs" : {&#xA;    "counting" : {&#xA;      "sum" : {&#xA;        "field" : "your_field.word_count"&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;
<p>If all you care about is the number of tokens/words in the field, you can also declare a <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-core-types.html#token_count" rel="nofollow"><code>token_count</code></a> sub-field in your string field. Your mapping would look like this:</p>&#xA;&#xA;<pre><code>{&#xA;    "your_type" : {&#xA;        "properties" : {&#xA;            "your_field" : {&#xA;                "type" : "string",&#xA;                "fields" : {&#xA;                    "word_count": {&#xA;                        "type" : "token_count",&#xA;                        "store" : "yes",&#xA;                        "analyzer" : "standard"&#xA;                    }&#xA;                }&#xA;            }&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>And then in your queries you can refer to the <code>your_field.word_count</code> field to get the number of tokens/words available in <code>your_field</code>.</p>&#xA;