34601544
ElasticSearch Sort on nested field across all documents
<p>I am trying to figure out if it is possible to sort based on nested field across all documents, for eg. in below JSON, fields is a nested object, what i am looking for is to retrieve all fields.name from all documents and then sort by name field. I know i can do this using inner hit query if it is part of single document. </p>&#xA;&#xA;<p>The other option is to retrieve all documents and then do sorting on front end/middle tier which is not a good option. </p>&#xA;&#xA;<pre><code>[ {&#xA;          "id": "42ddf6e1-23f5-4aed-9d3a-1ba3ac3677b1",&#xA;          "fields": [&#xA;            {&#xA;              "name": "asofheading"&#xA;            },&#xA;            {&#xA;              "name": "SEC_TYPE"&#xA;            }&#xA;          ],&#xA;},&#xA;{&#xA;          "id": "7579928e-2196-4f7d-aaf8-4bfe9e67b330",&#xA;          "fields": [&#xA;            {&#xA;              "name": "asofheading"&#xA;            },&#xA;            {&#xA;              "name": "SEC_TYPE"&#xA;            },&#xA;            {&#xA;              "name": "CUSIP"&#xA;            }&#xA;          ]&#xA; },&#xA;        {&#xA;          "id": "3a0940c1-7495-400c-a204-cd9bc6966fae",&#xA;          "fields": [&#xA;            {&#xA;              "name": "AsofHeading"&#xA;            },&#xA;            {&#xA;              "name": "SECT_PROFILE"&#xA;            },&#xA;            {&#xA;              "name": "SECT_PROFILESP"&#xA;            }&#xA;        },&#xA;&#xA;]&#xA;</code></pre>&#xA;&#xA;<p>I want to extract only field name from all documents and then sort by field name</p>&#xA;
<p>Use <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.1/search-request-sort.html#nested-sorting" rel="nofollow">nested sorting</a> (assuming the inner docs are of type <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.1/nested.html#_using_literal_nested_literal_fields_for_arrays_of_objects" rel="nofollow"><code>nested</code></a>). </p>&#xA;&#xA;<p>So, for example, with the documents you provided:</p>&#xA;&#xA;<pre><code>POST /test_index/_search&#xA;{&#xA;    "sort" : [&#xA;       {&#xA;          "fields.name" : {&#xA;             "mode" :  "max",&#xA;             "order" : "asc",&#xA;             "nested_path" : "fields"&#xA;          }&#xA;       }&#xA;    ]&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>returns:</p>&#xA;&#xA;<pre><code>{&#xA;   "took": 8,&#xA;   "timed_out": false,&#xA;   "_shards": {&#xA;      "total": 5,&#xA;      "successful": 5,&#xA;      "failed": 0&#xA;   },&#xA;   "hits": {&#xA;      "total": 3,&#xA;      "max_score": null,&#xA;      "hits": [&#xA;         {&#xA;            "_index": "test_index",&#xA;            "_type": "doc",&#xA;            "_id": "2",&#xA;            "_score": null,&#xA;            "_source": {&#xA;               "id": "7579928e-2196-4f7d-aaf8-4bfe9e67b330",&#xA;               "fields": [&#xA;                  {&#xA;                     "name": "asofheading"&#xA;                  },&#xA;                  {&#xA;                     "name": "SEC_TYPE"&#xA;                  },&#xA;                  {&#xA;                     "name": "CUSIP"&#xA;                  }&#xA;               ]&#xA;            },&#xA;            "sort": [&#xA;               "sec_type"&#xA;            ]&#xA;         },&#xA;         {&#xA;            "_index": "test_index",&#xA;            "_type": "doc",&#xA;            "_id": "1",&#xA;            "_score": null,&#xA;            "_source": {&#xA;               "id": "42ddf6e1-23f5-4aed-9d3a-1ba3ac3677b1",&#xA;               "fields": [&#xA;                  {&#xA;                     "name": "asofheading"&#xA;                  },&#xA;                  {&#xA;                     "name": "SEC_TYPE"&#xA;                  }&#xA;               ]&#xA;            },&#xA;            "sort": [&#xA;               "sec_type"&#xA;            ]&#xA;         },&#xA;         {&#xA;            "_index": "test_index",&#xA;            "_type": "doc",&#xA;            "_id": "3",&#xA;            "_score": null,&#xA;            "_source": {&#xA;               "id": "3a0940c1-7495-400c-a204-cd9bc6966fae",&#xA;               "fields": [&#xA;                  {&#xA;                     "name": "AsofHeading"&#xA;                  },&#xA;                  {&#xA;                     "name": "SECT_PROFILE"&#xA;                  },&#xA;                  {&#xA;                     "name": "SECT_PROFILESP"&#xA;                  }&#xA;               ]&#xA;            },&#xA;            "sort": [&#xA;               "sect_profilesp"&#xA;            ]&#xA;         }&#xA;      ]&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Here's the code I used to test it:</p>&#xA;&#xA;<p><a href="http://sense.qbox.io/gist/2de98ca3e72663ce7af63c435deb5e85c6070088" rel="nofollow">http://sense.qbox.io/gist/2de98ca3e72663ce7af63c435deb5e85c6070088</a></p>&#xA;