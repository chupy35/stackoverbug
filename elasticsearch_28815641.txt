28815641
elasticsearch update api - script do not change indexed document
<p>I am trying to use update api in elasticsearch 1.3.5. I have following document I am trying to update:</p>&#xA;&#xA;<pre><code>{&#xA;  "_index": "geocode",&#xA;  "_type": "google",&#xA;  "_id": "kolb dfsafa 303 46546456 z ",&#xA;  "_version": 8,&#xA;  "_score": 1,&#xA;  "_source": {&#xA;    "results": [&#xA;      {"formatted_address": "kolb 303, 46546456 dfsafa-dfsafa-d",&#xA;        "geometry": {&#xA;          "location": {&#xA;            "lat": 35.0360533,&#xA;            "lng": 14.5632209&#xA;          },&#xA;          "location_type": "ROOFTOP"&#xA;        },&#xA;        "types": [&#xA;          "street_address"&#xA;        ]&#xA;      }&#xA;    ],&#xA;    "status": "OK"&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>I have following script:</p>&#xA;&#xA;<pre><code>POST  /geocode/google/kolb%20dfsafa%20303%2046546456%20z%20/_update&#xA;{&#xA;    "script":"ctx._source.results.geometry.location.lat==latitude",&#xA;    "lang": "groovy",&#xA;    "params":{&#xA;        "latitude" : 0.0&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Where I would like to update lat position to 0.0. Api call finishes successfully(version increassed etc.) however nothing is updated.</p>&#xA;&#xA;<pre><code>{&#xA;   "_index": "geocode",&#xA;   "_type": "google",&#xA;   "_id": "kolb dfsafa 303 46546456 z ",&#xA;   "_version": 9&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Any hint where to look?</p>&#xA;
<p>As results is array , you need to address it as an array. Remember , you are working on the orginal _source and not the data from field data cache. Which means you need to use the right JSON path.</p>&#xA;&#xA;<pre><code>POST  /geocode/google/kolb%20dfsafa%20303%2046546456%20z%20/_update&#xA;{&#xA;    "script":"ctx._source.results[0].geometry.location.lat=latitude",&#xA;    "lang": "groovy",&#xA;    "params":{&#xA;        "latitude" : 0.0&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>You can refer to this <a href="http://blog.qbox.io/introduction-to-elasticsearch-scripting" rel="nofollow">link</a> on more information of this use case and more examples on Update API</p>&#xA;