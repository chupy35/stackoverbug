28937819
Does it matter if the filter is inside or outside a filtered query?
<p>While these two are giving me the same result, what is the difference between having the filter inside or outside? Is there a difference in terms of performance or the actions behind the scenes?</p>&#xA;&#xA;<pre><code>"query": {&#xA;    "filtered": {&#xA;        "query":  { "match": { "email": "business opportunity" }},&#xA;        "filter": { "term":  { "folder": "inbox" }}&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<pre><code>"query": {&#xA;    "filtered": {&#xA;    "query":  { "match": { "email": "business opportunity" }}&#xA;    }&#xA;},&#xA;"filter": {&#xA;    "term":  { "folder": "inbox" }&#xA;}&#xA;</code></pre>&#xA;
<h2>Filter inside a Query</h2>&#xA;&#xA;<p>Elasticsearch will execute the query and filter in what ever way is more efficient to reduce the results set and get you the answer as quickly as possible.&#xA;This is referred to as a <a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/query-dsl-filtered-query.html#query-dsl-filtered-query">filtered_query</a></p>&#xA;&#xA;<h2>Filter after a Query</h2>&#xA;&#xA;<p>The query is run first and <strong>then</strong> results are filtered before returning them to the client. &#xA;This is referred to as a <a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-request-post-filter.html#search-request-post-filter">post_filter</a>.</p>&#xA;&#xA;<p>Although a post_filter is less efficient, it can be useful when combining with an aggregation - the aggregated values won't take into account the post_filter, i.e. the aggregation will only be on the query results.</p>&#xA;