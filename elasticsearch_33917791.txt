33917791
Tokenising / filtering text with markup
<p>I have the following text:</p>&#xA;&#xA;<p><code>Lurasidone is a dopamine D&lt;sub&gt;2&lt;/sub&gt;</code></p>&#xA;&#xA;<p>I would like to tokenize it such that I get the following tokens:</p>&#xA;&#xA;<blockquote>&#xA;  <p>Lurasidone</p>&#xA;  &#xA;  <p>dopamine </p>&#xA;  &#xA;  <p>D2</p>&#xA;</blockquote>&#xA;&#xA;<p>How do I achieve this using a tokenizer or filter? I've attempted to to use the html filter however <code>D&lt;sub&gt;2&lt;/sub&gt;</code> is tokenized as:</p>&#xA;&#xA;<blockquote>&#xA;  <p>D</p>&#xA;  &#xA;  <p>2</p>&#xA;</blockquote>&#xA;&#xA;<p>whereas I need it to tokenize as:</p>&#xA;&#xA;<blockquote>&#xA;  <p>D2</p>&#xA;</blockquote>&#xA;
<p>You can use <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.0/analysis-pattern-replace-charfilter.html" rel="nofollow">Pattern Replace Char Filter</a></p>&#xA;&#xA;<p>This is what I did.</p>&#xA;&#xA;<pre><code>"char_filter": {&#xA;    "html_pattern": {&#xA;        "type": "pattern_replace",&#xA;        "pattern": "&lt;.*&gt;(.*)&lt;\\/.*&gt;",&#xA;        "replacement": "$1"&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>I included that in my <code>custom analyzer</code> like this</p>&#xA;&#xA;<pre><code>"my_custom_analyzer": {&#xA;    "tokenizer": "standard",&#xA;    "char_filter": [&#xA;        "html_pattern"&#xA;    ],&#xA;    "filter": ["stop"]&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>These are the tokens generated for your text</p>&#xA;&#xA;<pre><code>{&#xA;   "tokens": [&#xA;      {&#xA;         "token": "Lurasidone",&#xA;         "start_offset": 0,&#xA;         "end_offset": 10,&#xA;         "type": "&lt;ALPHANUM&gt;",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "dopamine",&#xA;         "start_offset": 16,&#xA;         "end_offset": 24,&#xA;         "type": "&lt;ALPHANUM&gt;",&#xA;         "position": 4&#xA;      },&#xA;      {&#xA;         "token": "D2",&#xA;         "start_offset": 25,&#xA;         "end_offset": 38,&#xA;         "type": "&lt;ALPHANUM&gt;",&#xA;         "position": 5&#xA;      }&#xA;   ]&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>I hope this helps.</p>&#xA;