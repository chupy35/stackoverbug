33301119
Error with Elasticsearch Helpers Scan API when using query parameter
<p>I am using Elasticsearch Helpers Scan API to output all bulk records from my index.&#xA;I wanted to use the query parameter to filter the certain records first and then use scan for which I referred to the standard doc for scan here . But as soon as I apply the query parameter it gives me a 400 error. Here is my line of code and error.</p>&#xA;&#xA;<p>Script:</p>&#xA;&#xA;<pre><code>import elasticsearch&#xA;import elasticsearch.exceptions &#xA;import elasticsearch.helpers as helpers&#xA;import time&#xA;&#xA;&#xA;es = elasticsearch.Elasticsearch('XXX.XX.XX.XX'],retry_on_timeout=True)  &#xA;&#xA;&#xA;scanResp = helpers.scan(client=es,scroll="5m",query={"match":{"channel_id": "34"}},index="my-index",timeout="10m",size=500)&#xA;&#xA;resp={}&#xA;start_time = time.time()&#xA;for resp in scanResp:&#xA;    data = resp&#xA;    #print data.values()[3]&#xA;&#xA;&#xA;print("--- %s seconds ---" % (time.time() - start_time))&#xA;</code></pre>&#xA;&#xA;<p>Output:</p>&#xA;&#xA;<blockquote>&#xA;  <p>RequestError: TransportError(400,&#xA;  u'SearchPhaseExecutionException[Failed to execute phase [init_scan],&#xA;  all shards failed; shardFailures&#xA;  {[lEAncRHvQHKpPqlfw1NWEQ][dev-godam][0]:&#xA;  SearchParseException[[dev-godam][0]: from[-1],size[-1]: Parse Failure&#xA;  [Failed to parse source [{"match": {"master_channel_id": "34"}}]]];&#xA;  nested: SearchParseException[[dev-godam][0]: from[-1],size[-1]: Parse&#xA;  Failure [No parser for element [match]]];&#xA;  }{[lEAncRHvQHKpPqlfw1NWEQ][dev-godam][1]:&#xA;  SearchParseException[[dev-godam][1]: from[-1],size[-1]: Parse Failure&#xA;  [Failed to parse source [{"match": {"master_channel_id": "34"}}]]];&#xA;  nested: SearchParseException[[dev-godam][1]: from[-1],size[-1]: Parse&#xA;  Failure [No parser for element [match]]];&#xA;  }{[lEAncRHvQHKpPqlfw1NWEQ][dev-godam][2]:&#xA;  SearchParseException[[dev-godam][2]: from[-1],size[-1]: Parse Failure&#xA;  [Failed to parse source [{"match": {"master_channel_id": "34"}}]]];&#xA;  nested: SearchParseException[[dev-godam][2]: from[-1],size[-1]: Parse&#xA;  Failure [No parser for element [match]]];&#xA;  }{[lEAncRHvQHKpPqlfw1NWEQ][dev-godam][3]:&#xA;  SearchParseException[[dev-godam][3]: from[-1],size[-1]: Parse Failure&#xA;  [Failed to parse source [{"match": {"master_channel_id": "34"}}]]];&#xA;  nested: SearchParseException[[dev-godam][3]: from[-1],size[-1]: Parse&#xA;  Failure [No parser for element [match]]];&#xA;  }{[lEAncRHvQHKpPqlfw1NWEQ][dev-godam][4]:&#xA;  SearchParseException[[dev-godam][4]: from[-1],size[-1]: Parse Failure&#xA;  [Failed to parse source [{"match": {"master_channel_id": "34"}}]]];&#xA;  nested: SearchParseException[[dev-godam][4]: from[-1],size[-1]: Parse&#xA;  Failure [No parser for element [match]]]; }]')</p>&#xA;</blockquote>&#xA;&#xA;<p>Looked on the internet but not sure what I have done wrong here.</p>&#xA;&#xA;<p>Any help is appreciated</p>&#xA;
<p>Your <code>body</code> parameter should be a dictionary instead of a string and use double quotes instead of single quotes, try this:</p>&#xA;&#xA;<pre><code>scanResp = helpers.scan(client=es,scroll="5m",query={"query":{"match": {"channel_id": "34"}}},index='stg-index',timeout="10m",size=500)&#xA;</code></pre>&#xA;