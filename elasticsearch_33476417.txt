33476417
Elasticsearch - using ngrams as a tokenizer and filter gives different outputs
<p>Can someone explain why using ngrams as a tokenzier gives a different output compared to when using it as a filter. For example using it as a tokenizer for "Paracetamol" I get:</p>&#xA;&#xA;<pre><code>{&#xA;   "tokens": [&#xA;      {&#xA;         "token": "par",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "para",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "parac",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "parace",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "paracet",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "paraceta",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "paracetam",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "paracetamo",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "paracetamol",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "ara",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "arac",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "arace",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "aracet",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "araceta",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "aracetam",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "aracetamo",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "aracetamol",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "rac",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "race",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "racet",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "raceta",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "racetam",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "racetamo",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "racetamol",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "ace",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "acet",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "aceta",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "acetam",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "acetamo",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "acetamol",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "cet",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "ceta",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "cetam",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "cetamo",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "cetamol",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "eta",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "etam",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "etamo",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "etamol",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "tam",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "tamo",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "tamol",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "amo",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "amol",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "mol",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      }&#xA;   ]&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Where as using it as a filter I get:</p>&#xA;&#xA;<pre><code>{&#xA;   "tokens": [&#xA;      {&#xA;         "token": "par",&#xA;         "start_offset": 0,&#xA;         "end_offset": 3,&#xA;         "type": "word",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "para",&#xA;         "start_offset": 0,&#xA;         "end_offset": 4,&#xA;         "type": "word",&#xA;         "position": 2&#xA;      },&#xA;      {&#xA;         "token": "parac",&#xA;         "start_offset": 0,&#xA;         "end_offset": 5,&#xA;         "type": "word",&#xA;         "position": 3&#xA;      },&#xA;      {&#xA;         "token": "parace",&#xA;         "start_offset": 0,&#xA;         "end_offset": 6,&#xA;         "type": "word",&#xA;         "position": 4&#xA;      },&#xA;      {&#xA;         "token": "paracet",&#xA;         "start_offset": 0,&#xA;         "end_offset": 7,&#xA;         "type": "word",&#xA;         "position": 5&#xA;      },&#xA;      {&#xA;         "token": "paraceta",&#xA;         "start_offset": 0,&#xA;         "end_offset": 8,&#xA;         "type": "word",&#xA;         "position": 6&#xA;      },&#xA;      {&#xA;         "token": "paracetam",&#xA;         "start_offset": 0,&#xA;         "end_offset": 9,&#xA;         "type": "word",&#xA;         "position": 7&#xA;      },&#xA;      {&#xA;         "token": "paracetamo",&#xA;         "start_offset": 0,&#xA;         "end_offset": 10,&#xA;         "type": "word",&#xA;         "position": 8&#xA;      },&#xA;      {&#xA;         "token": "paracetamol",&#xA;         "start_offset": 0,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 9&#xA;      },&#xA;      {&#xA;         "token": "ara",&#xA;         "start_offset": 1,&#xA;         "end_offset": 4,&#xA;         "type": "word",&#xA;         "position": 10&#xA;      },&#xA;      {&#xA;         "token": "arac",&#xA;         "start_offset": 1,&#xA;         "end_offset": 5,&#xA;         "type": "word",&#xA;         "position": 11&#xA;      },&#xA;      {&#xA;         "token": "arace",&#xA;         "start_offset": 1,&#xA;         "end_offset": 6,&#xA;         "type": "word",&#xA;         "position": 12&#xA;      },&#xA;      {&#xA;         "token": "aracet",&#xA;         "start_offset": 1,&#xA;         "end_offset": 7,&#xA;         "type": "word",&#xA;         "position": 13&#xA;      },&#xA;      {&#xA;         "token": "araceta",&#xA;         "start_offset": 1,&#xA;         "end_offset": 8,&#xA;         "type": "word",&#xA;         "position": 14&#xA;      },&#xA;      {&#xA;         "token": "aracetam",&#xA;         "start_offset": 1,&#xA;         "end_offset": 9,&#xA;         "type": "word",&#xA;         "position": 15&#xA;      },&#xA;      {&#xA;         "token": "aracetamo",&#xA;         "start_offset": 1,&#xA;         "end_offset": 10,&#xA;         "type": "word",&#xA;         "position": 16&#xA;      },&#xA;      {&#xA;         "token": "aracetamol",&#xA;         "start_offset": 1,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 17&#xA;      },&#xA;      {&#xA;         "token": "rac",&#xA;         "start_offset": 2,&#xA;         "end_offset": 5,&#xA;         "type": "word",&#xA;         "position": 18&#xA;      },&#xA;      {&#xA;         "token": "race",&#xA;         "start_offset": 2,&#xA;         "end_offset": 6,&#xA;         "type": "word",&#xA;         "position": 19&#xA;      },&#xA;      {&#xA;         "token": "racet",&#xA;         "start_offset": 2,&#xA;         "end_offset": 7,&#xA;         "type": "word",&#xA;         "position": 20&#xA;      },&#xA;      {&#xA;         "token": "raceta",&#xA;         "start_offset": 2,&#xA;         "end_offset": 8,&#xA;         "type": "word",&#xA;         "position": 21&#xA;      },&#xA;      {&#xA;         "token": "racetam",&#xA;         "start_offset": 2,&#xA;         "end_offset": 9,&#xA;         "type": "word",&#xA;         "position": 22&#xA;      },&#xA;      {&#xA;         "token": "racetamo",&#xA;         "start_offset": 2,&#xA;         "end_offset": 10,&#xA;         "type": "word",&#xA;         "position": 23&#xA;      },&#xA;      {&#xA;         "token": "racetamol",&#xA;         "start_offset": 2,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 24&#xA;      },&#xA;      {&#xA;         "token": "ace",&#xA;         "start_offset": 3,&#xA;         "end_offset": 6,&#xA;         "type": "word",&#xA;         "position": 25&#xA;      },&#xA;      {&#xA;         "token": "acet",&#xA;         "start_offset": 3,&#xA;         "end_offset": 7,&#xA;         "type": "word",&#xA;         "position": 26&#xA;      },&#xA;      {&#xA;         "token": "aceta",&#xA;         "start_offset": 3,&#xA;         "end_offset": 8,&#xA;         "type": "word",&#xA;         "position": 27&#xA;      },&#xA;      {&#xA;         "token": "acetam",&#xA;         "start_offset": 3,&#xA;         "end_offset": 9,&#xA;         "type": "word",&#xA;         "position": 28&#xA;      },&#xA;      {&#xA;         "token": "acetamo",&#xA;         "start_offset": 3,&#xA;         "end_offset": 10,&#xA;         "type": "word",&#xA;         "position": 29&#xA;      },&#xA;      {&#xA;         "token": "acetamol",&#xA;         "start_offset": 3,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 30&#xA;      },&#xA;      {&#xA;         "token": "cet",&#xA;         "start_offset": 4,&#xA;         "end_offset": 7,&#xA;         "type": "word",&#xA;         "position": 31&#xA;      },&#xA;      {&#xA;         "token": "ceta",&#xA;         "start_offset": 4,&#xA;         "end_offset": 8,&#xA;         "type": "word",&#xA;         "position": 32&#xA;      },&#xA;      {&#xA;         "token": "cetam",&#xA;         "start_offset": 4,&#xA;         "end_offset": 9,&#xA;         "type": "word",&#xA;         "position": 33&#xA;      },&#xA;      {&#xA;         "token": "cetamo",&#xA;         "start_offset": 4,&#xA;         "end_offset": 10,&#xA;         "type": "word",&#xA;         "position": 34&#xA;      },&#xA;      {&#xA;         "token": "cetamol",&#xA;         "start_offset": 4,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 35&#xA;      },&#xA;      {&#xA;         "token": "eta",&#xA;         "start_offset": 5,&#xA;         "end_offset": 8,&#xA;         "type": "word",&#xA;         "position": 36&#xA;      },&#xA;      {&#xA;         "token": "etam",&#xA;         "start_offset": 5,&#xA;         "end_offset": 9,&#xA;         "type": "word",&#xA;         "position": 37&#xA;      },&#xA;      {&#xA;         "token": "etamo",&#xA;         "start_offset": 5,&#xA;         "end_offset": 10,&#xA;         "type": "word",&#xA;         "position": 38&#xA;      },&#xA;      {&#xA;         "token": "etamol",&#xA;         "start_offset": 5,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 39&#xA;      },&#xA;      {&#xA;         "token": "tam",&#xA;         "start_offset": 6,&#xA;         "end_offset": 9,&#xA;         "type": "word",&#xA;         "position": 40&#xA;      },&#xA;      {&#xA;         "token": "tamo",&#xA;         "start_offset": 6,&#xA;         "end_offset": 10,&#xA;         "type": "word",&#xA;         "position": 41&#xA;      },&#xA;      {&#xA;         "token": "tamol",&#xA;         "start_offset": 6,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 42&#xA;      },&#xA;      {&#xA;         "token": "amo",&#xA;         "start_offset": 7,&#xA;         "end_offset": 10,&#xA;         "type": "word",&#xA;         "position": 43&#xA;      },&#xA;      {&#xA;         "token": "amol",&#xA;         "start_offset": 7,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 44&#xA;      },&#xA;      {&#xA;         "token": "mol",&#xA;         "start_offset": 8,&#xA;         "end_offset": 11,&#xA;         "type": "word",&#xA;         "position": 45&#xA;      }&#xA;   ]&#xA;}&#xA;</code></pre>&#xA;
<p>These two approaches may results equal outputs.<br>&#xA;But Depending on the circumstances one approach may be better than the other.<br>&#xA;If you need special characters in your search terms, you will probably need to use the ngram tokenizer in your mapping. It's useful to know how to use both.<br>&#xA;<a href="https://qbox.io/blog/an-introduction-to-ngrams-in-elasticsearch" rel="nofollow noreferrer">Reference</a></p>&#xA;