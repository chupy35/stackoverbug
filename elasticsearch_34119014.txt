34119014
Elasticsearch - simulate foreign key behavior
<p>I am having problem modeling my documents in Elasticsearch, while a foreign key in a relational db would have solved my problem very easily.&#xA;The closer I got was trying a parent child relationship, but my case has multiple parents to the same document ( I might looked at it the wrong way)</p>&#xA;&#xA;<p>Consider the following 3 documents from type person:<br>&#xA;doc1:</p>&#xA;&#xA;<pre><code>{&#xA;  _id: 10&#xA;  "source":{&#xA;    "first_name": "child1_first_name",&#xA;    "last_name": "child1_last_name",&#xA;    "age" : 10,&#xA;    "phone": "0505055050",&#xA;    .&#xA;    .&#xA;    "mother":{&#xA;      "id": 100&#xA;      "firt_name": "mother1",&#xA;      "last_name": "last_name1"&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>doc2:</p>&#xA;&#xA;<pre><code>{&#xA;  _id: 11&#xA;  "source":{&#xA;    "first_name": "child2_first_name",&#xA;    "last_name": "child2_last_name",&#xA;    "age" : 12,&#xA;    "phone": "878787878",&#xA;    .&#xA;    .&#xA;    "mother":{&#xA;      "id": 100&#xA;      "firt_name": "mother1",&#xA;      "last_name": "last_name1"&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>doc3:</p>&#xA;&#xA;<pre><code>{&#xA;  _id: 100&#xA;  "source":{&#xA;    "first_name": "mother1",&#xA;    "last_name": "last_name1",&#xA;    "age" : 40,&#xA;    "phone": "12212121212",&#xA;    .&#xA;    .&#xA;    "mother":{}&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>My problem is when the mother update her last name or first name.&#xA;Do I need to find all documents, that id 100 is their mother, and change their inner documents to the right first name and last name?</p>&#xA;&#xA;<p>This is just an example, my case is that I need to update 100+ children with the correct and new name of their mother.&#xA;In a relational database this would be easy by using foreign key.</p>&#xA;&#xA;<p>I tried to use this <a href="https://www.elastic.co/blog/managing-relations-inside-elasticsearch" rel="nofollow">reference</a> but couldn't find a solution to my problem.</p>&#xA;&#xA;<p>Any idea?</p>&#xA;
<p>Looks like you look for this:&#xA;Parent and Child documents in Elasticsearch&#xA;<a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/parent-child.html" rel="nofollow">https://www.elastic.co/guide/en/elasticsearch/guide/current/parent-child.html</a></p>&#xA;&#xA;<p>So you would first need to adapt the <code>mapping</code>so that <code>mother</code> can be used as parent and as a type itself -> more on <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/parent-child-mapping.html" rel="nofollow">https://www.elastic.co/guide/en/elasticsearch/guide/current/parent-child-mapping.html</a></p>&#xA;&#xA;<p>Then index as described in <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/indexing-parent-child.html" rel="nofollow">https://www.elastic.co/guide/en/elasticsearch/guide/current/indexing-parent-child.html</a> .</p>&#xA;&#xA;<pre><code>PUT /index_name/child/10?parent=100&#xA;</code></pre>&#xA;&#xA;<p>A change to the parent document now should lead to a change in all child documents.</p>&#xA;&#xA;<p>Side new: This plugin might be interesting for the solution: <a href="http://siren.solutions/relational-joins-for-elasticsearch-the-siren-join-plugin/" rel="nofollow">http://siren.solutions/relational-joins-for-elasticsearch-the-siren-join-plugin/</a></p>&#xA;