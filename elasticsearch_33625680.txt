33625680
remove document field on elasticsearch
<p>I'd like to update a document. So, each time I want to update a object I serialize it and I send it to ES. Imagine a POJO object with.</p>&#xA;&#xA;<pre><code>obj.status = 20;&#xA;obj.description = "raw description";&#xA;</code></pre>&#xA;&#xA;<p>When I update this object it's serialized and indexed on ES as:</p>&#xA;&#xA;<pre><code>{&#xA;    status: 20,&#xA;    description: "raw description"&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>So, I need now update this object as:</p>&#xA;&#xA;<pre><code>obj.status = null;&#xA;</code></pre>&#xA;&#xA;<p>Then, I serialize it:</p>&#xA;&#xA;<pre><code>{&#xA;    description: "raw description"&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>The problem is, from now then, I don't want <code>status</code> is indexed. The problem is that ES merges this object with the indexed previous one. So, on index this document is:</p>&#xA;&#xA;<pre><code>{&#xA;    status: 20,&#xA;    description: "raw description"&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>So, I need to "remove" this field from index.</p>&#xA;&#xA;<p>Any ideas.&#xA;Thanks.</p>&#xA;
<p>You have 2 solutions.</p>&#xA;&#xA;<ol>&#xA;<li>Use the Update API with <em>script</em> instead of <em>doc</em></li>&#xA;<li>Use the Index API, by reindexing a document with same Id you can remove a field. The Index API behaves likes an upsert.</li>&#xA;</ol>&#xA;&#xA;<p>Code examples:</p>&#xA;&#xA;<pre><code># Update API with Script&#xA;POST your_index/your_type/1/_update&#xA;{&#xA;    "script" : "ctx._source.remove(\"status\")"&#xA;}&#xA;# Index API to reindex&#xA;PUT your_index/your_type/1&#xA;{&#xA;    description: "raw description"&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>The Update API triggers a Read before Write, whereas the Index API only triggers a Write.</p>&#xA;