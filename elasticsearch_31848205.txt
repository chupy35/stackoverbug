31848205
elasticsearch aggregation result is 0
<p>The following is my query for elasticsearch:</p>&#xA;&#xA;<pre><code>GET index/_search&#xA;{&#xA;   "size": 0,&#xA;   "query": {&#xA;      "filtered": {&#xA;         "query": {&#xA;            "match_all": {}&#xA;         },&#xA;         "filter": {&#xA;            "and": [&#xA;               {&#xA;                  "term": {&#xA;                     "id_1": "xx"&#xA;                  }&#xA;               },&#xA;               {&#xA;                  "term": {&#xA;                     "level": "level2"&#xA;                  }&#xA;               },&#xA;               {&#xA;                  "or": [&#xA;                     {&#xA;                        "term": {&#xA;                           "type": "yyy"&#xA;                        }&#xA;                     },&#xA;                     {&#xA;                        "term": {&#xA;                           "type": "zzzz"&#xA;                        }&#xA;                     }&#xA;                  ]&#xA;               }&#xA;            ]&#xA;         }&#xA;      }&#xA;   },&#xA;   "aggs": {&#xA;      "variable": {&#xA;         "stats": {&#xA;            "field": "score"&#xA;         }&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>But the agg result is as follows:</p>&#xA;&#xA;<pre><code>{&#xA;   "took": 2,&#xA;   "timed_out": false,&#xA;   "_shards": {&#xA;      "total": 5,&#xA;      "successful": 5,&#xA;      "failed": 0&#xA;   },&#xA;   "hits": {&#xA;      "total": 68,&#xA;      "max_score": 0,&#xA;      "hits": []&#xA;   },&#xA;   "aggregations": {&#xA;      "variable": {&#xA;         "count": 30,&#xA;         "min": 0,&#xA;         "max": 0,&#xA;         "avg": 0,&#xA;         "sum": 0&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Why the min,max etc are 0. But value is there for score like(0.18,0.25,etc..). Also in mapping the type for score is long. Please help me to solve this. Thanks in advance.</p>&#xA;&#xA;<p>Edit:</p>&#xA;&#xA;<p>value in index:</p>&#xA;&#xA;<pre><code>"score": 0.18&#xA;</code></pre>&#xA;&#xA;<p>Single document:</p>&#xA;&#xA;<pre><code>{&#xA;            "_index": "index",&#xA;            "_type": "ppppp",&#xA;            "_id": "n0IiTEd2QFCnJUZOSiNu1w",&#xA;            "_score": 1,&#xA;            "_source": {&#xA;               "name_2": "aaa",&#xA;               "keyid": "bbbb",&#xA;               "qqq": "cccc",&#xA;               "level": "level2",&#xA;               "type": "kkk",&#xA;               "keytype": "Year",&#xA;               "org_id": 25,&#xA;               "tempid": "113",&#xA;               "id_2": "561",&#xA;               "name_1": "xxxxx",&#xA;               "date_obj": [&#xA;                  {&#xA;                     "keyid": "wwwww",&#xA;                     "keytype": "Year",&#xA;                     "value": 21.510617952000004,&#xA;                     "date": "2015",&#xA;                     "id": "ggggggg",&#xA;                     "productid": ""&#xA;                  },&#xA;                  {&#xA;                     "keyid": "rrrrrr",&#xA;                     "keytype": "Year",&#xA;                     "value": 0.13,&#xA;                     "date": "2015",&#xA;                     "id": "iiiiii",&#xA;                     "productid": ""&#xA;                  }&#xA;               ],&#xA;               "date": "2015",&#xA;               "ddddd": 21.510617952000004,&#xA;               "id_1": "29",&#xA;               "leveltype": "nnnn",&#xA;               "tttt": 0.13,&#xA;               "score": 0.13    -------------------&gt;problem           &#xA;            }&#xA;         }&#xA;</code></pre>&#xA;&#xA;<p>Mapping:</p>&#xA;&#xA;<pre><code>curl -XPUT ip:9200/index -d '{   &#xA;    "mappings" : {&#xA;        "places" : {            &#xA;            "properties" : {&#xA;                "score" : { "type" : "float"}                &#xA;            }&#xA;        }&#xA;}&#xA;}'&#xA;</code></pre>&#xA;
<p>The fix should be as simple as changing the type of the <code>score</code> field to <code>float</code> (or <code>double</code>) instead of <code>long</code>. <code>long</code> is an integer type and 0.18 will be indexed as 0 under the hood.</p>&#xA;&#xA;<pre><code>"score" : {&#xA;    "type" : "float",&#xA;    "null_value" : 0.0&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Note that you'll need to reindex your data after making the mapping change.</p>&#xA;