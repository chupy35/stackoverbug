32506110
Elasticsearch - Querying nested objects
<p>I'm storing objects in elasticsearch like this</p>&#xA;&#xA;<pre><code>{&#xA;  "user":{&#xA;           "name":"Johnson",&#xA;           "age":24&#xA;          }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Please note that I do not have a default mapping set in elasticsearch. I'm simply inserting the data directly.</p>&#xA;&#xA;<p>Now,&#xA;While using "nested query" to try to query the data.</p>&#xA;&#xA;<pre><code>GET user_index/user_document/_search&#xA;{&#xA;&#xA;  "query":{&#xA;        "nested" : {&#xA;            "path" : "user",&#xA;            "score_mode" : "avg",&#xA;            "query" : {&#xA;                "bool" : {&#xA;                    "must" : [&#xA;                        {&#xA;                            "match" : {"user.name" : "Johnson"}&#xA;                        }&#xA;                    ]&#xA;                }&#xA;            }&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>This fails and i get an error</p>&#xA;&#xA;<p><code>nested object under path [user] is not of nested type</code></p>&#xA;&#xA;<p>My Questions are</p>&#xA;&#xA;<ol>&#xA;<li>Should i create a default mapping for querying nested objects?</li>&#xA;<li><p>Why can't a query like this below (which works) be used instead?</p>&#xA;&#xA;<pre><code>GET user_index/_search&#xA; {&#xA;&#xA;    "query":{&#xA;&#xA;        "match":{&#xA;&#xA;              "user.name":"Johnson"&#xA;&#xA;                 }&#xA;&#xA;            } &#xA;&#xA;}&#xA;</code></pre></li>&#xA;</ol>&#xA;
<blockquote>&#xA;  <p>Should i create a default mapping for querying nested objects?</p>&#xA;</blockquote>&#xA;&#xA;<p>No.  Nested objects in ES are used when you are going to be putting many objects into the array and need to query them separately.  As a general rule, don't create nested objects until you find that you really need them.  They bite you more then they help you in most cases.</p>&#xA;&#xA;<blockquote>&#xA;  <p>Why can't a query like this below (which works) be used instead?</p>&#xA;</blockquote>&#xA;&#xA;<ol>&#xA;<li>ES lowercases everything for searchability.  </li>&#xA;<li>You should also use a "term" query when querying the whole value.  </li>&#xA;</ol>&#xA;&#xA;<p>Here is a sample for you:</p>&#xA;&#xA;<pre><code>PUT test&#xA;&#xA;POST test/index1&#xA;{&#xA;  "user":{&#xA;           "name":"Johnson",&#xA;           "age":24&#xA;          }&#xA;}&#xA;&#xA;GET test/index1/_search&#xA;{&#xA;  "query": {&#xA;    "term": {&#xA;      "user.name": {&#xA;        "value": "johnson"&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;