34206629
Elasticsearch Filtering part of date ignoring Year like SQL DATEPART function
<p>The problem is similar to <a href="https://stackoverflow.com/questions/24010876/elasticsearch-filtering-by-part-of-date">Elasticsearch filtering by part of date</a></p>&#xA;&#xA;<p>I have a document having one field mapping is like :</p>&#xA;&#xA;<pre><code>"ActivityDate": {&#xA;                  "type": "date",&#xA;                  "ignore_malformed": true,&#xA;                  "format": "yyyy-MM-dd HH:mm:ss.SSS"&#xA;               }&#xA;</code></pre>&#xA;&#xA;<p>I am trying to get all ActivityDate that happened on 9th of December, irrespective of years.&#xA;I am trying various way of script filter like :</p>&#xA;&#xA;<pre><code>{&#xA;  "query":{&#xA;    "filtered":{&#xA;      "filter":{&#xA;        "script":{&#xA;          "script":" doc['ActivityDate'].value.getMonth() == 12" ,&#xA;          "lang":"expression"&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;
<p>You're almost there, you need to do it like this:</p>&#xA;&#xA;<pre><code>{&#xA;  "query":{&#xA;    "filtered":{&#xA;      "filter":{&#xA;        "script":{&#xA;          "script": "doc.ActivityDate.date.getMonthOfYear() == 12 &amp;&amp; doc.ActivityDate.date.getDayOfMonth() == 9"&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p><strong>UPDATE</strong></p>&#xA;&#xA;<p>Based on our discussion in comments, the only thing I can think of is because of the <code>ignore_malformed</code> property being true. Some dates probably don't satisfy the pattern you've configured and are thus not <code>Date</code> objects but <code>String</code> ones. That's the only thing that would explain the error you're getting.</p>&#xA;