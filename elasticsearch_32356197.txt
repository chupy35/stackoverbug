32356197
Elasticsearch indices.breaker.fielddata.limit settings
<p>I can set the breaker.fielddata limit with CURL, but the setup from config is not respected:</p>&#xA;&#xA;<p>ES version: 1.6.0</p>&#xA;&#xA;<p>In my node config</p>&#xA;&#xA;<blockquote>&#xA;  <p>/etc/elasticsearch/elasticsearch.yml</p>&#xA;</blockquote>&#xA;&#xA;<pre><code>indices.breaker.fielddata.limit: 60%&#xA;#indices.breaker.fielddata.limit: 60% # this should work, but is not&#xA;#indices.fielddata.breaker.limit: 60% # this is deprecated&#xA;indices.breaker.total.limit: 70%&#xA;&#xA;indices.breaker.request.limit: 50%&#xA;indices.fielddata.cache.size:  60%&#xA;</code></pre>&#xA;&#xA;<p>The fielddata limit is set to 60% (4.7g of 8g heap) in the config, but:</p>&#xA;&#xA;<blockquote>&#xA;  <p>curl -XGET '<a href="http://localhost:9200/_nodes/stats?pretty" rel="nofollow">http://localhost:9200/_nodes/stats?pretty</a>' |less</p>&#xA;&#xA;<pre><code>"breakers" : {&#xA;    "request" : {&#xA;      "limit_size_in_bytes" : 4277534720,&#xA;      "limit_size" : "3.9gb",&#xA;      "estimated_size_in_bytes" : 0,&#xA;      "estimated_size" : "0b",&#xA;      "overhead" : 1.0,&#xA;      "tripped" : 0&#xA;    },&#xA;    "fielddata" : {&#xA;      "limit_size_in_bytes" : 3422027776,&#xA;      "limit_size" : "3.1gb",&#xA;      "estimated_size_in_bytes" : 0,&#xA;      "estimated_size" : "0b",&#xA;      "overhead" : 1.0,&#xA;      "tripped" : 0&#xA;    },&#xA;    "parent" : {&#xA;      "limit_size_in_bytes" : 5988548608,&#xA;      "limit_size" : "5.5gb",&#xA;      "estimated_size_in_bytes" : 55438576,&#xA;      "estimated_size" : "52.8mb",&#xA;      "overhead" : 1.0,&#xA;      "tripped" : 0&#xA;    }&#xA;  }&#xA;</code></pre>&#xA;</blockquote>&#xA;&#xA;<p>As You see, the size of &#xA;<em>indices.breaker.request.limi</em>t did change form 40% to 50%&#xA;while&#xA;<em>indices.breaker.fielddata.limi</em>t is still 40% (3,1g)</p>&#xA;&#xA;<p>With a curl:</p>&#xA;&#xA;<blockquote>&#xA;  <p>curl -XPUT '<a href="http://localhost:9200/_cluster/settings" rel="nofollow">http://localhost:9200/_cluster/settings</a>' -d '{&#xA;  "persistent" : { "indices.breaker.fielddata.limit" : "60%" } }'</p>&#xA;</blockquote>&#xA;&#xA;<p>I can change the&#xA;<em>indices.breaker.fielddata.limit</em> to 60%</p>&#xA;&#xA;<p><strong>Why the line form the config is not respected?</strong></p>&#xA;&#xA;<pre><code>indices.breaker.fielddata.limit: 60%&#xA;</code></pre>&#xA;
<p>Seems like this is a known issue specified here  <a href="https://github.com/elastic/elasticsearch/pull/7704" rel="nofollow noreferrer">issue:1</a>,<a href="https://github.com/elastic/elasticsearch/issues/3670" rel="nofollow noreferrer">issue:2</a>.&#xA;In essence once you have dynamically updated the the breaker setting and set it as persistent there is no ideal way to reset to the defaults specified in config file.&#xA;The persistent settings are themselves are stored in the <a href="https://stackoverflow.com/questions/21804987/where-does-elasticsearch-store-persistent-settings">global cluster state file</a> and these settings override the setting in the config file (<a href="https://github.com/elastic/elasticsearch/issues/3671" rel="nofollow noreferrer">issue:3</a>)</p>&#xA;