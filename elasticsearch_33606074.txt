33606074
elasticsearch query nested array of objects
<p>Hi I am trying to get a query to filter based on values in an array of objects, the structure is like this </p>&#xA;&#xA;<pre><code>{&#xA;  "_index": "test",&#xA;  "_type": "home",&#xA;  "_id": "1247816",&#xA;  "_score": 1,&#xA;  "_source": {&#xA;    "TranCust": {&#xA;      "CustId": 1247816,&#xA;      "sourceNodeName": "SRC"&#xA;    },&#xA;    "TranList": [&#xA;      {&#xA;        "TranId": 2431015,&#xA;        "batchNr": "211"&#xA;      },&#xA;      {&#xA;        "TranId": 2431016,&#xA;        "batchNr": "213"&#xA;      }&#xA;    ]&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>as an example, i would like to find all documents with a TranId of 2431015, my query looks like this </p>&#xA;&#xA;<pre><code>{&#xA;  "query": {&#xA;    "bool": {&#xA;      "must": [&#xA;        {&#xA;          "nested": {&#xA;            "path": "TranList",&#xA;            "query": {&#xA;              "bool": {&#xA;                "must": [&#xA;                  {&#xA;                    "match": {&#xA;                      "TranId": "2431015"&#xA;                    }&#xA;                  }&#xA;                ]&#xA;              }&#xA;            }&#xA;          }&#xA;        }&#xA;      ]&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>it seems to return no results, is there a better way to try and write this query ?</p>&#xA;&#xA;<p><strong>EDIT,&#xA;here are the mappings put in</strong> </p>&#xA;&#xA;<pre><code>{&#xA; "mappings": {&#xA;    "home": {&#xA;        "properties": {&#xA;            "TranCust": {&#xA;                "type": "object"&#xA;                }&#xA;            },&#xA;            "TranList": {&#xA;                "type": "nested"&#xA;            }&#xA;        }&#xA;    }&#xA; }&#xA;}&#xA;</code></pre>&#xA;
<p>ok so after lots of attempts this is how i got it to work</p>&#xA;&#xA;<pre><code>{"query": {&#xA;"bool": {&#xA;  "must": [&#xA;    {&#xA;      "nested": {&#xA;        "path": "TranList", &#xA;        "query": {&#xA;          "bool": {&#xA;            "must": [ &#xA;              { "match": { "TranList.TranId ": "2431015" }}&#xA;            ]&#xA;    }}}}&#xA;  ]&#xA;}}&#xA;}&#xA;</code></pre>&#xA;