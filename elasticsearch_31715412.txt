31715412
Query to fetch documents that have a specific number of filtered nested documents
<p>I have an Elastic Search document type with a structure as shown below.</p>&#xA;&#xA;<pre><code>// Let's call this the PARENT document&#xA;{&#xA;  "id": "...",&#xA;  ... other fields&#xA;  // events are NESTED documents&#xA;  "events": [&#xA;    {&#xA;      "type": "TYPE_A",&#xA;      "date": "&lt;date 1&gt;"&#xA;    },&#xA;    {&#xA;      "type": "TYPE_A",&#xA;      "date": "&lt;date 2&gt;"&#xA;    },&#xA;    {&#xA;      "type": "TYPE_B",&#xA;      "date": "&lt;date 3&gt;"&#xA;    }&#xA;  ]&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>How do I write a query that fetches me all the parent documents where</p>&#xA;&#xA;<ol>&#xA;<li>between dates [date 1 - date 3]</li>&#xA;<li>N number of TYPE_A events have occurred</li>&#xA;</ol>&#xA;&#xA;<p>I can write a nested terms filter matching TYPE_A combined with a range filter on the dates to find all occurrences of the event between specified date range. But is there no way to now specify that N number of such events must have occurred?</p>&#xA;&#xA;<p>I'm even open to changing my existing model schema if someone can point out a way in this can be achieved.</p>&#xA;&#xA;<p>An example for a real life query matching this would be along the lines - find me all StackOverflow users who have answered more than 5 JavaScript questions in the last 30 days</p>&#xA;