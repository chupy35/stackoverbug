28472008
Elasticsearch counts of multiple indices
<p>I am creating a report to compare actual count from database with indexed records.</p>&#xA;&#xA;<p>I have three indices index1, index2 and index3</p>&#xA;&#xA;<p>To get the count for a single index i am using the following URL</p>&#xA;&#xA;<pre><code>http://localhost:9200/index1/_count?q=_type:invoice&#xA;&#xA;=&gt; {"count":50,"_shards":{"total":5,"successful":5,"failed":0}}&#xA;</code></pre>&#xA;&#xA;<p>For multiple indices:</p>&#xA;&#xA;<pre><code>http://localhost:9200/index1,index2/_count?q=_type:invoice&#xA;&#xA;=&gt; {"count":80,"_shards":{"total":5,"successful":5,"failed":0}}&#xA;</code></pre>&#xA;&#xA;<p>Now the count is added up, i want it to grouped by index also how can i pass filters group by a specific field&#xA;to get the output like this:</p>&#xA;&#xA;<pre><code>{"index1_count":50,"index2_count":50,"approved":10,"rejected":40 ,"_shards":{"total":5,"successful":5,"failed":0}}&#xA;</code></pre>&#xA;
<p>You can use <code>_search?search_type=count</code> and do an aggregation based on <code>_index</code> field to make the distinction between the indices:</p>&#xA;&#xA;<pre><code>GET /index1,index2/_search?search_type=count&#xA;{&#xA;  "aggs": {&#xA;    "by_index": {&#xA;      "terms": {&#xA;        "field": "_index"&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>and the result would be something like this:</p>&#xA;&#xA;<pre><code>"aggregations": {&#xA;      "by_index": {&#xA;         "doc_count_error_upper_bound": 0,&#xA;         "sum_other_doc_count": 0,&#xA;         "buckets": [&#xA;            {&#xA;               "key": "index1",&#xA;               "doc_count": 50&#xA;            },&#xA;            {&#xA;               "key": "index2",&#xA;               "doc_count": 80&#xA;            }&#xA;         ]&#xA;      }&#xA;   }&#xA;</code></pre>&#xA;