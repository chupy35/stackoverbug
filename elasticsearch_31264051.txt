31264051
ElasticSearch Score Function Depending on Neighbor Documents
<p>I have an ElasticSearch index with 2 mappings (types).&#xA;In the app I need to display a paginated feed containing items of both types.&#xA;Currently the items are sorted just by creation date, but I also want to have control on how the items alternate with each other on the page.&#xA;For example, I want to set a rule for sequence "3 items of type A, 1 item of type B, and so on".&#xA;I need it to make sure items of both types are displayed on each page and equally distributed across the pages.</p>&#xA;&#xA;<p>But as far as I see it's not possible to access another documents in custom score function script.</p>&#xA;&#xA;<p>Of course it's easy to implement directly in the app logic, but it's not clear how to implement pagination using this way.</p>&#xA;&#xA;<p>Any ideas on how to achieve that?</p>&#xA;
<p>I don't think you can do this.</p>&#xA;&#xA;<p>One approach (that doesn't work) is to keep a global variable in a script and to increment that once every document is being returned/processed. And then to take this number, divide it by 3 and get the modulo number. Based on this number, to sort the docs. <strong>But</strong> "global" variables are not possible in sripts.</p>&#xA;&#xA;<p>The only two approaches that I can think of is to use a script to generate a random number and based on that to sort. In this way, you get some chances to have a "mixed list of types.</p>&#xA;&#xA;<p>Or, if you want the smallest deterministic way of sorting the docs, still in a script take the ID of the document (you said is a number) modulo 3 it and use the value to sort.</p>&#xA;&#xA;<p>For the random approach:</p>&#xA;&#xA;<pre><code>  "sort": [&#xA;    {&#xA;      "date": {&#xA;        "order": "desc"&#xA;      }&#xA;    },&#xA;    {&#xA;      "_script": {&#xA;        "script": "Math.random()",&#xA;        "type": "number",&#xA;        "order": "asc"&#xA;      }&#xA;    }&#xA;  ]&#xA;</code></pre>&#xA;