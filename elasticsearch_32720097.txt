32720097
Elasticsearch not_analyzed field transform double '$' symbol
<p>I have a problem when I include a double dollar sign symbol in a not analyzed field. When I check the mapping for the type with the following command:</p>&#xA;&#xA;<pre><code>curl -XGET 'http://localhost:9200/documents/_mapping/document'&#xA;</code></pre>&#xA;&#xA;<p>I get this output for the code field:</p>&#xA;&#xA;<pre><code>{&#xA;  "documents": {&#xA;    "mappings": {&#xA;      "document": {&#xA;        "properties": {&#xA;          "code": {&#xA;            "index": "not_analyzed",&#xA;            "type": "string"&#xA;          },&#xA;          // More field mappings&#xA;</code></pre>&#xA;&#xA;<p>If I test the mapping with the following command:</p>&#xA;&#xA;<pre><code>curl -XGET 'http://localhost:9200/documents/_analyze?field=code' -d "ABC$"&#xA;</code></pre>&#xA;&#xA;<p>I get the following output:</p>&#xA;&#xA;<pre><code>{"tokens":[{"token":"ABC$","start_offset":0,"end_offset":4,"type":"word","position":1}]}&#xA;</code></pre>&#xA;&#xA;<p>This is ok because the token has the same value that the data entered in the command. The problem is when I use a double dollar sign like this:</p>&#xA;&#xA;<pre><code>Â curl -XGET 'http://localhost:9200/documents/_analyze?field=code' -d "ABC$$"&#xA;</code></pre>&#xA;&#xA;<p>Then I get the following token:</p>&#xA;&#xA;<pre><code>{"tokens":[{"token":"ABC4088","start_offset":0,"end_offset":7,"type":"word","position":1}]}&#xA;</code></pre>&#xA;&#xA;<p>It looks like the double dollar sign gets replaced by the number 4088. According to the docs, the not_analyzed index attribute means:</p>&#xA;&#xA;<blockquote>&#xA;  <p>Index this field, so it is searchable, but index the value <strong>exactly</strong> as specified. Do not analyze it.</p>&#xA;</blockquote>&#xA;&#xA;<p>Do miss something in the code field mapping to avoid this? </p>&#xA;
<p>This is because <code>$$</code> is a special environment variable in your shell that gets expanded to the ID of the current shell process.</p>&#xA;&#xA;<p>So when running the <code>curl</code> command what happens is that the PID of your current shell is resolved and replaces the <code>$$</code> variable, hence the <code>4088</code> you see instead of <code>$$</code>.</p>&#xA;&#xA;<p>Try to issue <code>echo $$</code> and you'll see the ID of your current shell.</p>&#xA;&#xA;<pre><code>curl -XGET 'http://localhost:9200/documents/_analyze?field=code' -d "ABC4088"&#xA;                                                                          ^&#xA;                                                                          |&#xA;                                          $$ replaced by the ID of your process&#xA;</code></pre>&#xA;&#xA;<p>Try to simply escape the <code>$</code> characters and you should be fine</p>&#xA;&#xA;<pre><code>curl -XGET 'http://localhost:9200/documents/_analyze?field=code' -d "ABC\$\$"&#xA;</code></pre>&#xA;