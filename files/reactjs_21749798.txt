21749798
How can I reset a react component including all transitively reachable state?
<p>I occasionally have react components that are conceptually stateful which I want to reset.  The ideal behavior would be equivalent to removing the old component and readding a new, pristine component.</p>&#xA;&#xA;<p>React provides a method <code>setState</code> which allows setting the components own explicit state, but that excludes implicit state such as browser focus and form state, and it also excludes the state of its children.  Catching all that indirect state can be a tricky task, and I'd prefer to solve it rigorously and completely rather that playing whack-a-mole with every new bit of surprising state.</p>&#xA;&#xA;<p>Is there an API or pattern to do this?</p>&#xA;&#xA;<p><strong>Edit:</strong>  I made a trivial example demonstrating the <code>this.replaceState(this.getInitialState())</code> approach and contrasting it with the <code>this.setState(this.getInitialState())</code> approach: <a href="https://jsfiddle.net/emn13/kdrzk6gh/">https://jsfiddle.net/emn13/kdrzk6gh/</a> - <code>replaceState</code> is more robust.</p>&#xA;
<p>To ensure that the implicit browser state you mention and state of children is reset, you can add a <a href="https://reactjs.org/docs/lists-and-keys.html#keys" rel="noreferrer"><code>key</code> attribute</a> to the root-level component returned by <code>render</code>; when it changes, that component will be thrown away and created from scratch.</p>&#xA;&#xA;<pre><code>render: function() {&#xA;    // ...&#xA;    return &lt;div key={uniqueId}&gt;&#xA;        {children}&#xA;    &lt;/div&gt;;&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>There's no shortcut to reset the individual component's local state.</p>&#xA;
<p>You should actually avoid <code>replaceState</code> and use <code>setState</code> instead.</p>&#xA;&#xA;<p>The docs say that <code>replaceState</code> "may be removed entirely in a future version of React." I think it will most definitely be removed because <code>replaceState</code> doesn't really jive with the philosophy of React. It facilitates making a React component begin to feel kinda swiss knife-y.&#xA;This grates against the natural growth of a React component of becoming smaller, and more purpose-made.</p>&#xA;&#xA;<p>In React, if you have to err on generalization or specialization: aim for specialization. As a corollary, the state tree for your component should have a certain parsimony (it's fine to tastefully break this rule if you're scaffolding out a brand-spanking new product though).</p>&#xA;&#xA;<p>Anyway this is how you do it. Similar to Ben's (accepted) answer above, but like this:</p>&#xA;&#xA;<pre><code>this.setState(this.getInitialState());&#xA;</code></pre>&#xA;&#xA;<p>Also (like Ben also said) in order to reset the "browser state" you need to remove that DOM node. Harness the power of the vdom and use a new <code>key</code> prop for that component. The new render will replace that component wholesale.</p>&#xA;&#xA;<p>Reference: <a href="https://facebook.github.io/react/docs/component-api.html#replacestate">https://facebook.github.io/react/docs/component-api.html#replacestate</a></p>&#xA;