26383015
Conditional mixins in React?
<p>Is it possible to build the mixin array for a React component based on a prop?</p>&#xA;&#xA;<p>I have one component with a prop that may take one of two values. Based on this, I need radically different behavior from one of my mixins. I'd like to separate this mixin into two separate files rather than having monstrous conditional statements everywhere, but I can't find an easy way to do this. Any tips?</p>&#xA;
<p>No, it's not possible. Without knowing anymore, it sounds like you might want to explore the idea of creating different components and conditionally using the right one from the parent. You could even wrap this up and hide that from consumers if you want.</p>&#xA;
<p>Natively no, it's better to build separate components depending on the conditions. However there is a 3rd party component called <a href="https://github.com/jhudson8/react-mixin-manager" rel="nofollow">react-mixin-manager</a> that can do dynamic mixins based on conditions and mixins that accept parameters. However I haven't used it, so I can't really vouch it and I don't recommend using it on a production site, but feel free to play around with that</p>&#xA;
<p>As mentioned by others, this is probably a terrible idea, but in the spirt of "anything is possible", here it goes.</p>&#xA;&#xA;<p>First we need to define an interface for testing a prop.  It's fully flexibly, with a convenience default.</p>&#xA;&#xA;<pre class="lang-js prettyprint-override"><code>var hasOwn = Function.prototype.call.bind(Object.prototype.hasOwnProperty);&#xA;function testProps(obj, thisArg){&#xA;    return Object.keys(obj).every(function(propName){&#xA;        var test = obj[propName], prop = thisArg.props[propName];&#xA;        if (typeof test === "function"){&#xA;            return test(prop);&#xA;        }&#xA;        else {&#xA;            return prop === test;&#xA;        }&#xA;    });&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>An example of what you'd pass to that is <code>{foo: true, bar: odd}</code> where odd returns true if a number is odd.  When called with <code>&lt;Component foo={true} bar={7} /&gt;</code> the mixin would be 'active'.</p>&#xA;&#xA;<p>Using that, we can define a function which takes an array of <code>{mixin: mixin, condition: tests}</code>, where tests is in the aforementioned format.</p>&#xA;&#xA;<pre class="lang-js prettyprint-override"><code>function conditionalizeMixins(mixins){&#xA;   var proxyMixin = {};&#xA;&#xA;   var runMixins = function(lifeCycleKey){&#xA;      return function(){&#xA;          var component = this, args = arguments;&#xA;          var result;&#xA;&#xA;          mixins.forEach(function(mixin){&#xA;              if (testProps(mixin.condition, component)) {&#xA;                  result = mixin.mixin[lifeCycleKey].apply(component, args);&#xA;              }&#xA;          });&#xA;          return result;&#xA;      }&#xA;   }&#xA;&#xA;   mixins.forEach(function(mixin){&#xA;      Object.keys(mixin.mixin).forEach(function(key){&#xA;         if (proxyMixin[key]) return;&#xA;         proxyMixin[key] = runMixins(key);&#xA;      });&#xA;   });&#xA;&#xA;   return proxyMixin;&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Now we can define our mixins like so:</p>&#xA;&#xA;<pre class="lang-js prettyprint-override"><code>  mixins: [conditionalizeMixins([&#xA;    {&#xA;       mixin: myMixin,&#xA;       condition: {foo: true, bar: false}&#xA;    },&#xA;    {&#xA;       mixin: myMixin,&#xA;       condition: {foo: false, num: function(x){return x%2===1}}&#xA;    }&#xA;  ])]&#xA;</code></pre>&#xA;&#xA;<p>See if there's a way to split this into two components, rather than a single component.  That's likely the best way to go about this.</p>&#xA;&#xA;<p>Notes about the above code:</p>&#xA;&#xA;<ul>&#xA;<li>performance isn't great, but could be optimized</li>&#xA;<li>if multiple conditional mixins define, e.g., getInitialState, only the last active one is used</li>&#xA;<li>it hides errors, e.g. if you define doFoo which returns a string, and none of the mixins are active, it'll silently return undefined</li>&#xA;</ul>&#xA;&#xA;<p><a href="http://jsbin.com/fidomoroyidi/3/edit" rel="nofollow">jsbin</a></p>&#xA;