20608417 elasticsearch: how to free store size after deleting documents

On my elasticsearch server: total documents: 3 million, total size: 3.6G Then,
I delete about 2.8 millions documents: total documents: about 0.13 million,
total size: 3.6G

I have deleted the documents, how should I free the size of the documents?

Deleting documents only flags these as deleted, so they would not be searched.
To reclaim disk space, you have to optimize the index:

    
    
    curl -XPOST 'http://localhost:9200/_optimize?only_expunge_deletes=true'
    

documentation:
<http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/indices-
optimize.html>

### Update

Starting with Elasticsearch 2.1.x, `optimize` [is
deprecated](https://www.elastic.co/guide/en/elasticsearch/reference/2.1/breaking_21_index_apis.html#_optimize_api)
in [favor of](https://github.com/elastic/elasticsearch/pull/13778)
`forcemerge`. The API is [the
same](https://www.elastic.co/guide/en/elasticsearch/reference/2.1/indices-
forcemerge.html#indices-forcemerge), only the endpoint did change.

    
    
    curl -XPOST 'http://localhost:9200/_forcemerge?only_expunge_deletes=true'
    

In the current elasticsearch version(5.4),

  1. To optimize all indices:

`POST /_all/_forcemerge?only_expunge_deletes=true`

  2. To optimize single index

`POST /twitter/_forcemerge?only_expunge_deletes=true` , where twitter is the
index

Reference:
<https://www.elastic.co/guide/en/elasticsearch/reference/5.4/indices-
forcemerge.html#indices-forcemerge>

