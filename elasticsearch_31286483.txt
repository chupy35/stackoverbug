31286483
Failing with dynamic templates in ElasticSearch
<p>I try to create a simple template, including some dynamic template, and I can't seem to index documents.</p>&#xA;&#xA;<p>I get the error:</p>&#xA;&#xA;<pre><code>400 {"error":"MapperParsingException[mapping [_default_]]; nested: ClassCastException[java.util.LinkedHashMap cannot be cast to java.util.List]; ","status":400}&#xA;</code></pre>&#xA;&#xA;<p>It works fine if I remove the <code>dynaic_templates</code> part of the JSON.</p>&#xA;&#xA;<p>What am I doing wrong?</p>&#xA;&#xA;<p>Here is a reproduction of the code in python:</p>&#xA;&#xA;<pre><code>import requests&#xA;import json&#xA;&#xA;template = {&#xA;    "template": "some_index_*",&#xA;    "settings": {&#xA;        "index": {&#xA;            "number_of_replicas": "0",&#xA;            "number_of_shards": "8",&#xA;&#xA;        }&#xA;    },&#xA;    "mappings": {&#xA;        "_default_": {&#xA;            "_all": {&#xA;                "enabled": False&#xA;            },&#xA;            "properties": {&#xA;                "H1": {&#xA;                    "properties": {&#xA;                        "sub1": {&#xA;                            "doc_values": True,&#xA;                            "type": "boolean",&#xA;                            "index": "not_analyzed"&#xA;                        },&#xA;                        "sub2": {&#xA;                            "index": "no",&#xA;                            "type": "string"&#xA;                        },&#xA;                    }&#xA;                }&#xA;            },&#xA;            "dynamic_templates": {&#xA;                "text_indexed_template": {&#xA;                    "match_mapping_type": "string",&#xA;                    "mapping": {&#xA;                        "index": "not_analyzed",&#xA;                        "type": "string",&#xA;                        "doc_values": True&#xA;                    },&#xA;                    "match": "*_idx"&#xA;                }&#xA;            },&#xA;            "_source": {&#xA;                "compress": False&#xA;            }&#xA;        }&#xA;    },&#xA;}&#xA;&#xA;res = requests.put(&#xA;    url="http://127.0.0.1:9200/" + "_template/my_template/",&#xA;    data=json.dumps(template)&#xA;)&#xA;&#xA;print res.status_code, res.content&#xA;&#xA;new_doc = {&#xA;            "H1": {&#xA;                "sub1": True,&#xA;                "sub2": "testing, testing"&#xA;            }&#xA;        }&#xA;&#xA;res = requests.post(&#xA;    url="http://127.0.0.1:9200/" + 'some_index_tryme/record/',&#xA;    data=json.dumps(new_doc)&#xA;)&#xA;&#xA;print res.status_code, res.content&#xA;</code></pre>&#xA;
<p>The <code>dynamic_templates</code> should be an array of elements, meaning surrounded by <code>[ ]</code>. So, yours should look like this:</p>&#xA;&#xA;<pre><code>  "dynamic_templates": [&#xA;    {&#xA;      "text_indexed_template": {&#xA;        "match_mapping_type": "string",&#xA;        "mapping": {&#xA;          "index": "not_analyzed",&#xA;          "type": "string",&#xA;          "doc_values": true&#xA;        },&#xA;        "match": "*_idx"&#xA;      }&#xA;    }&#xA;  ]&#xA;</code></pre>&#xA;