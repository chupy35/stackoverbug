32587257
elasticsearch aggregation PHP
<p>i am trying to get the unique values from my elasticsearch database.</p>&#xA;&#xA;<p>So i want the unique names from my elasticsearch database.</p>&#xA;&#xA;<p>So i am aggregation like so ---              </p>&#xA;&#xA;<pre><code>   $paramss = [&#xA;            'index' =&gt; 'myIndex',&#xA;            'type' =&gt; 'myType',&#xA;            'ignore_unavailable' =&gt; true,&#xA;            'ignore' =&gt; [404, 500]&#xA;        ];&#xA;&#xA;&#xA;    $paramss['body'] = &lt;&lt;&lt;JSON&#xA;{&#xA;"size": 0,&#xA;"aggs" : {&#xA;    "langs" : {&#xA;        "terms" : { "field" : "name" }&#xA;    }&#xA;}}&#xA;JSON;&#xA;&#xA;        $results = $client-&gt;search($paramss);&#xA;        print_r(json_encode($results));&#xA;</code></pre>&#xA;&#xA;<p>i get the result like so---</p>&#xA;&#xA;<pre><code>{&#xA;took: 3,&#xA;timed_out: false,&#xA;_shards: {&#xA;    total: 5,&#xA;    successful: 5,&#xA;    failed: 0&#xA;},&#xA;hits: {&#xA;    total: 1852,&#xA;    max_score: 0,&#xA;    hits: [&#xA;&#xA;    ]&#xA;},&#xA;aggregations: {&#xA;    langs: {&#xA;        buckets: [&#xA;            {&#xA;                key: "aaaa.se",&#xA;                doc_count: 430&#xA;            },&#xA;            {&#xA;                key: "bbbb.se",&#xA;                doc_count: 358&#xA;            },&#xA;            {&#xA;                key: "cccc.se",&#xA;                doc_count: 49&#xA;            },&#xA;            {&#xA;                key: "eeee.com",&#xA;                doc_count: 46&#xA;            }&#xA;        ]&#xA;    }&#xA;}&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>But the problem is i am not getting all the unique values, I am getting only <strong>10 values</strong>, which is default value for elasticsearch query.</p>&#xA;&#xA;<p>So how can i change the query size !!!</p>&#xA;&#xA;<p>i tried like so---</p>&#xA;&#xA;<pre><code>   $paramss = [&#xA;            'index' =&gt; 'myIndex',&#xA;            'type' =&gt; 'myType',&#xA;            'size' =&gt; 1000,&#xA;            'ignore_unavailable' =&gt; true,&#xA;            'ignore' =&gt; [404, 500]&#xA;        ];&#xA;</code></pre>&#xA;&#xA;<p>which returns me some weird documents.</p>&#xA;&#xA;<p>So do anyone knows the solution of this problem.</p>&#xA;&#xA;<p>How can i get all the unique names from my elasticsearch database, can someone help me to fix this problem. </p>&#xA;
<p>You need to put size parameter inside terms:</p>&#xA;&#xA;<pre><code>{&#xA;"aggs" : {&#xA;    "langs" : {&#xA;        "terms" : { &#xA;            "field" : "name",&#xA;            "size": 0&#xA;        }&#xA;    }&#xA;}}&#xA;</code></pre>&#xA;&#xA;<p>Link to documentation where you can find more info:&#xA;<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-terms-aggregation.html" rel="nofollow">https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-terms-aggregation.html</a></p>&#xA;
<p>You are also doing everuthing right, except you the <code>size</code>.</p>&#xA;&#xA;<p>The <code>"size": 0</code> should come after the targeted field's name.</p>&#xA;&#xA;<pre><code>$client = new Elasticsearch\Client($params);&#xA;    $query['body'] = '{&#xA;        "aggs" : {&#xA;            "all_sources" : {&#xA;                "terms" : {&#xA;                    "field" : "source",&#xA;                    "order" : { "_term" : "asc" },&#xA;                    "size": 0&#xA;                }&#xA;            }&#xA;        }&#xA;    }';&#xA;</code></pre>&#xA;