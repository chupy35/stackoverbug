32544867
How to write this score_function in elasticsearch?
<p>I need to get some document order by custom score function:</p>&#xA;&#xA;<pre><code>day(now - document.create_time)  * 10 + length(document.content) + document.answer_count&#xA;</code></pre>&#xA;&#xA;<p>how can I write this score function in elasticsearch?</p>&#xA;&#xA;<p>of cause</p>&#xA;&#xA;<p>my document has field:</p>&#xA;&#xA;<p><code>&#xA;create_time&#xA;content&#xA;answer_count&#xA;</code></p>&#xA;
<p>By assuming that :</p>&#xA;&#xA;<ul>&#xA;<li>create_time -> @timestamp, string type</li>&#xA;<li>content -> string type </li>&#xA;<li>answer_count -> numeric type</li>&#xA;</ul>&#xA;&#xA;<p>You can write this score function in Elasticsearch like below:</p>&#xA;&#xA;<pre><code>{&#xA;    "query": {&#xA;        "function_score": {&#xA;            "query": {&#xA;                "bool": {&#xA;                    "must": [&#xA;                        {&#xA;                            "match_all": {}&#xA;                        }&#xA;                    ]&#xA;                }&#xA;            },&#xA;            "script_score": {&#xA;                "script": "((System.currentTimeMillis() - doc['@timestamp'].value.toLong() ) / (1000 * 60 * 60 * 24)) * 10 + doc['content'].value.length() + doc['answer_count'].value"&#xA;            }&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Maybe you should adapt the part of convert:</p>&#xA;&#xA;<pre><code>((System.currentTimeMillis() - doc['@timestamp'].value.toLong() ) / (1000 * 60 * 60 * 24))&#xA;</code></pre>&#xA;&#xA;<p>PS: I used groovy Language in script section.&#xA;Remember to activate the mode ElasticSearch script in the configuration file <strong>config/elasticsearch.yml</strong>:</p>&#xA;&#xA;<pre><code>script.inline: on&#xA;script.indexed: on&#xA;</code></pre>&#xA;&#xA;<p>Regards,&#xA;Alain</p>&#xA;