26855637
Can a component know its own DOM tree context?
<p>I am attempting to write a <code>&lt;Heading /&gt;</code> component that will abstract away some of the headaches of dealing with headings (h1, h2, etc) in conjunction with accessibility standards.</p>&#xA;&#xA;<p>The goal being that this component would be able to dynamically choose a h(1,2,3) depending on its closest parent heading. However, Looking up the DOM tree like this remind me more of jQUERY than react. I've looked through the docs and SO but haven't seen anything about it, so I'm not sure if this is even possible. </p>&#xA;&#xA;<p>So the question is: Is it possible for a component to know where it is rendered in the DOM tree and then execute some logic with that info? (probably somewhere in componentWillMount).</p>&#xA;
<p>You could look upward in the DOM in componentDidMount and componentDidUpdate, but that's messy and uncontrolable.  There may be a better solution but this is the first thing that comes to mind.</p>&#xA;&#xA;&#xA;&#xA;<pre class="lang-js prettyprint-override"><code>var headerFactories = ['h1', 'h2', 'h3', 'h4'].map(function(tag){ &#xA;    return React.createFactory(tag)&#xA;});&#xA;var makeHeader = function(level){&#xA;    var make = function(){&#xA;        var factory = headerFactories[make.level] &#xA;                   || headerFactories[headerFactories.length - 1];&#xA;        return factory.apply(this, arguments);&#xA;    };&#xA;    make.sub = function(){&#xA;        return makeHeader(make.level + 1);&#xA;    };&#xA;    make.level = level;&#xA;    return make;&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>The api may seem a bit strange, but let's say we have a Page component and an Article child which may have another Article child.</p>&#xA;&#xA;<pre class="lang-js prettyprint-override"><code>var Page = React.createClass({&#xA;   render: function(){&#xA;      // make a root level header&#xA;      var header = makeHeader(); &#xA;      return &lt;div&gt;&#xA;        {header(null, "My Page")}&#xA;        &lt;Article headerFactory={header.sub()} data={foo} subArticle={bar} /&gt;&#xA;      &lt;/div&gt;&#xA;   }&#xA;});&#xA;&#xA;var Article = React.createClass({&#xA;   render: function(){&#xA;      var subArticle = false;&#xA;&#xA;      if (this.props.subArticle) {&#xA;         subArticle = &lt;Article headerFactory={this.props.headerFactory.sub()} /&gt;&#xA;      }&#xA;&#xA;      return &lt;div&gt;&#xA;         {this.props.headerFactory(null, this.props.data.title)}&#xA;      &lt;/div&gt;&#xA;   }&#xA;});&#xA;</code></pre>&#xA;&#xA;<p>What happens is when we do <code>headerFactory(null, "foo")</code> we get a component of that header level.  When we call <code>.sub()</code> we get a version of that headerFactory with the next header level.</p>&#xA;&#xA;<pre class="lang-js prettyprint-override"><code>var h1 = makeHeader();&#xA;var h2 = h1.sub();&#xA;var h3 = h2.sub();&#xA;var h4 = h3.sub();&#xA;</code></pre>&#xA;&#xA;<p>This allows components to have header levels based on their parents without breaking out of React.  </p>&#xA;