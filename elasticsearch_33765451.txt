33765451
elasticsearch - how to monitor fielddata vs node RAM
<p>elasticsearch 1.7.2 on CentOS, 8GB RAM, multi node cluster.</p>&#xA;&#xA;<p>We are reviewing: <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/_limiting_memory_usage.html" rel="nofollow">https://www.elastic.co/guide/en/elasticsearch/guide/current/_limiting_memory_usage.html</a></p>&#xA;&#xA;<p>and have a few questions.</p>&#xA;&#xA;<p>1) Other than the breakers, how do we see approaching max-out of fielddata RAM ?  (The stats in <code>/_stats/fielddata?fields=*</code> , like <code>memory_size</code>, don't show 'available_memory')</p>&#xA;&#xA;<p>2) When we run <code>/_stats/fielddata?fields=*</code>, we see <code>"primaries"</code> and <code>"total"</code>, which is fine. But what is the total a total of?  It appears to be <code>memory_size * number of nodes</code>, (but that doesn't make sense to us).</p>&#xA;&#xA;<p>3) We moved from nodes with 4GB RAM to nodes with 8GB RAM, yet we feel like the avail RAM (on stock elasticsearch.yml) for fielddata did not double. Is that a fair conclusion?</p>&#xA;&#xA;<p>The essential thing we want to monitor is: How close are we to maxing RAM... but we don't see what to measure.</p>&#xA;
<p>First of all, you are not maxing RAM, but HEAP. ES is using both Heap memory (from the JVM) and, also, RAM (as file data cache).</p>&#xA;&#xA;<p>To see how much heap your nodes are using, this is the command to use: <code>GET /_nodes/stats/jvm</code>, which will output something like</p>&#xA;&#xA;<pre><code>     "jvm": {&#xA;        "timestamp": 1447790529519,&#xA;        "uptime_in_millis": 84853,&#xA;        "mem": {&#xA;           "heap_used_in_bytes": 311374768,&#xA;           "heap_used_percent": 14,&#xA;           "heap_committed_in_bytes": 2112618496,&#xA;</code></pre>&#xA;&#xA;<p>You need <code>100 * heap_used_in_bytes / heap_committed_in_bytes</code> and resulting a percentage of usage. Or simply ysing <code>heap_used_percent</code>. For the actual RAM usage, use your OS reports for that or <code>GET /_nodes/stats/os</code>.</p>&#xA;&#xA;<p>For <code>fielddata</code> you can get statistics <strong>per node</strong> using <code>GET /_nodes/stats/indices/fielddata</code></p>&#xA;