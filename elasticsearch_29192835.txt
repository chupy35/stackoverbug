29192835
Elasticsearch:how to change cluster health from yellow to green
<p>I have a cluster with one node (by local). Health cluster is yellow. Now I add more one node, but shards can not be allocated in second node. So the health of my cluster is still yellow. I can not change this state to green, not like as this guide:<a href="http://www.elastic.co/guide/en/elasticsearch/guide/current/_add_an_index.html" rel="nofollow noreferrer">health cluster example</a>.</p>&#xA;&#xA;<p>So how to change health state to green?</p>&#xA;&#xA;<p>My cluster:<img src="https://i.stack.imgur.com/6OaW2.png" alt="enter image description here">&#xA;Cluster health:</p>&#xA;&#xA;<pre><code>curl -XGET 'http://localhost:9200/_cluster/health?pretty=true'  &#xA;{&#xA; "cluster_name" : "astrung",&#xA; "status" : "yellow",&#xA; "timed_out" : false,&#xA; "number_of_nodes" : 2,&#xA; "number_of_data_nodes" : 2,&#xA; "active_primary_shards" : 22,&#xA; "active_shards" : 22,&#xA; "relocating_shards" : 0,&#xA; "initializing_shards" : 2,&#xA; "unassigned_shards" : 20&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Shard status:</p>&#xA;&#xA;<pre><code>curl -XGET 'http://localhost:9200/_cat/shards?v'&#xA; index          shard prirep state        docs  store ip          node &#xA; _river         0     p      STARTED         2  8.1kb 192.168.1.3 One  &#xA; _river         0     r      UNASSIGNED                                &#xA; megacorp       4     p      STARTED         1  3.4kb 192.168.1.3 One  &#xA; megacorp       4     r      UNASSIGNED                                &#xA; megacorp       0     p      STARTED         2  6.1kb 192.168.1.3 One  &#xA; megacorp       0     r      UNASSIGNED                                &#xA; megacorp       3     p      STARTED         1  2.2kb 192.168.1.3 One  &#xA; megacorp       3     r      UNASSIGNED                                &#xA; megacorp       1     p      STARTED         0   115b 192.168.1.3 One  &#xA; megacorp       1     r      UNASSIGNED                                &#xA; megacorp       2     p      STARTED         1  2.2kb 192.168.1.3 One  &#xA; megacorp       2     r      UNASSIGNED                                &#xA; mybucket       2     p      STARTED         1  2.1kb 192.168.1.3 One  &#xA; mybucket       2     r      UNASSIGNED                                &#xA; mybucket       0     p      STARTED         0   115b 192.168.1.3 One  &#xA; mybucket       0     r      UNASSIGNED                                &#xA; mybucket       3     p      STARTED         2  5.4kb 192.168.1.3 One  &#xA; mybucket       3     r      UNASSIGNED                                &#xA; mybucket       1     p      STARTED         1  2.2kb 192.168.1.3 One  &#xA; mybucket       1     r      UNASSIGNED                                &#xA; mybucket       4     p      STARTED         1  2.5kb 192.168.1.3 One  &#xA; mybucket       4     r      UNASSIGNED                                &#xA; .kibana        0     r      INITIALIZING             192.168.1.3 Two  &#xA; .kibana        0     p      STARTED         2  8.9kb 192.168.1.3 One  &#xA; .marvel-kibana 2     p      STARTED         0   115b 192.168.1.3 One  &#xA; .marvel-kibana 2     r      UNASSIGNED                                &#xA; .marvel-kibana 0     r      INITIALIZING             192.168.1.3 Two  &#xA; .marvel-kibana 0     p      STARTED         1  2.9kb 192.168.1.3 One  &#xA; .marvel-kibana 3     p      STARTED         0   115b 192.168.1.3 One  &#xA; .marvel-kibana 3     r      UNASSIGNED                                &#xA; .marvel-kibana 1     p      STARTED         0   115b 192.168.1.3 One  &#xA; .marvel-kibana 1     r      UNASSIGNED                                &#xA; .marvel-kibana 4     p      STARTED         0   115b 192.168.1.3 One  &#xA; .marvel-kibana 4     r      UNASSIGNED                                &#xA; user_ids       4     p      STARTED        11    5kb 192.168.1.3 One  &#xA; user_ids       4     r      UNASSIGNED                                &#xA; user_ids       0     p      STARTED         7 25.1kb 192.168.1.3 One  &#xA; user_ids       0     r      UNASSIGNED                                &#xA; user_ids       3     p      STARTED        11  4.9kb 192.168.1.3 One  &#xA; user_ids       3     r      UNASSIGNED                                &#xA; user_ids       1     p      STARTED         8 28.7kb 192.168.1.3 One  &#xA; user_ids       1     r      UNASSIGNED                                &#xA; user_ids       2     p      STARTED        11  8.5kb 192.168.1.3 One  &#xA; user_ids       2     r      UNASSIGNED                              &#xA;</code></pre>&#xA;
<p>thou recovery normally takes a long time, looking at the number and size of your documents, it should take a very sort time to recover.</p>&#xA;&#xA;<p>Looks like you have issues with the nodes contacting each other, check firewall rules, ensure ports 9200 and 9300 are reachable from each.</p>&#xA;
<p>I would suggest you to update the replication factor of all the indices to 0 and then update it back to 1. Let me know if this works!&#xA;Here's a curl to get you started</p>&#xA;&#xA;<pre><code>curl -XPUT 'http://localhost:9200/_settings' -d '&#xA;{&#xA;    "index" : {&#xA;        "number_of_replicas" : 0&#xA;    }&#xA;}'&#xA;</code></pre>&#xA;