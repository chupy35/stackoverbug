30423582
Group by a filter on elastic then get the total hits
<p>I have an elastic index with elements that look something like this:</p>&#xA;&#xA;<pre><code>{&#xA;   "_index": "logstash",&#xA;   "_type": "logs",&#xA;   "_id": "AU2E2aXQESJWOe",&#xA;   "_score": 2.248888,&#xA;   "_source": {&#xA;     "@version": "1",&#xA;     "@timestamp": "2015-05-24T07:36:04.811Z",&#xA;     "timeApache": "22/May/2015:17:31:56 +0200",&#xA;     "client": "XX.XX.XX.XXX",&#xA;     "method": "GET",&#xA;     "Status": "200",&#xA;     "request": "/some/path/",&#xA;     "querystring": "?some=querystring",&#xA;     "referrer": "\"http://im.areferer.com/en/ref/24230/874802/\"",&#xA;     "agent": "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.65 Safari/537.36"&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>The thing is that I'd like to group by the "client" field (it's an IP) and then do a count (total hits), but I'm new to elastic and it's beeing an impossible task for me... Could some one shred some light on how to do that?</p>&#xA;
<p>Supposing that client field is a <code>not_analyzed</code> string field I would use <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-terms-aggregation.html" rel="nofollow">term aggregation</a> as follows:</p>&#xA;&#xA;<pre><code>{&#xA;    "aggs" : {&#xA;        "ips" : {&#xA;            "terms" : { "field" : "client" }&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;