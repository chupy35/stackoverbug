31545913
Search/Delete field with period from ElasticSearch when a nested document with same structure exists
<p>I accidentally created a field with periods when I was using the Bulk API to update nested documents. Now, my documents have a nested document and a field name with the same structure. For example, the structure is similar to the following:</p>&#xA;&#xA;<pre><code>{&#xA;  "foo":{&#xA;    "bar": 123&#xA;  },&#xA;  "foo.bar": 123&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>This is causing problems when I do queries against my index. How can I go about finding documents with the top-level field "foo.bar" and delete them?</p>&#xA;
<p>You can achieve this using a script in a <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-update.html#_updates_with_a_partial_document" rel="nofollow">partial update call</a> like this:</p>&#xA;&#xA;<pre><code>curl -XPOST http://localhost:9200/myindex/mytype/123/_update -d '{&#xA;    "script" : "ctx._source.remove(\"foo.bar\")"&#xA;}' &#xA;</code></pre>&#xA;&#xA;<p><strong>UPDATE:</strong> If you need to remove that field for all documents that contain it, there's another solution using the <a href="https://github.com/yakaz/elasticsearch-action-updatebyquery" rel="nofollow">update-by-query plugin</a>. In one shot, you can specify which documents to update and what to update in the matching documents, like this:</p>&#xA;&#xA;<pre><code>curl -XPOST localhost:9200/myindex/_update_by_query -d '{&#xA;    "query" : {&#xA;        "filtered" : {&#xA;            "filter" : {&#xA;                "exists": {"field": "foo.bar"}&#xA;            }&#xA;        }&#xA;    },&#xA;    "script" : "ctx._source.remove(\"foo.bar\")"&#xA;}'&#xA;</code></pre>&#xA;