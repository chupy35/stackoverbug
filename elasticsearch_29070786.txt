29070786
Filtered query on a nested object in elasticsearch
<p>Document: </p>&#xA;&#xA;<pre><code>{&#xA;  "issue_id": 1100,&#xA;  "text_content": [&#xA;    {&#xA;      "page": 1,&#xA;      "content": "First Page"&#xA;    },&#xA;    {&#xA;      "page": 2,&#xA;      "content": "Second TOC"&#xA;    }&#xA;  ]&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>The above document is indexed in <code>issues</code> index with a type <code>issue_text</code>.&#xA;Below is the mapping on the type.</p>&#xA;&#xA;<p>Mapping:</p>&#xA;&#xA;<pre><code>{&#xA;  "issues": {&#xA;    "mappings": {&#xA;      "issue_text": {&#xA;        "properties": {&#xA;          "issue_id": {&#xA;            "type": "integer"&#xA;          },&#xA;          "text_contents": {&#xA;            "type": "nested",&#xA;            "include_in_parent": true,&#xA;            "properties": {&#xA;              "content": {&#xA;                "type": "string"&#xA;              },&#xA;              "page": {&#xA;                "type": "integer"&#xA;              }&#xA;            }&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}  &#xA;</code></pre>&#xA;&#xA;<p>Query:</p>&#xA;&#xA;<pre><code>curl -XPOST "http://localhost:9200/issues/issue_text/_search" -d'{&#xA;  "query": {&#xA;    "filtered": {&#xA;      "filter": {&#xA;        "term": {&#xA;          "issue_id": 1109&#xA;        }&#xA;      },&#xA;      "query": {&#xA;        "nested": {&#xA;          "path": "text_contents",&#xA;          "query": {&#xA;            "bool": {&#xA;              "must": [&#xA;                {&#xA;                  "match": {&#xA;                    "text_contents.content": "toc"&#xA;                  }&#xA;                }&#xA;              ]&#xA;            }&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}'&#xA;</code></pre>&#xA;&#xA;<p>I am getting an error. &#xA;nested: QueryParsingException[[issues] [nested] nested object under path [text_contents] is not of nested type]. </p>&#xA;&#xA;<p>I am trying to fetch text_contents object which match the word "toc" for an document with the given issue_id(1109). In short - trying to filter and find a certain document and then perform a full text search on a nested object in that document.</p>&#xA;