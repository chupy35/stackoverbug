34108692
Elasticsearch date range must not be between multiple date_begin, date_end
<p>I have <code>check_in</code> and <code>check_out</code> "d-m-Y" search fields in my application. These searches available members between these dates.&#xA;On the other hand, members can edit their calendars and can put any date ranges to calendar marked as not available.&#xA;For example : Alice's calendar.&#xA;This is just related index in elastic.</p>&#xA;&#xA;<p>Note : There is no multiple search filters, I just write them to show several cases. For this searches, Alice mustn't be found by elastic search.</p>&#xA;&#xA;<pre><code>Example Searches:&#xA; check_in  "04-12-2015"&#xA; check_out "07-12-2015"&#xA;&#xA; check_in  "08-12-2015"&#xA; check_out "11-12-2015"&#xA;&#xA; check_in  "09-12-2015"&#xA; check_out "15-12-2015"&#xA;&#xA; check_in  "05-12-2015"&#xA; check_out "11-12-2015"&#xA;&#xA;&#xA;"Alice's Not available Calendar" : [&#xA;    {&#xA;        "date_begin" : "05-12-2015",&#xA;        "date_end'   : '09-12-2015"&#xA;    },&#xA;    {&#xA;        "date_begin" : "01-01-2016",&#xA;        "date_end'   : '07-02-2016"&#xA;    },&#xA;    {&#xA;        "date_begin" : "09-04-2016",&#xA;        "date_end'   : '11-04-2016"&#xA;    },&#xA;    {&#xA;        "date_begin" : "17-04-2016",&#xA;        "date_end'   : '21-04-2016"&#xA;    }&#xA;]&#xA;</code></pre>&#xA;&#xA;<p>I should check these assertions:</p>&#xA;&#xA;<pre><code>{check_in} lte {date_begin} and&#xA;{check_out} lte {date_end}&#xA;&#xA;check_in&#xA;    date_begin&#xA;check_out&#xA;    date_end&#xA;&#xA;&#xA;{check_in} gte {date_begin} and&#xA;{check_out} lte {date_end}    &#xA;&#xA;    date_begin&#xA;check_in&#xA;check_out&#xA;    date_end&#xA;&#xA;&#xA;&#xA;{check_in} lte {date_begin} and&#xA;{check_out} gte {date_end}    &#xA;&#xA;check_in&#xA;    date_begin&#xA;    date_end&#xA;check_out&#xA;&#xA;&#xA;&#xA;{check_in} gte {date_begin} and&#xA;{check_out} gte {date_end}&#xA;&#xA;    date_begin&#xA;check_in&#xA;    date_end&#xA;check_out&#xA;</code></pre>&#xA;&#xA;<p>For these information how should I send my query to filter in desired way ? I couldn't imagine how should be in proper way.</p>&#xA;&#xA;<p>Something like this, but how could I write correct syntax.</p>&#xA;&#xA;<pre><code>{&#xA;"bool" : {&#xA;    "must_not" : {&#xA;        "range" : {&#xA;            "date_begin" : { "lte" : "{check_in}" }&#xA;        }&#xA;    },&#xA;    &lt;---- AND -----&gt;&#xA;    "must_not" : {&#xA;        "range" : {&#xA;            "date_end" : { "lte" : "{check_out}" }&#xA;        }&#xA;    },&#xA;    &lt;---- OR -----&gt;&#xA;    "must_not" : {&#xA;        "range" : {&#xA;            "date_begin" : { "gte" : "{check_in}" }&#xA;        }&#xA;    },&#xA;    &lt;---- AND -----&gt;&#xA;    "must_not" : {&#xA;        "range" : {&#xA;            "date_end" : { "lte" : "{check_out}" }&#xA;        }&#xA;    },&#xA;    &lt;---- OR -----&gt;&#xA;    "must_not" : {&#xA;        "range" : {&#xA;            "date_begin" : { "lte" : "{check_in}" }&#xA;        }&#xA;    },&#xA;    &lt;---- AND -----&gt;&#xA;    "must_not" : {&#xA;        "range" : {&#xA;            "date_end" : { "gte" : "{check_out}" }&#xA;        }&#xA;    },&#xA;    &lt;---- OR -----&gt;&#xA;    "must_not" : {&#xA;        "range" : {&#xA;            "date_begin" : { "gte" : "{check_in}" }&#xA;        }&#xA;    },&#xA;    &lt;---- AND -----&gt;&#xA;    "must_not" : {&#xA;        "range" : {&#xA;            "date_end" : { "gte" : "{check_out}" }&#xA;        }&#xA;    },&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>}</p>&#xA;
<p>If I understand correctly, the search should return members with following conditions.</p>&#xA;&#xA;<p>1)<code>date_begin</code> should be greater that both <code>check_in</code> and <code>check_out</code></p>&#xA;&#xA;<p><strong>OR</strong></p>&#xA;&#xA;<p>2)<code>date_end</code> should be less that both <code>check_in</code> and <code>check_out</code></p>&#xA;&#xA;<p>Lets say user enters <em>2014-02-19</em> as <code>check_in</code> date and <em>2014-02-20</em> as <code>check_out</code> date then I think following query will satisfy all your requirements</p>&#xA;&#xA;<pre><code>{&#xA;  "query": {&#xA;    "bool": {&#xA;      "should": [&#xA;        {&#xA;          "bool": {&#xA;            "must": [&#xA;              {&#xA;                "range": {&#xA;                  "date_begin": {&#xA;                    "gt": "2014-02-19"&#xA;                  }&#xA;                }&#xA;              },&#xA;              {&#xA;                "range": {&#xA;                  "date_begin": {&#xA;                    "gt": "2014-02-20"&#xA;                  }&#xA;                }&#xA;              }&#xA;            ]&#xA;          }&#xA;        },&#xA;        {&#xA;          "bool": {&#xA;            "must": [&#xA;              {&#xA;                "range": {&#xA;                  "date_end": {&#xA;                    "lt": "2014-02-19"&#xA;                  }&#xA;                }&#xA;              },&#xA;              {&#xA;                "range": {&#xA;                  "date_end": {&#xA;                    "lt": "2014-02-20"&#xA;                  }&#xA;                }&#xA;              }&#xA;            ]&#xA;          }&#xA;        }&#xA;      ]&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>This will give you all available members.</p>&#xA;