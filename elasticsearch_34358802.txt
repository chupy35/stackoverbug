34358802
Comma in Elasticsearch synonyms
<p>Some of the sentences I want to define as syonyms have commas in them, for example:</p>&#xA;&#xA;<p>"Employment Information" and "Your Activity, Your Job" are synonyms. </p>&#xA;&#xA;<p>However if I define them in the following way the result is not what I envisioned, since "," has a special meaning in the Elasticsearch format:</p>&#xA;&#xA;<p>Employment Information=>Your Activity, Your Job</p>&#xA;&#xA;<p>Is the only solution for me to use WordNet synonym format in this case or perhaps I can just ignore the comma entirely and take it out?</p>&#xA;
<p>I dont think <code>comma</code> will be an issue, If you are using <code>standard analyzer</code> then it will remove <code>comma</code>. This is my test setup</p>&#xA;&#xA;<pre><code>"filter": {&#xA;     "my_synonym_filter": {&#xA;         "type": "synonym",&#xA;         "synonyms": [&#xA;             "employment information=&gt;your activity your job"&#xA;         ]&#xA;     }&#xA; },&#xA; "analyzer": {&#xA;     "my_synonyms": {&#xA;         "tokenizer": "standard",&#xA;         "filter": [&#xA;             "lowercase",&#xA;             "my_synonym_filter"&#xA;         ]&#xA;     }&#xA; }&#xA;</code></pre>&#xA;&#xA;<p>It is good to use <code>lowercase filter</code> to avoid case sensitive <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/synonyms-analysis-chain.html" rel="nofollow">issues</a>, so now this query</p>&#xA;&#xA;<pre><code>GET my_index/_analyze?text=employment Information&amp;analyzer=my_synonyms&#xA;</code></pre>&#xA;&#xA;<p>will give you following tokens</p>&#xA;&#xA;<pre><code>{&#xA;   "tokens": [&#xA;      {&#xA;         "token": "your",&#xA;         "start_offset": 0,&#xA;         "end_offset": 10,&#xA;         "type": "SYNONYM",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "activity",&#xA;         "start_offset": 11,&#xA;         "end_offset": 22,&#xA;         "type": "SYNONYM",&#xA;         "position": 2&#xA;      },&#xA;      {&#xA;         "token": "your",&#xA;         "start_offset": 11,&#xA;         "end_offset": 22,&#xA;         "type": "SYNONYM",&#xA;         "position": 3&#xA;      },&#xA;      {&#xA;         "token": "job",&#xA;         "start_offset": 11,&#xA;         "end_offset": 22,&#xA;         "type": "SYNONYM",&#xA;         "position": 4&#xA;      }&#xA;   ]&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>There is a <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/multi-word-synonyms.html" rel="nofollow">gotcha</a> with <code>multiword synonym</code>, if you analyze the output of&#xA;<code>GET my_index/_analyze?text=employment Information is useful&amp;analyzer=my_synonyms</code>, you will get unexpected results like this</p>&#xA;&#xA;<pre><code>{&#xA;   "tokens": [&#xA;      {&#xA;         "token": "your",&#xA;         "start_offset": 0,&#xA;         "end_offset": 10,&#xA;         "type": "SYNONYM",&#xA;         "position": 1&#xA;      },&#xA;      {&#xA;         "token": "activity",&#xA;         "start_offset": 11,&#xA;         "end_offset": 22,&#xA;         "type": "SYNONYM",&#xA;         "position": 2&#xA;      },&#xA;      {&#xA;         "token": "is",&#xA;         "start_offset": 23,&#xA;         "end_offset": 25,&#xA;         "type": "&lt;ALPHANUM&gt;",&#xA;         "position": 3&#xA;      },&#xA;      {&#xA;         "token": "your",&#xA;         "start_offset": 23,&#xA;         "end_offset": 25,&#xA;         "type": "SYNONYM",&#xA;         "position": 3&#xA;      },&#xA;      {&#xA;         "token": "useful",&#xA;         "start_offset": 26,&#xA;         "end_offset": 32,&#xA;         "type": "&lt;ALPHANUM&gt;",&#xA;         "position": 4&#xA;      },&#xA;      {&#xA;         "token": "job",&#xA;         "start_offset": 26,&#xA;         "end_offset": 32,&#xA;         "type": "SYNONYM",&#xA;         "position": 4&#xA;      }&#xA;   ]&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>You can solve this issue with <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/synonyms-expand-or-contract.html#synonyms-contraction" rel="nofollow">simple contraction</a>, write <code>synonyms</code> like this</p>&#xA;&#xA;<pre><code>"synonyms": [&#xA;     "employment information,your activity your job=&gt;sentence1"&#xA; ]&#xA;</code></pre>&#xA;&#xA;<p>If you are using <code>keyword analyzer</code> then you could use <code>pattern replace char filter</code> to remove comma.</p>&#xA;