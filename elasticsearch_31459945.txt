31459945
how do you transform a date that's storred as a type long (epoch time) into a dateOptionalTime in Elasticsearch?
<p>I have a field in my database that's stored as Epoch time, which is a <code>long</code>. I'm trying to get Elasticsearch to recognize this field as what it <em>actually</em> is: a date. Once indexed by Elasticsearch, I want it to be of type <code>dateOptionalTime</code>. </p>&#xA;&#xA;<p>My thinking is that I need to apply a <code>transform</code> to convert the Epoch <code>long</code> into a string <code>date</code>. </p>&#xA;&#xA;<p>On my index, I have a mapping that specifies the <code>type</code> for my field as <code>date</code> with a <code>format</code> of <code>dateOptionalTime</code>. Finally, this timestamp is in all of my docs, so I've added my (attempted) mapping to <code>_default_</code>. </p>&#xA;&#xA;<p>The code: </p>&#xA;&#xA;<pre><code>'_default_', {&#xA;            '_all': {'enabled': 'true'},&#xA;            'dynamic_templates': [&#xA;                { "date_fixer" : {&#xA;                    "match": "my_timestamp",&#xA;                    "mapping": {&#xA;                        "transform": {&#xA;                            "script": "ctx._source['my_timestamp'] = new Date(ctx._source['my_timestamp']).toString()"&#xA;                        },&#xA;                        'type': "date",&#xA;                    }&#xA;                }&#xA;            }]&#xA;    }&#xA;</code></pre>&#xA;&#xA;<p>I'm brand new to Elastic, so I'll walk through what I <em>think</em> is happening. </p>&#xA;&#xA;<ol>&#xA;<li><p>I'm setting this to type <code>_default_</code> which will apply this to all new types Elastic encounters. </p></li>&#xA;<li><p>I set <code>_all</code> to enabled. I want Elastic to use the default mapping for all types with the exception of my timestamp field. </p></li>&#xA;<li><p>finally, I add my dynamic template that (a) converts the long into a date, and (b) applies a mapping to the timestamp field explicitly saying that it <em>is</em> a <code>date</code></p></li>&#xA;</ol>&#xA;&#xA;<p><strong>The Problem:</strong></p>&#xA;&#xA;<p>When I try to add my data to the index, I get the following exception. </p>&#xA;&#xA;<pre><code>TransportError(400, u'MapperParsingException[failed to parse [my_timestamp]]; nested: ElasticsearchIllegalArgumentException[unknown property [$date]]; ')&#xA;</code></pre>&#xA;&#xA;<p>My data looks like: </p>&#xA;&#xA;<pre><code>{&#xA;    "timestamp": 8374747594, &#xA;    "owner": "text", &#xA;    "some_more": {&#xA;        "key": "val", &#xA;        "key": "val"&#xA;    }&#xA;}&#xA;</code></pre>&#xA;