29745008
Add a field that is the prefix of another in ElasticSearch
<p>I want to be able to search according to the 2 first letters of a string with the mapping:</p>&#xA;&#xA;<pre><code>"user_id": {&#xA;"type": "string",&#xA;"index": "not_analyzed"&#xA;},&#xA;</code></pre>&#xA;&#xA;<p>For that, I want to add a field:</p>&#xA;&#xA;<pre><code>"user_id_2letter_prefix": {&#xA;"type": "string",&#xA;"index": "not_analyzed"&#xA;},&#xA;</code></pre>&#xA;&#xA;<p>and, since the index is already populated I'd like to run a script that does that.</p>&#xA;&#xA;<p>Thought about using the update API, but not sure about the syntax. Something along the lines of:</p>&#xA;&#xA;<pre><code>curl -XPOST 'localhost:9200/test/type1/1/_update' -d '{&#xA;    "script" : "ctx._source.user_id_2letter_prefix += ctx._source.user_id[:2]",&#xA;}'&#xA;</code></pre>&#xA;&#xA;<p>What is the syntax? Is there a way to tell the cluster to update all documents this way (assuming it might stop in the middle for some error, it'd need to be ignoring, or overwriting those that are already updated)</p>&#xA;