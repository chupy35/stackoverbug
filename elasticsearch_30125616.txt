30125616
Why is my Elasticsearch cluster on localhost stuck in yellow status instead of green?
<p>I've spun up 3 instances of elastic search on my development box by creating 3 different configuration files and then running the following commands:</p>&#xA;&#xA;<pre><code>elasticsearch.bat -Des.config="C:\Program Files\elasticsearch-1.5.1\config\elasticsearch.yml"&#xA;elasticsearch.bat -Des.config="C:\Program Files\elasticsearch-1.5.1\config\elasticsearch_1.yml"&#xA;elasticsearch.bat -Des.config="C:\Program Files\elasticsearch-1.5.1\config\elasticsearch_2.yml"&#xA;</code></pre>&#xA;&#xA;<p>This seems to have successfully created 3 nodes but the cluster health comes up as:</p>&#xA;&#xA;<pre><code>{&#xA;   "cluster_name": "elasticsearch",&#xA;   "status": "yellow",&#xA;   "timed_out": false,&#xA;   "number_of_nodes": 3,&#xA;   "number_of_data_nodes": 3,&#xA;   "active_primary_shards": 135,&#xA;   "active_shards": 135,&#xA;   "relocating_shards": 0,&#xA;   "initializing_shards": 0,&#xA;   "unassigned_shards": 135,&#xA;   "number_of_pending_tasks": 0&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Multicast is enabled (since it's the default) and all the configuration files have the default settings. The only explicit setting I've made in each one is:</p>&#xA;&#xA;<pre><code>script:&#xA;    disable_dynamic: false&#xA;</code></pre>&#xA;&#xA;<p>which I need because I'm using a script field but I think this setting is unlikely to have any bearing on my current problem. I'm expecting that the cluster should be green since the default number of replicas is 1. For some reason, elasticsearch thinks that the replica shards are inactive but I've not idea why it's not activating the replicas. The following link seems to do a similar thing to what I've done yet acheives a cluster with green status: </p>&#xA;&#xA;<p><a href="http://thediscoblog.com/blog/2013/09/03/effortless-elasticsearch-clustering/" rel="nofollow">http://thediscoblog.com/blog/2013/09/03/effortless-elasticsearch-clustering/</a></p>&#xA;&#xA;<p>Any ideas what I might be doing wrong?</p>&#xA;&#xA;<p><strong>UPDATE</strong>&#xA;In order to give some context to the answer given by Andrei, looking in the logs reveals lines like the following which turn up repeatedly:</p>&#xA;&#xA;<pre><code>[2015-05-08 16:04:25,284][WARN ][cluster.routing.allocation.decider] [Robert Kelly] high disk watermark [10%] exceeded on [IZ6wN0KQQMSjjtkhfkQnMQ][Yith] free: 6.2gb[5.2%], shards will be relocated away from this node&#xA;[2015-05-08 16:04:25,284][WARN ][cluster.routing.allocation.decider] [Robert Kelly] high disk watermark [10%] exceeded on [AQ8BnsURQsCywKxkjStu7A][Robert Kelly] free: 6.2gb[5.2%], shards will be relocated away from this node&#xA;[2015-05-08 16:04:25,284][WARN ][cluster.routing.allocation.decider] [Robert Kelly] high disk watermark [10%] exceeded on [ZlH32e6JT9C_VcAfNtxV0A][Maxam] free: 6.2gb[5.2%], shards will be relocated away from this node&#xA;</code></pre>&#xA;
<p>You don't have enough disk space and the replicas will not be assigned anymore. Run </p>&#xA;&#xA;<pre><code>PUT /_cluster/settings&#xA;{&#xA;  "transient": {&#xA;    "cluster.routing.allocation.disk.threshold_enabled": false&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>to disable the protection mechanism. But this is a temporary solution, of course you need to free some disk space. Also, the error will come back after cluster restart.</p>&#xA;&#xA;<p>If you want it to be permanent, run</p>&#xA;&#xA;<pre><code>PUT /_cluster/settings&#xA;{&#xA;  "persistent": {&#xA;    "cluster.routing.allocation.disk.threshold_enabled": false&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>The difference is that the settings in the latter case is <code>persistent</code>, meaning it will survive a cluster restart.</p>&#xA;&#xA;<p>This, or <a href="http://www.elastic.co/guide/en/elasticsearch/reference/1.5/index-modules-allocation.html#disk" rel="nofollow">change the limits of the threshold</a>.</p>&#xA;