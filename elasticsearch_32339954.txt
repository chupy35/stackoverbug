32339954
Building an ElasticSearch Multi-Filter Aggregate errors out
<p>Here is my ES payload:</p>&#xA;&#xA;<pre><code>{&#xA;  "filtered": {&#xA;    "filter": {&#xA;      "and": {&#xA;        "filters": [&#xA;          {&#xA;            "status": [&#xA;              "error",&#xA;              "active",&#xA;              "opt_out"&#xA;            ]&#xA;          },&#xA;          {&#xA;            "group_ids": [&#xA;              "UUIDs-go-here"&#xA;            ]&#xA;          }&#xA;        ]&#xA;      }&#xA;    }&#xA;  },&#xA;  "aggs": {&#xA;    "status_count": {&#xA;      "terms": {&#xA;        "field": "status"&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>The error I am receiving is <code>Parse Failure [No parser for element [filtered]]];</code></p>&#xA;&#xA;<p>I was following this <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-and-filter.html" rel="nofollow">https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-and-filter.html</a> to help build out my filters, but obviously I am doing something wrong</p>&#xA;
<p>Try this instead:</p>&#xA;&#xA;<pre><code>{&#xA;   "query": {&#xA;      "filtered": {&#xA;         "filter": {&#xA;            "and": {&#xA;               "filters": [&#xA;                  {&#xA;                      "terms": {&#xA;                         "status": [&#xA;                            "error",&#xA;                            "active",&#xA;                            "opt_out"&#xA;                         ]&#xA;                      }&#xA;                  },&#xA;                  {&#xA;                      "terms": {&#xA;                         "group_ids": [&#xA;                            "UUIDs-go-here"&#xA;                         ]&#xA;                      }&#xA;                  }&#xA;               ]&#xA;            }&#xA;         }&#xA;      }&#xA;   },&#xA;   "aggs": {&#xA;      "status_count": {&#xA;         "terms": {&#xA;            "field": "status"&#xA;         }&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Wrap your entire <code>filtered query</code> in the query syntax, as <code>filtered</code> is a type of query and not a query itself. Then, in your <code>and filters</code>, you also need to specify what kind of and filters you are running, as <code>status</code> is not a type of filter. I assumed here that your were looking for <code>terms</code> filters on the fields.</p>&#xA;