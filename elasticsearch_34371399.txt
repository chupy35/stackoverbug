34371399
exact match query in elasticsearch
<p>I'm trying to run an exact match query in ES</p>&#xA;&#xA;<p>in MYSQL my query would be:</p>&#xA;&#xA;<pre><code>SELECT * WHERE `content_state`='active' AND `author`='bob' AND `title` != 'Beer';&#xA;</code></pre>&#xA;&#xA;<p>I looked at the ES docs here:</p>&#xA;&#xA;<p><a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/_finding_exact_values.html" rel="nofollow">https://www.elastic.co/guide/en/elasticsearch/guide/current/_finding_exact_values.html</a></p>&#xA;&#xA;<p>and came up with this:</p>&#xA;&#xA;<pre><code>{&#xA;"from" : '.$offset.', "size" : '.$limit.',&#xA;"filter": {&#xA;"and": [&#xA;  {&#xA;    "and": [&#xA;      {&#xA;        "term": {&#xA;          "content_state": "active"&#xA;        }&#xA;      },&#xA;      {&#xA;        "term": {&#xA;          "author": "bob"&#xA;        }&#xA;      },&#xA;      {&#xA;        "not": {&#xA;          "filter": {&#xA;            "term": {&#xA;              "title": "Beer"&#xA;            }&#xA;          }&#xA;        }&#xA;      }&#xA;    ]&#xA;  }&#xA;    ]&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>but my results are still coming back with the title = Beer, it doesn't seem to be excluding the titles that = Beer.</p>&#xA;&#xA;<p>did I do something wrong?</p>&#xA;&#xA;<p>I'm pretty new to ES</p>&#xA;
<p>I figured it out, I used this instead...</p>&#xA;&#xA;<pre><code>{&#xA; "from" : '.$offset.', "size" : '.$limit.',&#xA;  "query": {&#xA;   "bool": {&#xA;   "must": [&#xA;    {&#xA;      "query_string": {&#xA;        "default_field": "content_state",&#xA;        "query": "active"&#xA;      }&#xA;    },&#xA;    {&#xA;      "query_string": {&#xA;        "default_field": "author",&#xA;        "query": "bob"&#xA;      }&#xA;    }&#xA;  ],&#xA;&#xA;  "must_not": [&#xA;    {&#xA;      "query_string": {&#xA;        "default_field": "title",&#xA;        "query": "Beer"&#xA;      }&#xA;    }&#xA;  ]&#xA;&#xA;&#xA;&#xA;&#xA;}&#xA;}&#xA;}&#xA;</code></pre>&#xA;
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html" rel="nofollow">Query String Query</a> is a pretty good concept to handle various relationship between search criteria. Have a quick look into <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html#query-string-syntax" rel="nofollow">Query string query syntax</a> to understand in detail about this concept</p>&#xA;&#xA;<pre><code>{&#xA;  "query": {&#xA;    "query_string": {&#xA;      "query": "(content_state:active AND author:bob) AND NOT (title:Beer)"&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;
<p><strong>Filters are supposed to work on exact values</strong>, if you had defined your mapping in a manner where title was a <strong>non-analyzed</strong> field, your previous attempt ( with filters) would have worked as well. </p>&#xA;&#xA;<pre><code>{&#xA;    "mappings": {&#xA;        "test": {&#xA;            "_all": {&#xA;                "enabled": false&#xA;            },&#xA;            "properties": {&#xA;                "content_state": {&#xA;                    "type": "string"&#xA;                },&#xA;                "author": {&#xA;                    "type": "string"&#xA;                },&#xA;                "title": {&#xA;                    "type": "string",&#xA;                    "index": "not_analyzed"&#xA;                }&#xA;            }&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;