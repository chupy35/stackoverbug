30389439
Faulty response while querying for email ids in elasticsearch
<p>When I am searching for mail ids in my indexed documents,elasticsearch is returing faulty results. This is the query i used: </p>&#xA;&#xA;<pre><code>{&#xA;“query” : {&#xA;“match” : {&#xA;“mail” : “bill@gmail.com”&#xA;}&#xA;}&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>In the entire indexed documents,there is only a single document containing the value "bill@gmail.com" in the field "mail". But elasticsearch response shows many other documents,which either have "bill" or "gmail.com". Why is this happening and can somebody recommend a fix for this behaviour?.</p>&#xA;
<p>I think your email address might be tokenized during indexing. So instead of bill@gmail.com there are three tokens (terms): bill, gmail, com. If that is the case, try to add <code>"index": "not_analyzed"</code> to its mapping definition </p>&#xA;&#xA;<p>or </p>&#xA;&#xA;<p>try to use <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-bool-filter.html" rel="nofollow">bool</a> as below :</p>&#xA;&#xA;<pre><code>{&#xA;    "query": {&#xA;        "bool": {&#xA;            "must": [&#xA;                {&#xA;                    "match": {&#xA;                        "mail": "bill@gmail.com"&#xA;                    }&#xA;                }&#xA;            ]&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;
<p>In elasticsearch,by default,it takes the "standard analyzer" as the default analyzer.&#xA;The "standard analyzer" breaks "bill@gmail.com" in to "bill" and "gmail.com". So what happened in your case is that when you searched for "bill@gmail.com",it shows documents matching either "bill" or "gmail.com".</p>&#xA;&#xA;<p>Two possible solutions have been mentioned by @yogesh. Another solution which is provided by elasticsearch is the UAX Email tokeniser. This tokeniser,preserves email ids and URL links and wont break them.</p>&#xA;&#xA;<p>You can apply the UAX Email tokeniser as follows:</p>&#xA;&#xA;<pre><code>curl -X PUT "http://localost:9200/news" -d '{&#xA;  "analysis": {&#xA;    "analyzer": {&#xA;      "urlAnalyzer": {&#xA;        "type": "custom",&#xA;        "tokenizer": "uax_url_email"&#xA;      }&#xA;    }&#xA;  }&#xA;}'&#xA;&#xA;And finally apply it on our field&#xA;curl -X PUT "http://$hostname:9200/news/public/_mapping" -d '{&#xA;  "public": {&#xA;    "properties": {&#xA;      "mail": {&#xA;        "type": "string",&#xA;        "analyzer": "urlAnalyzer"&#xA;      }&#xA;    }&#xA;  }&#xA;}'&#xA;</code></pre>&#xA;&#xA;<p>Here "news" is the name of the index i have created. Replace it with yours.</p>&#xA;