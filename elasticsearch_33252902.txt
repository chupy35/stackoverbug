33252902
show all buckets from aggregation within a single _type where one index contains multiple _type with same field names
<p>I created an index named "electronics". I created two _type in index i.e "mobiles", "laptops" which have common field name "screensize". </p>&#xA;&#xA;<p>Since I need to show facets for all the terms present in the fields, I am using aggregations to generate the terms and its facets. </p>&#xA;&#xA;<pre><code>{&#xA;  "aggs": {&#xA;    "distinct_field": {&#xA;      "terms": {&#xA;        "field": "screensize",&#xA;        'min_doc_count': 0,&#xA;        'size': 0&#xA;      }&#xA;    }&#xA;  }&#xA;} &#xA;</code></pre>&#xA;&#xA;<p>In the response I am getting all the screensizes with _type of mobiles as well as laptops(Since lucene treats same field names from different types as single field.). I only need the terms present in mobiles even if their count is 0. </p>&#xA;&#xA;<p>I thought about doing a filtered query for mobiles _type before doing aggregations, but the results were still the same. </p>&#xA;&#xA;<pre><code>{&#xA;  "query": {&#xA;    "filtered": {&#xA;      "filter": {&#xA;        "type": {&#xA;          "value": "mobiles"&#xA;        }&#xA;      }&#xA;    }&#xA;  },&#xA;  "aggs": {&#xA;    "distinct_field": {&#xA;      "terms": {&#xA;        "field": "screensize",&#xA;        'min_doc_count': 0,&#xA;        'size': 0&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Is there any way I could possibly get only the terms from a single _type for a particular field? </p>&#xA;
<p>I'm suggesting another approach using a <code>terms</code> aggregation with a <code>script</code> instead of <code>field</code> like this. The script will only return the value of the screensize if the <code>type</code> of the document is <code>mobiles</code> and <code>null</code> instead. This should work, try it out:</p>&#xA;&#xA;<pre><code>{&#xA;  "aggs": {&#xA;    "distinct_field": {&#xA;      "terms": {&#xA;        "script": "doc._type.value == 'mobiles' ? doc.screensize.value : null",&#xA;        "min_doc_count": 0,&#xA;        "size": 0&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>For this to work you also need to make sure that <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-scripting.html#enable-dynamic-scripting" rel="nofollow">scripting is enabled</a></p>&#xA;