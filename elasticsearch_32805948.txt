32805948
failed to execute script Elasticsearch
<p>I am trying to update the some values in a particular field, which I want to be unique. </p>&#xA;&#xA;<p>But when I give the script the condition .unique() it returns me an  error.</p>&#xA;&#xA;<p>If I do not give the condition unique then it's keep updating again and again.&#xA;Means the value will be </p>&#xA;&#xA;<p>update_field= array ('world','values','frost','world','values','frost',...)</p>&#xA;&#xA;<p>What I am doing wrong here anyone knows !!!</p>&#xA;&#xA;<pre><code>        $script['script'] = 'ctx._source.update_field = (ctx._source.update_field + new_value).unique()';&#xA;        // unique() is giving the error but why&#xA;</code></pre>&#xA;&#xA;<p>error message ---</p>&#xA;&#xA;<blockquote>&#xA;  <p>{"error":"ElasticsearchIllegalArgumentException[failed to execute&#xA;  script]; nested:&#xA;  GroovyScriptExecutionException[MissingMethodException[No signature of&#xA;  method: java.lang.String.unique() is applicable for argument types: ()&#xA;  values: []\nPossible solutions: minus(java.lang.Object),&#xA;  minus(java.util.regex.Pattern), minus(java.lang.Object), size(),&#xA;  size(), use([Ljava.lang.Object;)]]; ","status":400}</p>&#xA;</blockquote>&#xA;&#xA;<p>a sample documents ---</p>&#xA;&#xA;<pre><code>    hits: {&#xA;        total: 19,&#xA;        max_score: 5.5197725,&#xA;        hits: [&#xA;            {&#xA;                _index: "myIndex",&#xA;                _type: "myType",&#xA;                _id: "pdd9da099f380b3951a627a5d5a38758680016f16",&#xA;                _score: 5.5197725,&#xA;                _source: {&#xA;                    content: "After shooting attacks are several police cars sent to the streets to watch. &#xA;                    title: "The police in Copenhagen when bødemål despite extra tasks",&#xA;                    update_field: "[funny]"&#xA;&#xA;            }},}&#xA;</code></pre>&#xA;&#xA;<p>So there you can see that the update_field is not empty and have some value -&#xA;when when i try ---</p>&#xA;&#xA;<pre><code>$script['script'] = 'ctx._source.update_field = ((ctx._source.update_field ?: []) - new_value).unique()';&#xA;</code></pre>&#xA;&#xA;<p>it also returns me the same error ! &#xA;don't know why !!</p>&#xA;
<p>From the error, the key point is <code>No signature of method: java.lang.String.unique()</code>. It's probably because <code>update_field</code> does not exist or is empty at some point and thus the <code>+</code> operator will simply try to concatenate it as a string with the array you're specifying. </p>&#xA;&#xA;<p>One way to fix this would be to make sure <code>update_field</code> is considered as an array no matter what. You should be able to achieve this by replacing <code>ctx._source.update_field</code> with <code>(ctx._source.update_field ?: [])</code>, that way if <code>update_field</code> does not exist or is empty, then an empty array will be used instead and the <code>+</code> operator will work on an array instead of on a string field.</p>&#xA;&#xA;<pre><code>$script['script'] = 'ctx._source.update_field = ((ctx._source.update_field ?: []) + new_value).unique()';&#xA;</code></pre>&#xA;