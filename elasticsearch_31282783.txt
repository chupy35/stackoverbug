31282783
Elasticsearch asciifolding not working properly
<p>I've created this test index using marvel plugin:</p>&#xA;&#xA;<pre><code>POST /test&#xA;{&#xA;   "index" : {&#xA;      "analysis" : {&#xA;         "analyzer" : {&#xA;            "folding": {&#xA;              "tokenizer": "standard",&#xA;              "filter":  [ "lowercase", "asciifolding" ]&#xA;            }&#xA;         }&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>And I'm making the analyze request like this:</p>&#xA;&#xA;<pre><code>GET /test/_analyze?analyzer=folding&amp;text=olá&#xA;</code></pre>&#xA;&#xA;<p>And I'm getting the result:</p>&#xA;&#xA;<pre><code>{&#xA;    "tokens": [&#xA;          {&#xA;             "token": "ol",&#xA;             "start_offset": 0,&#xA;             "end_offset": 2,&#xA;             "type": "&lt;ALPHANUM&gt;",&#xA;             "position": 1&#xA;          }&#xA;       ]&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>But I need to have an "ola" token instead of the "ol" only. According to the documentation it's properly configured:</p>&#xA;&#xA;<p><a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/asciifolding-token-filter.html" rel="noreferrer">https://www.elastic.co/guide/en/elasticsearch/guide/current/asciifolding-token-filter.html</a></p>&#xA;&#xA;<p>What am I doing wrong?</p>&#xA;
<p>Try this, to prove that Elasticsearch does a good job in the end. I suspect the Sense interface is not passing the correct text to the analyzer.</p>&#xA;&#xA;<pre><code>PUT /my_index&#xA;{&#xA;  "settings": {&#xA;    "analysis": {&#xA;      "analyzer": {&#xA;        "folding": {&#xA;          "tokenizer": "standard",&#xA;          "filter":  [ "lowercase", "asciifolding" ]&#xA;        }&#xA;      }&#xA;    }&#xA;  },&#xA;  "mappings": {&#xA;    "test": {&#xA;      "properties": {&#xA;        "text": {&#xA;          "type": "string",&#xA;          "analyzer": "folding"&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;&#xA;POST /my_index/test/1&#xA;{&#xA;  "text": "olá"&#xA;}&#xA;&#xA;GET /my_index/test/_search&#xA;{&#xA;  "fielddata_fields": ["text"]&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>The result:</p>&#xA;&#xA;<pre><code>   "hits": {&#xA;      "total": 1,&#xA;      "max_score": 1,&#xA;      "hits": [&#xA;         {&#xA;            "_index": "my_indexxx",&#xA;            "_type": "test",&#xA;            "_id": "1",&#xA;            "_score": 1,&#xA;            "_source": {&#xA;               "text": "olá"&#xA;            },&#xA;            "fields": {&#xA;               "text": [&#xA;                  "ola"&#xA;               ]&#xA;            }&#xA;         }&#xA;      ]&#xA;   }&#xA;</code></pre>&#xA;