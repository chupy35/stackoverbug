28987312
ElasticSearch: How to query an array (of long)?
<p>I'm trying to query the documents that have the value <code>[1,2]</code> in their <code>array</code>field.</p>&#xA;&#xA;<pre><code>GET a/g/_search&#xA;{"query":{"match":{"array":[1,2]}}}&#xA;</code></pre>&#xA;&#xA;<p>returns the error:</p>&#xA;&#xA;<p><code>{"error": "SearchPhaseExecutionException[Failed to execute phase [query], all shards failed... &#xA;"status": 400 }</code></p>&#xA;&#xA;<p>The indexation was succefull, using the command:</p>&#xA;&#xA;<pre><code>PUT a/g/2&#xA;{"array": [1,2]}&#xA;</code></pre>&#xA;&#xA;<p>and the mapping is the following:</p>&#xA;&#xA;<pre><code>{&#xA;   "a": {&#xA;      "mappings": {&#xA;         "g": {"properties": {"array": {"type": "long"}}}&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;
<p>You can only search for items in that array not the array as a whole.</p>&#xA;&#xA;<p>So this will work:</p>&#xA;&#xA;<pre><code>{&#xA;    "query": {&#xA;        "match": {&#xA;            "array": 1&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>However searching for complete array can be done using workaround by indexing an additional field that keeps track of number of items in array. By combining search for all items in the array and count of them this will be achievable to some extent.&#xA;<a href="http://www.elastic.co/guide/en/elasticsearch/guide/current/_finding_multiple_exact_values.html#_equals_exactly" rel="nofollow">http://www.elastic.co/guide/en/elasticsearch/guide/current/_finding_multiple_exact_values.html#_equals_exactly</a></p>&#xA;&#xA;<p>Assuming that you index the additional field <code>count</code> the document becomes <code>{"array": [1,2], "count": 2}</code>. The query in this case will be:</p>&#xA;&#xA;<pre><code>{&#xA;    "query": {&#xA;        "bool": {&#xA;            "must": [&#xA;                {"match": {"array": 1}},&#xA;                {"match": {"array": 2}},&#xA;                {"match": {"count": 2}}&#xA;            ]&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;