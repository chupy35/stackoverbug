33263673
Disable dynamic mapping creation for only specific indexes on elasticsearch?
<p>I'm trying to disable dynamic mapping creation for only specific indexes, not for all. For some reason I can't put <em>default</em> mapping with 'dynamic' : 'false'.&#xA;So, here left two options as I can see:</p>&#xA;&#xA;<ol>&#xA;<li>specify property <em>'index.mapper.dynamic'</em> in file <em>elasticsearch.yml</em>.</li>&#xA;<li>put <em>'index.mapper.dynamic'</em> at index creation time, as described here <a href="https://www.elastic.co/guide/en/kibana/current/setup.html#kibana-dynamic-mapping">https://www.elastic.co/guide/en/kibana/current/setup.html#kibana-dynamic-mapping</a></li>&#xA;</ol>&#xA;&#xA;<p>First option may only accept values: true, false and strict. So there is no way to specify subset of specific indexes (like we do by pattern with property <em>'action.auto_create_index'</em> <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-index_.html#index-creation">https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-index_.html#index-creation</a>).</p>&#xA;&#xA;<p>Second option just not works. &#xA;I've created index</p>&#xA;&#xA;<pre><code>POST http://localhost:9200/test_idx/&#xA;{&#xA;    "settings" : {&#xA;        "mapper" : {&#xA;            "dynamic" : false&#xA;        }&#xA;    },&#xA;    "mappings" : {&#xA;        "test_type" : {&#xA;            "properties" : {&#xA;                "field1" : {&#xA;                    "type" : "string"&#xA;                }&#xA;            }&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Then checked index settings:</p>&#xA;&#xA;<pre><code>GET http://localhost:9200/test_idx/_settings    &#xA;{&#xA;    "test_idx" : {&#xA;        "settings" : {&#xA;            "index" : {&#xA;                "mapper" : {&#xA;                    "dynamic" : "false"&#xA;                },&#xA;                "creation_date" : "1445440252221",&#xA;                "number_of_shards" : "1",&#xA;                "number_of_replicas" : "0",&#xA;                "version" : {&#xA;                    "created" : "1050299"&#xA;                },&#xA;                "uuid" : "5QSYSYoORNqCXtdYn51XfA"&#xA;            }&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>and mapping:</p>&#xA;&#xA;<pre><code>GET http://localhost:9200/test_idx/_mapping&#xA;{&#xA;    "test_idx" : {&#xA;        "mappings" : {&#xA;            "test_type" : {&#xA;                "properties" : {&#xA;                    "field1" : {&#xA;                        "type" : "string"&#xA;                    }&#xA;                }&#xA;            }&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>so far so good, let's index document with undeclared field:</p>&#xA;&#xA;<pre><code>POST http://localhost:9200/test_idx/test_type/1&#xA;{&#xA;    "field1" : "it's ok, field must be in mapping and in source",&#xA;    "somefield" : "but this field must be in source only, not in mapping"&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Then I've checked mapping again:</p>&#xA;&#xA;<pre><code>GET http://localhost:9200/test_idx/_mapping&#xA;{&#xA;    "test_idx" : {&#xA;        "mappings" : {&#xA;            "test_type" : {&#xA;                "properties" : {&#xA;                    "field1" : {&#xA;                        "type" : "string"&#xA;                    },&#xA;                    "somefield" : {&#xA;                        "type" : "string"&#xA;                    }&#xA;                }&#xA;            }&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>As you can see, mapping is extended regardless of index setting "dynamic" : false.&#xA;I've also tried to create index exactly as described in doc </p>&#xA;&#xA;<pre><code>PUT http://localhost:9200/test_idx&#xA;{&#xA;    "index.mapper.dynamic": false&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>but got the same behavior.</p>&#xA;&#xA;<p>Maybe I've missed something?</p>&#xA;&#xA;<p>Thanks a lot in advance!</p>&#xA;
<p>You're almost there: the value needs to be set to <code>strict</code>.&#xA;And the correct usage is the following:</p>&#xA;&#xA;<pre><code>PUT /test_idx&#xA;{&#xA;  "mappings": {&#xA;    "test_type": {&#xA;      "dynamic":"strict",&#xA;      "properties": {&#xA;        "field1": {&#xA;          "type": "string"&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>And pushing this a bit further, if you want to forbid the creation even of new types, not only fields in that index, use this:</p>&#xA;&#xA;<pre><code>PUT /test_idx&#xA;{&#xA;  "mappings": {&#xA;    "_default_": {&#xA;      "dynamic": "strict"&#xA;    },&#xA;    "test_type": {&#xA;      "properties": {&#xA;        "field1": {&#xA;          "type": "string"&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Without <code>_default_</code> template:</p>&#xA;&#xA;<pre><code>PUT /test_idx&#xA;{&#xA;  "settings": {&#xA;    "index.mapper.dynamic": false&#xA;  },&#xA;  "mappings": {&#xA;    "test_type": {&#xA;      "dynamic": "strict",&#xA;      "properties": {&#xA;        "field1": {&#xA;          "type": "string"&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;
<p>You must know about that the below part just mean that ES could'nt create a type dynamically.</p>&#xA;&#xA;<pre><code>"mapper" : {&#xA;        "dynamic" : false&#xA;    }&#xA;</code></pre>&#xA;&#xA;<p>You should configure ES like this:</p>&#xA;&#xA;<pre><code>PUT http://localhost:9200/test_idx/_mapping/test_type&#xA;{&#xA;  "dynamic":"strict"&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Then you cant't index other field that without mapping any more ,and get an error as follow:</p>&#xA;&#xA;<pre><code>mapping set to strict, dynamic introduction of [hatae] within [data] is not allowed&#xA;</code></pre>&#xA;&#xA;<p>If you wanna store the data,but make the field can't be index,you could take the setting like this:</p>&#xA;&#xA;<pre><code>PUT http://localhost:9200/test_idx/_mapping/test_type&#xA;{&#xA;  "dynamic":false&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Hope these can help the people with the same issue :).</p>&#xA;