31719968
select matching objects from array in elasticsearch
<pre><code>{&#xA;    class: 1,&#xA;    users: [{&#xA;        name: 'abc',&#xA;        surname: 'def'&#xA;    }, {&#xA;        name: 'xyz',&#xA;        surname: 'wef'&#xA;    }, {&#xA;        name: 'abc',&#xA;        surname: 'pqr'&#xA;    }]&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>I have a document structure like above object and I want to return only users who have name 'abc' but problem is it matches name 'abc' but returns &#xA;all array. I want only matched users .</p>&#xA;&#xA;<p>Mapping - </p>&#xA;&#xA;<pre><code>{&#xA;        "class":"string",&#xA;        "users" : {&#xA;            "type" : "nested",&#xA;            "properties": {&#xA;                "name" : {"type": "string" },&#xA;                "surname"  : {"type": "string" }&#xA;            }&#xA;        }&#xA;    }&#xA;</code></pre>&#xA;
<p>Then if you have your <code>users</code> field mapped as <code>nested</code> type, it's a good start!</p>&#xA;&#xA;<p>Using <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-inner-hits.html#nested-inner-hits" rel="noreferrer">nested <code>inner_hits</code></a>, you can retrieve only the matching user names with a query like this one:</p>&#xA;&#xA;<pre><code>{&#xA;  "_source": false,&#xA;  "query": {&#xA;    "nested": {&#xA;      "path": "users",&#xA;      "inner_hits": {        &lt;---- this is where the magic happens&#xA;        "_source": [&#xA;          "name"&#xA;        ]&#xA;      },&#xA;      "query": {&#xA;        "bool": {&#xA;          "must": [&#xA;            {&#xA;              "term": {&#xA;                "users.name": "abc"&#xA;              }&#xA;            }&#xA;          ]&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;