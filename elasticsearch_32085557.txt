32085557
ElasticSearch: post_filter or filter?
<p>Let's say I have a similar situation explained here:&#xA;<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-post-filter.html" rel="noreferrer">https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-post-filter.html</a></p>&#xA;&#xA;<p>Before I stumbled upon this article, I have been using filter instead of post_filter for this kind of scenario, and it produced output just like the post_filter.</p>&#xA;&#xA;<p>My question is: Are they the same thing? If not, which one is the recommended and more efficient method to use and why?</p>&#xA;
<p>As far as <strong>search hits</strong> are concerned, they are the same thing, i.e. the hits you get will be correctly filtered according to either your filter in a <code>filtered</code> query or the filter in your <code>post_filter</code>.</p>&#xA;&#xA;<p>However, as far as <strong>aggregations</strong> are concerned, the end result will not be the same. The difference between both boils down to what document set the aggregations will be computed on. </p>&#xA;&#xA;<p>If your filter is in a <code>filtered</code> query, then your aggregations will be computed on the document set selected by the query(ies) and the filter(s) in your <code>filtered</code> query, i.e. the same set of documents that you will get in the response.</p>&#xA;&#xA;<p>If your filter is in a <code>post_filter</code>, then your aggregations will be computed on the document set selected by your various query(ies). Once aggregations have been computed on that document set, the latter is further filtered by the filter(s) in your <code>post_filter</code> before returning the matching documents.</p>&#xA;&#xA;<p>To sum it up, </p>&#xA;&#xA;<ul>&#xA;<li>a <code>filtered</code> query affects <strong>both search results and aggregations</strong>  </li>&#xA;<li>while a <code>post_filter</code> <strong>only affects the search results but NOT the aggregations</strong></li>&#xA;</ul>&#xA;
<p>In my tests , I could find filter is behaving exactly as post_filter. Both are only affecting the hits section ONLY. </p>&#xA;