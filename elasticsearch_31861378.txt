31861378
Elasticsearch filter by year from a date field
<p>i have docs with date field of the format yyyy-MM-dd. is there a way to filter only based on year part of the field.</p>&#xA;&#xA;<p>example:</p>&#xA;&#xA;<pre><code>{'name': 'a', 'born': '1984-11-22'},&#xA;{'name': 'b', 'born': '1984-12-12'},&#xA;{'name': 'c', 'born': '1985-10-22'},&#xA;</code></pre>&#xA;&#xA;<p>I want to do a term/range filter to find people born on year 1984.&#xA;Any help is highly appreciated.</p>&#xA;
<p>Yes, you can do it using a <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-range-filter.html" rel="nofollow"><code>range</code> filter</a> and specifying a year <code>format</code> :</p>&#xA;&#xA;<pre><code>{&#xA;    "constant_score": {&#xA;        "filter": {&#xA;            "range" : {&#xA;                "born" : {&#xA;                    "gte": "1984",&#xA;                    "lte": "1984",&#xA;                    "format": "yyyy"&#xA;                }&#xA;            }&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;
<pre><code>"query": {&#xA;        "filtered": {&#xA;           "filter": {&#xA;               "range": {&#xA;                  "born": {&#xA;                     "gte": "1984||/y",&#xA;                     "lte": "1984||/y",&#xA;                     "format": "yyyy"&#xA;                  }&#xA;               }&#xA;           }&#xA;        }&#xA;    }&#xA;</code></pre>&#xA;&#xA;<p>This required rounding the input year argument as well in addition to adding the format. Without rounding by year the range query does not work as intended. Tried it on multiple date formats like dateOptionalTime, date etc.</p>&#xA;&#xA;<p>For details on how to use Date Math see <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-range-query.html" rel="nofollow noreferrer">https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-range-query.html</a></p>&#xA;