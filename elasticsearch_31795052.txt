31795052
Elastic Search query against nested and non nested fields
<p>I am indexing restaurant and their dishes in ES. The restaurant dishes are nested and a list of several dishes. The restaurant name and cuisines (a list too) comes outside. The structure is somewhat like this:</p>&#xA;&#xA;<pre><code>{ &#xA;     "restaurant_name": "Dominos",&#xA;     "cuisines": ["Italian", "Continental"],&#xA;     "restaurant_dishes": [&#xA;          {&#xA;              "dish_name": "Margherita"&#xA;          },&#xA;          {&#xA;               "dish_name": "Piri Piri Pizza"&#xA;          }&#xA;      ]&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>I am trying to run a should (OR) query against them like this:</p>&#xA;&#xA;<pre><code>{&#xA;  "query": {&#xA;&#xA;    "bool": { &#xA;              "should": [ &#xA;                          {&#xA;                              "term": {"restaurant_name": "Dominos"}&#xA;                          },&#xA;                          {    &#xA;                              "nested": {&#xA;&#xA;                                "path": "restaurant_dishes",&#xA;                                "query": {&#xA;                                          "match": {&#xA;                                            "dish_name": "Dominos"&#xA;                                                   }&#xA;                                          }&#xA;                                       }&#xA;                          }&#xA;                        ],&#xA;             "minimum_number_should_match": 1&#xA;&#xA;    }&#xA;&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Here is the mapping:</p>&#xA;&#xA;<pre><code>  {&#xA;        "restaurant": {&#xA;            "_routing": {&#xA;                "required": True,&#xA;                "path": "id"&#xA;            },&#xA;        "properties": {&#xA;              "restaurant_name": {"type": "string", "index":"analyzed", "analyzer": "standard"},},&#xA;        "restaurant_dishes": {&#xA;                    "type": "nested",&#xA;                    "properties": {"dish_name": {"type": "string", "index": "analyzed", "analyzer": "standard"},}&#xA;</code></pre>&#xA;&#xA;<p>I expect this to return the listing because <code>"name"</code> field matches. However it returns an empty list. I basically want to implement a single search box which searches for <code>restaurant name, cuisines and dish names</code> in a single query.</p>&#xA;