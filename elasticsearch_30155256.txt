30155256
How to get the count of most frequent pattern in elasticsearch?
<p>I want to get the ten most frequent patterns in search with <code>elasticsearch</code> .<br>&#xA;Example :</p>&#xA;&#xA;<pre><code>"cgn:4189, dfsdkfldslfs"&#xA;"cgn:4210, aezfvdsvgds"&#xA;"cgn:4189, fdsmpfjdjs"&#xA;"cgn:4195, cvsf"&#xA;"cgn:4189, mkpjd"&#xA;"cgn:4210, mfsfgkpjd"&#xA;</code></pre>&#xA;&#xA;<p>I want to get :</p>&#xA;&#xA;<pre><code>4189 : 3&#xA;4210 : 2&#xA;4195 : 1&#xA;</code></pre>&#xA;&#xA;<p>I know how to do that in <code>mysql</code> or via awk/sort/head ... but with <code>elasticsearch</code> I'm lost.</p>&#xA;
<p>Exactly how it will work depends on your analyzer, but if you are just using the default, <a href="http://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-standard-analyzer.html" rel="nofollow">standard analyzer</a>, you can probably get what you want pretty easily with a <a href="http://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-terms-aggregation.html" rel="nofollow">terms aggregation</a>.</p>&#xA;&#xA;<p>As a simple example, I set up a trivial index:</p>&#xA;&#xA;<pre><code>PUT /test_index&#xA;{&#xA;   "settings": {&#xA;      "number_of_shards": 1&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Then indexed the data you posted, using the <a href="http://www.elastic.co/guide/en/elasticsearch/reference/current/docs-bulk.html" rel="nofollow">bulk api</a>:</p>&#xA;&#xA;<pre><code>POST /test_index/doc/_bulk&#xA;{"index":{"_id":1}}&#xA;{"msg":"cgn:4189, dfsdkfldslfs"}&#xA;{"index":{"_id":2}}&#xA;{"msg":"cgn:4210, aezfvdsvgds"}&#xA;{"index":{"_id":3}}&#xA;{"msg":"cgn:4189, fdsmpfjdjs"}&#xA;{"index":{"_id":4}}&#xA;{"msg":"cgn:4195, cvsf"}&#xA;{"index":{"_id":5}}&#xA;{"msg":"cgn:4189, mkpjd"}&#xA;{"index":{"_id":6}}&#xA;{"msg":"cgn:4210, mfsfgkpjd"}&#xA;</code></pre>&#xA;&#xA;<p>Then I can run a simple terms aggregation to get back all the terms and how often they occur (ordered descending by term frequency by default):</p>&#xA;&#xA;<pre><code>POST /test_index/_search?search_type=count&#xA;{&#xA;   "aggs": {&#xA;      "msg_terms": {&#xA;         "terms": {&#xA;            "field": "msg"&#xA;         }&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>which returns:</p>&#xA;&#xA;<pre><code>{&#xA;   "took": 4,&#xA;   "timed_out": false,&#xA;   "_shards": {&#xA;      "total": 1,&#xA;      "successful": 1,&#xA;      "failed": 0&#xA;   },&#xA;   "hits": {&#xA;      "total": 6,&#xA;      "max_score": 0,&#xA;      "hits": []&#xA;   },&#xA;   "aggregations": {&#xA;      "msg_terms": {&#xA;         "doc_count_error_upper_bound": 0,&#xA;         "sum_other_doc_count": 0,&#xA;         "buckets": [&#xA;            {&#xA;               "key": "cgn",&#xA;               "doc_count": 6&#xA;            },&#xA;            {&#xA;               "key": "4189",&#xA;               "doc_count": 3&#xA;            },&#xA;            {&#xA;               "key": "4210",&#xA;               "doc_count": 2&#xA;            },&#xA;            {&#xA;               "key": "4195",&#xA;               "doc_count": 1&#xA;            },&#xA;            {&#xA;               "key": "aezfvdsvgds",&#xA;               "doc_count": 1&#xA;            },&#xA;            {&#xA;               "key": "cvsf",&#xA;               "doc_count": 1&#xA;            },&#xA;            {&#xA;               "key": "dfsdkfldslfs",&#xA;               "doc_count": 1&#xA;            },&#xA;            {&#xA;               "key": "fdsmpfjdjs",&#xA;               "doc_count": 1&#xA;            },&#xA;            {&#xA;               "key": "mfsfgkpjd",&#xA;               "doc_count": 1&#xA;            },&#xA;            {&#xA;               "key": "mkpjd",&#xA;               "doc_count": 1&#xA;            }&#xA;         ]&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Here is the code I used:</p>&#xA;&#xA;<p><a href="http://sense.qbox.io/gist/a827095b675596c4e3d545ce963cde3fae932156" rel="nofollow">http://sense.qbox.io/gist/a827095b675596c4e3d545ce963cde3fae932156</a></p>&#xA;