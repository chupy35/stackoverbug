31253795
BoolFilter and BoolQuery in ElasticSearch
<p>I am applying to two search requests a filter and a query semantically identical like so:</p>&#xA;&#xA;<pre><code>static FilterBuilder filter(String field1Value, String field2Value){&#xA;    return FilterBuilders.boolFilter().must(FilterBuilders.termFilter("field1",field1Value)).should(FilterBuilders.termFilter("field2",field2Value));&#xA;}&#xA;static QueryBuilder query(String field1Value, String field2Value){&#xA;    return QueryBuilders.boolQuery().must(QueryBuilders.termQuery("field1",field1Value)).should(QueryBuilders.termQuery("field2",field2Value));&#xA;}&#xA;client.prepareSearch(indexName).setPostFilter(filter("hello", "world")).setTypes("mytype");&#xA;client.prepareSearch(indexName).setQuery(query("hello","world")).setTypes("mytype");&#xA;</code></pre>&#xA;&#xA;<p>However, while the search with the query returns results, the search with the filter doesn't return any result. Aren't the two suppose to behave identically and if not, why?</p>&#xA;
<p>They are not exactly the same. &#xA;In a bool query with a must clause a document would be a match if none of the clauses in should are matched provided there is no explicit <a href="https://www.elastic.co/guide/en/elasticsearch/reference/1.3/query-dsl-bool-query.html" rel="nofollow">minimum_should_match</a> in the query.</p>&#xA;&#xA;<p>In filter bool query at-least one should clause needs to be satisfied for a document to be considered a match. In filters there is no option of minimum_should_match  and can be treated as always set to one.</p>&#xA;&#xA;<p>i.e for filters it can be viewed as follows </p>&#xA;&#xA;<pre><code> [must_clause] &amp;&amp; [should_clause1 || should_clause_2]&#xA;</code></pre>&#xA;&#xA;<p>For the example in the OP :</p>&#xA;&#xA;<p>1) the documents would pass the filter if and only if they match  field1 criteria in <em>must clause</em> and field2 criteria in <em>should clause</em> .</p>&#xA;&#xA;<p>2) Whereas for bool query  it would suffice for a  document to be considered a match if must-clause is satisfied i.e field1 match</p>&#xA;