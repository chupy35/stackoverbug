33262833
Elastic Search Filtered Query with term filter
<p>I do have a problem with a filtered query. When I run the following query :</p>&#xA;&#xA;<pre><code>{&#xA;"query":{&#xA;  "filtered":{&#xA;     "query":{&#xA;        "regexp":{&#xA;           "name":"chri.*"&#xA;        }&#xA;     },&#xA;     "filter":{&#xA;        "bool":{&#xA;           "must":[&#xA;                {"term": { "accountNonLocked": "false" }}&#xA;            ]&#xA;        }&#xA;     }&#xA;  }&#xA;},"fields" : ["name", "id", "accountNonLocked","role"], &#xA;"from" : 0, &#xA;"size" : 10&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>I got to following response </p>&#xA;&#xA;<pre><code>{&#xA;"took": 4,&#xA;  "timed_out": false,&#xA;  "_shards": {&#xA;     "total": 5,&#xA;     "successful": 5,&#xA;     "failed": 0&#xA;  },&#xA;  "hits": {&#xA;  "total": 2,&#xA;  "max_score": 1,&#xA;  "hits": [&#xA;  {&#xA;    "_index": "candidatindex",&#xA;    "_type": "job",&#xA;    "_id": "54c7867ecfcbbe42dc000478",&#xA;    "_score": 1,&#xA;    "fields": {&#xA;      "name": [&#xA;        "Christophe toto"&#xA;      ],&#xA;      "accountNonLocked": [&#xA;        true&#xA;      ],&#xA;      "role": [&#xA;        "DHR"&#xA;      ]&#xA;    }&#xA;  },&#xA;  {&#xA;    "_index": "candidatindex",&#xA;    "_type": "job",&#xA;    "_id": "54c7867ecfcbbe42dc000468",&#xA;    "_score": 1,&#xA;    "fields": {&#xA;      "name": [&#xA;        "Christophe Toto"&#xA;      ],&#xA;      "accountNonLocked": [&#xA;        true&#xA;      ],&#xA;      "role": [&#xA;        "CANDIDATE"&#xA;      ]&#xA;    }&#xA;  }&#xA;  ]}&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>But when I add a filter on the role like this :</p>&#xA;&#xA;<pre><code>{&#xA;"query":{&#xA;  "filtered":{&#xA;     "query":{&#xA;        "regexp":{&#xA;           "name":"chri.*"&#xA;        }&#xA;     },&#xA;     "filter":{&#xA;        "bool":{&#xA;           "must":[&#xA;                {"term": { "accountNonLocked": "false" }},&#xA;                {"term": { "role": "CANDIDATE" }}&#xA;            ]&#xA;        }&#xA;     }&#xA;  }&#xA;},"fields" : ["name", "id", "accountNonLocked","role"], &#xA;"from" : 0, &#xA;"size" : 10&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Then I got an empty result :</p>&#xA;&#xA;<pre><code>{&#xA;"took": 3,&#xA;  "timed_out": false,&#xA;  "_shards": {&#xA;    "total": 5,&#xA;    "successful": 5,&#xA;    "failed": 0&#xA;  },&#xA;  "hits": {&#xA;    "total": 0,&#xA;    "max_score": null,&#xA;    "hits": []&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Does anyone can tell me what I am doing wrong ?</p>&#xA;
<p>Your <code>role</code> field is probably an <code>analyzed</code> string.&#xA;So either try with a lowercase value like in</p>&#xA;&#xA;<pre><code> {"term": { "role": "candidate" }}&#xA;</code></pre>&#xA;&#xA;<p>or change the mapping of your <code>role</code> field to be <code>not_analyzed</code> (you'll need to reindex your data for the change to take effect)</p>&#xA;