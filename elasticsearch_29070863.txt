29070863
Elasticsearch Scripting with date
<p>I have elasticsearch document as below. </p>&#xA;&#xA;<pre><code>{&#xA;  "ProductID": 123,&#xA;  "SellingPrice": 1200.00,&#xA;  "DiscountAmount":0.00,&#xA;  "Discount": {&#xA;    "Type": "percentage",&#xA;    "Amount": 25,&#xA;    "StartDate": "2014-08-13T12:05:00",&#xA;    "EndDate": "2014-12-31T12:10:00"&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Whenever i retrieve this document, script should automatically check the Endate with Current system date, if discount is not expired, It should change "DiscountAmount" field based on discount percentage in the result. Please help me on this.  </p>&#xA;
<p>You can't change the actual fields in your document but you can add fields to your result with <a href="http://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-script-fields.html" rel="nofollow">script fields</a>. Something like this (untested) should get you started.</p>&#xA;&#xA;<pre><code>"script_fields" : {        &#xA;    "actual_cost" : {&#xA;        "script" : "if (doc['Discount.EndDate'].value &gt; System.currentTimeMillis()) {return doc['SellingPrice'].value * doc['Discount.Amount]/100;}; return doc['SellingPrice'].value;"&#xA;    }&#xA;}&#xA;</code></pre>&#xA;