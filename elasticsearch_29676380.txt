29676380
Elasticsearch with query_string and range
<p>I'm trying to get a result that is greater than X and has a field equal to Y. I tried this:</p>&#xA;&#xA;<pre><code>{&#xA;   "sort": {&#xA;      "datapublicacao": "desc"&#xA;   },&#xA;   "query": {&#xA;      "query_string": {&#xA;         "query": "fullslug:noticia"&#xA;      },&#xA;      "range": {&#xA;         "id": {&#xA;            "gt": "145890"&#xA;         }&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>But the following error occurs:</p>&#xA;&#xA;<pre><code>{&#xA;   "error": "SearchPhaseExecutionException[Failed to execute phase [query], all shards failed; shardFailures {[PkbOJvspSO-yk_8dRMmxcg][jornal.jurid][2]: SearchParseException[[jornal.jurid][2]: query[fullslug:noticia],from[-1],size[-1],sort[&lt;custom:\"datapublicacao\": org.elasticsearch.index.fielddata.fieldcomparator.LongValuesComparatorSource@4105c103&gt;!]: Parse Failure [Failed to parse source [{\n   \"sort\": {\n      \"datapublicacao\": \"desc\"\n   },\n   \"query\": {\n      \"query_string\": {\n         \"query\": \"fullslug:noticia\"\n      },\n      \"range\": {\n         \"id\": {\n            \"gt\": \"145890\"\n         }\n      }\n   }\n}\n]]]; nested: ElasticsearchParseException[Expected field name but got START_OBJECT \"range\"]; }{[PkbOJvspSO-yk_8dRMmxcg][jornal.jurid][3]: SearchParseException[[jornal.jurid][3]: query[fullslug:noticia],from[-1],size[-1],sort[&lt;custom:\"datapublicacao\": org.elasticsearch.index.fielddata.fieldcomparator.LongValuesComparatorSource@32ef6244&gt;!]: Parse Failure [Failed to parse source [{\n   \"sort\": {\n      \"datapublicacao\": \"desc\"\n   },\n   \"query\": {\n      \"query_string\": {\n         \"query\": \"fullslug:noticia\"\n      },\n      \"range\": {\n         \"id\": {\n            \"gt\": \"145890\"\n         }\n      }\n   }\n}\n]]]; nested: ElasticsearchParseException[Expected field name but got START_OBJECT \"range\"]; }{[PkbOJvspSO-yk_8dRMmxcg][jornal.jurid][0]: SearchParseException[[jornal.jurid][0]: query[fullslug:noticia],from[-1],size[-1],sort[&lt;custom:\"datapublicacao\": org.elasticsearch.index.fielddata.fieldcomparator.LongValuesComparatorSource@1534ed83&gt;!]: Parse Failure [Failed to parse source [{\n   \"sort\": {\n      \"datapublicacao\": \"desc\"\n   },\n   \"query\": {\n      \"query_string\": {\n         \"query\": \"fullslug:noticia\"\n      },\n      \"range\": {\n         \"id\": {\n            \"gt\": \"145890\"\n         }\n      }\n   }\n}\n]]]; nested: ElasticsearchParseException[Expected field name but got START_OBJECT \"range\"]; }{[PkbOJvspSO-yk_8dRMmxcg][jornal.jurid][1]: SearchParseException[[jornal.jurid][1]: query[fullslug:noticia],from[-1],size[-1],sort[&lt;custom:\"datapublicacao\": org.elasticsearch.index.fielddata.fieldcomparator.LongValuesComparatorSource@21c787c&gt;!]: Parse Failure [Failed to parse source [{\n   \"sort\": {\n      \"datapublicacao\": \"desc\"\n   },\n   \"query\": {\n      \"query_string\": {\n         \"query\": \"fullslug:noticia\"\n      },\n      \"range\": {\n         \"id\": {\n            \"gt\": \"145890\"\n         }\n      }\n   }\n}\n]]]; nested: ElasticsearchParseException[Expected field name but got START_OBJECT \"range\"]; }{[PkbOJvspSO-yk_8dRMmxcg][jornal.jurid][4]: SearchParseException[[jornal.jurid][4]: query[fullslug:noticia],from[-1],size[-1],sort[&lt;custom:\"datapublicacao\": org.elasticsearch.index.fielddata.fieldcomparator.LongValuesComparatorSource@45d53e55&gt;!]: Parse Failure [Failed to parse source [{\n   \"sort\": {\n      \"datapublicacao\": \"desc\"\n   },\n   \"query\": {\n      \"query_string\": {\n         \"query\": \"fullslug:noticia\"\n      },\n      \"range\": {\n         \"id\": {\n            \"gt\": \"145890\"\n         }\n      }\n   }\n}\n]]]; nested: ElasticsearchParseException[Expected field name but got START_OBJECT \"range\"]; }]",&#xA;   "status": 400&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>If I make the query just with the query_string or just the range, it works, but with them both it does not work.</p>&#xA;
<p>Use elasticsearch <a href="http://www.elastic.co/guide/en/elasticsearch/reference/1.4/query-dsl-bool-query.html" rel="noreferrer">bool search</a> as below </p>&#xA;&#xA;<pre><code>{&#xA;"query": {&#xA;    "filtered": {&#xA;        "query": {&#xA;            "bool": {&#xA;                "must": [&#xA;                    {&#xA;                        "query_string": {&#xA;                            "query": "fullslug:noticia"&#xA;                        }&#xA;                    },&#xA;                    {&#xA;                        "range": {&#xA;                            "id": {&#xA;                                "gte": 145890&#xA;                            }&#xA;                        }&#xA;                    }&#xA;                ]&#xA;            }&#xA;        }&#xA;    }&#xA;},&#xA;"sort": {&#xA;    "datapublicacao": "desc"&#xA;}&#xA;}&#xA;</code></pre>&#xA;