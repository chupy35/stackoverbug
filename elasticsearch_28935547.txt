28935547
elasticsearch, function_score SearchPhaseExecutionException
<p>I followed the tutorial at the last part of this <a href="http://www.elasticsearch.org/guide/en/elasticsearch/guide/current/script-score.html" rel="nofollow">page</a>.</p>&#xA;&#xA;<pre><code>POST /merchantindex/_search&#xA;{&#xA;    "function_score": {&#xA;    "query": {&#xA;    {"query_string": { "query": "test"}}&#xA;    },&#xA;    "functions": [&#xA;        {&#xA;            "script_score": &#xA;            {&#xA;                "script": "return _score;"&#xA;            }&#xA;        }&#xA;    ]&#xA;}&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>What I am expecting the returning of relevance score. I wanted to do some processing with the _score, e.g. _score * some other stuffs but I am just trying if the code works for now.</p>&#xA;&#xA;<p>Error that I got is </p>&#xA;&#xA;<pre><code>"error": "SearchPhaseExecutionException[Failed to execute phase [query], all shards failed;...&#xA;</code></pre>&#xA;
<p>This error:</p>&#xA;&#xA;<pre><code>"error": "SearchPhaseExecutionException[Failed to execute phase [query], all shards failed;...&#xA;</code></pre>&#xA;&#xA;<p>typically means that the formatting of your query is wrong.</p>&#xA;&#xA;<p>if you check your query you'll see that you have two curly brackets between <code>query</code> and <code>query_string</code>:</p>&#xA;&#xA;<pre><code>"query": {    {"query_string":&#xA;</code></pre>&#xA;&#xA;<p>Also <code>function_score</code> needs to sit inside a query and <code>functions</code> needs to be inside <code>function_score</code>.</p>&#xA;&#xA;<p>Try this instead:</p>&#xA;&#xA;<pre><code>curl -XPOST "http://localhost:9200/merchantindex/_search" -d '&#xA;{&#xA;    "query": {&#xA;      "function_score" : {&#xA;         "query" :{&#xA;            "query_string": { "query": "test"}&#xA;         },&#xA;         "functions": [&#xA;         {&#xA;            "script_score": {&#xA;                "script": "return _score;"&#xA;            }&#xA;         }&#xA;       ]&#xA;     }&#xA;   }&#xA;}'&#xA;</code></pre>&#xA;