28503578
Elasticsearch: disable coordination factor for multi match query
<p>I use a multi match query with different weights on each field.&#xA;I set tie_breaker to 1 to disable use_dis_max and use the sum instead of the max for the score.</p>&#xA;&#xA;<pre><code>GET index_name/index_type/_search?explain&#xA;{&#xA; "size": 1,&#xA;  "query": {&#xA;  "multi_match": {&#xA;   "query": "ticket",&#xA;   "fields": ["title^9", "descr^4", "*section_body"],&#xA;   "tie_breaker": 1&#xA;  }&#xA; }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>ES sums the scores for each field then multiplies it by the coordination factor.</p>&#xA;&#xA;<p>I want to disable the coordination factor, so I tried to wrap my multi match query into a bool query and set disable_coord to true as the following:</p>&#xA;&#xA;<pre><code>GET index_name/index_type/_search?explain&#xA;{&#xA;  "size": 1,&#xA;  "query": {&#xA;    "bool": {&#xA;       "disable_coord": true,&#xA;       "should": [&#xA;         {&#xA;          "multi_match": {&#xA;          "query": "ticket",&#xA;          "fields": ["title^9", "descr^4", "*section_body"],&#xA;          "tie_breaker": 1&#xA;           }&#xA;         }&#xA;      ]&#xA;    }&#xA; }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>But I can see that nothing changed in the scoring formula, ES is still summing the scores for all different fields then multiplying the result by the coordination factor. </p>&#xA;&#xA;<p>How can I disable the coordination factor ?</p>&#xA;
<p>I would recommending separating the individual conditions of the <code>should</code> and boosting them individually.  That might look something like the following:</p>&#xA;&#xA;<pre><code>{&#xA;  "size": 1,&#xA;  "query": {&#xA;    "bool": {&#xA;      "disable_coord": true,&#xA;      "should": [&#xA;        {"match" : {"title" : {"query" : "ticket", "boost" : 9}}},&#xA;        {"match" : {"descr" : {"query" : "ticket", "boost" : 4}}},&#xA;        {"multi_match" : {&#xA;          "fields" : ["*section_body"],&#xA;          "query" : "ticket"&#xA;        }}&#xA;      ]&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>For a silly set of test data I ginned up, it does look like this results in the coordination factor no longer being applied, namely that the resulting scores for each document are higher when <code>disable_coord</code> is <code>true</code> versus when it is set to <code>false</code>.</p>&#xA;