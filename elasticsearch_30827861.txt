30827861
Elasticsearch Java API Function Score Query with geo and time gauss function
<p>I am currently trying to build this function score query with the Java API of elasticsearch:</p>&#xA;&#xA;<pre><code>{&#xA;   "query": {&#xA;      "function_score": {&#xA;         "functions": [&#xA;            {&#xA;               "gauss": {&#xA;                  "location": {&#xA;                     "origin": {&#xA;                        "lat": 52.55,&#xA;                        "lon": 13.69&#xA;                     },&#xA;                     "offset": "30km",&#xA;                     "scale": "10km",&#xA;                     "decay": 0.9&#xA;                  }&#xA;               }&#xA;            },&#xA;            {&#xA;               "gauss": {&#xA;                  "createdAt": {&#xA;                     "origin": "2015-06-14T15:50:00",&#xA;                     "scale": "8h",&#xA;                     "offset": "4h",&#xA;                     "decay": 0.75&#xA;                  }&#xA;               }&#xA;            }&#xA;         ]&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>But I can't find any documentation regarding the java api and the function score queries. This is what I have so far:</p>&#xA;&#xA;<pre><code>elasticsearch.client&#xA;  .prepareSearch(config.offerIndex.value)&#xA;  .setQuery(&#xA;     QueryBuilders.functionScoreQuery(&#xA;       ScoreFunctionBuilders&#xA;         .gaussDecayFunction("location", ???, ???).setDecay(0.9)&#xA;     )&#xA;  )&#xA;</code></pre>&#xA;&#xA;<p>The second and the third parameter of the gaussDecayFunction are named origin and scale. But they have the any type and I have no idea how I have to provide my location and time values there.&#xA;And the next question is how I can provide to functions in the FunctionScore Builder</p>&#xA;
<p>I have found this solution but I am not sure if this is the clean way to do it. Would appreciate if someone can approve it.</p>&#xA;&#xA;<pre><code>val lat = 52.52&#xA;val lon = 13.402&#xA;&#xA;QueryBuilders&#xA;  .functionScoreQuery(&#xA;     ScoreFunctionBuilders.gaussDecayFunction("location", new GeoPoint(lat, lon), "10km")&#xA;       .setDecay(0.9)&#xA;       .setOffset("30km"))&#xA;  .add(&#xA;     ScoreFunctionBuilders.gaussDecayFunction("createdAt", new DateTime(), "8h")&#xA;       .setDecay(0.75)&#xA;       .setOffset("4h"))&#xA;)&#xA;</code></pre>&#xA;