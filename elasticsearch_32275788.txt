32275788
Elasticsearch Phrase Suggestion
<p>The elasticsearch <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-suggesters-phrase.html" rel="nofollow">documentation</a> states:</p>&#xA;&#xA;<blockquote>&#xA;  <p>In practice this suggester will be able to make better decisions about which tokens to pick based on <em>co-occurence</em> and frequencies.</p>&#xA;</blockquote>&#xA;&#xA;<p>I have a document in my index that has a <em>name</em> field with content <code>Bella Tank</code>.</p>&#xA;&#xA;<p>To test the phrase suggester, I send the following query:</p>&#xA;&#xA;<pre><code>curl -XPOST 'localhost:9200/my_index/_search?pretty' -d '{&#xA;  "suggest" : {&#xA;    "text" : "Bell Tank",&#xA;    "suggestion": {&#xA;      "phrase": {&#xA;        "field": "name",&#xA;        "size": 3&#xA;      }&#xA;    }&#xA;  }&#xA;}'&#xA;</code></pre>&#xA;&#xA;<p>And the 3 suggestions I receive are:</p>&#xA;&#xA;<pre><code>"suggest" : {&#xA;  "suggestion" : [ {&#xA;    "text" : "Bell Tank",&#xA;    "offset" : 0,&#xA;    "length" : 9,&#xA;    "options" : [ {&#xA;      "text" : "ball tank",&#xA;      "score" : 0.03721739&#xA;    }, {&#xA;      "text" : "bella tank",&#xA;      "score" : 0.03721739&#xA;    }, {&#xA;      "text" : "bess tank",&#xA;      "score" : 0.034840018&#xA;    } ]&#xA;  } ]&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>As you can see, <code>ball tank</code> and <code>bella tank</code> suggestions have the same score, even though only <code>bella tank</code> exists in my index. It doesn't seem to care about co-occurence of tokens at all.</p>&#xA;&#xA;<p>Is my only choice here to create a non-analyzed version of <code>name</code> using <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/_multi_fields.html" rel="nofollow">multifields</a> or am I doing this all wrong?</p>&#xA;
<p>You need to use an <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-shingle-tokenfilter.html" rel="nofollow">shingle filter</a> on the field you are suggesting against. Multifields are great for this because you may not want to <em>search</em> with the shingles. You can use up to 3 for the <code>max_shingle_size</code>.</p>&#xA;&#xA;<p>Its certainly a <a href="https://github.com/elastic/elasticsearch/issues/13283" rel="nofollow">bug</a> that the docs don't mention this very prominently.</p>&#xA;&#xA;<p>Look at how <a href="https://en.wikipedia.org/w/api.php?action=cirrus-settings-dump&amp;format=json&amp;formatversion=2" rel="nofollow">wikipedia</a> sets up its suggest analyzer. Its not perfect but its a good start.</p>&#xA;