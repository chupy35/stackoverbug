34618903
How to combine term filters with a missing filter in Elasticsearch?
<p>We are using Elasticsearch 1.6 and I have a working three term query that I need to modify with a stand alone working missing filter.  Here is the current code:</p>&#xA;&#xA;<p>The original term query with three entries</p>&#xA;&#xA;<pre><code>GET ...&#xA;{&#xA;  "query": {&#xA;    "nested": {&#xA;      "path": "MAIN_FIELD",&#xA;      "query": {&#xA;        "bool": {&#xA;          "must": [&#xA;            {&#xA;              "term": {&#xA;                "MAIN_FIELD.ID": 1234&#xA;              }&#xA;            },&#xA;            {&#xA;              "term": {&#xA;                "MAIN_FIELD.OTHER_IND": "false"&#xA;              }&#xA;            },&#xA;            {&#xA;              "term": {&#xA;                "MAIN_FIELD.INDICATOR": "Y"&#xA;              }&#xA;            }&#xA;          ]&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;</code></pre>&#xA;&#xA;<p>}</p>&#xA;&#xA;<p>The stand alone missing query:</p>&#xA;&#xA;<pre><code>GET ...&#xA;{&#xA;    "query" : {&#xA;        "filtered" : {&#xA;            "filter" : {&#xA;                "missing" : { "field" : "MAIN_FIELD.OTHER_IND" }&#xA;            }&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>How do I change the term query from the first query:</p>&#xA;&#xA;<pre><code>"term": {&#xA;           "MAIN_FIELD.OTHER_IND": "false"&#xA;        }  &#xA;</code></pre>&#xA;&#xA;<p>to use a missing filter?</p>&#xA;
<p>I think what you want is below:</p>&#xA;&#xA;<pre><code>{&#xA;   "query": {&#xA;      "nested": {&#xA;         "path": "MAIN_FIELD",&#xA;         "query": {&#xA;            "bool": {&#xA;               "must": [&#xA;                  {&#xA;                     "term": {&#xA;                        "MAIN_FIELD.ID": 1234&#xA;                     }&#xA;                  },&#xA;                  {&#xA;                     "filtered": {&#xA;                        "filter": {&#xA;                            "missing": {&#xA;                               "field": "MAIN_FIELD.OTHER_IND"&#xA;                            }&#xA;                        }&#xA;                     }&#xA;                  },&#xA;                  {&#xA;                     "term": {&#xA;                        "MAIN_FIELD.INDICATOR": "Y"&#xA;                     }&#xA;                  }&#xA;               ]&#xA;            }&#xA;         }&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;