30389495
How to implement case sensitive search in elasticsearch?
<p>I have a field in my indexed documents where i need to search with case being sensitive. I am using the match query to fetch the results. &#xA;An example of my data document is :</p>&#xA;&#xA;<pre><code>{&#xA;"name" : "binoy",&#xA;"age" : 26,&#xA;"country": "India"&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Now when I give the following query:</p>&#xA;&#xA;<pre><code>{&#xA;“query” : {&#xA;“match” : {&#xA;“name” : “Binoy"&#xA;}&#xA;}&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>It gives me a match for "binoy" against "Binoy". I want the search to be case sensitive. It seems by default,elasticsearch seems to go with case being insensitive. How to make the search case sensitive in elasticsearch?</p>&#xA;
<p>Have your mapping like:</p>&#xA;&#xA;<pre><code>PUT /whatever&#xA;{&#xA;  "settings": {&#xA;    "analysis": {&#xA;      "analyzer": {&#xA;        "mine": {&#xA;          "type": "custom",&#xA;          "tokenizer": "standard"&#xA;        }&#xA;      }&#xA;    }&#xA;  },&#xA;  "mappings": {&#xA;    "type": {&#xA;      "properties": {&#xA;        "name": {&#xA;          "type": "string",&#xA;          "analyzer": "mine"&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>meaning, no <code>lowercase</code> filter for that custom analyzer.</p>&#xA;
<p>It depends on the mapping you have defined for you field <code>name</code>. If you haven't defined any mapping then elasticsearch will treat it as string and use the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/1.3/analysis-standard-analyzer.html" rel="nofollow">standard analyzer</a> (which lower-cases the tokens) to generate tokens. Your query will also use the same analyzer for search hence matching is done by lower-casing the input. That's why "Binoy" matches "binoy"</p>&#xA;&#xA;<p>To solve it you can define a custom analyzer without <code>lowercase</code> filter and use it for your field <code>name</code>. You can define the analyzer as below</p>&#xA;&#xA;<pre><code>"analyzer": {&#xA;                "casesensitive_text": {&#xA;                    "type":         "custom",&#xA;                    "tokenizer":    "standard",&#xA;                    "filter": ["stop", "porter_stem" ]&#xA;                }&#xA;            }&#xA;</code></pre>&#xA;&#xA;<p>You can define the mapping for <code>name</code> as below</p>&#xA;&#xA;<pre><code>"name": {&#xA;    "type": "string", &#xA;    "analyzer": "casesensitive_text"&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Now you can do the the search on <code>name</code>.</p>&#xA;&#xA;<p><strong>note:</strong> the analyzer above is for example purpose. You may need to change it as per your needs</p>&#xA;
<p>In the mapping you can define the field as not_analyzed.</p>&#xA;&#xA;<pre><code>curl -X PUT "http://localhost:9200/sample" -d '{&#xA;  "index": {&#xA;    "number_of_shards": 1,&#xA;    "number_of_replicas": 1&#xA;  }&#xA;}'&#xA;&#xA;echo&#xA;curl -X PUT "http://localhost:9200/sample/data/_mapping" -d '{&#xA;  "data": {&#xA;    "properties": {&#xA;      "name": {&#xA;        "type": "string",&#xA;        "index": "not_analyzed"&#xA;      }&#xA;    }&#xA;  }&#xA;}'&#xA;</code></pre>&#xA;&#xA;<p>Now if you can do normal index and do normal search , it wont analyze it and make sure it deliver case insensitive search.</p>&#xA;
<p>Here is the full <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-templates.html" rel="nofollow noreferrer">index template</a> which worked for my ElasticSearch 5.6:</p>&#xA;&#xA;<pre><code>{&#xA;  "template": "logstash-*",&#xA;  "settings": {&#xA;     "analysis" : {&#xA;         "analyzer" : {&#xA;             "case_sensitive" : {&#xA;                 "type" : "custom",&#xA;                 "tokenizer":    "standard",&#xA;                 "filter": ["stop", "porter_stem" ]                    &#xA;             }&#xA;         }&#xA;     },        &#xA;     "number_of_shards": 5,&#xA;     "number_of_replicas": 1      &#xA;  },      &#xA;  "mappings": {&#xA;   "fluentd": {&#xA;     "properties": {&#xA;       "message": {&#xA;         "type": "text",&#xA;         "fields": {&#xA;           "case_sensitive": { &#xA;             "type": "text",&#xA;             "analyzer": "case_sensitive"&#xA;           }&#xA;         }          &#xA;       }&#xA;     }&#xA;   }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>As you see, the logs are coming from FluentD and are saved into a timebased index <code>logstash-*</code>. To make sure, I can still execute wildcard queries on the <code>message</code> filed, I put a <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/multi-fields.html" rel="nofollow noreferrer">multi-field mapping</a> on that field. Wildcard/analyzed queries can be done on <code>message</code> field and the case sensitive one on the <code>message.case_sensitive</code> field.  </p>&#xA;