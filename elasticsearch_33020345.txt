33020345
ElasticSearch index template versioning
<p>My application creates an index template on ElasticSearch. Later on, the application is updated and needs to update the index template to support new fields.</p>&#xA;&#xA;<ol>&#xA;<li><p>Is there a way to set a some identifier for the index template&#xA;(except its name which is always the same), such that my app can&#xA;compare these values between the app version and the deployed&#xA;version? (unique ID / ETag / anything else)</p></li>&#xA;<li><p>Alternatively, if I can't detect a difference: What is the cost of&#xA;modifying the index template multiple times, mostly modifications&#xA;that perform no actual change?</p></li>&#xA;<li><p>Can I find for an index which template it uses (and which version of it,&#xA;if such ability exists)?</p></li>&#xA;</ol>&#xA;&#xA;<p>Thanks.</p>&#xA;
<p>I've solved for this before by using version numbers, build IDs or time stamps as part of the index name (and using <em>index aliases</em> to point to the relevant index for each application).</p>&#xA;&#xA;<p>See this post for a more detailed example:  <a href="https://www.elastic.co/blog/changing-mapping-with-zero-downtime" rel="nofollow">https://www.elastic.co/blog/changing-mapping-with-zero-downtime</a></p>&#xA;
<p>When creating an index template, you can use the mapping metadata to store the extra info needed to know from which version of the application the mapping was created.</p>&#xA;&#xA;<pre><code>PUT _template/my_template&#xA;{&#xA;  "template" : "logstash-*",&#xA;  "mappings" : {&#xA;      "logs" : {&#xA;        "_meta" : {&#xA;          "product" : "my_product",&#xA;          "version" : "1.0.1"&#xA;        },&#xA;        "_source" : {"enabled" : "true"},&#xA;        "properties" : {&#xA;        }&#xA;      }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Then query for existing indices to find the index last created and then get its mappings.</p>&#xA;&#xA;<pre><code>GET logstash-2015.10.08/_mapping&#xA;</code></pre>&#xA;&#xA;<p>You'll find the mappings and the metadata inside.</p>&#xA;&#xA;<p>This can be useful to store the version of the product the mapping correlates to.</p>&#xA;