34090080
how to change type of a value in elasticsearch
<p>I am trying to do geomap of a value in Elasticsearch but the value type of the <code>client_location</code> is set as a string and I would like to change it to <code>geo_point</code>. When I run the following I am getting:</p>&#xA;&#xA;<pre><code>#curl -XGET "http://core.z0z0.tk:9200/_all/_mappings/http?pretty"&#xA;{&#xA;  "packetbeat-2015.12.04" : {&#xA;    "mappings" : {&#xA;      "http" : {&#xA;        "properties" : {&#xA;          "@timestamp" : {&#xA;            "type" : "date",&#xA;            "format" : "strict_date_optional_time||epoch_millis"&#xA;          },&#xA;          "beat" : {&#xA;            "properties" : {&#xA;              "hostname" : {&#xA;                "type" : "string"&#xA;              },&#xA;              "name" : {&#xA;                "type" : "string"&#xA;              }&#xA;            }&#xA;          },&#xA;          "bytes_in" : {&#xA;            "type" : "long"&#xA;          },&#xA;          "bytes_out" : {&#xA;            "type" : "long"&#xA;          },&#xA;          "client_ip" : {&#xA;            "type" : "string"&#xA;          },&#xA;          "client_location" : {&#xA;            "type" : "string"&#xA;          },&#xA;          "client_port" : {&#xA;            "type" : "long"&#xA;          },&#xA;          "client_proc" : {&#xA;            "type" : "string"&#xA;          },&#xA;          "client_server" : {&#xA;            "type" : "string"&#xA;          },&#xA;          "count" : {&#xA;            "type" : "long"&#xA;          },&#xA;          "direction" : {&#xA;            "type" : "string"&#xA;          },&#xA;          "http" : {&#xA;            "properties" : {&#xA;              "code" : {&#xA;                "type" : "long"&#xA;              },&#xA;              "content_length" : {&#xA;                "type" : "long"&#xA;              },&#xA;              "phrase" : {&#xA;                "type" : "string"&#xA;              }&#xA;            }&#xA;          },&#xA;          "ip" : {&#xA;            "type" : "string"&#xA;          },&#xA;          "method" : {&#xA;            "type" : "string"&#xA;          },&#xA;          "notes" : {&#xA;            "type" : "string"&#xA;          },&#xA;          "params" : {&#xA;            "type" : "string"&#xA;          },&#xA;          "path" : {&#xA;            "type" : "string"&#xA;          },&#xA;          "port" : {&#xA;            "type" : "long"&#xA;          },&#xA;          "proc" : {&#xA;            "type" : "string"&#xA;          },&#xA;          "query" : {&#xA;            "type" : "string"&#xA;          },&#xA;          "responsetime" : {&#xA;            "type" : "long"&#xA;          },&#xA;          "server" : {&#xA;            "type" : "string"&#xA;          },&#xA;          "status" : {&#xA;            "type" : "string"&#xA;          },&#xA;              "type" : {&#xA;            "type" : "string"&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>When I run the following command to change the type of the value from string to <code>geo_point</code> I am getting the following error:</p>&#xA;&#xA;<pre><code># curl -XPUT "http://localhost:9200/_all/_mappings/http" -d '&#xA;&gt; {&#xA;&gt; "http" : {&#xA;&gt;         "properties" : {&#xA;&gt;           "client_location" : {&#xA;&gt;             "type" : "geo_point"&#xA;&gt;           }&#xA;&gt;         }&#xA;&gt;   }&#xA;&gt; }&#xA;&gt; '&#xA;{"error":{"root_cause":[{"type":"merge_mapping_exception","reason":"Merge failed with failures {[mapper [client_location] of different type, current_type [string], merged_type[geo_point]]}"}],"type":"merge_mapping_exception","reason":"Merge failed with failures {[mapper [client_location] of different type, current_type [string], merged_type [geo_point]]}"},"status":400}&#xA;</code></pre>&#xA;&#xA;<p>Any suggestion how should I correctly change the type?</p>&#xA;&#xA;<p>Thanks in advance.</p>&#xA;
<p>Unfortunately, once you've created a field you cannot change its type anymore. The best thing to do is to delete the index and recreate it properly with the adequate mapping.</p>&#xA;&#xA;<p>Another temporary solution if you don't want to delete your index immediately, is to create a sub-field of your existing field:</p>&#xA;&#xA;<pre><code># curl -XPUT "http://localhost:9200/_all/_mappings/http" -d '{&#xA;  "http": {&#xA;    "properties": {&#xA;      "client_location": {&#xA;        "type": "string",&#xA;        "fields": {&#xA;          "geo": {&#xA;            "type": "geo_point"&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}'&#xA;</code></pre>&#xA;&#xA;<p>And then you can access it in your queries using <code>client_location.geo</code>.&#xA;Also note that you have to re-index your data in order to populate that new sub-field... which means you might just as well delete your index and re-create it properly.</p>&#xA;&#xA;<p><strong>UPDATE</strong></p>&#xA;&#xA;<p>After installing Packetbeat you need to make sure to install the packetbeat template yourself as described here (i.e. it is not done automatically):&#xA;<a href="https://www.elastic.co/guide/en/beats/packetbeat/current/packetbeat-getting-started.html#packetbeat-template" rel="nofollow">https://www.elastic.co/guide/en/beats/packetbeat/current/packetbeat-getting-started.html#packetbeat-template</a></p>&#xA;&#xA;<pre><code>curl -XPUT 'http://localhost:9200/_template/packetbeat' -d@/etc/packetbeat/packetbeat.template.json&#xA;</code></pre>&#xA;