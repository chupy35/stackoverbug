30457663
May I search among some fields, but use another field's matching score for sorting?
<p>I have some documents like this</p>&#xA;&#xA;<pre><code>{"id":1,"city":"London","content":"soccer","continent":"Europe"},&#xA;{"id":2,"city":"New York","content":"basketball","continent":"North America"},&#xA;{"id":3,"city":"Tokyo","content":"baseball","continent":"Asia"},&#xA;...&#xA;</code></pre>&#xA;&#xA;<p>I need to search keywords among some fields(excluding <code>city</code> field), e.g. a query like</p>&#xA;&#xA;<pre><code>{&#xA;  "query": {&#xA;    "bool": {&#xA;      "should": [ //SHOULD_CLAUSE&#xA;        "match": {&#xA;          "continent": "America"&#xA;        },&#xA;        "term": {&#xA;          "content": "soccer"&#xA;        }&#xA;      ]&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>To make the results more "personalized", I want to make matched documents whose <code>city</code> field is the same as the visiting user's <code>city</code> property. &#xA;However, if I make <code>city</code> as a query field(something like <code>"match":{"city":"Tokyo"}</code>) in <code>should</code> boolean clause, it may return some documents that only match the <code>city</code> field, which mismatch the fields I need to search. When using <code>boost</code> to make <code>city</code> field more "important" for sorting things goes worse.&#xA;How can I achieve my goal?</p>&#xA;&#xA;<p>It seems that a possible way write the <code>SHOULD_CLAUSE</code> part twice and make one of it combined with <code>city</code> clause using <code>and</code></p>&#xA;&#xA;<pre><code>{&#xA;  "query": {&#xA;    "bool": {&#xA;      "should": [{&#xA;        "bool": {&#xA;          "must": [{&#xA;            "bool": {&#xA;              SHOULD_CLAUSE&#xA;            }&#xA;          }, {&#xA;            "match": {&#xA;              "city": {&#xA;                "query": "Tokyo",&#xA;                "boost": 4.0&#xA;              }&#xA;            }&#xA;          }]&#xA;        }&#xA;      }, {&#xA;        "bool": {&#xA;          SHOULD_CLAUSE&#xA;        }&#xA;      }]&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>But under the real circumstance the <code>SHOULD_CLAUSE</code> part may be more complicated and the whole query seems too long to write. I wonder if there is a better way.</p>&#xA;
<p>If you want to have only result matching your user city, you should wrap your should query into a must query, something like :</p>&#xA;&#xA;<pre><code>{&#xA;  "query": {&#xA;    "bool": {&#xA;      "must": [{&#xA;        "bool": {&#xA;          "should": [{&#xA;            SHOULD_CLAUSE_1&#xA;          }, {&#xA;            SHOULD_CLAUSE_2&#xA;          }]&#xA;        }&#xA;      }, {&#xA;        "match": {&#xA;          "city": "Tokyo"&#xA;        }&#xA;      }]&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;