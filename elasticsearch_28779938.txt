28779938
Filter ElasticSearch result whose array contains at least 1 tag
<p>I query against elasticsearch with following DSL.</p>&#xA;&#xA;<pre><code>{&#xA;   "query": {&#xA;      "filtered": {&#xA;         "query": {&#xA;            "multi_match": {&#xA;               "query": "Next",&#xA;               "type": "phrase_prefix",&#xA;               "fields": [&#xA;                  "defaultContent"&#xA;               ]&#xA;            }&#xA;         },&#xA;         "filter": {&#xA;            "bool": {&#xA;               "must_not": {&#xA;                  "term": {&#xA;                     "_deleted": true&#xA;                  }&#xA;               },&#xA;               "should": [&#xA;                  {&#xA;                     "term": {&#xA;                        "site": "xxx"&#xA;                     }&#xA;                  },&#xA;                  {&#xA;                     "term": {&#xA;                        "site": "base"&#xA;                     }&#xA;                  }&#xA;               ]&#xA;            }&#xA;         }&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>And it works and return 1 match.</p>&#xA;&#xA;<pre><code>{&#xA;   "took": 42,&#xA;   "timed_out": false,&#xA;   "_shards": {&#xA;      "total": 5,&#xA;      "successful": 5,&#xA;      "failed": 0&#xA;   },&#xA;   "hits": {&#xA;      "total": 1,&#xA;      "max_score": 2.733073,&#xA;      "hits": [&#xA;         {&#xA;            "_index": "cms",&#xA;            "_type": "content",&#xA;            "_id": "base&gt;3453fm9lxkmyy_17",&#xA;            "_score": 2.733073,&#xA;            "_source": {&#xA;               "tags": [&#xA;                  "tag1",&#xA;                  "tag2"&#xA;               ],&#xA;               "site": "base",&#xA;               "_rev": "1-3b6eb2b3c3d5554bb3ef3f16a299160c",&#xA;               "defaultContent": "Next action to be settled",&#xA;               "_id": "base&gt;3453fm9lxkmyy_17",&#xA;               "type": "content",&#xA;               "key": "3453fm9lxkmyy_17"&#xA;            }&#xA;         }&#xA;      ]&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Now I want to modify the DSL, and add a new condition -- Only returns those whose tags contains <code>tag1</code> or <code>tag8</code></p>&#xA;&#xA;<pre><code>{&#xA;   "query": {&#xA;      "filtered": {&#xA;         "query": {&#xA;            "multi_match": {&#xA;               "query": "Next",&#xA;               "type": "phrase_prefix",&#xA;               "fields": [&#xA;                  "defaultContent"&#xA;               ]&#xA;            }&#xA;         },&#xA;         "filter": {&#xA;            "bool": {&#xA;               "must": {&#xA;                   "term" : {&#xA;                       "tags" : ["tag1", "tag8"],&#xA;                       "minimum_should_match" : 1&#xA;                   }&#xA;               },&#xA;               "must_not": {&#xA;                  "term": {&#xA;                     "_deleted": true&#xA;                  }&#xA;               },&#xA;               "should": [&#xA;                  {&#xA;                     "term": {&#xA;                        "site": "xxx"&#xA;                     }&#xA;                  },&#xA;                  {&#xA;                     "term": {&#xA;                        "site": "base"&#xA;                     }&#xA;                  }&#xA;               ]&#xA;            }&#xA;         }&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>And then, I get nothing.</p>&#xA;&#xA;<pre><code>{&#xA;   "took": 23,&#xA;   "timed_out": false,&#xA;   "_shards": {&#xA;      "total": 5,&#xA;      "successful": 5,&#xA;      "failed": 0&#xA;   },&#xA;   "hits": {&#xA;      "total": 0,&#xA;      "max_score": null,&#xA;      "hits": []&#xA;   }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>Am I doing something wrong? It should return 1 match because it contains <code>tag1</code></p>&#xA;
<p>The "term" filter is used when you want to match on a single term. Kind of like SQL <code>column1 = 'foo'</code></p>&#xA;&#xA;<p>You want to use the "terms" filter which is the equivalent of SQL <code>column1 IN ('foo', 'bar')</code></p>&#xA;