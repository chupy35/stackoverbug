32757299
ElasticSearch - Search for complete phrase only
<p>I am trying to create a search that will return me exactly what i requested.</p>&#xA;&#xA;<p>For instance let's say i have 2 documents with a field named 'Val'</p>&#xA;&#xA;<p>First doc have a value of 'a - Copy', second document is 'a - Copy (2)'</p>&#xA;&#xA;<p><strong>My goal</strong> is to search exactly the value 'a - Copy' and find only the <strong>first</strong> document in my returned results and not both of them with different similarity rankings</p>&#xA;&#xA;<p>When i try most of the usual queries like:</p>&#xA;&#xA;<pre><code>GET test/_search&#xA;{&#xA;  "query": {&#xA;    "match": { &#xA;      "Val": {&#xA;          "query": "a - copy",&#xA;          "type":  "phrase"&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>or: </p>&#xA;&#xA;<pre><code>GET /test/doc/_search&#xA;{&#xA;  "query": {&#xA;    "query_string": {&#xA;      "default_field": "Val",&#xA;      "query": "a - copy"&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>I get both documents all the time</p>&#xA;
<p>Yes, you are getting that because your field is, most likely, <code>analyzed</code> and split into tokens.</p>&#xA;&#xA;<p>You need an analyzer similar to this one</p>&#xA;&#xA;<pre><code>    "custom_keyword_analyzer": {&#xA;      "type": "custom",&#xA;      "tokenizer": "keyword",&#xA;      "filter": "lowercase"&#xA;    }&#xA;</code></pre>&#xA;&#xA;<p>which uses the <code>keyword</code> tokenizer and the <code>lowercase</code> filter (I noticed you indexed upper case letters, but expect to search with lowercase letters).</p>&#xA;&#xA;<p>And then use a <code>term</code> filter to search your documents.</p>&#xA;
<p>There is a very good documentation for finding exact values in ES: &#xA;<a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/_finding_exact_values.html" rel="nofollow">https://www.elastic.co/guide/en/elasticsearch/guide/current/_finding_exact_values.html</a></p>&#xA;&#xA;<p>It shows you how to use the <code>term</code> filter and it mentions problems with <code>analyzed fields</code>, too.</p>&#xA;&#xA;<p>To put it in a nutshell you need to run a <code>term</code> filter like this (I've put your values in):</p>&#xA;&#xA;<pre><code>GET /test/doc/_search&#xA;{&#xA;    "query" : {&#xA;        "filtered" : { &#xA;            "query" : {&#xA;                "match_all" : {} &#xA;            },&#xA;            "filter" : {&#xA;                "term" : { &#xA;                    "Val" : "a - copy"&#xA;                }&#xA;            }&#xA;        }&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>However, this doesn't work with analyzed fields. You won't get any results.</p>&#xA;&#xA;<blockquote>&#xA;  <p>To prevent this from happening, we need to tell Elasticsearch that&#xA;  this field contains an exact value by setting it to be not_analyzed.</p>&#xA;</blockquote>&#xA;&#xA;<p>There are multiple ways to achieve that. e.g. <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/mapping-intro.html#custom-field-mappings" rel="nofollow">custom field mappings</a>. </p>&#xA;