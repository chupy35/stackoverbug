29116848
Getting exception in indexing data using node client
<p>I have used transport client before which works fine. I want to use node client now. I tried the following:</p>&#xA;&#xA;<pre><code>package es.code;&#xA;&#xA;import org.apache.log4j.Logger;&#xA;import org.elasticsearch.action.get.GetResponse;&#xA;import org.elasticsearch.action.index.IndexResponse;&#xA;import org.elasticsearch.client.Client;&#xA;import org.elasticsearch.node.Node;&#xA;&#xA;import static org.elasticsearch.node.NodeBuilder.*;&#xA;&#xA;import java.io.IOException;&#xA;&#xA;public class elasticsearch {&#xA;&#xA;    private elasticsearch() {&#xA;    }&#xA;&#xA;    public static void main(String[] args) throws IOException {&#xA;        System.out.println("Hello, World");&#xA;        Client client = null;&#xA;&#xA;        Node node = nodeBuilder().clusterName("sample_test").client(true).node();&#xA;        client = node.client();&#xA;        String json = "{" +&#xA;                "\"user\":\"prachi\"," +&#xA;                "\"postDate\":\"2013-01-30\"," +&#xA;                "\"message\":\"trying out Elasticsearch\"" +&#xA;                "}";&#xA;&#xA;        IndexResponse response = client.prepareIndex("estest", "testing")&#xA;                .setSource(json)&#xA;                .execute()&#xA;                .actionGet();&#xA;&#xA;        System.out.println(response.getId());    &#xA;        node.close();  &#xA;    }&#xA;&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>I am getting the following exception:</p>&#xA;&#xA;<pre><code>Exception in thread "main" org.elasticsearch.discovery.MasterNotDiscoveredException: waited for [1m]&#xA;    at org.elasticsearch.action.support.master.TransportMasterNodeOperationAction$4.onTimeout(TransportMasterNodeOperationAction.java:164)&#xA;    at org.elasticsearch.cluster.ClusterStateObserver$ObserverClusterStateListener.onTimeout(ClusterStateObserver.java:239)&#xA;    at org.elasticsearch.cluster.service.InternalClusterService$NotifyTimeout.run(InternalClusterService.java:520)&#xA;    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)&#xA;    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)&#xA;    at java.lang.Thread.run(Thread.java:744)&#xA;</code></pre>&#xA;&#xA;<p><strong>What is it which I am doing wrong? If I remove <code>client(true)</code>, the program runs successfully. But I don't see data in ES index.</strong> </p>&#xA;&#xA;<p>What is the correct way to do it?</p>&#xA;
<p>I just played with your code and it works perfectly fine.For this code to work you must have your master node running on your cluster (with name sample_test). When you have client(true) ES will create a <strong>Transport Client</strong> instance which will remotely connect to the running cluster (not joining the cluster). </p>&#xA;&#xA;<p>From node client documentation when client true </p>&#xA;&#xA;<blockquote>&#xA;  <p>Is the node going to be a client node which means it will hold no data&#xA;  (node.data is set to false) and other optimizations by different&#xA;  modules.</p>&#xA;</blockquote>&#xA;&#xA;<pre><code>//Master node should be running. Works as a client. &#xA;nodeBuilder().clusterName("sample_test").client(true).node() &#xA;&#xA;//Spin up individual node instance. &#xA;nodeBuilder().clusterName("sample_test").node() &#xA;</code></pre>&#xA;&#xA;<p>If you further need to configure data store for your node client following code might help you. </p>&#xA;&#xA;<pre><code>Settings settings = ImmutableSettings.settingsBuilder().put("path.data", "D:\\ESDATA\\").build();&#xA;nodeBuilder().settings(settings);&#xA;Node node = nodeBuilder().clusterName("sample_test").data(true).settings(settings).node();&#xA;</code></pre>&#xA;