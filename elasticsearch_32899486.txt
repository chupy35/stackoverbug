32899486
elasticsearch filters aggregation won't work
<p>Like <a href="https://stackoverflow.com/questions/32489706/need-explanation-on-elasticsearch-filters-aggregation">this</a> post, I can't get filters agg to work:</p>&#xA;&#xA;<pre><code>GET files/_search&#xA;{&#xA;  "query": {&#xA;    "match": {&#xA;      "words": "sugar"&#xA;    }&#xA;  },&#xA;  "aggs": {&#xA;    "xxx": {&#xA;      "filters": {&#xA;        "filter_list": {&#xA;          "errors": {&#xA;            "term": {&#xA;              "abstract": "error"&#xA;            }&#xA;          },&#xA;          "warnings": {&#xA;            "term": {&#xA;              "abstract": "warning"&#xA;            }&#xA;          }&#xA;        }&#xA;      },&#xA;      "aggs": {&#xA;        "st": {&#xA;          "significant_terms": {&#xA;            "field": "abstract"&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<blockquote>&#xA;  <p>SearchParseException[[files][3]: query[words:sugar],from[-1],size[-1]:&#xA;  Parse Failure [Unknown key for a START_OBJECT in [xxx]:&#xA;  [filter_list].]]; }{[tIS8uY8nTDil6kWtgsbkQg][files][4]:&#xA;  SearchParseException[[files][4]: query[words:sugar],from[-1],size[-1]:&#xA;  Parse Failure [Failed to parse source [{\n  \"query\": {\n<br>&#xA;  \"match\": {\n      \"words\": \"sugar\"\n    }\n  },\n  \"aggs\": {\n&#xA;  \"xxx\": {\n      \"filters\": {\n        \"filter_list\": {\n<br>&#xA;  \"errors\": {\n            \"term\": {\n              \"abstract\":&#xA;  \"error\"\n            }\n          },\n          \"warnings\": {\n<br>&#xA;  \"term\": {\n              \"abstract\": \"warning\"\n            }\n &#xA;  }\n        }\n      },\n      \"aggs\": {\n        \"st\": {\n<br>&#xA;  \"significant_terms\": {\n            \"field\": \"abstract\"\n<br>&#xA;  }\n        }\n      }\n    }\n  }\n}\n]]]; nested:&#xA;  SearchParseException[[epars][4]: query[words:sugar],from[-1],size[-1]:&#xA;  Parse Failure [Unknown key for a START_OBJECT in [xxx]:&#xA;  [filter_list].]]; }]",    "status": 400 }</p>&#xA;</blockquote>&#xA;
<p>You have only one thing wrong, i.e. <code>filter_list</code> should read <code>filters</code>, as it is a mandatory element of the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-filters-aggregation.html" rel="nofollow"><code>filters</code> aggregation</a>.</p>&#xA;&#xA;<pre><code>GET files/_search&#xA;{&#xA;  "query": {&#xA;    "match": {&#xA;      "words": "sugar"&#xA;    }&#xA;  },&#xA;  "aggs": {&#xA;    "xxx": {&#xA;      "filters": {&#xA;        "filters": {           &lt;---- change this&#xA;          "errors": {&#xA;            "term": {&#xA;              "abstract": "error"&#xA;            }&#xA;          },&#xA;          "warnings": {&#xA;            "term": {&#xA;              "abstract": "warning"&#xA;            }&#xA;          }&#xA;        }&#xA;      },&#xA;      "aggs": {&#xA;        "st": {&#xA;          "significant_terms": {&#xA;            "field": "abstract"&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;