30781207
ElasticSearch - doc_value in murmur3 hash
<p>Continuing a <a href="https://stackoverflow.com/questions/30766792/elasticsearch-kibana-unique-count-using-pre-computed-hashes?noredirect=1#comment49604500_30766792">previous question.</a></p>&#xA;&#xA;<h2>What am I trying to do?</h2>&#xA;&#xA;<p>Thanks to @AndreiStefan I'm trying to put a <code>murmur3</code> hash off the heap, using <code>doc_values</code>:</p>&#xA;&#xA;<pre><code>"dynamic_templates": [&#xA;{&#xA;  "murmur3_hashed": {&#xA;    "mapping": {&#xA;      "index": "not_analyzed",&#xA;      "norms": {&#xA;        "enabled": false&#xA;      },&#xA;      "fielddata": {&#xA;        "format": "doc_values"&#xA;      },&#xA;      "doc_values": true,&#xA;      "type": "string",&#xA;      "fields": {&#xA;        "hash": {&#xA;          "index": "no",&#xA;          "doc_values": true,&#xA;          "type": "murmur3"&#xA;        }&#xA;      }&#xA;    },&#xA;    "match_mapping_type": "string",&#xA;    "match": "my_prop"&#xA;  }&#xA;}&#xA;]&#xA;</code></pre>&#xA;&#xA;<p>I used stream2es for reindexing.</p>&#xA;&#xA;<h2>What is the result?</h2>&#xA;&#xA;<p>After a reindexing, the result property is:</p>&#xA;&#xA;<pre><code>  "my_prop": {&#xA;    "index": "not_analyzed",&#xA;    "fielddata": {&#xA;      "format": "doc_values"&#xA;    },&#xA;    "doc_values": true,&#xA;    "type": "string",&#xA;    "fields": {&#xA;      "hash": {&#xA;        "null_value": -1,&#xA;        "precision_step": 2147483647,&#xA;        "type": "murmur3"&#xA;      }&#xA;    }&#xA;  },&#xA;</code></pre>&#xA;&#xA;<h2>What is the problem?</h2>&#xA;&#xA;<p>Why is the <code>"index": "no", "doc_values": true</code> missing in the result property?</p>&#xA;
<p>This is the list of commands that I tested in ES 1.6.0:</p>&#xA;&#xA;<pre><code>PUT /test&#xA;{&#xA;  "mappings": {&#xA;    "_default_": {&#xA;      "dynamic_templates": [&#xA;        {&#xA;          "murmur3_hashed": {&#xA;            "mapping": {&#xA;              "index": "not_analyzed",&#xA;              "norms": {&#xA;                "enabled": false&#xA;              },&#xA;              "fielddata": {&#xA;                "format": "doc_values"&#xA;              },&#xA;              "doc_values": true,&#xA;              "type": "string",&#xA;              "fields": {&#xA;                "hash": {&#xA;                  "index": "no",&#xA;                  "doc_values": true,&#xA;                  "type": "murmur3"&#xA;                }&#xA;              }&#xA;            },&#xA;            "match_mapping_type": "string",&#xA;            "match": "my_prop"&#xA;          }&#xA;        }&#xA;      ]&#xA;    }&#xA;  }&#xA;}&#xA;&#xA;POST /test/test_type/1&#xA;{&#xA;  "my_prop": "xxx"&#xA;}&#xA;&#xA;GET /test/test_type/_mapping&#xA;</code></pre>&#xA;&#xA;<hr>&#xA;&#xA;<p>And I got this as output:</p>&#xA;&#xA;<pre><code>{&#xA;   "test": {&#xA;      "mappings": {&#xA;         "test_type": {&#xA;            "dynamic_templates": [&#xA;               {&#xA;                  "murmur3_hashed": {&#xA;                     "mapping": {&#xA;                        "fielddata": {&#xA;                           "format": "doc_values"&#xA;                        },&#xA;                        "norms": {&#xA;                           "enabled": false&#xA;                        },&#xA;                        "index": "not_analyzed",&#xA;                        "type": "string",&#xA;                        "fields": {&#xA;                           "hash": {&#xA;                              "index": "no",&#xA;                              "type": "murmur3",&#xA;                              "doc_values": true&#xA;                           }&#xA;                        },&#xA;                        "doc_values": true&#xA;                     },&#xA;                     "match": "my_prop",&#xA;                     "match_mapping_type": "string"&#xA;                  }&#xA;               }&#xA;            ],&#xA;            "properties": {&#xA;               "my_prop": {&#xA;                  "type": "string",&#xA;                  "index": "not_analyzed",&#xA;                  "doc_values": true,&#xA;                  "fielddata": {&#xA;                     "format": "doc_values"&#xA;                  },&#xA;                  "fields": {&#xA;                     "hash": {&#xA;                        "type": "murmur3",&#xA;                        "index": "no",&#xA;                        "doc_values": true,&#xA;                        "precision_step": 2147483647,&#xA;                        "null_value": -1&#xA;                     }&#xA;                  }&#xA;               }&#xA;            }&#xA;         }&#xA;      }&#xA;   }&#xA;}&#xA;</code></pre>&#xA;