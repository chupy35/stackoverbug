31674555
Is it possible to sort elasticsearch query by whether or not the field meets the condition?
<p>I've got elasticsearch document with mapping like this.</p>&#xA;&#xA;<pre><code>{&#xA;    "date_added": {&#xA;        "type": "date",&#xA;        "format": "dateOptionalTime"&#xA;    }&#xA;    "expires": {&#xA;        "type": "date",&#xA;        "format": "dateOptionalTime"&#xA;    }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>What I want to do is query with double sort:</p>&#xA;&#xA;<p>1) newest to oldest (that's an easy sort, no problem here)</p>&#xA;&#xA;<p>2) show documents yet to expire on top (so documents where "expires" is greater than now)</p>&#xA;&#xA;<p>In my response I want to get documents sorted in somewhat two parts - yet to expire newest to oldest, expired newest to oldest.</p>&#xA;&#xA;<p>I struggle to create sort that would achieve the second part. Can I sort by result of range filter? Maybe I can create some property-like boolean field that will change depending on "expires" field and later use it for sort?</p>&#xA;
<p>This looks like an excellent use case for function score. You can mention a function score function to increase boost for documents having expiry date larger than now. </p>&#xA;&#xA;<pre><code>{&#xA;  "query": {&#xA;    "function_score": {&#xA;      "filter": [&#xA;        {&#xA;          "filter": {&#xA;            "range": {&#xA;              "expires": {&#xA;                "gte": "now"&#xA;              }&#xA;            }&#xA;          },&#xA;          "boost": 1000&#xA;        }&#xA;      ],&#xA;      "score_mode": "sum",&#xA;      "boost_mode": "sum"&#xA;    }&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>You can read more about it <a href="https://www.elastic.co/guide/en/elasticsearch/reference/1.6/query-dsl-function-score-query.html" rel="nofollow">here</a> and <a href="http://blog.qbox.io/optimizing-search-results-in-elasticsearch-with-scoring-and-boosting" rel="nofollow">here</a>.</p>&#xA;