31352627
Elasticsearch how can I do online re-index without missing newly documents after scan & scoll?
<p>I don't want my elasticsearch to be taken offline while re-indexing (using scan and scoll api), so my strategy is re-indexing online and in the end check if the number of documents in the new index is not less than the old index. Note, I did a flush after re-index so document counts are correct.</p>&#xA;&#xA;<p>However, as I am re-indexing, new documents are added to the old index. So in the end of re-index, some documents are missing (which aren't actually missing, they were just added after the start of re-indexing).</p>&#xA;&#xA;<p>I don't dare to alias the new index to the official index name at the start of re-index. Because, in the case where there are actually documents missing, all newly added documents during re-index will be in the new index. I want the effect that if the new index fails, I can simply delete it without affecting the old index.</p>&#xA;&#xA;<p>This won't be a problem if I could either diff two indices or if I could retrieve all documents which were added after some checkpoint time.</p>&#xA;&#xA;<p>I saw a post at <a href="https://stackoverflow.com/questions/25856533/diff-indices-in-elasticsearch">Diff indices in ElasticSearch</a> which asks how to diff two indices but no answers to that.</p>&#xA;