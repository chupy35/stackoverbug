28445684
Why HTML tag is searchable even if it was filtered in elastic search
<p>I am new to elasticsearch and was testing html_strip filter. Ideally I should not be able to search on HTML tags. Following is steps.</p>&#xA;&#xA;<p>Index:</p>&#xA;&#xA;<pre><code>curl -XPOST 'localhost:9200/foo/test/_analyzer?tokenizer=standard&amp;char_filters=html_strip' -d '&#xA;{&#xA;    "content" : "&lt;title&gt;Dilip Kumar&lt;/title&gt;"&#xA;}'&#xA;</code></pre>&#xA;&#xA;<p>Search: </p>&#xA;&#xA;<pre><code>http://localhost:9200/foo/test/_search?tokenizer=standard&amp;char_filters=html_strip&amp;q=title&#xA;</code></pre>&#xA;&#xA;<p>Result: </p>&#xA;&#xA;<pre><code>{&#xA;  "took": 3,&#xA;  "timed_out": false,&#xA;  "_shards": {&#xA;    "total": 5,&#xA;    "successful": 5,&#xA;    "failed": 0&#xA;  },&#xA;  "hits": {&#xA;    "total": 1,&#xA;    "max_score": 0.2169777,&#xA;    "hits": [&#xA;      {&#xA;        "_index": "foo",&#xA;        "_type": "test",&#xA;        "_id": "_analyzer",&#xA;        "_score": 0.2169777,&#xA;        "_source": {&#xA;          "content": "&lt;title&gt;Dilip Kumar&lt;/title&gt;"&#xA;        }&#xA;      }&#xA;    ]&#xA;  }&#xA;}&#xA;</code></pre>&#xA;&#xA;<p><strong>UPDATE</strong>&#xA;As suggested; I used following mapping and repeated above steps after deleting the existing index however still I am able to search markup.</p>&#xA;&#xA;<pre><code>curl -XPUT "http://localhost:9200/foo " -d'&#xA;{&#xA;  "foo": {&#xA;    "settings": {&#xA;      "analysis": {&#xA;        "analyzer": {&#xA;          "html_analyzer": {&#xA;            "type": "custom",&#xA;            "tokenizer": "standard",&#xA;            "filter": [&#xA;              "standard",&#xA;              "lowercase",&#xA;              "stop",&#xA;              "asciifolding"&#xA;            ],&#xA;            "char_filter": [&#xA;              "html_strip"&#xA;            ]&#xA;          },&#xA;          "whitespace_analyzer": {&#xA;            "type": "custom",&#xA;            "tokenizer": "whitespace",&#xA;            "filter": [&#xA;              "standard",&#xA;              "lowercase",&#xA;              "stop",&#xA;              "asciifolding"&#xA;            ]&#xA;          }&#xA;        }&#xA;      }&#xA;    },&#xA;    "mappings": {&#xA;      "test": {&#xA;        "properties": {&#xA;          "content": {&#xA;            "type": "string",&#xA;            "index_analyzer": "html_analyzer",&#xA;            "search_analyzer": "whitespace_analyzer"&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}'&#xA;</code></pre>&#xA;
<p>You need to apply analyzer before indexing on the mapping. &#xA;This will make sure all documents that are indexed passes through this mapping and all the tags are stripped out before indexing.&#xA;In your case , you applied the analyzer while querying and this will only affect your search phrase and not the data you search.</p>&#xA;&#xA;<p>You can read more on creating mapping <a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/mapping.html" rel="nofollow">here</a></p>&#xA;&#xA;<p>I dont believe there is format like this - </p>&#xA;&#xA;<pre><code>http://localhost:9200/foo/test/_search?tokenizer=standard&amp;char_filters=html_strip&amp;q=title&#xA;</code></pre>&#xA;&#xA;<p>Rather if you can set the analyzer as follows , it should work fine - </p>&#xA;&#xA;<pre><code>curl -XPUT "http://localhost:9200/foo " -d'&#xA;{&#xA;  "foo": {&#xA;    "settings": {&#xA;      "analysis": {&#xA;        "analyzer": {&#xA;          "html_analyzer": {&#xA;            "type": "custom",&#xA;            "tokenizer": "standard",&#xA;            "filter": [&#xA;              "standard",&#xA;              "lowercase",&#xA;              "stop",&#xA;              "asciifolding"&#xA;            ],&#xA;            "char_filter": [&#xA;              "html_strip"&#xA;            ]&#xA;          },&#xA;          "whitespace_analyzer": {&#xA;            "type": "custom",&#xA;            "tokenizer": "whitespace",&#xA;            "filter": [&#xA;              "standard",&#xA;              "lowercase",&#xA;              "stop",&#xA;              "asciifolding"&#xA;            ]&#xA;          }&#xA;        }&#xA;      }&#xA;    },&#xA;    "mappings": {&#xA;      "test": {&#xA;        "properties": {&#xA;          "content": {&#xA;            "type": "string",&#xA;            "analyzer": "html_analyzer"&#xA;          }&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;}'&#xA;</code></pre>&#xA;&#xA;<p>Here i made the analyzer common for indexing and searching</p>&#xA;